/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={4680:(t,e,i)=>{const s=i(6844),r=i(8985);var n=console.assert.bind(console),o=function(t,e,i,s){var r;for(r=0;r<s;r++)e[r]=0;for(r=0;r<i;r++)e[t[r]]++},h=function(t,e,i,s){var r,n=0;if(s)for(r=0;r<i;r++)n+=t[r],e[r]=n;else for(r=0;r<i;r++)n+=t[r],e[r]=n-t[r]},a=function(t,e,i,s,l,c){var u,d,f,m,p,g,y,w,b,C,I,S,v,x=0,T=0;for(l<=256?(u=r.makeS32Buffer(l),l<=i?(d=e.subarray(s+i-l),T=1):(d=r.makeS32Buffer(l),T=3)):l<=i?(u=e.subarray(s+i-l),l<=i-l?(d=e.subarray(s+i-2*l),T=0):l<=1024?(d=r.makeS32Buffer(l),T=2):(d=u,T=8)):(u=d=r.makeS32Buffer(l),T=12),o(t,u,s,l),h(u,d,l,!0),m=0;m<s;m++)e[m]=0;g=-1,m=s-1,p=s,y=0,S=t[s-1];do{v=S}while(--m>=0&&(S=t[m])>=v);for(;m>=0;){do{v=S}while(--m>=0&&(S=t[m])<=v);if(m>=0){g>=0&&(e[g]=p),g=--d[v],p=m,++y;do{v=S}while(--m>=0&&(S=t[m])>=v)}}if(y>1?(function(t,e,i,s,r,a){var l,c,u,d,f;for(i===s&&o(t,i,r,a),h(i,s,a,!1),l=s[f=t[u=r-1]],u--,e[l++]=t[u]<f?~u:u,c=0;c<r;c++)(u=e[c])>0?(n(t[u]>=t[u+1]),(d=t[u])!==f&&(s[f]=l,l=s[f=d]),n(c<l),u--,e[l++]=t[u]<f?~u:u,e[c]=0):u<0&&(e[c]=~u);for(i===s&&o(t,i,r,a),h(i,s,a,1),c=r-1,l=s[f=0];c>=0;c--)(u=e[c])>0&&(n(t[u]<=t[u+1]),(d=t[u])!==f&&(s[f]=l,l=s[f=d]),n(l<=c),u--,e[--l]=t[u]>f?~(u+1):u,e[c]=0)}(t,e,u,d,s,l),C=function(t,e,i,s){var r,o,h,a,l,c,u,d,f,m;for(n(i>0),r=0;(h=e[r])<0;r++)e[r]=~h,n(r+1<i);if(r<s)for(o=r,r++;n(r<i),!((h=e[r])<0&&(e[o++]=~h,e[r]=0,o===s));r++);d=t[r=o=i-1];do{f=d}while(--r>=0&&(d=t[r])>=f);for(;r>=0;){do{f=d}while(--r>=0&&(d=t[r])<=f);if(r>=0){e[s+(r+1>>>1)]=o-r,o=r+1;do{f=d}while(--r>=0&&(d=t[r])>=f)}}for(r=0,u=0,a=i,c=0;r<s;r++){if(m=!0,(l=e[s+((h=e[r])>>>1)])===c&&a+l<i){for(o=0;o<l&&t[h+o]===t[a+o];)o++;o===l&&(m=!1)}m&&(u++,a=h,c=l),e[s+(h>>>1)]=u}return u}(t,e,s,y)):1===y?(e[g]=p+1,C=1):C=0,C<y){for(0!=(4&T)&&(u=null,d=null),0!=(2&T)&&(d=null),I=s+i-2*y,0==(13&T)&&(l+C<=I?I-=l:T|=8),n(s>>>1<=I+y),m=y+(s>>>1)-1,p=2*y+I-1;y<=m;m--)0!==e[m]&&(e[p--]=e[m]-1);f=e.subarray(y+I),a(f,e,I,y,C,!1),f=null,m=s-1,p=2*y-1,S=t[s-1];do{v=S}while(--m>=0&&(S=t[m])>=v);for(;m>=0;){do{v=S}while(--m>=0&&(S=t[m])<=v);if(m>=0){e[p--]=m+1;do{v=S}while(--m>=0&&(S=t[m])>=v)}}for(m=0;m<y;m++)e[m]=e[y+e[m]];0!=(4&T)&&(u=d=r.makeS32Buffer(l)),0!=(2&T)&&(d=r.makeS32Buffer(l))}if(0!=(8&T)&&o(t,u,s,l),y>1){h(u,d,l,!0),m=y-1,p=s,v=t[w=e[y-1]];do{for(b=d[S=v];b<p;)e[--p]=0;do{if(e[--p]=w,--m<0)break;w=e[m]}while((v=t[w])===S)}while(m>=0);for(;p>0;)e[--p]=0}return c?x=function(t,e,i,s,r,a){var l,c,u,d,f,m=-1;for(i===s&&o(t,i,r,a),h(i,s,a,!1),l=s[f=t[u=r-1]],e[l++]=u>0&&t[u-1]<f?~u:u,c=0;c<r;c++)(u=e[c])>0?(u--,n(t[u]>=t[u+1]),e[c]=~(d=t[u]),d!==f&&(s[f]=l,l=s[f=d]),n(c<l),e[l++]=u>0&&t[u-1]<f?~u:u):0!==u&&(e[c]=~u);for(i===s&&o(t,i,r,a),h(i,s,a,!0),c=r-1,l=s[f=0];c>=0;c--)(u=e[c])>0?(u--,n(t[u]<=t[u+1]),e[c]=d=t[u],d!==f&&(s[f]=l,l=s[f=d]),n(l<=c),e[--l]=u>0&&t[u-1]>f?~t[u-1]:u):0!==u?e[c]=~u:m=c;return m}(t,e,u,d,s,l):function(t,e,i,s,r,a){var l,c,u,d,f;for(i===s&&o(t,i,r,a),h(i,s,a,!1),l=s[f=t[u=r-1]],e[l++]=u>0&&t[u-1]<f?~u:u,c=0;c<r;c++)u=e[c],e[c]=~u,u>0&&(u--,n(t[u]>=t[u+1]),(d=t[u])!==f&&(s[f]=l,l=s[f=d]),n(c<l),e[l++]=u>0&&t[u-1]<f?~u:u);for(i===s&&o(t,i,r,a),h(i,s,a,!0),c=r-1,l=s[f=0];c>=0;c--)(u=e[c])>0?(u--,n(t[u]<=t[u+1]),(d=t[u])!==f&&(s[f]=l,l=s[f=d]),n(l<=c),e[--l]=0===u||t[u-1]>f?~u:u):e[c]=~u}(t,e,u,d,s,l),u=null,d=null,x},l=Object.create(null);l.suffixsort=function(t,e,i,s){if(n(t&&e&&t.length>=i&&e.length>=i),i<=1)return 1===i&&(e[0]=0),0;if(!s)if(1===t.BYTES_PER_ELEMENT)s=256;else{if(2!==t.BYTES_PER_ELEMENT)throw new Error("Need to specify alphabetSize");s=65536}return n(s>0),t.BYTES_PER_ELEMENT&&n(s<=1<<8*t.BYTES_PER_ELEMENT),a(t,e,0,i,s,!1)},l.bwtransform=function(t,e,i,s,r){var o,h;if(n(t&&e&&i),n(t.length>=s&&e.length>=s&&i.length>=s),s<=1)return 1===s&&(e[0]=t[0]),s;if(!r)if(1===t.BYTES_PER_ELEMENT)r=256;else{if(2!==t.BYTES_PER_ELEMENT)throw new Error("Need to specify alphabetSize");r=65536}for(n(r>0),t.BYTES_PER_ELEMENT&&n(r<=1<<8*t.BYTES_PER_ELEMENT),h=a(t,i,0,s,r,!0),e[0]=t[s-1],o=0;o<h;o++)e[o+1]=i[o];for(o+=1;o<s;o++)e[o]=i[o];return h+1},l.unbwtransform=function(t,e,i,s,n){var o,h,a=r.makeU32Buffer(256);for(o=0;o<256;o++)a[o]=0;for(o=0;o<s;o++)i[o]=a[t[o]]++;for(o=0,h=0;o<256;o++)h+=a[o],a[o]=h-a[o];for(o=s-1,h=0;o>=0;o--)h=i[h]+a[e[o]=t[h]],h+=h<n?1:0;a=null},l.bwtransform2=function(t,e,i,s){var o,h,l,c=0;if(n(t&&e),n(t.length>=i&&e.length>=i),i<=1)return 1===i&&(e[0]=t[0]),0;if(!s)if(1===t.BYTES_PER_ELEMENT)s=256;else{if(2!==t.BYTES_PER_ELEMENT)throw new Error("Need to specify alphabetSize");s=65536}if(n(s>0),t.BYTES_PER_ELEMENT&&n(s<=1<<8*t.BYTES_PER_ELEMENT),(l=t.length>=2*i?t:s<=256?r.makeU8Buffer(2*i):s<=65536?r.makeU16Buffer(2*i):r.makeU32Buffer(2*i))!==t)for(o=0;o<i;o++)l[o]=t[o];for(o=0;o<i;o++)l[i+o]=l[o];var u=r.makeS32Buffer(2*i);for(a(l,u,0,2*i,s,!1),o=0,h=0;o<2*i;o++){var d=u[o];d<i&&(0===d&&(c=h),--d<0&&(d=i-1),e[h++]=t[d])}return n(h===i),c},t.exports=s(l)},6702:(t,e,i)=>{i(6844);const s=i(1009),r=i(4680),n=i(2636),o=i(1221),h=i(7294),a=i(3482),l=i(7408),c=i(8985);s.EOF,BWTC=Object.create(null),BWTC.MAGIC="bwtc",BWTC.compressFile=c.compressFileHelper(BWTC.MAGIC,(function(t,e,i,s,u){var d=new l(e);d.encodeStart(u,1);var f=9;"number"==typeof s&&s>=1&&s<=9&&(f=s),d.encodeByte(f);var m=f<=5;f*=1e5;var p,g,y,w,b,C,I=c.makeU8Buffer(f),S=function(){var e;for(e=0;e<f;){var i=t.readByte();if(i<0)break;I[e++]=i}return e},v=c.makeU8Buffer(f),x=c.makeS32Buffer(f),T=c.makeU8Buffer(256),A=a.factory(d),k=new h(f,0,A,A);do{if(0===(p=S()))break;p===I.length?(d.encodeFreq(1,0,3),g=I):(d.encodeFreq(1,1,3),k.encode(p),g=I.subarray(0,p)),w=r.bwtransform(g,v,x,p,256),k.encode(w);var B=c.makeU16Buffer(512);for(b=0;b<p;b++)B[256+(y=v[b])]=1;for(b=255;b>0;b--)B[b]=B[2*b]+B[2*b+1];for(B[0]=1,b=1;b<512;b++){var L=b>>>1,M=1<<9-c.fls(b);if(0===B[L]||B[L]===2*M);else if(b>=256)d.encodeBit(B[b]);else{var E=B[b];E=0===E?0:E===M?2:1,d.encodeFreq(1,E,3)}}var _=0;for(b=0;b<256;b++)B[256+b]&&(T[_++]=b);for(B=null,b=0;b<p;b++){for(y=v[b],C=0;C<_&&T[C]!==y;C++);for(console.assert(C<_),v[b]=C;C>0;C--)T[C]=T[C-1];T[0]=y}var Y=new o(d,_+1,65280,256);m&&(Y=new n(d,_+1));var P=0,j=function(){for(;0!==P;)1&P?(Y.encode(0),P-=1):(Y.encode(1),P-=2),P>>>=1};for(b=0;b<p;b++)0===(y=v[b])?P++:(j(),Y.encode(y+1),P=0);j()}while(p===I.length);d.encodeFreq(1,2,3),d.encodeFinish()}),!0),BWTC.decompressFile=c.decompressFileHelper(BWTC.MAGIC,(function(t,e,i){var s=new l(t);s.decodeStart(!0);var u=s.decodeByte();console.assert(u>=1&&u<=9);var d=u<=5;u*=1e5;for(var f,m,p,g,y,w=c.makeU8Buffer(u),b=c.makeU8Buffer(u),C=c.makeS32Buffer(u),I=c.makeU8Buffer(256),S=a.factory(s),v=new h(u,0,S,S);;){var x=s.decodeCulFreq(3);if(s.decodeUpdate(1,x,3),0===x)m=u,f=w;else if(1===x)m=v.decode(),f=w.subarray(0,m);else if(2===x)break;var T=v.decode(),A=c.makeU16Buffer(512);for(A[0]=1,p=1;p<512;p++){var k=p>>>1,B=1<<9-c.fls(p);if(0===A[k]||A[k]===2*B)A[p]=A[k]>>>1;else if(p>=256)A[p]=s.decodeBit();else{var L=s.decodeCulFreq(3);s.decodeUpdate(1,L,3),A[p]=2===L?B:L}}var M=0;for(p=0;p<256;p++)A[256+p]&&(I[M++]=p);A=null;var E=new o(s,M+1,65280,256);d&&(E=new n(s,M+1,!0));var _=1;for(p=0;p<m;)if(0===(y=E.decode())){for(g=0;g<_;g++)f[p++]=0;_*=2}else if(1===y){for(g=0;g<_;g++)f[p++]=0,f[p++]=0;_*=2}else _=1,f[p++]=y-1;for(p=0;p<m;p++){for(g=f[p],f[p]=y=I[g];g>0;g--)I[g]=I[g-1];I[0]=y}r.unbwtransform(w,b,C,m,T),e.write(b,0,m)}s.decodeFinish()})),t.exports=BWTC},3941:(t,e,i)=>{const s=i(1009);var r=function(t){(function(){var e=256;this.readBit=function(){if(0==(255&e)){var i=t.readByte();if(i===s.EOF)return this._eof=!0,i;e=i<<1|1}var r=256&e?1:0;return e<<=1,r},this.seekBit=function(t){var e=t>>>3,i=t-8*e;this.seek(e),this._eof=!1,this.readBits(i)},this.tellBit=function(){for(var i=8*t.tell(),s=e;0!=(255&s);)i--,s<<=1;return i},this.readByte=function(){return 0==(255&e)?t.readByte():this.readBits(8)},this.seek=function(i){t.seek(i),e=256}}).call(this),function(){var e=1;this.writeBit=function(i){e<<=1,i&&(e|=1),256&e&&(t.writeByte(255&e),e=1)},this.writeByte=function(i){1===e?t.writeByte(i):t.writeBits(8,i)},this.flush=function(){for(;1!==e;)this.writeBit(0);t.flush&&t.flush()}}.call(this)};r.EOF=s.EOF,(r.prototype=Object.create(s.prototype)).readBits=function(t){var e,i=0;if(t>31)return(i=65536*this.readBits(t-16))+this.readBits(16);for(e=0;e<t;e++)i<<=1,this.readBit()>0&&i++;return i},r.prototype.writeBits=function(t,e){if(t>32){var i=65535&e,s=(e-i)/65536;return this.writeBits(t-16,s),void this.writeBits(16,i)}var r;for(r=t-1;r>=0;r--)this.writeBit(e>>>r&1)},t.exports=r},9316:(t,e,i)=>{i(6844);const s=i(3941),r=i(4680),n=i(4990),o=i(8006),h=i(1009),a=i(8985);var l=50,c=54156738319193,u=25779555029136,d=h.EOF,f=function(t,e){var i,s=t[e];for(i=e;i>0;i--)t[i]=t[i-1];return t[0]=s,s},m={OK:0,LAST_BLOCK:-1,NOT_BZIP_DATA:-2,UNEXPECTED_INPUT_EOF:-3,UNEXPECTED_OUTPUT_EOF:-4,DATA_ERROR:-5,OUT_OF_MEMORY:-6,OBSOLETE_INPUT:-7,END_OF_BLOCK:-8},p={};p[m.LAST_BLOCK]="Bad file checksum",p[m.NOT_BZIP_DATA]="Not bzip data",p[m.UNEXPECTED_INPUT_EOF]="Unexpected input EOF",p[m.UNEXPECTED_OUTPUT_EOF]="Unexpected output EOF",p[m.DATA_ERROR]="Data error",p[m.OUT_OF_MEMORY]="Out of memory",p[m.OBSOLETE_INPUT]="Obsolete (pre 0.9.5) bzip format not supported.";var g=function(t,e){var i=p[t]||"unknown error";e&&(i+=": "+e);var s=new TypeError(i);throw s.errorCode=t,s},y=function(t,e){this.writePos=this.writeCurrent=this.writeCount=0,this._start_bunzip(t,e)};y.prototype._init_block=function(){return this._get_next_block()?(this.blockCRC=new n,!0):(this.writeCount=-1,!1)},y.prototype._start_bunzip=function(t,e){var i=a.makeU8Buffer(4);4===t.read(i,0,4)&&"BZh"===String.fromCharCode(i[0],i[1],i[2])||g(m.NOT_BZIP_DATA,"bad magic");var r=i[3]-48;(r<1||r>9)&&g(m.NOT_BZIP_DATA,"level out of range"),this.reader=new s(t),this.dbufSize=1e5*r,this.nextoutput=0,this.outputStream=e,this.streamCRC=0},y.prototype._get_next_block=function(){var t,e,i,s=this.reader,r=s.readBits(48);if(r===u)return!1;r!==c&&g(m.NOT_BZIP_DATA),this.targetBlockCRC=s.readBits(32),this.streamCRC=(this.targetBlockCRC^(this.streamCRC<<1|this.streamCRC>>>31))>>>0,s.readBits(1)&&g(m.OBSOLETE_INPUT);var n=s.readBits(24);n>this.dbufSize&&g(m.DATA_ERROR,"initial position out of bounds");var o=s.readBits(16),h=a.makeU8Buffer(256),l=0;for(t=0;t<16;t++)if(o&1<<15-t){var d=16*t;for(i=s.readBits(16),e=0;e<16;e++)i&1<<15-e&&(h[l++]=d+e)}var p=s.readBits(3);(p<2||p>6)&&g(m.DATA_ERROR);var y=s.readBits(15);0===y&&g(m.DATA_ERROR);var w=a.makeU8Buffer(256);for(t=0;t<p;t++)w[t]=t;var b=a.makeU8Buffer(y);for(t=0;t<y;t++){for(e=0;s.readBits(1);e++)e>=p&&g(m.DATA_ERROR);b[t]=f(w,e)}var C,I=l+2,S=[];for(e=0;e<p;e++){var v,x,T=a.makeU8Buffer(I),A=a.makeU16Buffer(21);for(o=s.readBits(5),t=0;t<I;t++){for(;(o<1||o>20)&&g(m.DATA_ERROR),s.readBits(1);)s.readBits(1)?o--:o++;T[t]=o}for(v=x=T[0],t=1;t<I;t++)T[t]>x?x=T[t]:T[t]<v&&(v=T[t]);C={},S.push(C),C.permute=a.makeU16Buffer(258),C.limit=a.makeU32Buffer(22),C.base=a.makeU32Buffer(21),C.minLen=v,C.maxLen=x;var k=0;for(t=v;t<=x;t++)for(A[t]=C.limit[t]=0,o=0;o<I;o++)T[o]===t&&(C.permute[k++]=o);for(t=0;t<I;t++)A[T[t]]++;for(k=o=0,t=v;t<x;t++)k+=A[t],C.limit[t]=k-1,k<<=1,o+=A[t],C.base[t+1]=k-o;C.limit[x+1]=Number.MAX_VALUE,C.limit[x]=k+A[x]-1,C.base[v]=0}var B=a.makeU32Buffer(256);for(t=0;t<256;t++)w[t]=t;var L,M=0,E=0,_=0,Y=this.dbuf=a.makeU32Buffer(this.dbufSize);for(I=0;;){for(I--||(I=49,_>=y&&g(m.DATA_ERROR),C=S[b[_++]]),t=C.minLen,e=s.readBits(t);t>C.maxLen&&g(m.DATA_ERROR),!(e<=C.limit[t]);t++)e=e<<1|s.readBits(1);((e-=C.base[t])<0||e>=258)&&g(m.DATA_ERROR);var P=C.permute[e];if(0!==P&&1!==P){if(M)for(M=0,E+o>this.dbufSize&&g(m.DATA_ERROR),B[L=h[w[0]]]+=o;o--;)Y[E++]=L;if(P>l)break;E>=this.dbufSize&&g(m.DATA_ERROR),B[L=h[L=f(w,t=P-1)]]++,Y[E++]=L}else M||(M=1,o=0),o+=0===P?M:2*M,M<<=1}for((n<0||n>=E)&&g(m.DATA_ERROR),e=0,t=0;t<256;t++)i=e+B[t],B[t]=e,e=i;for(t=0;t<E;t++)Y[B[L=255&Y[t]]]|=t<<8,B[L]++;var j=0,D=0,X=0;return E&&(D=255&(j=Y[n]),j>>=8,X=-1),this.writePos=j,this.writeCurrent=D,this.writeCount=E,this.writeRun=X,!0},y.prototype._read_bunzip=function(t,e){var i,s,r;if(this.writeCount<0)return 0;for(var n=this.dbuf,o=this.writePos,h=this.writeCurrent,a=this.writeCount,l=(this.outputsize,this.writeRun);a;){for(a--,s=h,h=255&(o=n[o]),o>>=8,3==l++?(i=h,r=s,h=-1):(i=1,r=h),this.blockCRC.updateCRCRun(r,i);i--;)this.outputStream.writeByte(r),this.nextoutput++;h!=s&&(l=0)}return this.writeCount=a,this.blockCRC.getCRC()!==this.targetBlockCRC&&g(m.DATA_ERROR,"Bad block CRC (got "+this.blockCRC.getCRC().toString(16)+" expected "+this.targetBlockCRC.toString(16)+")"),this.nextoutput},y.Err=m,y.decode=function(t,e,i){for(var s=a.coerceInputStream(t),r=a.coerceOutputStream(e,e),n=r.stream,o=new y(s,n);!("eof"in s)||!s.eof();)if(o._init_block())o._read_bunzip();else{var h=o.reader.readBits(32);if(h!==o.streamCRC&&g(m.DATA_ERROR,"Bad stream CRC (got "+o.streamCRC.toString(16)+" expected "+h.toString(16)+")"),!i||!("eof"in s)||s.eof())break;o._start_bunzip(s,n)}return r.retval},y.decodeBlock=function(t,e,i){var s=a.coerceInputStream(t),r=a.coerceOutputStream(i,i),o=r.stream,h=new y(s,o);return h.reader.seekBit(e),h._get_next_block()&&(h.blockCRC=new n,h.writeCopies=0,h._read_bunzip()),r.retval},y.table=function(t,e,i){var s=new h;s.delegate=a.coerceInputStream(t),s.pos=0,s.readByte=function(){return this.pos++,this.delegate.readByte()},s.tell=function(){return this.pos},s.delegate.eof&&(s.eof=s.delegate.eof.bind(s.delegate));var r=new h;r.pos=0,r.writeByte=function(){this.pos++};for(var n=new y(s,r),o=n.dbufSize;!("eof"in s)||!s.eof();){var l=n.reader.tellBit();if(n._init_block()){var c=r.pos;n._read_bunzip(),e(l,r.pos-c)}else{if(n.reader.readBits(32),!i||!("eof"in s)||s.eof())break;n._start_bunzip(s,r),console.assert(n.dbufSize===o,"shouldn't change block size within multistream file")}}};var w=function(t,e){var i,s=[];for(i=0;i<e;i++)s[i]=t[i]<<9|i;s.sort((function(t,e){return t-e}));var r=s.map((function(t){return t>>>9}));for(o.allocateHuffmanCodeLengths(r,20),this.codeLengths=a.makeU8Buffer(e),i=0;i<e;i++){var n=511&s[i];this.codeLengths[n]=r[i]}};w.prototype.computeCanonical=function(){var t,e=this.codeLengths.length,i=[];for(t=0;t<e;t++)i[t]=this.codeLengths[t]<<9|t;i.sort((function(t,e){return t-e})),this.code=a.makeU32Buffer(e);var s=0,r=0;for(t=0;t<e;t++){var n=i[t]>>>9,o=511&i[t];console.assert(r<=n),s<<=n-r,this.code[o]=s++,r=n}},w.prototype.cost=function(t,e,i){var s,r=0;for(s=0;s<i;s++)r+=this.codeLengths[t[e+s]];return r},w.prototype.emit=function(t){var e,i=this.codeLengths[0];for(t.writeBits(5,i),e=0;e<this.codeLengths.length;e++){var s,r,n=this.codeLengths[e];for(console.assert(n>0&&n<=20),i<n?(s=2,r=n-i):(s=3,r=i-n);r-- >0;)t.writeBits(2,s);t.writeBit(0),i=n}},w.prototype.encode=function(t,e){t.writeBits(this.codeLengths[e],this.code[e])};var b=function(t,e,i,s){for(var r=0,n=-1,o=0;r<i&&!(4===o&&(e[r++]=0,r>=i));){var h=t.readByte();if(h===d)break;if(s.updateCRC(h),h!==n)n=h,o=1;else if(++o>4){if(o<256){e[r-1]++;continue}o=1}e[r++]=h}return r},C=function(t,e,i){var s,r,n;for(s=0,n=0;s<i.length;s+=l){var o=Math.min(l,i.length-s),h=0,a=e[0].cost(i,s,o);for(r=1;r<e.length;r++){var c=e[r].cost(i,s,o);c<a&&(h=r,a=c)}t[n++]=h}},I=function(t,e,i){var s,n,o,h,c=a.makeU8Buffer(e),u=r.bwtransform2(t,c,e,256);i.writeBit(0),i.writeBits(24,u);var d=[],m=[];for(n=0;n<e;n++)d[s=t[n]]=!0,m[s>>>4]=!0;for(n=0;n<16;n++)i.writeBit(!!m[n]);for(n=0;n<16;n++)if(m[n])for(o=0;o<16;o++)i.writeBit(!!d[n<<4|o]);var p=0;for(n=0;n<256;n++)d[n]&&p++;var g=a.makeU16Buffer(e+1),y=p+1,b=[];for(n=0;n<=y;n++)b[n]=0;var I=a.makeU8Buffer(p);for(n=0,o=0;n<256;n++)d[n]&&(I[o++]=n);d=null,m=null;var S=0,v=0,x=function(t){g[S++]=t,b[t]++},T=function(){for(;0!==v;)1&v?(x(0),v-=1):(x(1),v-=2),v>>>=1};for(n=0;n<c.length;n++){for(s=c[n],o=0;o<p&&I[o]!==s;o++);console.assert(o!==p),f(I,o),0===o?v++:(T(),x(o+1),v=0)}T(),x(y),g=g.subarray(0,S);var A,k=[];for(A=S>=2400?6:S>=1200?5:S>=600?4:S>=200?3:2,k.push(new w(b,y+1)),n=0;n<=y;n++)b[n]=1;k.push(new w(b,y+1)),b=null;var B=a.makeU8Buffer(Math.ceil(S/l));for(function(t,e,i,s,r){for(var n,o,h,a=[];t.length<e;){for(C(s,t,i),n=0;n<t.length;n++)a[n]=0;for(n=0;n<s.length;n++)a[s[n]]++;var c=a.indexOf(Math.max.apply(Math,a)),u=[];for(n=0,o=0;n<s.length;n++)if(s[n]===c){var d=n*l,f=Math.min(d+l,i.length);u.push({index:n,cost:t[c].cost(i,d,f-d)})}for(u.sort((function(t,e){return t.cost-e.cost})),n=u.length>>>1;n<u.length;n++)s[u[n].index]=t.length;t.push(null);var m,p=[];for(n=0;n<t.length;n++)for(m=p[n]=[],o=0;o<r;o++)m[o]=0;for(n=0,o=0;n<i.length;)for(m=p[s[o++]],h=0;h<l&&n<i.length;h++)m[i[n++]]++;for(n=0;n<t.length;n++)t[n]=new w(p[n],r)}}(k,A,g,B,y+1),C(B,k,g),console.assert(k.length>=2&&k.length<=6),i.writeBits(3,k.length),i.writeBits(15,B.length),n=0;n<k.length;n++)I[n]=n;for(n=0;n<B.length;n++){var L=B[n];for(o=0;o<k.length&&I[o]!==L;o++);for(console.assert(o<k.length),f(I,o);o>0;o--)i.writeBit(1);i.writeBit(0)}for(n=0;n<k.length;n++)k[n].emit(i),k[n].computeCanonical();for(n=0,h=0;n<S;){var M=k[B[h++]];for(o=0;o<l&&n<S;o++)M.encode(i,g[n++])}},S=Object.create(null);S.compressFile=function(t,e,i){t=a.coerceInputStream(t);var r=a.coerceOutputStream(e,e);e=new s(r.stream);var o=9;if("number"==typeof i&&(o=i),o<1||o>9)throw new Error("Invalid block size multiplier");var h=1e5*o;h-=19,e.writeByte("B".charCodeAt(0)),e.writeByte("Z".charCodeAt(0)),e.writeByte("h".charCodeAt(0)),e.writeByte("0".charCodeAt(0)+o);var l,d=a.makeU8Buffer(h),f=0;do{var m=new n;(l=b(t,d,h,m))>0&&(f=((f<<1|f>>>31)^m.getCRC())>>>0,e.writeBits(48,c),e.writeBits(32,m.getCRC()),I(d,l,e))}while(l===h);return e.writeBits(48,u),e.writeBits(32,f),e.flush(),r.retval},S.decompressFile=y.decode,S.decompressBlock=y.decodeBlock,S.table=y.table,t.exports=S},4990:(t,e,i)=>{const s=i(8985);var r=s.arraycopy(s.makeU32Buffer(256),[0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188]);t.exports=function(){var t=4294967295;this.getCRC=function(){return~t>>>0},this.updateCRC=function(e){t=t<<8^r[255&(t>>>24^e)]},this.updateCRCRun=function(e,i){for(;i-- >0;)t=t<<8^r[255&(t>>>24^e)]}}},4818:(t,e,i)=>{const s=i(3941),r=i(9881),n=i(8985);var o=function(t,e,i){var s;for(this.literalModel=[],s=0;s<e;s++)this.literalModel[s]=t(i)};o.prototype.encode=function(t,e){this.literalModel[e].encode(t)},o.prototype.decode=function(t){return this.literalModel[t].decode()},o.MAGIC="ctx1",o.compressFile=n.compressFileHelper(o.MAGIC,(function(t,e,i,h){var a=new s(e),l=256;i<0&&l++;var c=r.factory(a,8191),u=new o(c,256,l),d=32,f={encode:function(t){u.encode(t,d),d=t}};n.compressWithModel(t,i,f),a.flush()})),o.decompressFile=n.decompressFileHelper(o.MAGIC,(function(t,e,i){var h=new s(t),a=256;i<0&&a++;var l=r.factory(h,8191),c=new o(l,256,a),u=32,d={decode:function(){var t=c.decode(u);return u=t,t}};n.decompressWithModel(e,i,d)})),t.exports=o},2636:(t,e,i)=>{const s=i(7408),r=(i(1009),i(8985));var n=256,o=function(t,e,i){var s;console.assert(e<300);var o=this.numSyms=e;for(this.coder=t,this.prob=r.makeU16Buffer(e+2),this.escape=r.makeU16Buffer(e+1),this.update=r.makeU16Buffer(e+1),this.prob[o+1]=n,s=0;s<=this.numSyms;s++)this.escape[s]=s;if(this.updateCount=0,this.updateThresh=n-Math.floor(128),i){for(this.probToSym=r.makeU16Buffer(n),this.escProbToSym=r.makeU16Buffer(this.numSyms),s=0;s<n;s++)this.probToSym[s]=o;for(s=0;s<this.numSyms;s++)this.escProbToSym[s]=s}};o.factory=function(t,e){return function(i){return new o(t,i,e)}},o.prototype._update=function(t,e){if(t===this.numSyms){if(this.update[t]>=40)return;if(this.updateCount>=this.updateThresh-1)return}if(this.update[t]++,this.updateCount++,!(this.updateCount<this.updateThresh)){var i,s,r,o,h,a;for(this.escape[0]=this.prob[0]=i=s=r=0,o=0;o<this.numSyms+1;o++){var l=(this.prob[o+1]-this.prob[o]>>>1)+this.update[o];l?(this.prob[o]=i,i+=l,1&l&&r++,this.escape[o]=s):(this.prob[o]=i,this.escape[o]=s,s++)}for(this.prob[o]=i,console.assert(i===n),this.updateThresh=n-Math.floor((i-r)/2),o=0;o<this.numSyms+1;o++)this.update[o]=0;if(this.update[this.numSyms]=1,this.updateCount=1,e)for(o=0,h=0,a=0;o<this.numSyms+1;o++){for(var c=this.prob[o+1];h<c;h++)this.probToSym[h]=o;for(var u=this.escape[o+1];a<u;a++)this.escProbToSym[a]=o}}},o.prototype.encode=function(t){var e=this.prob[t],i=this.prob[t+1]-e;if(console.assert(this.prob[this.numSyms+1]===n),i)return this.coder.encodeShift(i,e,8),this._update(t);console.assert(t!==this.numSyms),this.encode(this.numSyms),e=this.escape[t],i=this.escape[t+1]-e;var s=this.escape[this.numSyms];return this.coder.encodeFreq(i,e,s),this._update(t)},o.prototype.decode=function(){var t=this.coder.decodeCulShift(8),e=this.probToSym[t],i=this.prob[e],s=this.prob[e+1]-i;if(this.coder.decodeUpdate(s,i,n),this._update(e,!0),e!==this.numSyms)return e;var r=this.escape[this.numSyms];return t=this.coder.decodeCulFreq(r),e=this.escProbToSym[t],i=this.escape[e],s=this.escape[e+1]-i,this.coder.decodeUpdate(s,i,r),this._update(e,!0),e},o.MAGIC="dfsm",o.compressFile=r.compressFileHelper(o.MAGIC,(function(t,e,i,n,h){var a=new s(e);a.encodeStart(h,1);var l=new o(a,i<0?257:256);r.compressWithModel(t,i,l),a.encodeFinish()}),!0),o.decompressFile=r.decompressFileHelper(o.MAGIC,(function(t,e,i){var n=new s(t);n.decodeStart(!0);var h=new o(n,i<0?257:256,!0);r.decompressWithModel(e,i,h),n.decodeFinish()})),t.exports=o},8118:(t,e,i)=>{const s=i(3727),r=i(7408),n=i(1009),o=i(8985);var h=Object.create(null);h.MAGIC="dmc!";var a=function(t,e,i){this.out=[],this.model=i?i.clone():new s(t,e,65280,256),this.count=o.makeU16Buffer(e),this.sum=0};a.prototype.clone=function(t,e){var i,s=new a(t,e,null);for(i=0;i<e;i++)s.out[i]=this.out[i];return s};var l=function(t,e,i,s){var r,n;for(this.coder=t,this.size=e,this.MIN_CNT1=i||8,this.MIN_CNT2=s||128,this.nodes=[],r=0;r<e;r++)this.nodes[r]=new a(t,e);for(r=0;r<e;r++)for(n=0;n<e;n++)this.nodes[r].out[n]=this.nodes[n];this.current=this.nodes[0]};l.prototype.maybeSplit=function(t,e,i){var s,r=t.count[e],n=i.sum;if(r<=this.MIN_CNT1||n-r<=this.MIN_CNT2)return i;var o=i.clone(this.coder,this.size);for(this.nodes.push(o),t.out[e]=o,o.sum=i.sum=0,s=0;s<this.size;s++)o.count[s]=i.count[s]*r/n,o.sum+=o.count[s],i.count[s]-=o.count[s],i.sum+=i.count[s];return o},l.prototype.encode=function(t){var e=this.current;e.model.encode(t);var i=e.out[t];65535!==e.count[t]&&(e.count[t]++,e.sum++),this.current=this.maybeSplit(e,t,i)},l.prototype.decode=function(){var t=this.current,e=t.model.decode(),i=t.out[e];return 65535!==t.count[e]&&(t.count[e]++,t.sum++),this.current=this.maybeSplit(t,e,i),e},h.compressFile=o.compressFileHelper(h.MAGIC,(function(t,e,i,s){var h=+(s=s||{}).m||8,a=+s.n||128;o.writeUnsignedNumber(e,h),o.writeUnsignedNumber(e,a);var c=new r(e);c.encodeStart(202,0);for(var u=new l(c,i<0?257:256,h,a),d=0;d!==i;){var f=t.readByte();if(f===n.EOF){u.encode(256);break}u.encode(f),d++}c.encodeFinish()})),h.decompressFile=o.decompressFileHelper(h.MAGIC,(function(t,e,i){var s=o.readUnsignedNumber(t),n=o.readUnsignedNumber(t),h=new r(t);h.decodeStart();for(var a=new l(h,i<0?257:256,s,n),c=0;c!==i;){var u=a.decode();if(256===u)break;e.writeByte(u),c++}h.decodeFinish()})),t.exports=h},1221:(t,e,i)=>{const s=i(7408),r=(i(1009),i(8985));var n=65535,o=4294901760,h=16,a=4294901758,l=function(t,e,i,s){var n;for(this.coder=t,this.numSyms=e+1,this.tree=r.makeU32Buffer(2*this.numSyms),this.increment=+s||256,this.max_prob=+i||65280,console.assert(this.max_prob+(this.increment-1)<=65535),console.assert(e<=65535),n=0;n<e;n++)this.tree[this.numSyms+n]=1;this.tree[this.numSyms+n]=0|this.increment<<h,this._sumTree()};l.factory=function(t,e,i){return function(s){return new l(t,s,e,i)}},l.prototype.clone=function(){var t,e=new l(this.coder,this.size,this.max_prob,this.increment);for(t=1;t<this.tree.length;t++)e.tree[t]=this.tree[t];return e},l.prototype.encode=function(t){var e=this.numSyms+t,i=this.tree[e],s=o,r=h,a=this.increment<<h;0==(i&o)?(this.encode(this.numSyms-1),s=n,a-=1,r=0):t===this.numSyms-1&&(this.tree[1]&n)>>>0==1&&(a=-this.tree[e]);for(var l=0;e>1;){var c=e>>>1;1&e&&(l+=this.tree[2*c]),this.tree[e]+=a,e=c}var u=this.tree[1];this.tree[1]+=a,i=(i&s)>>>r,l=(l&s)>>>r,u=(u&s)>>>r,this.coder.encodeFreq(i,l,u),(this.tree[1]&o)>>>h>=this.max_prob&&this._rescale()},l.prototype._decode=function(t){var e=o,i=h,s=this.increment<<h;t&&(e=n,s-=1,i=0);for(var r=(this.tree[1]&e)>>>i,a=this.coder.decodeCulFreq(r),l=1,c=0;l<this.numSyms;){this.tree[l]+=s;var u=(this.tree[2*l]&e)>>>i;l*=2,a-c>=u&&(c+=u,l++)}var d=l-this.numSyms,f=(this.tree[l]&e)>>>i;if(this.tree[l]+=s,this.coder.decodeUpdate(f,c,r),d===this.numSyms-1&&(this.tree[1]&n)>>>0==1)for(s=-this.tree[l];l>=1;)this.tree[l]+=s,l>>>=1;return(this.tree[1]&o)>>>h>=this.max_prob&&this._rescale(),d},l.prototype.decode=function(){var t=this._decode(!1);return t===this.numSyms-1&&(t=this._decode(!0)),t},l.prototype._rescale=function(){var t,e,i=!0;for(t=0;t<this.numSyms-1;t++)0==((e=this.tree[this.numSyms+t])&n)?(0==(e=(e&a)>>>1)&&(e=1,i=!1),this.tree[this.numSyms+t]=e):i=!1;e=((e=this.tree[this.numSyms+t])&a)>>>1,i?e=0:0===e&&(e=65536),this.tree[this.numSyms+t]=e,this._sumTree()},l.prototype._sumTree=function(){var t;for(t=this.numSyms-1;t>0;t--)this.tree[t]=this.tree[2*t]+this.tree[2*t+1]},l.MAGIC="fenw",l.compressFile=r.compressFileHelper(l.MAGIC,(function(t,e,i,n,o){var h=new s(e);h.encodeStart(o,1);var a=new l(h,i<0?257:256);r.compressWithModel(t,i,a),h.encodeFinish()}),!0),l.decompressFile=r.decompressFileHelper(l.MAGIC,(function(t,e,i){var n=new s(t);n.decodeStart(!0);var o=new l(n,i<0?257:256);r.decompressWithModel(e,i,o),n.decodeFinish()})),t.exports=l},9881:(t,e,i)=>{const s=i(3941),r=i(8985);var n=function(t,e,i,s){this.up=t,this.down=e,this.symbol=i,this.weight=s};n.prototype.clone=function(){return new n(this.up,this.down,this.symbol,this.weight)},n.prototype.set=function(t){this.up=t.up,this.down=t.down,this.symbol=t.symbol,this.weight=t.weight};var o=function(t,e,i,s){var r;for(console.assert(t&&"number"==typeof t),(!e||e>t)&&(e=t),(e<<=1)&&e--,this.table=[],r=0;r<=e;r++)this.table[r]=new n(0,0,0,0);if(this.map=[],this.size=t)for(r=0;r<t;r++)this.map[r]=0;this.esc=this.root=e,i&&(this.readBit=i.readBit.bind(i),this.writeBit=i.writeBit.bind(i)),this.max_weight=s};o.factory=function(t,e){return function(i){return new o(i,i,t,e)}},o.prototype.split=function(t){var e,i;return(e=this.esc)?(this.esc--,(i=this.esc)?(this.table[e].down=i,this.table[e].weight=1,this.table[i].up=e,this.esc--):(e=0,i=1),this.table[i].symbol=t,this.table[i].weight=0,this.table[i].down=0,this.map[t]=i,this.table[this.esc].weight=0,this.table[this.esc].down=0,this.table[this.esc].up=e,i):(console.assert(!1),0)},o.prototype.leader=function(t){for(var e,i,s=this.table[t].weight,r=t;s===this.table[r+1].weight;)r++;return r===t?t:(i=this.table[t].symbol,e=this.table[r].symbol,this.table[r].symbol=i,this.table[t].symbol=e,this.map[i]=r,this.map[e]=t,r)},o.prototype.slide=function(t){var e,i=t;if(1&(e=this.table[i++].clone()).weight)for(;e.weight>this.table[i+1].weight;)i++;return this.table[t].set(this.table[i]),this.table[i].set(e),this.table[i].up=this.table[t].up,this.table[t].up=e.up,1&e.weight?(this.table[e.down].up=i,this.table[e.down-1].up=i,this.map[this.table[t].symbol]=t):(this.table[this.table[t].down-1].up=t,this.table[this.table[t].down].up=t,this.map[e.symbol]=i),i},o.prototype.increment=function(t){var e;for(this.table[t].up===t+1?(this.table[t].weight+=2,t++):t=this.leader(t);this.table[t].weight+=2,e=this.table[t].up;){for(;this.table[t].weight>this.table[t+1].weight;)t=this.slide(t);t=1&this.table[t].weight?e:this.table[t].up}this.max_weight&&this.table[this.root].weight>=this.max_weight&&this.scale(1)},o.prototype.scale=function(t){for(var e,i,s=this.esc;++s<=this.root;)for(1&this.table[s].weight?(e=-2&this.table[this.table[s].down].weight)&&(e+=1|this.table[this.table[s].down-1].weight):(e=this.table[s].weight>>t&-2)||(this.map[this.table[s].symbol]=0,this.esc++&&this.esc++),this.table[s].weight=e,i=s;e<this.table[--i].weight;)this.slide(i);this.table[this.esc].down=0},o.prototype.sendid=function(t){for(var e,i=0;t--;)this.map[t]||i++;if(e=this.size-Math.floor((this.root-this.esc)/2)-1)do{this.writeBit(1&i),i>>=1}while(e>>=1)},o.prototype.encode=function(t){var e,i,s,r,n=1;if(t<this.size){if((s=r=this.map[t])||(s=this.esc)){for(;i=this.table[s].up;)n<<=1,n|=1&s,s=i;for(;e=1&n,n>>=1;)this.writeBit(e);r||(this.sendid(t),r=this.split(t)),this.increment(r)}}else console.assert(!1)},o.prototype.readid=function(){var t,e,i=0,s=1;if(t=this.size-Math.floor((this.root-this.esc)/2)-1)do{i|=this.readBit()?s:0,s<<=1}while(t>>=1);for(e=0;e<this.size;e++)if(!this.map[e]&&!i--)return e;return console.assert(!1),0},o.prototype.decode=function(){for(var t,e,i=this.root;e=this.table[i].down;)i=this.readBit()?e-1:e;if(i===this.esc){if(!this.esc)return console.assert(!1),0;t=this.readid(),i=this.split(t)}else t=this.table[i].symbol;return this.increment(i),t},o.MAGIC="huff",o.compressFile=r.compressFileHelper(o.MAGIC,(function(t,e,i,n){var h=new s(e),a=256;i<0&&a++;var l=new o(257,a,h,8191);r.compressWithModel(t,i,l),h.flush()})),o.decompressFile=r.decompressFileHelper(o.MAGIC,(function(t,e,i){var n=new s(t),h=256;i<0&&h++;var a=new o(257,h,n,8191);r.decompressWithModel(e,i,a)})),t.exports=o},8006:(t,e,i)=>{const s=i(6844),r=i(8985);var n=function(t,e,i){for(var s=t.length,r=e,n=t.length-2;e>=i&&t[e]%s>r;)n=e,e-=r-e+1;for(e=Math.max(i-1,e);n>e+1;){var o=e+n>>1;t[o]%s>r?n=o:e=o}return n};t.exports=s({allocateHuffmanCodeLengths:function(t,e){switch(t.length){case 2:t[1]=1;case 1:return void(t[0]=1)}!function(t){var e,i,s,r,n=t.length;for(t[0]+=t[1],e=0,i=1,s=2;i<n-1;i++)s>=n||t[e]<t[s]?(r=t[e],t[e++]=i):r=t[s++],s>=n||e<i&&t[e]<t[s]?(r+=t[e],t[e++]=i+n):r+=t[s++],t[i]=r}(t);var i=function(t,e){var i,s=t.length-2;for(i=1;i<e-1&&s>1;i++)s=n(t,s-1,0);return s}(t,e);t[0]%t.length>=i?function(t){var e,i,s,r,o=t.length-2,h=t.length-1;for(e=1,i=2;i>0;e++){for(r=i-((s=o)-(o=n(t,s-1,0)));r>0;r--)t[h--]=e;i=s-o<<1}}(t):function(t,e,i){var s,r,o,h,a=t.length-2,l=t.length-1,c=1==i?2:1,u=1==i?e-2:e;for(s=c<<1;s>0;c++){for(r=a,a=a<=e?a:n(t,r-1,e),o=0,c>=i?o=Math.min(u,1<<c-i):c==i-1&&(o=1,t[a]==r&&a++),h=s-(r-a+o);h>0;h--)t[l--]=c;u-=o,s=r-a+o<<1}}(t,i,e-r.fls(i-1))}})},7294:(t,e,i)=>{const s=i(8985);var r=function(t,e,i,r){var n,o=s.fls(t-1);for(this.extraStates=+e||0,this.lgDistanceModel=i(1+o+e),this.distanceModel=[],n=2;n<=o;n++){var h=n-1;this.distanceModel[n]=r(1<<h)}};r.prototype.encode=function(t){if(t<2)this.lgDistanceModel.encode(t+this.extraStates);else{var e=s.fls(t);console.assert(t&1<<e-1),console.assert(e>=2),this.lgDistanceModel.encode(e+this.extraStates);var i=t&(1<<e-1)-1;this.distanceModel[e].encode(i)}},r.prototype.decode=function(){var t=this.lgDistanceModel.decode()-this.extraStates;return t<2?t:(1<<t-1)+this.distanceModel[t].decode()},t.exports=r},3054:(t,e,i)=>{const s=i(1009),r=i(8985);var n=Object.create(null);n.MAGIC="lzjb";var o=1023,h=s.EOF;n.compressFile=r.compressFileHelper(n.MAGIC,(function(t,e,i,s){var n,a,l,c,u,d,f,m=1024,p=1;"number"==typeof s&&(m*=2,s=Math.max(1,Math.min(9,s))-1,p=1<<Math.floor(s/2),1&s&&(p=Math.round(1.5*p)),s>=2&&s<=4&&p++),d=r.makeU16Buffer(m*p);for(var g=r.makeU8Buffer(1024),y=0,w=function(t){return g[y++]=t,y>=g.length&&(y=0),t},b=r.makeU8Buffer(17),C=0,I=function(){var t;for(t=0;t<C;t++)e.writeByte(b[t]);C=0},S=[],v=function(){return S.length?S.pop():t.readByte()},x=function(t){S.push(t)},T=128,A=[];;){var k=v();if(k===h)break;256==(T<<=1)&&(I(),T=1,b[0]=0,C=1);var B=v();if(B===h){b[C++]=w(k);break}var L=v();if(L!==h){for(c=(k<<16)+(B<<8)+L,c^=c>>9,c+=c>>5,u=((c^=k)&m-1)*p,A.length=0,f=0;f<p;f++){l=y-d[u+f]&o,n=g.length+y-l;var M=g[n&o],E=g[n+1&o],_=g[n+2&o];0===l?M=1^k:1==l?(E=k,_=B):2==l&&(_=k),k===M&&B===E&&L===_&&A.push(l)}for(f=p-1;f>0;f--)d[u+f]=d[u+f-1];if(d[u]=y,0===A.length)b[C++]=w(k),x(L),x(B);else{b[0]|=T,w(k),w(B),w(L);var Y=v(),P=A[0],j=g.length+y;for(a=3;a<66&&Y!==h;a++,j++){for(f=0;f<A.length;)Y!==g[j-A[f]&o]?(P=A[f],A.splice(f,1)):f++;if(0===A.length)break;w(Y),Y=v()}0!==A.length&&(P=A[0]),x(Y),b[C++]=a-3<<2|P>>8,b[C++]=255&P}}else b[C++]=w(k),x(B)}I()})),n.decompressFile=r.decompressFileHelper(n.MAGIC,(function(t,e,i){for(var s,n,a,l,c=r.makeU8Buffer(1024),u=0,d=128;0!==i&&(l=t.readByte())!==h;)if(256==(d<<=1)&&(d=1,n=l,l=t.readByte()),n&d)for(a=3+(l>>2),(s=u-((l<<8|t.readByte())&o))<0&&(s+=c.length),i>=0&&(i-=a);--a>=0;)l=c[u++]=c[s++],e.writeByte(l),u>=c.length&&(u=0),s>=c.length&&(s=0);else e.writeByte(l),c[u++]=l,u>=c.length&&(u=0),i>=0&&i--})),t.exports=n},1542:(t,e,i)=>{const s=i(4818),r=i(1221),n=i(7294),o=i(3482),h=i(7408),a=i(1009),l=i(8985);var c=Object.create(null);c.MAGIC="lzjR";var u=1023;c.compressFile=l.compressFileHelper(c.MAGIC,(function(t,e,i,c,d){var f,m,p,g,y,w,b,C=1024,I=1;"number"==typeof c&&(C*=2,c=Math.max(1,Math.min(9,c))-1,I=1<<Math.floor(c/2),1&c&&(I=Math.round(1.5*I)),c>=2&&c<=4&&I++);var S=new h(e);S.encodeStart(d,1),w=l.makeU16Buffer(C*I);for(var v=l.makeU8Buffer(1024),x=0,T=function(t){return v[x++]=t,x>=v.length&&(x=0),t},A=[],k=function(){return A.length?A.pop():t.readByte()},B=function(t){A.push(t)},L=[],M=o.factory(S),E=r.factory(S,65280,256),_=new s(E,256,1+(i<0?257:256)),Y=function(t){return t<=32?E(t):M(t)},P=new n(64,0,E,Y),j=new n(1024,1,E,Y),D=32,X=0;;){var O=x,R=k();if(R===a.EOF)break;var U=k();if(U===a.EOF){_.encode(T(R),D);break}var N=k();if(N!==a.EOF){for(g=(R<<16)+(U<<8)+N,g^=g>>9,g+=g>>5,y=((g^=R)&C-1)*I,L.length=0,b=0;b<I;b++){p=x-w[y+b]&u,f=v.length+x-p;var F=v[f&u],H=v[f+1&u],W=v[f+2&u];1==p?(H=R,W=U):2==p&&(W=R),R===F&&U===H&&N===W&&L.push(p)}for(b=I-1;b>0;b--)w[y+b]=w[y+b-1];if(w[y]=x,0===L.length)_.encode(T(R),D),B(N),B(U),D=R;else{_.encode(256,D),T(R),T(U),T(N),D=N;var V=k(),Z=L[0],G=v.length+x;for(m=3;m<66&&V!==a.EOF;m++,G++){for(b=0;b<L.length;)V!==v[G-L[b]&u]?(Z=L[b],L.splice(b,1)):b++;if(0===L.length)break;T(V),D=V,V=k()}0!==L.length&&(Z=L[0]),B(V),P.encode(m-3),(p=O-Z&u)===X?j.encode(-1):(j.encode(p),X=p)}}else _.encode(T(R),D),B(U),D=R}i<0&&_.encode(257,D),S.encodeFinish()}),!0),c.decompressFile=l.decompressFileHelper(c.MAGIC,(function(t,e,i){var a,c,u,d=l.makeU8Buffer(1024),f=0,m=new h(t);m.decodeStart(!0);for(var p=o.factory(m),g=r.factory(m,65280,256),y=new s(g,256,1+(i<0?257:256)),w=function(t){return t<=32?g(t):p(t)},b=new n(64,0,g,w),C=new n(1024,1,g,w),I=32,S=0;0!==i&&257!==(u=y.decode(I));)if(256===u)for(c=b.decode()+3,(a=C.decode())<0?a=S:S=a,i>=0&&(i-=c);--c>=0;)u=I=d[f++]=d[a++],e.writeByte(u),f>=d.length&&(f=0),a>=d.length&&(a=0);else e.writeByte(u),d[f++]=I=u,f>=d.length&&(f=0),i>=0&&i--;m.decodeFinish()})),t.exports=c},8425:(t,e,i)=>{const s=i(3941),r=i(4818),n=(i(2636),i(1221)),o=i(9881),h=i(7294),a=i(3482),l=i(7408),c=i(1009),u=i(8985);var d=Object.create(null);d.MAGIC="lzp3";var f=1<<20,m=65535,p=function(t){this.buffer=u.makeU8Buffer(Math.min(t+4,f)),this.pos=0,this.ctxt4=u.makeU32Buffer(65536),this.ctxt3=u.makeU32Buffer(4096),this.ctxt2=u.makeU32Buffer(65536),this.put(99),this.put(83),this.put(97),this.put(32)};p.prototype.put=function(t){return this.buffer[this.pos++]=t,this.pos>=f&&(this.pos=0),t},p.prototype.get=function(t){return this.buffer[1048575&t]},p.prototype.context=function(t,e){var i,s=0;for(t=t-e&1048575,i=0;i<e;i++)s=s<<8|this.buffer[t++],t>=f&&(t=0);return s},p.prototype.getIndex=function(t,e){var i=this.context(t,4),s=65535&(i>>>15^i),r=4095&(i>>>11^i),n=i&m,o=0;return 0===e&&(0!==(o=this.ctxt4[s])&&i!==this.context(o-1,4)&&(o=0),0===o&&(0!==(o=this.ctxt3[r])&&(16777215&i)!==this.context(o-1,3)&&(o=0),0===o&&0!==(o=this.ctxt2[n])&&(i&&m)!==this.context(o-1,2)&&(o=0))),e&&e--,this.ctxt4[s]=this.ctxt3[r]=this.ctxt2[n]=1+(t|e<<20),o},d.compressFile=u.compressFileHelper(d.MAGIC,(function(t,e,i,s){var o,u,d,m=new p(i>=0?i:f),g=new l(e);g.encodeStart(0,0),o=n.factory(g,65280,256);var y=a.factory(g);u=function(t){return t>256?y(t):o(t)},d=function(){g.encodeFinish()};var w,b=new r(o,256,i<0?257:256),C=[];for(w=0;w<16;w++)C[w]=new h(1048576,1,o,u);for(var I,S=0,v=0;S!==i;){var x=t.readByte();I=m.pos;var T=m.getIndex(I,0);if(0!==T){for(var A=1+(--T>>>20),k=0;m.get(T+k)===x&&k<1048575;)k++,m.put(x),x=t.readByte();A===k?C[15&v].encode(-1):C[15&v].encode(k),m.getIndex(I,k),S+=k,v<<=1,k>0&&(v|=1)}var B=m.get(m.pos-1);if(x===c.EOF){i<0&&b.encode(256,B);break}b.encode(x,B),m.put(x),S++}d&&d()})),d.decompressFile=u.decompressFileHelper(d.MAGIC,(function(t,e,i){var c,u,d,g=!!(128&t.readByte()),y=new p(i>=0?i:f);if(g){var w=new s(t);c=o.factory(w,m),u=a.factory(w)}else{var b=new l(t);b.decodeStart(!0),c=n.factory(b,65280,256);var C=a.factory(b);u=function(t){return t>256?C(t):c(t)},d=function(){b.decodeFinish()}}var I,S=new r(c,256,i<0?257:256),v=[];for(I=0;I<16;I++)v[I]=new h(1048576,1,c,u);for(var x,T,A=0,k=0;A!==i;){x=y.pos;var B=y.getIndex(x,0);if(0!==B){var L=1+(--B>>>20),M=v[15&k].decode();for(M<0&&(M=L),I=0;I<M;I++)T=y.get(B+I),e.writeByte(y.put(T));y.getIndex(x,M),A+=M,k<<=1,M>0&&(k|=1)}if(A===i)break;var E=y.get(y.pos-1);if(256===(T=S.decode(E)))break;e.writeByte(y.put(T)),A++}d&&d()})),t.exports=d},3727:(t,e,i)=>{const s=i(7408),r=(i(1009),i(8985));var n=function(t,e){return t-e},o=function(t,e,i,s,n){this.coder=t,this.increment=+s||256,this.max_prob=+i||65280,console.assert(this.max_prob+(this.increment-1)<=65535),this.sym=r.makeU16Buffer(e+1),this.prob=r.makeU16Buffer(e+2),this.sym[0]=e,this.prob[0]=0,this.seenSyms=1,this.prob[this.seenSyms]=this.increment,this.numSyms=e,n&&(this.sortedSeen=[e])};o.factory=function(t,e,i,s){return function(r){return new o(t,r,e,i,s)}},o.prototype.clone=function(){var t,e=new o(this.coder,this.numSyms,this.max_prob,this.increment,!!this.sortedSeen);for(t=0;t<this.seenSyms;t++)e.sym[t]=this.sym[t],e.prob[t]=this.prob[t];return e.prob[t]=this.prob[t],e.seenSyms=this.seenSyms,this.sortedSeen&&(e.sortedSeen=this.sortedSeen.slice(0)),e},o.prototype._update=function(t,e,i){var s,r;for(s=e;s<this.seenSyms-1;s++)this.sym[s]=this.sym[s+1],this.prob[s]=this.prob[s+1]-i;e<this.seenSyms?(this.sym[s]=t,this.prob[s]=this.prob[s+1]-i,this.prob[this.seenSyms]=r=this.prob[this.seenSyms]+this.increment,t===this.numSyms&&this.seenSyms>=this.numSyms&&(r=this.prob[--this.seenSyms],this.sortedSeen&&this.sortedSeen.length--)):(r=this.prob[this.seenSyms],this.sym[e]=t,this.prob[e]=r,r+=this.increment,this.prob[++this.seenSyms]=r,this.sortedSeen&&(this.sortedSeen.push(t),this.sortedSeen.sort(n))),r>=this.max_prob&&this._rescale()},o.prototype._rescale=function(){var t,e,i=0,s=!0;for(this.sortedSeen&&(this.sortedSeen.length=0),t=0,e=0;t<this.seenSyms;t++){var r=this.sym[t],o=this.prob[t+1]-this.prob[t];(o>>>=1)>0&&(r===this.numSyms&&(s=!1),this.sym[e]=r,this.prob[e++]=i,i+=o,this.sortedSeen&&this.sortedSeen.push(r))}this.prob[e]=i,this.seenSyms=e,this.sortedSeen&&this.sortedSeen.sort(n),s&&this.seenSyms<this.numSyms&&this._update(this.numSyms,this.seenSyms)},o.prototype.decode=function(){var t,e=this.prob[this.seenSyms],i=this.coder.decodeCulFreq(e);for(t=this.seenSyms-1;t>=0&&!(this.prob[t]<=i);t--);console.assert(t>=0);var s=this.sym[t],r=this.prob[t],n=this.prob[t+1]-r;if(this.coder.decodeUpdate(n,r,e),this._update(s,t,n),s===this.numSyms){if(n=1,e=this.numSyms,this.sortedSeen){var o=this.sortedSeen;for(e=this.numSyms-this.seenSyms,o[o.length-1]===this.numSyms&&e++,s=r=this.coder.decodeCulFreq(e),t=0;t<o.length&&o[t]<=s;t++)s++}else s=r=this.coder.decodeCulFreq(e);this.coder.decodeUpdate(n,r,e),this._update(s,this.seenSyms)}return s},o.prototype.encode=function(t){var e,i,s,r;for(e=this.seenSyms-1;e>=0;e--)if(t===this.sym[e])return s=this.prob[e],i=this.prob[e+1]-s,r=this.prob[this.seenSyms],this.coder.encodeFreq(i,s,r),this._update(t,e,i);if(console.assert(t!==this.numSyms),this.encode(this.numSyms),i=1,s=t,r=this.numSyms,this.sortedSeen){var n=this.sortedSeen;for(r-=this.seenSyms,n[n.length-1]===this.numSyms&&r++,e=0;e<n.length&&n[e]<t;e++)s--}return this.coder.encodeFreq(i,s,r),this._update(t,this.seenSyms)},o.MAGIC="mtfm",o.compressFile=r.compressFileHelper(o.MAGIC,(function(t,e,i,n,h){var a=new s(e);a.encodeStart(h,1);var l=new o(a,i<0?257:256);r.compressWithModel(t,i,l),a.encodeFinish()}),!0),o.decompressFile=r.decompressFileHelper(o.MAGIC,(function(t,e,i){var n=new s(t);n.decodeStart(!0);var h=new o(n,i<0?257:256);r.decompressWithModel(e,i,h),n.decodeFinish()})),t.exports=o},3482:(t,e,i)=>{const s=i(3941),r=i(8985);var n=function(t,e){this.bitstream=t,this.bits=r.fls(e-1)};n.factory=function(t){return function(e){return new n(t,e)}},n.prototype.encode=function(t){var e;for(e=this.bits-1;e>=0;e--){var i=t>>>e&1;this.bitstream.writeBit(i)}},n.prototype.decode=function(){var t,e=0;for(t=this.bits-1;t>=0;t--)e<<=1,this.bitstream.readBit()&&e++;return e},n.MAGIC="nomo",n.compressFile=r.compressFileHelper(n.MAGIC,(function(t,e,i,o){var h=new s(e),a=new n(h,i<0?257:256);r.compressWithModel(t,i,a),h.flush()})),n.decompressFile=r.decompressFileHelper(n.MAGIC,(function(t,e,i){var o=new s(t),h=new n(o,i<0?257:256);r.decompressWithModel(e,i,h)})),t.exports=n},1536:(t,e,i)=>{const s=i(7408),r=i(8985);var n=1<<18,o=function(){this.buffer=r.makeU8Buffer(n),this.pos=0,this.firstPass=!0;for(var t=0;t<5;t++)this.put("cSaCsA".charCodeAt(t%6))};o.prototype.put=function(t){return this.buffer[this.pos++]=t,this.pos>=n&&(this.pos=0,this.firstPass=!1),t},o.prototype.get=function(t){return this.buffer[262143&t]},o.prototype.context=function(t,e){var i,s=[];for(t=t-e&262143,i=0;i<e;i++)s.push(this.buffer[t++]),t>=n&&(t=0);return String.fromCharCode.apply(String,s)};var h=function(t,e){this.window=new o,this.contexts=Object.create(null);var i=function(){};i.prototype.encode=function(i,s){var r,n=0;for(r=0;r<i;r++)s[r]||n++;var o=e-s.total;t.encodeFreq(1,n,o)},i.prototype.decode=function(i){var s,r,n,o=e-i.total;for(r=n=t.decodeCulFreq(o),s=0;s<=r;s++)i[s]&&r++;return t.decodeUpdate(1,n,o),r},this.cm1coder=new i;var s=function(){this.sym=[e],this.prob=[0,256],this.refcount=0};s.prototype._rescale=function(){var t,i,s=this.sym.length,r=0,n=!0;for(t=0,i=0;t<s;t++){var o=this.sym[t],h=this.prob[t+1]-this.prob[t];(h>>>=1)>0&&(o===e&&(n=!1),this.sym[i]=o,this.prob[i++]=r,r+=h)}return this.prob[i]=r,s=this.sym.length=i,this.prob.length=s+1,n&&s<e&&(r=this._update(e,s,0,1)),r},s.prototype.update=function(t,e){var i=0;for(i=0;i<this.sym.length;i++)if(this.sym[i]===t)return this._update(t,i,this.prob[i+1]-this.prob[i],e);return this._update(t,i,0,e)},s.prototype._update=function(t,i,s,r){var n,o,h,a=this.sym.length;for(o=i;o<a-1;o++)this.sym[o]=this.sym[o+1],this.prob[o]=this.prob[o+1]-s;if(i<a)this.sym[o]=t,this.prob[o]=this.prob[o+1]-s,this.prob[a]=h=this.prob[a]+r;else if(h=this.prob[a],this.sym[i]=t,this.prob[i]=h,h+=r,this.prob[++a]=h,this.sym.length>e)for(n=0;n<a;n++)e===this.sym[n]&&(this._update(e,n,this.prob[n+1]-this.prob[n],-1),this.sym.length--,this.prob.length--,h=this.prob[this.prob.length-1]);return h>=65280&&(h=this._rescale()),h},s.prototype.encode=function(i,s){var r,n,o,h,a,l,c=this.sym.length,u=0,d=0,f=0;for(r=c-1;r>=0;r--){if(h=this.prob[r],o=this.prob[r+1]-h,i===this.sym[r]){for(n=r-1;n>=0&&u<s.total;n--)s[this.sym[n]]&&(u+=1,d+=l=this.prob[n+1]-this.prob[n],f+=l);return a=this.prob[c],h-=d,a-=f,t.encodeFreq(o,h,a),i!==e||(this._update(i,r,o,128),!1)}s[this.sym[r]]&&(u+=1,f+=o)}for(this.encode(e,s),console.assert(this.sym[this.sym.length-1]===e),r=0;r<this.sym.length-1;r++)s[this.sym[r]]||(s[this.sym[r]]=!0,s.total++)},s.prototype.decode=function(i){var s,r,n=this.sym.length,o=this.prob[n],h=0,a=0,l=0;for(r=n-1;r>=0&&h<i.total;r--)i[this.sym[r]]&&(h+=1,l+=this.prob[r+1]-this.prob[r]);var c=t.decodeCulFreq(o-l)+l;for(a=l,r=n-1;r>=0;r--)if(i[this.sym[r]])a-=s=this.prob[r+1]-this.prob[r],c-=s;else if(this.prob[r]<=c)break;console.assert(r>=0);var u=this.sym[r],d=this.prob[r],f=this.prob[r+1]-d;if(t.decodeUpdate(f,d-a,o-l),u<e)return u;for(this._update(u,r,f,128),console.assert(this.sym[this.sym.length-1]===e),r=0;r<this.sym.length-1;r++)i[this.sym[r]]||(i[this.sym[r]]=!0,i.total++);return-1},this.newContext=function(t){return new s},this.newExclude=function(){var t=Object.create(null);return t.total=0,t},function(){var t,e;for(t=0;t<5;t++)for(e=0;e<=t;e++){var i=this.window.context(e+(4-t),e);this.contexts[i]||(this.contexts[i]=this.newContext()),this.contexts[i].refcount++}}.call(this)};h.prototype.update=function(t,e,i){var s,r,n;for(r=0;r<=5;r++)n=e.slice(5-r),(s=this.contexts[n])||(s=this.contexts[n]=this.newContext()),r>=i&&s.update(t,128),s.refcount++;e=this.window.context(this.window.pos+5,5);var o=this.window.firstPass;for(r=5;r>=0&&!o;r--)n=e.slice(0,r),s=this.contexts[n],console.assert(s),--s.refcount<=0&&(console.assert(""!==n),delete this.contexts[n]);this.window.put(t)},h.prototype.decode=function(){var t,e,i,s,r=this.window.context(this.window.pos,5),n=this.newExclude();for(e=5;e>=0;e--)if(i=r.slice(5-e),(t=this.contexts[i])&&(s=t.decode(n))>=0)return this.update(s,r,e),s;return s=this.cm1coder.decode(n),this.update(s,r,e),s},h.prototype.encode=function(t){var e,i=this.window.context(this.window.pos,5),s=this.newExclude();for(e=5;e>=0;e--){var r=i.slice(5-e),n=this.contexts[r];if(n&&n.encode(t,s))return void this.update(t,i,e)}this.cm1coder.encode(t,s),this.update(t,i,e)},h.MAGIC="ppm2",h.compressFile=r.compressFileHelper(h.MAGIC,(function(t,e,i,n,o){var a=new s(e);a.encodeStart(o,1);var l=new h(a,i<0?257:256);r.compressWithModel(t,i,l),a.encodeFinish()}),!0),h.decompressFile=r.decompressFileHelper(h.MAGIC,(function(t,e,i){var n=new s(t);n.decodeStart(!0);var o=new h(n,i<0?257:256);r.decompressWithModel(e,i,o),n.decodeFinish()})),t.exports=h},7408:t=>{var e=Math.pow(2,31),i=e>>>8,s=Math.pow(2,32)-1,r=function(t){this.low=0,this.range=e,this.buffer=0,this.help=0,this.bytecount=0,this.stream=t},n=function(t,r){for(;t.range<=i;){if(t.low<255<<23){for(r.writeByte(t.buffer);t.help;t.help--)r.writeByte(255);t.buffer=t.low>>>23&255}else if(t.low&e){for(r.writeByte(t.buffer+1);t.help;t.help--)r.writeByte(0);t.buffer=t.low>>>23&255}else if(t.help++,t.help>s)throw new Error("Too many bytes outstanding, file too large!");t.range=t.range<<8>>>0,t.low=(t.low<<8&e-1)>>>0,t.bytecount++}};r.prototype.encodeStart=function(t,i){this.low=0,this.range=e,this.buffer=t,this.help=0,this.bytecount=i},r.prototype.encodeFreq=function(t,e,i){n(this,this.stream);var s=this.range/i>>>0,r=s*e;this.low+=r,e+t<i?this.range=s*t:this.range-=r},r.prototype.encodeShift=function(t,e,i){n(this,this.stream);var s=this.range>>>i,r=s*e;this.low+=r,e+t>>>i?this.range-=r:this.range=s*t},r.prototype.encodeBit=function(t){this.encodeShift(1,t?1:0,1)},r.prototype.encodeByte=function(t){this.encodeShift(1,t,8)},r.prototype.encodeShort=function(t){this.encodeShift(1,t,16)},r.prototype.encodeFinish=function(){var t=this.stream;n(this,t),this.bytecount+=5;var e=this.low>>>23;if((this.low&i-1)>=(16777215&this.bytecount)>>>1&&e++,e>255)for(t.writeByte(this.buffer+1);this.help;this.help--)t.writeByte(0);else for(t.writeByte(this.buffer);this.help;this.help--)t.writeByte(255);return t.writeByte(255&e),t.writeByte(this.bytecount>>>16&255),t.writeByte(this.bytecount>>>8&255),t.writeByte(255&this.bytecount),this.bytecount},r.prototype.decodeStart=function(t){var e=t?0:this.stream.readByte();return"number"!=typeof e||e<0||(this.buffer=this.stream.readByte(),this.low=this.buffer>>>1,this.range=128),e};var o=function(t,e){for(;t.range<=i;)t.low=t.low<<8|t.buffer<<7&255,t.buffer=e.readByte(),t.low|=t.buffer>>>1,t.low=t.low>>>0,t.range=t.range<<8>>>0};r.prototype.decodeCulFreq=function(t){o(this,this.stream),this.help=this.range/t>>>0;var e=this.low/this.help>>>0;return e>=t?t-1:e},r.prototype.decodeCulShift=function(t){o(this,this.stream),this.help=this.range>>>t;var e=this.low/this.help>>>0;return e>>>t?(1<<t)-1:e},r.prototype.decodeUpdate=function(t,e,i){var s=this.help*e;this.low-=s,e+t<i?this.range=this.help*t:this.range-=s},r.prototype.decodeBit=function(){var t=this.decodeCulShift(1);return this.decodeUpdate(1,t,2),t},r.prototype.decodeByte=function(){var t=this.decodeCulShift(8);return this.decodeUpdate(1,t,256),t},r.prototype.decodeShort=function(){var t=this.decodeCulShift(16);return this.decodeUpdate(1,t,65536),t},r.prototype.decodeFinish=function(){o(this,this.stream)},r.prototype.writeBit=r.prototype.encodeBit,r.prototype.readBit=r.prototype.decodeBit,r.prototype.writeByte=r.prototype.encodeByte,r.prototype.readByte=r.prototype.decodeByte,t.exports=r},5535:(t,e,i)=>{const s=i(7408),r=i(1009),n=i(8985);var o=1<<17,h=Object.create(null);h.MAGIC="smpl",h.compressFile=n.compressFileHelper(h.MAGIC,(function(t,e,i,h,a){var l=new s(e);l.encodeStart(a,1);for(var c=n.makeU8Buffer(o),u=[],d=0,f=!1,m=function(){var e=0;for(e=0;e<256;e++)u[e]=0;if(f)d=0;else{for(e=0;e<o;){var i=t.readByte();if(i===r.EOF){f=!0;break}if(c[e++]=i,u[i]++,65535===u[i])break}d=e}};;){var p;if(m(),f&&0===d)break;for(l.encodeBit(!0),p=0;p<256;p++)l.encodeShort(u[p]);for(u[256]=d,p=256;p;p--)u[p-1]=u[p]-u[p-1];for(p=0;p<d;p++){var g=c[p];l.encodeFreq(u[g+1]-u[g],u[g],u[256])}}l.encodeBit(!1),l.encodeFinish()}),!0),h.decompressFile=n.decompressFileHelper(h.MAGIC,(function(t,e,i){var r=new s(t);for(r.decodeStart(!0);r.decodeBit();){var n,o=[];for(n=0;n<256;n++)o[n]=r.decodeShort();var h=0;for(n=0;n<256;n++){var a=o[n];o[n]=h,h+=a}for(o[256]=h,n=0;n<h;n++){var l,c=r.decodeCulFreq(h);for(l=0;l<256&&!(o[l]<=c&&c<o[l+1]);l++);r.decodeUpdate(o[l+1]-o[l],o[l],h),e.writeByte(l)}}r.decodeFinish()})),t.exports=h},1009:(t,e,i)=>{const s=i(6844);var r=function(){};r.prototype.readByte=function(){var t=[0];return 0===this.read(t,0,1)?(this._eof=!0,-1):t[0]},r.prototype.read=function(t,e,i){for(var s,r=0;r<i;){if(-1===(s=this.readByte())){this._eof=!0;break}t[e+r++]=s}return r},r.prototype.eof=function(){return!!this._eof},r.prototype.seek=function(t){throw new Error("Stream is not seekable.")},r.prototype.tell=function(){throw new Error("Stream is not seekable.")},r.prototype.writeByte=function(t){var e=[t];this.write(e,0,1)},r.prototype.write=function(t,e,i){var s;for(s=0;s<i;s++)this.writeByte(t[e+s]);return i},r.prototype.flush=function(){},r.EOF=-1,t.exports=s(r)},8985:(t,e,i)=>{const s=i(6844),r=i(1009);var n=Object.create(null),o=r.EOF;n.coerceInputStream=function(t,e){if("readByte"in t){if(e&&!("read"in t)){var i=t;(t=new r).readByte=function(){var t=i.readByte();return t===o&&(this._eof=!0),t},"size"in i&&(t.size=i.size),"seek"in i&&(t.seek=function(t){i.seek(t),this._eof=!1}),"tell"in i&&(t.tell=i.tell.bind(i))}}else{var s=t;(t=new r).size=s.length,t.pos=0,t.readByte=function(){return this.pos>=this.size?o:s[this.pos++]},t.read=function(t,e,i){for(var r=0;r<i&&this.pos<s.length;)t[e++]=s[this.pos++],r++;return r},t.seek=function(t){this.pos=t},t.tell=function(){return this.pos},t.eof=function(){return this.pos>=s.length}}return t};var h=function(t,e){this.buffer=t,this.resizeOk=e,this.pos=0};(h.prototype=Object.create(r.prototype)).writeByte=function(t){if(this.resizeOk&&this.pos>=this.buffer.length){var e=n.makeU8Buffer(2*this.buffer.length);e.set(this.buffer),this.buffer=e}this.buffer[this.pos++]=t},h.prototype.getBuffer=function(){if(this.pos!==this.buffer.length){if(!this.resizeOk)throw new TypeError("outputsize does not match decoded input");var t=n.makeU8Buffer(this.pos);t.set(this.buffer.subarray(0,this.pos)),this.buffer=t}return this.buffer},n.coerceOutputStream=function(t,e){var i={stream:t,retval:t};if(t){if("object"==typeof t&&"writeByte"in t)return i;"number"==typeof e?(console.assert(e>=0),i.stream=new h(n.makeU8Buffer(e),!1)):i.stream=new h(t,!1)}else i.stream=new h(n.makeU8Buffer(16384),!0);return Object.defineProperty(i,"retval",{get:i.stream.getBuffer.bind(i.stream)}),i},n.compressFileHelper=function(t,e,i){return function(s,r,o){s=n.coerceInputStream(s);var h,a,l=n.coerceOutputStream(r,r);for(r=l.stream,h=0;h<t.length;h++)r.writeByte(t.charCodeAt(h));if(a="size"in s&&s.size>=0?s.size:-1,i){var c=n.coerceOutputStream([]);for(n.writeUnsignedNumber(c.stream,a+1),c=c.retval,h=0;h<c.length-1;h++)r.writeByte(c[h]);i=c[c.length-1]}else n.writeUnsignedNumber(r,a+1);return e(s,r,a,o,i),l.retval}},n.decompressFileHelper=function(t,e){return function(i,s){var r;for(i=n.coerceInputStream(i),r=0;r<t.length;r++)if(t.charCodeAt(r)!==i.readByte())throw new Error("Bad magic");var o=n.readUnsignedNumber(i)-1,h=n.coerceOutputStream(s,o);return s=h.stream,e(i,s,o),h.retval}},n.compressWithModel=function(t,e,i){for(var s=0;s!==e;){var r=t.readByte();if(r===o){i.encode(256);break}i.encode(r),s++}},n.decompressWithModel=function(t,e,i){for(var s=0;s!==e;){var r=i.decode();if(256===r)break;t.writeByte(r),s++}},n.writeUnsignedNumber=function(t,e){console.assert(e>=0);var i,s=[];do{s.push(127&e),e=Math.floor(e/128)}while(0!==e);for(s[0]|=128,i=s.length-1;i>=0;i--)t.writeByte(s[i]);return t},n.readUnsignedNumber=function(t){for(var e,i=0;;){if(128&(e=t.readByte())){i+=127&e;break}i=128*(i+e)}return i};var a=function(t){for(var e=0,i=t.length;e<i;e++)t[e]=0;return t},l=function(t){return a(new Array(t))},c=function(t){return t};"undefined"!=typeof process&&Array.prototype.some.call(new Uint32Array(128),(function(t){return 0!==t}))&&(c=a),n.makeU8Buffer="undefined"!=typeof Uint8Array?function(t){return c(new Uint8Array(t))}:"undefined"!=typeof Buffer?function(t){var e=new Buffer(t);return e.fill(0),e}:l,n.makeU16Buffer="undefined"!=typeof Uint16Array?function(t){return c(new Uint16Array(t))}:l,n.makeU32Buffer="undefined"!=typeof Uint32Array?function(t){return c(new Uint32Array(t))}:l,n.makeS32Buffer="undefined"!=typeof Int32Array?function(t){return c(new Int32Array(t))}:l,n.arraycopy=function(t,e){console.assert(t.length>=e.length);for(var i=0,s=e.length;i<s;i++)t[i]=e[i];return t};var u=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8];console.assert(256===u.length);var d=n.fls=function(t){return console.assert(t>=0),t>4294967295?32+d(Math.floor(t/4294967296)):0!=(4294901760&t)?0!=(4278190080&t)?24+u[t>>>24&255]:16+u[t>>>16]:0!=(65280&t)?8+u[t>>>8]:u[t]};n.log2c=function(t){return 0===t?-1:d(t-1)},t.exports=s(n)},6844:t=>{"use strict";Object.freeze?t.exports=Object.freeze:t.exports=function(t){return t}},1072:(t,e,i)=>{const s=i(6844),r=i(3941),n=i(1009),o=i(4680),h=i(4818),a=i(2636),l=i(1221),c=i(3727),u=i(3482),d=i(9881),f=i(7408),m=i(6702),p=i(9316),g=i(8118),y=i(3054),w=i(1542),b=i(8425),C=i(1536),I=i(5535);t.exports=s({version:"1.2.0",BitStream:r,Stream:n,BWT:o,Context1Model:h,DefSumModel:a,FenwickModel:l,MTFModel:c,NoModel:u,Huffman:d,RangeCoder:f,BWTC:m,Bzip2:p,Dmc:g,Lzjb:y,LzjbR:w,Lzp3:b,PPM:C,Simple:I})},9875:(t,e,i)=>{"use strict";i.r(e),i.d(e,{alaw:()=>s,mulaw:()=>r});var s={};i.r(s),i.d(s,{decode:()=>l,decodeSample:()=>h,encode:()=>a,encodeSample:()=>o});var r={};i.r(r),i.d(r,{decode:()=>y,decodeSample:()=>p,encode:()=>g,encodeSample:()=>m});const n=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];function o(t){let e,i=~(t=-32768==t?-32767:t)>>8&128;if(i||(t*=-1),t>32635&&(t=32635),t>=256){let i=n[t>>8&127];e=i<<4|t>>i+3&15}else e=t>>4;return 85^e^i}function h(t){let e=0;128&(t^=85)&&(t&=-129,e=-1);let i=4+((240&t)>>4),s=0;return s=4!=i?1<<i|(15&t)<<i-4|1<<i-5:t<<1|1,s=0===e?s:-s,8*s*-1}function a(t){let e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=o(t[i]);return e}function l(t){let e=new Int16Array(t.length);for(let i=0;i<t.length;i++)e[i]=h(t[i]);return e}const c=132,u=32635,d=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],f=[0,132,396,924,1980,4092,8316,16764];function m(t){let e,i,s,r;return e=t>>8&128,0!=e&&(t=-t),(t+=c)>u&&(t=u),i=d[t>>7&255],s=t>>i+3&15,r=~(e|i<<4|s),r}function p(t){let e,i,s,r;return e=128&(t=~t),i=t>>4&7,s=15&t,r=f[i]+(s<<i+3),0!=e&&(r=-r),r}function g(t){let e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=m(t[i]);return e}function y(t){let e=new Int16Array(t.length);for(let i=0;i<t.length;i++)e[i]=p(t[i]);return e}},4202:(t,e,i)=>{const s=i(8764).lW,{Bzip2:r}=i(1072),n=s.from("BZh1".split("").map((t=>t.charCodeAt(0))));t.exports.decompress=function(t,e,i,o,h){const a=s.from(i.slice(h,o+h)),l=r.decompressFile(s.concat([n,a]));t.set(l)}},7910:t=>{t.exports=class{constructor(t){this.buffer=t,this.offset=0}putByte(t){this.buffer[this.offset++]=t}putInt(t){this.buffer[this.offset++]=t>>24,this.buffer[this.offset++]=t>>16,this.buffer[this.offset++]=t>>8,this.buffer[this.offset++]=t}putString(t){for(let e=0;e<t.length;e++)this.buffer[this.offset++]=t.charCodeAt(e);this.buffer[this.offset++]=10}putBytes(t,e,i){for(let s=e;s<i;s++)this.buffer[this.offset++]=t[s]}getUnsignedByte(){return 255&this.buffer[this.offset++]}getUnsignedShort(){return this.offset+=2,((255&this.buffer[this.offset-2])<<8)+(255&this.buffer[this.offset-1])}getUnsignedInt(){return this.offset+=4,((255&this.buffer[this.offset-4])<<24)+((255&this.buffer[this.offset-3])<<16)+((255&this.buffer[this.offset-2])<<8)+(255&this.buffer[this.offset-1])}getBytes(t,e,i){for(let s=e;s<i;s++)t[e+s]=this.buffer[this.offset++]}}},6451:(t,e,i)=>{const s=i(3720);t.exports=class{constructor(){this.hash=new s,this.name=null,this.serverIndex=0,this.serverId=0,this.currentX=0,this.currentY=0,this.npcId=0,this.stepCount=0,this.animationCurrent=0,this.animationNext=0,this.movingStep=0,this.waypointCurrent=0,this.message=null,this.messageTimeout=0,this.bubbleItem=0,this.bubbleTimeout=0,this.damageTaken=0,this.healthCurrent=0,this.healthMax=0,this.combatTimer=0,this.colourHair=0,this.colourTop=0,this.colourBottom=0,this.colourSkin=0,this.incomingProjectileSprite=0,this.attackingPlayerServerIndex=0,this.attackingNpcServerIndex=0,this.projectileRange=0,this.skullVisible=0,this.waypointsX=new Int32Array(10),this.waypointsY=new Int32Array(10),this.equippedItem=new Int32Array(12),this.level=-1}}},5575:(t,e,i)=>{const s=i(3241),r=i(8107),n=i(1531),o=i(3720),h=i(9222),a=i(6848),l=i(8576),c=i(5583);class u extends n{constructor(t){super(t),this.friendListCount=0,this.ignoreListCount=0,this.settingsBlockChat=0,this.settingsBlockPrivate=0,this.settingsBlockTrade=0,this.settingsBlockDuel=0,this.sessionID=new o(0),this.worldFullTimeout=0,this.moderatorLevel=0,this.autoLoginTimeout=0,this.packetLastRead=0,this.messageIndex=0,this.server="127.0.0.1",this.port=43594,this.username="",this.password="",this.incomingPacket=new Int8Array(5e3),this.friendListOnline=new Int32Array(200),this.friendListHashes=[];for(let t=0;t<200;t+=1)this.friendListHashes.push(new o(0));this.ignoreList=[];for(let t=0;t<u.maxSocialListSize;t+=1)this.ignoreList.push(new o(0));this.messageTokens=new Int32Array(u.maxSocialListSize)}async register(t,e){if(this.worldFullTimeout>0)return this.showLoginScreenStatus("Please wait...","Connecting to server"),await c(2e3),void this.showLoginScreenStatus("Sorry! The server is currently full.","Please try again later");try{t=a.formatAuthString(t,20),e=a.formatAuthString(e,20),this.showLoginScreenStatus("Please wait...","Connecting to server"),this.packetStream=new h(await this.createSocket(this.server,this.port),this);const i=a.usernameToHash(t);this.packetStream.newPacket(l.SESSION),this.packetStream.putByte(i.shiftRight(16).and(31).toInt()),this.packetStream.flushPacket();const s=await this.packetStream.getLong();if(this.sessionID=s,s.equals(0))return void this.showLoginScreenStatus("Login server offline.","Please try again in a few mins");console.log("Verb: Session id: "+s),this.packetStream.newPacket(l.REGISTER),this.packetStream.putShort(u.clientVersion),this.packetStream.putString(t),this.packetStream.putString(e),this.packetStream.flushPacket();const r=await this.packetStream.readStream();switch(this.packetStream.closeStream(),console.log("Newplayer response: "+r),r){case 2:return void this.resetLoginVars();case 13:case 3:return void this.showLoginScreenStatus("Username already taken.","Please choose another username");case 4:return void this.showLoginScreenStatus("That username is already in use.","Wait 60 seconds then retry");case 5:return void this.showLoginScreenStatus("The client has been updated.","Please reload this page");case 6:return void this.showLoginScreenStatus("You may only use 1 character at once.","Your ip-address is already in use");case 7:return void this.showLoginScreenStatus("Login attempts exceeded!","Please try again in 5 minutes");case 11:return void this.showLoginScreenStatus("Account has been temporarily disabled","for cheating or abuse");case 12:return void this.showLoginScreenStatus("Account has been permanently disabled","for cheating or abuse");case 14:return this.showLoginScreenStatus("Sorry! The server is currently full.","Please try again later"),void(this.worldFullTimeout=1500);case 15:return void this.showLoginScreenStatus("You need a members account","to login to this server");case 16:return void this.showLoginScreenStatus("Please login to a members server","to access member-only features");default:return void this.showLoginScreenStatus("Error unable to create username.","Unrecognised response code")}}catch(t){console.error(t),this.showLoginScreenStatus("Error unable to create user.","Unrecognised response code")}}async login(t,e,i){if(this.worldFullTimeout>0)return this.showLoginScreenStatus("Please wait...","Connecting to server"),await c(2e3),void this.showLoginScreenStatus("Sorry! The server is currently full.","Please try again later");try{if(this.username=t,t=a.formatAuthString(t,20),this.password=e,e=a.formatAuthString(e,20),0===t.trim().length)return void this.showLoginScreenStatus("You must enter both a username","and a password - Please try again");i?this.drawTextBox("Connection lost! Please wait...","Attempting to re-establish"):this.showLoginScreenStatus("Please wait...","Connecting to server"),this.packetStream=new h(await this.createSocket(this.server,this.port),this),this.packetStream.maxReadTries=u.maxReadTries,this.packetStream.newPacket(l.SESSION);const s=a.usernameToHash(t);this.packetStream.putByte(s.shiftRight(16).and(31).toInt()),this.packetStream.flushPacket();const r=await this.packetStream.getLong();if(this.sessionID=r,r.equals(0))return void this.showLoginScreenStatus("Login server offline.","Please try again in a few mins");console.log("Verb: Session id: "+r);const n=new Int32Array(4);n[0]=99999999*Math.random()|0,n[1]=99999999*Math.random()|0,n[2]=r.shiftRight(32).toInt(),n[3]=r.toInt(),this.packetStream.newPacket(l.LOGIN),this.packetStream.putByte(+i),this.packetStream.putShort(u.clientVersion),this.packetStream.putByte(0),this.packetStream.putByte(10),this.packetStream.putInt(n[0]),this.packetStream.putInt(n[1]),this.packetStream.putInt(n[2]),this.packetStream.putInt(n[3]),this.packetStream.putInt(0),this.packetStream.putString(t),this.packetStream.putString(e),this.packetStream.flushPacket();const o=await this.packetStream.readStream();if(console.log("login response:"+o),25===o)return this.moderatorLevel=1,this.autoLoginTimeout=0,void this.resetGame();if(0===o)return this.moderatorLevel=0,this.autoLoginTimeout=0,void this.resetGame();if(1===o)return void(this.autoLoginTimeout=0);if(i)return t="",e="",void this.resetLoginVars();switch(o){case-1:return void this.showLoginScreenStatus("Error unable to login.","Server timed out");case 3:return void this.showLoginScreenStatus("Invalid username or password.","Try again, or create a new account");case 4:return void this.showLoginScreenStatus("That username is already logged in.","Wait 60 seconds then retry");case 5:return void this.showLoginScreenStatus("The client has been updated.","Please reload this page");case 6:return void this.showLoginScreenStatus("You may only use 1 character at once.","Your ip-address is already in use");case 7:return void this.showLoginScreenStatus("Login attempts exceeded!","Please try again in 5 minutes");case 8:return void this.showLoginScreenStatus("Error unable to login.","Server rejected session");case 9:return void this.showLoginScreenStatus("Error unable to login.","Loginserver rejected session");case 10:return void this.showLoginScreenStatus("That username is already in use.","Wait 60 seconds then retry");case 11:return void this.showLoginScreenStatus("Account temporarily disabled.","Check your message inbox for details");case 12:return void this.showLoginScreenStatus("Account permanently disabled.","Check your message inbox for details");case 14:return this.showLoginScreenStatus("Sorry! This world is currently full.","Please try a different world"),void(this.worldFullTimeout=1500);case 15:return void this.showLoginScreenStatus("You need a members account","to login to this world");case 16:return void this.showLoginScreenStatus("Error - no reply from loginserver.","Please try again");case 17:return void this.showLoginScreenStatus("Error - failed to decode profile.","Contact customer support");case 18:return void this.showLoginScreenStatus("Account suspected stolen.","Press 'recover a locked account' on front page.");case 20:return void this.showLoginScreenStatus("Error - loginserver mismatch","Please try a different world");case 21:return void this.showLoginScreenStatus("Unable to login.","That is not an RS-Classic account");case 22:return void this.showLoginScreenStatus("Password suspected stolen.","Press 'change your password' on front page.");default:return void this.showLoginScreenStatus("Error unable to login.","Unrecognised response code")}}catch(t){console.error(t)}this.autoLoginTimeout>0&&(await c(5e3),this.autoLoginTimeout--,await this.login(this.username,this.password,i)),i?(this.username="",this.password="",this.resetLoginVars()):this.showLoginScreenStatus("Sorry! Unable to connect.","Check internet settings or try another world")}async recoverAttempt(t){this.showLoginScreenStatus("Please wait...","Connecting to server");try{this.packetStream=new h(await this.createSocket(this.server,this.port),this),this.packetStream.maxReadTries=this.maxReadTries,this.packetStream.newPacket(),this.packetStream.putLong(a.usernameToHash(t)),this.packetStream.flushPacket();const i=await this.packetStream.readStream();if(console.log("Getpq response: "+i),0===i)return void this.showLoginScreenStatus("Sorry, the recovery questions for this user have not been set","");for(let t=0;t<5;t++){const i=await this.packetStream.readStream();if(i<0)throw new Error("invalid recovery question length");const s=new Int8Array(i);await this.packetStream.readBytes(i,s);const r=(e=s.slice(0,i),Array.from(e).map((t=>String.fromCharCode(t))).join(""));this.panelRecoverUser.updateText(this.controlRecoverQuestions[t],r)}if(this.recentRecoverFail)return void this.showLoginScreenStatus("Sorry, you have already attempted 1 recovery, try again later","");this.loginScreen=3,this.panelRecoverUser.updateText(this.controlRecoverInfo1,"@yel@To prove this is your account please provide the answers to"),this.panelRecoverUser.updateText(this.controlRecoverInfo2,"@yel@your security questions. You will then be able to reset your password");for(let t=0;t<5;t++)this.panelRecoverUser.updateText(this.controlRecoverAnswers[t],"");this.panelRecoverUser.updateText(this.controlRecoverOldPassword,""),this.panelRecoverUser.updateText(this.controlRecoverNewPassword,""),this.panelRecoverUser.updateText(this.controlRecoverConfirmPassword,"")}catch(t){return console.error(t),void this.showLoginScreenStatus("Sorry! Unable to connect.","Check leternet settings or try another world")}var e}closeConnection(){if(null!==this.packetStream)try{this.packetStream.newPacket(l.CLOSE_CONNECTION),this.packetStream.flushPacket()}catch(t){console.error(t)}this.username="",this.password="",this.resetLoginVars()}async lostConnection(){try{throw new Error("")}catch(t){console.error(t)}this.options.retryLoginOnDisconnect&&(this.autoLoginTimeout=10),await this.login(this.username,this.password,!0)}drawTextBox(t,e){const i=this.getGraphics(),n=new r("Helvetica",1,15);i.setColor(s.black),i.fillRect(372,319,280,50),i.setColor(s.white),i.drawRect(372,319,280,50),this.drawString(i,t,n,512,334),this.drawString(i,e,n,512,354)}async checkConnection(){const t=Date.now();this.packetStream.hasPacket()&&(this.packetLastRead=t),t-this.packetLastRead>5e3&&(this.packetLastRead=t,this.packetStream.newPacket(l.PING),this.packetStream.sendPacket());try{this.packetStream.writePacket(20)}catch(t){return void await this.lostConnection()}const e=await this.packetStream.readPacket(this.incomingPacket);if(e>0){const t=this.packetStream.isaacCommand(255&this.incomingPacket[0]);this.handleIncomingPacket(t,e,this.incomingPacket)}}sortFriendsList(){let t=!0;for(;t;){t=!1;for(let e=0;e<this.friendListCount-1;e++)if(255!==this.friendListOnline[e]&&255===this.friendListOnline[e+1]||0===this.friendListOnline[e]&&0!==this.friendListOnline[e+1]){const i=this.friendListOnline[e];this.friendListOnline[e]=this.friendListOnline[e+1],this.friendListOnline[e+1]=i;const s=this.friendListHashes[e];this.friendListHashes[e]=this.friendListHashes[e+1],this.friendListHashes[e+1]=s,t=!0}}}sendPrivacySettings(t,e,i,s){this.packetStream.newPacket(l.SETTINGS_PRIVACY),this.packetStream.putByte(t),this.packetStream.putByte(e),this.packetStream.putByte(i),this.packetStream.putByte(s),this.packetStream.sendPacket()}ignoreAdd(t){const e=a.usernameToHash(t);this.packetStream.newPacket(l.IGNORE_ADD),this.packetStream.putLong(e),this.packetStream.sendPacket();for(let t=0;t<this.ignoreListCount;t++)if(this.ignoreList[t].equals(e))return;return this.ignoreListCount>=u.maxSocialListSize?void 0:void(this.ignoreList[this.ignoreListCount++]=e)}ignoreRemove(t){this.packetStream.newPacket(l.IGNORE_REMOVE),this.packetStream.putLong(t),this.packetStream.sendPacket();for(let e=0;e<this.ignoreListCount;e++)if(this.ignoreList[e].equals(t)){this.ignoreListCount--;for(let t=e;t<this.ignoreListCount;t++)this.ignoreList[t]=this.ignoreList[t+1];return}}friendAdd(t){this.packetStream.newPacket(l.FRIEND_ADD),this.packetStream.putLong(a.usernameToHash(t)),this.packetStream.sendPacket();const e=a.usernameToHash(t);for(let t=0;t<this.friendListCount;t++)if(this.friendListHashes[t].equals(e))return;return this.friendListCount>=u.maxSocialListSize?void 0:(this.friendListHashes[this.friendListCount]=e,this.friendListOnline[this.friendListCount]=0,void this.friendListCount++)}friendRemove(t){this.packetStream.newPacket(l.FRIEND_REMOVE),this.packetStream.putLong(t),this.packetStream.sendPacket();for(let e=0;e<this.friendListCount;e++)if(this.friendListHashes[e].equals(t)){this.friendListCount--;for(let t=e;t<this.friendListCount;t++)this.friendListHashes[t]=this.friendListHashes[t+1],this.friendListOnline[t]=this.friendListOnline[t+1];break}this.showServerMessage(`@pri@${a.hashToUsername(t)} has been removed from your friends list`)}sendPrivateMessage(t,e,i){this.packetStream.newPacket(l.PM),this.packetStream.putLong(t),this.packetStream.putBytes(e,0,i),this.packetStream.sendPacket()}sendChatMessage(t,e){this.packetStream.newPacket(l.CHAT),this.packetStream.putBytes(t,0,e),this.packetStream.sendPacket()}sendCommandString(t){this.packetStream.newPacket(l.COMMAND),this.packetStream.putString(t),this.packetStream.sendPacket()}}u.clientVersion=1,u.maxReadTries=0,u.maxSocialListSize=100,t.exports=u},5178:(t,e,i)=>{const s=i(6848),r=i(2861);class n{static getModelIndex(t){if(/^na$/i.test(t))return 0;for(let e=0;e<n.modelCount;e++)if(n.modelName[e].toLowerCase()===t.toLowerCase())return e;return n.modelName[n.modelCount++]=t,n.modelCount-1}static getUnsignedByte(){let t=255&n.dataInteger[n.offset];return n.offset++,t}static getUnsignedShort(){let t=s.getUnsignedShort(n.dataInteger,n.offset);return n.offset+=2,t}static getUnsignedInt(){let t=s.getUnsignedInt(n.dataInteger,n.offset);return n.offset+=4,t>99999999&&(t=99999999-t),t}static getString(){let t="";for(t="";0!==n.dataString[n.stringOffset];t+=String.fromCharCode(n.dataString[n.stringOffset++]));return n.stringOffset++,t}static loadData(t,e){n.dataString=s.loadData("string.dat",0,t),n.stringOffset=0,n.dataInteger=s.loadData("integer.dat",0,t),n.offset=0;let i=0;for(n.itemCount=n.getUnsignedShort(),n.itemName=[],n.itemDescription=[],n.itemCommand=[],n.itemPicture=new Int32Array(n.itemCount),n.itemBasePrice=new Int32Array(n.itemCount),n.itemStackable=new Int32Array(n.itemCount),n.itemUnused=new Int32Array(n.itemCount),n.itemWearable=new Int32Array(n.itemCount),n.itemMask=new Int32Array(n.itemCount),n.itemSpecial=new Int32Array(n.itemCount),n.itemMembers=new Int32Array(n.itemCount),i=0;i<n.itemCount;i++)n.itemName.push(n.getString());for(i=0;i<n.itemCount;i++)n.itemDescription.push(n.getString());for(i=0;i<n.itemCount;i++)n.itemCommand.push(n.getString());for(i=0;i<n.itemCount;i++)n.itemPicture[i]=n.getUnsignedShort(),n.itemPicture[i]+1>n.itemSpriteCount&&(n.itemSpriteCount=n.itemPicture[i]+1);for(i=0;i<n.itemCount;i++)n.itemBasePrice[i]=n.getUnsignedInt();for(i=0;i<n.itemCount;i++)n.itemStackable[i]=n.getUnsignedByte();for(i=0;i<n.itemCount;i++)n.itemUnused[i]=n.getUnsignedByte();for(i=0;i<n.itemCount;i++)n.itemWearable[i]=n.getUnsignedShort();for(i=0;i<n.itemCount;i++)n.itemMask[i]=n.getUnsignedInt();for(i=0;i<n.itemCount;i++)n.itemSpecial[i]=n.getUnsignedByte();for(i=0;i<n.itemCount;i++)n.itemMembers[i]=n.getUnsignedByte();for(i=0;i<n.itemCount;i++)e||1!==n.itemMembers[i]||(n.itemName[i]="Members object",n.itemDescription[i]="You need to be a member to use this object",n.itemBasePrice[i]=0,n.itemCommand[i]="",n.itemUnused[0]=0,n.itemWearable[i]=0,n.itemSpecial[i]=1);for(n.npcCount=n.getUnsignedShort(),n.npcName=[],n.npcDescription=[],n.npcCommand=[],n.npcAttack=new Int32Array(n.npcCount),n.npcStrength=new Int32Array(n.npcCount),n.npcHits=new Int32Array(n.npcCount),n.npcDefense=new Int32Array(n.npcCount),n.npcAttackable=new Int32Array(n.npcCount),n.npcSprite=r(new Int32Array(12*n.npcCount),[n.npcCount,12]),n.npcColourHair=new Int32Array(n.npcCount),n.npcColourTop=new Int32Array(n.npcCount),n.npcColorBottom=new Int32Array(n.npcCount),n.npcColourSkin=new Int32Array(n.npcCount),n.npcWidth=new Int32Array(n.npcCount),n.npcHeight=new Int32Array(n.npcCount),n.npcWalkModel=new Int32Array(n.npcCount),n.npcCombatModel=new Int32Array(n.npcCount),n.npcCombatAnimation=new Int32Array(n.npcCount),i=0;i<n.npcCount;i++)n.npcName.push(n.getString());for(i=0;i<n.npcCount;i++)n.npcDescription.push(n.getString());for(i=0;i<n.npcCount;i++)n.npcAttack[i]=n.getUnsignedByte();for(i=0;i<n.npcCount;i++)n.npcStrength[i]=n.getUnsignedByte();for(i=0;i<n.npcCount;i++)n.npcHits[i]=n.getUnsignedByte();for(i=0;i<n.npcCount;i++)n.npcDefense[i]=n.getUnsignedByte();for(i=0;i<n.npcCount;i++)n.npcAttackable[i]=n.getUnsignedByte();for(i=0;i<n.npcCount;i++)for(let t=0;t<12;t++)n.npcSprite.set(i,t,n.getUnsignedByte()),255===n.npcSprite.get(i,t)&&n.npcSprite.set(i,t,-1);for(i=0;i<n.npcCount;i++)n.npcColourHair[i]=n.getUnsignedInt();for(i=0;i<n.npcCount;i++)n.npcColourTop[i]=n.getUnsignedInt();for(i=0;i<n.npcCount;i++)n.npcColorBottom[i]=n.getUnsignedInt();for(i=0;i<n.npcCount;i++)n.npcColourSkin[i]=n.getUnsignedInt();for(i=0;i<n.npcCount;i++)n.npcWidth[i]=n.getUnsignedShort();for(i=0;i<n.npcCount;i++)n.npcHeight[i]=n.getUnsignedShort();for(i=0;i<n.npcCount;i++)n.npcWalkModel[i]=n.getUnsignedByte();for(i=0;i<n.npcCount;i++)n.npcCombatModel[i]=n.getUnsignedByte();for(i=0;i<n.npcCount;i++)n.npcCombatAnimation[i]=n.getUnsignedByte();for(i=0;i<n.npcCount;i++)n.npcCommand[i]=n.getString();for(n.textureCount=n.getUnsignedShort(),n.textureName=[],n.textureSubtypeName=[],i=0;i<n.textureCount;i++)n.textureName.push(n.getString());for(i=0;i<n.textureCount;i++)n.textureSubtypeName.push(n.getString());for(n.animationCount=n.getUnsignedShort(),n.animationName=[],n.animationCharacterColour=new Int32Array(n.animationCount),n.animationGender=new Int32Array(n.animationCount),n.animationHasA=new Int32Array(n.animationCount),n.animationHasF=new Int32Array(n.animationCount),n.animationNumber=new Int32Array(n.animationCount),i=0;i<n.animationCount;i++)n.animationName.push(n.getString());for(i=0;i<n.animationCount;i++)n.animationCharacterColour[i]=n.getUnsignedInt();for(i=0;i<n.animationCount;i++)n.animationGender[i]=n.getUnsignedByte();for(i=0;i<n.animationCount;i++)n.animationHasA[i]=n.getUnsignedByte();for(i=0;i<n.animationCount;i++)n.animationHasF[i]=n.getUnsignedByte();for(i=0;i<n.animationCount;i++)n.animationNumber[i]=n.getUnsignedByte();for(n.objectCount=n.getUnsignedShort(),n.objectName=[],n.objectDescription=[],n.objectCommand1=[],n.objectCommand2=[],n.objectModelIndex=new Int32Array(n.objectCount),n.objectWidth=new Int32Array(n.objectCount),n.objectHeight=new Int32Array(n.objectCount),n.objectType=new Int32Array(n.objectCount),n.objectElevation=new Int32Array(n.objectCount),i=0;i<n.objectCount;i++)n.objectName.push(n.getString());for(i=0;i<n.objectCount;i++)n.objectDescription.push(n.getString());for(i=0;i<n.objectCount;i++)n.objectCommand1.push(n.getString());for(i=0;i<n.objectCount;i++)n.objectCommand2.push(n.getString());for(i=0;i<n.objectCount;i++)n.objectModelIndex[i]=n.getModelIndex(n.getString());for(i=0;i<n.objectCount;i++)n.objectWidth[i]=n.getUnsignedByte();for(i=0;i<n.objectCount;i++)n.objectHeight[i]=n.getUnsignedByte();for(i=0;i<n.objectCount;i++)n.objectType[i]=n.getUnsignedByte();for(i=0;i<n.objectCount;i++)n.objectElevation[i]=n.getUnsignedByte();for(n.wallObjectCount=n.getUnsignedShort(),n.wallObjectName=[],n.wallObjectDescription=[],n.wallObjectCommand1=[],n.wallObjectCommand2=[],n.wallObjectHeight=new Int32Array(n.wallObjectCount),n.wallObjectTextureFront=new Int32Array(n.wallObjectCount),n.wallObjectTextureBack=new Int32Array(n.wallObjectCount),n.wallObjectAdjacent=new Int32Array(n.wallObjectCount),n.wallObjectInvisible=new Int32Array(n.wallObjectCount),i=0;i<n.wallObjectCount;i++)n.wallObjectName.push(n.getString());for(i=0;i<n.wallObjectCount;i++)n.wallObjectDescription.push(n.getString());for(i=0;i<n.wallObjectCount;i++)n.wallObjectCommand1.push(n.getString());for(i=0;i<n.wallObjectCount;i++)n.wallObjectCommand2.push(n.getString());for(i=0;i<n.wallObjectCount;i++)n.wallObjectHeight[i]=n.getUnsignedShort();for(i=0;i<n.wallObjectCount;i++)n.wallObjectTextureFront[i]=n.getUnsignedInt();for(i=0;i<n.wallObjectCount;i++)n.wallObjectTextureBack[i]=n.getUnsignedInt();for(i=0;i<n.wallObjectCount;i++)n.wallObjectAdjacent[i]=n.getUnsignedByte();for(i=0;i<n.wallObjectCount;i++)n.wallObjectInvisible[i]=n.getUnsignedByte();for(n.roofCount=n.getUnsignedShort(),n.roofHeight=new Int32Array(n.roofCount),n.roofNumVertices=new Int32Array(n.roofCount),i=0;i<n.roofCount;i++)n.roofHeight[i]=n.getUnsignedByte();for(i=0;i<n.roofCount;i++)n.roofNumVertices[i]=n.getUnsignedByte();for(n.tileCount=n.getUnsignedShort(),n.tileDecoration=new Int32Array(n.tileCount),n.tileType=new Int32Array(n.tileCount),n.tileAdjacent=new Int32Array(n.tileCount),i=0;i<n.tileCount;i++)n.tileDecoration[i]=n.getUnsignedInt();for(i=0;i<n.tileCount;i++)n.tileType[i]=n.getUnsignedByte();for(i=0;i<n.tileCount;i++)n.tileAdjacent[i]=n.getUnsignedByte();for(n.projectileSprite=n.getUnsignedShort(),n.spellCount=n.getUnsignedShort(),n.spellName=[],n.spellDescription=[],n.spellLevel=new Int32Array(n.spellCount),n.spellRunesRequired=new Int32Array(n.spellCount),n.spellType=new Int32Array(n.spellCount),n.spellRunesId=[],n.spellRunesCount=[],i=0;i<n.spellCount;i++)n.spellName.push(n.getString());for(i=0;i<n.spellCount;i++)n.spellDescription.push(n.getString());for(i=0;i<n.spellCount;i++)n.spellLevel[i]=n.getUnsignedByte();for(i=0;i<n.spellCount;i++)n.spellRunesRequired[i]=n.getUnsignedByte();for(i=0;i<n.spellCount;i++)n.spellType[i]=n.getUnsignedByte();for(i=0;i<n.spellCount;i++){const t=n.getUnsignedByte();n.spellRunesId.push(new Int32Array(t));for(let e=0;e<t;e++)n.spellRunesId[i][e]=n.getUnsignedShort()}for(i=0;i<n.spellCount;i++){let t=n.getUnsignedByte();n.spellRunesCount.push(new Int32Array(t));for(let e=0;e<t;e++)n.spellRunesCount[i][e]=n.getUnsignedByte()}for(n.prayerCount=n.getUnsignedShort(),n.prayerName=[],n.prayerDescription=[],n.prayerLevel=new Int32Array(n.prayerCount),n.prayerDrain=new Int32Array(n.prayerCount),i=0;i<n.prayerCount;i++)n.prayerName.push(n.getString());for(i=0;i<n.prayerCount;i++)n.prayerDescription.push(n.getString());for(i=0;i<n.prayerCount;i++)n.prayerLevel[i]=n.getUnsignedByte();for(i=0;i<n.prayerCount;i++)n.prayerDrain[i]=n.getUnsignedByte();n.dataString=null,n.dataInteger=null}}n.modelName=[],n.modelName.length=5e3,n.modelName.fill(null),n.spellCount=0,n.itemCount=0,n.itemSpriteCount=0,n.tileCount=0,n.wallObjectCount=0,n.modelCount=0,n.prayerCount=0,n.projectileSprite=0,n.npcCount=0,n.textureCount=0,n.roofCount=0,n.objectCount=0,n.animationCount=0,n.stringOffset=0,n.offset=0,t.exports=n},5822:(t,e,i)=>{const s=i(6848),r=i(5965),n=12345678;class o{constructor(){this.numVertices=0,this.numFaces=0,this.transformState=0,this.visible=!1,this.textureTranslucent=!1,this.transparent=!1,this.isolated=!1,this.unlit=!1,this.unpickable=!1,this.projected=!1,this.autocommit=!1,this.depth=0,this.x1=0,this.x2=0,this.y1=0,this.y2=0,this.z1=0,this.z2=0,this.key=-1,this.maxVerts=0,this.lightDiffuse=1024,this.lightAmbience=32,this.magic=0,this.maxFaces=0,this.baseX=0,this.baseY=0,this.baseZ=0,this.scaleFx=0,this.scaleFy=0,this.scaleFz=0,this.shearXy=0,this.shearXz=0,this.shearYx=0,this.shearYz=0,this.shearZx=0,this.shearZy=0,this.transformKind=0,this.diameter=0,this.lightDirectionX=180,this.lightDirectionY=155,this.lightDirectionZ=95,this.lightDirectionMagnitude=0,this.dataPtr=0,this.orientationYaw=0,this.orientationPitch=0,this.orientationRoll=0,this.projectVertexX=null,this.projectVertexY=null,this.projectVertexZ=null,this.vertexViewX=null,this.vertexViewY=null,this.vertexIntensity=null,this.vertexAmbience=null,this.faceNumVertices=null,this.faceVertices=null,this.faceFillFront=null,this.faceFillBack=null,this.normalMagnitude=null,this.normalScale=null,this.faceIntensity=null,this.faceNormalX=null,this.faceNormalY=null,this.faceNormalZ=null,this.faceTag=null,this.isLocalPlayer=null,this.vertexX=null,this.vertexY=null,this.vertexZ=null,this.vertexTransformedX=null,this.vertexTransformedY=null,this.vertexTransformedZ=null,this.faceTransStateThing=null,this.faceBoundLeft=null,this.faceBoundRight=null,this.faceBoundBottom=null,this.faceBoundTop=null,this.faceBoundNear=null,this.faceBoundFar=null}static _from2(t,e){let i=new o;i.transformState=1,i.visible=!0,i.textureTranslucent=!1,i.transparent=!1,i.autocommit=!1,i.isolated=!1,i.unlit=!1,i.unpickable=!1,i.projected=!1,i.magic=n,i.diameter=n,i.lightDirectionMagnitude=256,i.allocate(t,e),i.faceTransStateThing=[];for(let t=0;t<i.numFaces;t++)i.faceTransStateThing.push(new Int32Array([0]));return i}static _from2A(t,e){let i=new o;return i.transformState=1,i.visible=!0,i.textureTranslucent=!1,i.transparent=!1,i.autocommit=!1,i.isolated=!1,i.unlit=!1,i.unpickable=!1,i.projected=!1,i.magic=n,i.diameter=n,i.lightDirectionMagnitude=256,i.merge(t,e,!0),i}static fromBytes(t,e){let i=new o;i.transformState=1,i.visible=!0,i.textureTranslucent=!1,i.transparent=!1,i.autocommit=!1,i.isolated=!1,i.unlit=!1,i.unpickable=!1,i.projected=!1,i.magic=n,i.diameter=n,i.lightDirectionMagnitude=256;const r=s.getUnsignedShort(t,e);e+=2;const h=s.getUnsignedShort(t,e);e+=2,i.allocate(r,h),i.faceTransStateThing=[],i.faceTransStateThing.length=h;for(let t=0;t<h;t+=1)i.faceTransStateThing[t]=[0];for(let n=0;n<r;n++)i.vertexX[n]=s.getSignedShort(t,e),e+=2;for(let n=0;n<r;n++)i.vertexY[n]=s.getSignedShort(t,e),e+=2;for(let n=0;n<r;n++)i.vertexZ[n]=s.getSignedShort(t,e),e+=2;i.numVertices=r;for(let s=0;s<h;s++)i.faceNumVertices[s]=255&t[e++];for(let r=0;r<h;r++)i.faceFillFront[r]=s.getSignedShort(t,e),e+=2,32767===i.faceFillFront[r]&&(i.faceFillFront[r]=i.magic);for(let r=0;r<h;r++)i.faceFillBack[r]=s.getSignedShort(t,e),e+=2,32767===i.faceFillBack[r]&&(i.faceFillBack[r]=i.magic);for(let s=0;s<h;s++){const r=255&t[e++];i.faceIntensity[s]=0===r?0:i.magic}for(let n=0;n<h;n++){i.faceVertices[n]=new Int32Array(i.faceNumVertices[n]);for(let o=0;o<i.faceNumVertices[n];o++)r<256?i.faceVertices[n][o]=255&t[e++]:(i.faceVertices[n][o]=s.getUnsignedShort(t,e),e+=2)}return i.numFaces=h,i.transformState=1,i}static _from6(t,e,i,s,r,h){let a=new o;return a.transformState=1,a.visible=!0,a.textureTranslucent=!1,a.transparent=!1,a.projected=!1,a.magic=n,a.diameter=n,a.lightDirectionMagnitude=256,a.autocommit=i,a.isolated=s,a.unlit=r,a.unpickable=h,a.merge(t,e,!1),a}static _from7(t,e,i,s,r,h,a){let l=new o;return l.transformState=1,l.visible=!0,l.textureTranslucent=!1,l.transparent=!1,l.magic=n,l.diameter=n,l.lightDirectionMagnitude=256,l.autocommit=i,l.isolated=s,l.unlit=r,l.unpickable=h,l.projected=a,l.allocate(t,e),l}allocate(t,e){this.vertexX=new Int32Array(t),this.vertexY=new Int32Array(t),this.vertexZ=new Int32Array(t),this.vertexIntensity=new Int32Array(t),this.vertexAmbience=new Int8Array(t),this.faceNumVertices=new Int32Array(e),this.faceVertices=[],this.faceVertices.length=e,this.faceVertices.fill(null),this.faceFillFront=new Int32Array(e),this.faceFillBack=new Int32Array(e),this.faceIntensity=new Int32Array(e),this.normalScale=new Int32Array(e),this.normalMagnitude=new Int32Array(e),this.projected||(this.projectVertexX=new Int32Array(t),this.projectVertexY=new Int32Array(t),this.projectVertexZ=new Int32Array(t),this.vertexViewX=new Int32Array(t),this.vertexViewY=new Int32Array(t)),this.unpickable||(this.isLocalPlayer=new Int8Array(e),this.faceTag=new Int32Array(e)),this.autocommit?(this.vertexTransformedX=this.vertexX,this.vertexTransformedY=this.vertexY,this.vertexTransformedZ=this.vertexZ):(this.vertexTransformedX=new Int32Array(t),this.vertexTransformedY=new Int32Array(t),this.vertexTransformedZ=new Int32Array(t)),this.unlit&&this.isolated||(this.faceNormalX=new Int32Array(e),this.faceNormalY=new Int32Array(e),this.faceNormalZ=new Int32Array(e)),this.isolated||(this.faceBoundLeft=new Int32Array(e),this.faceBoundRight=new Int32Array(e),this.faceBoundBottom=new Int32Array(e),this.faceBoundTop=new Int32Array(e),this.faceBoundNear=new Int32Array(e),this.faceBoundFar=new Int32Array(e)),this.numFaces=0,this.numVertices=0,this.maxVerts=t,this.maxFaces=e,this.baseX=this.baseY=this.baseZ=0,this.orientationYaw=this.orientationPitch=this.orientationRoll=0,this.scaleFx=this.scaleFy=this.scaleFz=256,this.shearXy=this.shearXz=this.shearYx=this.shearYz=this.shearZx=this.shearZy=256,this.transformKind=0}projectionPrepare(){this.projectVertexX=new Int32Array(this.numVertices),this.projectVertexY=new Int32Array(this.numVertices),this.projectVertexZ=new Int32Array(this.numVertices),this.vertexViewX=new Int32Array(this.numVertices),this.vertexViewY=new Int32Array(this.numVertices)}clear(){this.numFaces=0,this.numVertices=0}reduce(t,e){this.numFaces-=t,this.numFaces<0&&(this.numFaces=0),this.numVertices-=e,this.numVertices<0&&(this.numVertices=0)}merge(t,e,i){let s=0,r=0;for(let i=0;i<e;i++)s+=t[i].numFaces,r+=t[i].numVertices;this.allocate(r,s),i&&(this.faceTransStateThing=[],this.faceTransStateThing.length=s);for(let s=0;s<e;s++){let r=t[s];r.commit(),this.lightAmbience=r.lightAmbience,this.lightDiffuse=r.lightDiffuse,this.lightDirectionX=r.lightDirectionX,this.lightDirectionY=r.lightDirectionY,this.lightDirectionZ=r.lightDirectionZ,this.lightDirectionMagnitude=r.lightDirectionMagnitude;for(let t=0;t<r.numFaces;t++){let n=new Int32Array(r.faceNumVertices[t]),o=r.faceVertices[t];for(let e=0;e<r.faceNumVertices[t];e++)n[e]=this.vertexAt(r.vertexX[o[e]],r.vertexY[o[e]],r.vertexZ[o[e]]);let h=this.createFace(r.faceNumVertices[t],n,r.faceFillFront[t],r.faceFillBack[t]);if(this.faceIntensity[h]=r.faceIntensity[t],this.normalScale[h]=r.normalScale[t],this.normalMagnitude[h]=r.normalMagnitude[t],i)if(e>1){this.faceTransStateThing[h]=new Int32Array(r.faceTransStateThing[t].length+1),this.faceTransStateThing[h][0]=s;for(let e=0;e<r.faceTransStateThing[t].length;e++)this.faceTransStateThing[h][e+1]=r.faceTransStateThing[t][e]}else{this.faceTransStateThing[h]=new Int32Array(r.faceTransStateThing[t].length);for(let e=0;e<r.faceTransStateThing[t].length;e++)this.faceTransStateThing[h][e]=r.faceTransStateThing[t][e]}}}this.transformState=1}vertexAt(t,e,i){for(let s=0;s<this.numVertices;s++)if(this.vertexX[s]===t&&this.vertexY[s]===e&&this.vertexZ[s]===i)return s;return this.numVertices>=this.maxVerts?-1:(this.vertexX[this.numVertices]=t,this.vertexY[this.numVertices]=e,this.vertexZ[this.numVertices]=i,this.numVertices++)}createVertex(t,e,i){return this.numVertices>=this.maxVerts?-1:(this.vertexX[this.numVertices]=t,this.vertexY[this.numVertices]=e,this.vertexZ[this.numVertices]=i,this.numVertices++)}createFace(t,e,i,s){return this.numFaces>=this.maxFaces?-1:(this.faceNumVertices[this.numFaces]=t,this.faceVertices[this.numFaces]=e,this.faceFillFront[this.numFaces]=i,this.faceFillBack[this.numFaces]=s,this.transformState=1,this.numFaces++)}split(t,e,i,s,r,n,h,a){this.commit();let l=new Int32Array(n),c=new Int32Array(n);for(let t=0;t<n;t++)l[t]=0,c[t]=0;for(let t=0;t<this.numFaces;t++){let e=0,n=0,o=this.faceNumVertices[t],h=this.faceVertices[t];for(let t=0;t<o;t++)e+=this.vertexX[h[t]],n+=this.vertexZ[h[t]];let a=(e/(o*i)|0)+(n/(o*s)|0)*r;l[a]+=o,c[a]++}let u=[];for(let t=0;t<n;t++)l[t]>h&&(l[t]=h),u.push(o._from7(l[t],c[t],!0,!0,!0,a,!0)),u[t].lightDiffuse=this.lightDiffuse,u[t].lightAmbience=this.lightAmbience;for(let t=0;t<this.numFaces;t++){let e=0,n=0,o=this.faceNumVertices[t],h=this.faceVertices[t];for(let t=0;t<o;t++)e+=this.vertexX[h[t]],n+=this.vertexZ[h[t]];let a=(e/(o*i)|0)+(n/(o*s)|0)*r;this.copyLighting(u[a],h,o,t)}for(let t=0;t<n;t++)u[t].projectionPrepare();return u}copyLighting(t,e,i,s){let r=new Int32Array(i);for(let s=0;s<i;s++){let i=r[s]=t.vertexAt(this.vertexX[e[s]],this.vertexY[e[s]],this.vertexZ[e[s]]);t.vertexIntensity[i]=this.vertexIntensity[e[s]],t.vertexAmbience[i]=this.vertexAmbience[e[s]]}let n=t.createFace(i,r,this.faceFillFront[s],this.faceFillBack[s]);t.unpickable||this.unpickable||(t.faceTag[n]=this.faceTag[s]),t.faceIntensity[n]=this.faceIntensity[s],t.normalScale[n]=this.normalScale[s],t.normalMagnitude[n]=this.normalMagnitude[s]}_setLight_from5(t,e,i,s,r){this.lightAmbience=256-4*t,this.lightDiffuse=16*(64-e)+128,this.unlit||(this.lightDirectionX=i,this.lightDirectionY=s,this.lightDirectionZ=r,this.lightDirectionMagnitude=0|Math.sqrt(i*i+s*s+r*r),this.light())}_setLight_from6(t,e,i,s,r,n){if(this.lightAmbience=256-4*e,this.lightDiffuse=16*(64-i)+128,!this.unlit){for(let e=0;e<this.numFaces;e++)this.faceIntensity[e]=t?this.magic:0;this.lightDirectionX=s,this.lightDirectionY=r,this.lightDirectionZ=n,this.lightDirectionMagnitude=0|Math.sqrt(s*s+r*r+n*n),this.light()}}_setLight_from3(t,e,i){this.unlit||(this.lightDirectionX=t,this.lightDirectionY=e,this.lightDirectionZ=i,this.lightDirectionMagnitude=0|Math.sqrt(t*t+e*e+i*i),this.light())}setVertexAmbience(t,e){this.vertexAmbience[t]=255&e}rotate(t,e,i){this.orientationYaw=this.orientationYaw+t&255,this.orientationPitch=this.orientationPitch+e&255,this.orientationRoll=this.orientationRoll+i&255,this.determineTransformKind(),this.transformState=1}orient(t,e,i){this.orientationYaw=255&t,this.orientationPitch=255&e,this.orientationRoll=255&i,this.determineTransformKind(),this.transformState=1}translate(t,e,i){this.baseX+=t,this.baseY+=e,this.baseZ+=i,this.determineTransformKind(),this.transformState=1}place(t,e,i){this.baseX=t,this.baseY=e,this.baseZ=i,this.determineTransformKind(),this.transformState=1}determineTransformKind(){256!==this.shearXy||256!==this.shearXz||256!==this.shearYx||256!==this.shearYz||256!==this.shearZx||256!==this.shearZy?this.transformKind=4:256!==this.scaleFx||256!==this.scaleFy||256!==this.scaleFz?this.transformKind=3:0!==this.orientationYaw||0!==this.orientationPitch||0!==this.orientationRoll?this.transformKind=2:0!==this.baseX||0!==this.baseY||0!==this.baseZ?this.transformKind=1:this.transformKind=0}applyTranslate(t,e,i){for(let s=0;s<this.numVertices;s++)this.vertexTransformedX[s]+=t,this.vertexTransformedY[s]+=e,this.vertexTransformedZ[s]+=i}applyRotation(t,e,i){for(let s=0;s<this.numVertices;s++){if(0!==i){let t=o.sine9[i],e=o.sine9[i+256],r=this.vertexTransformedY[s]*t+this.vertexTransformedX[s]*e>>15;this.vertexTransformedY[s]=this.vertexTransformedY[s]*e-this.vertexTransformedX[s]*t>>15,this.vertexTransformedX[s]=r}if(0!==t){let e=o.sine9[t],i=o.sine9[t+256],r=this.vertexTransformedY[s]*i-this.vertexTransformedZ[s]*e>>15;this.vertexTransformedZ[s]=this.vertexTransformedY[s]*e+this.vertexTransformedZ[s]*i>>15,this.vertexTransformedY[s]=r}if(0!==e){let t=o.sine9[e],i=o.sine9[e+256],r=this.vertexTransformedZ[s]*t+this.vertexTransformedX[s]*i>>15;this.vertexTransformedZ[s]=this.vertexTransformedZ[s]*i-this.vertexTransformedX[s]*t>>15,this.vertexTransformedX[s]=r}}}applyShear(t,e,i,s,r,n){for(let o=0;o<this.numVertices;o++)0!==t&&(this.vertexTransformedX[o]+=this.vertexTransformedY[o]*t>>8),0!==e&&(this.vertexTransformedZ[o]+=this.vertexTransformedY[o]*e>>8),0!==i&&(this.vertexTransformedX[o]+=this.vertexTransformedZ[o]*i>>8),0!==s&&(this.vertexTransformedY[o]+=this.vertexTransformedZ[o]*s>>8),0!==r&&(this.vertexTransformedZ[o]+=this.vertexTransformedX[o]*r>>8),0!==n&&(this.vertexTransformedY[o]+=this.vertexTransformedX[o]*n>>8)}applyScale(t,e,i){for(let s=0;s<this.numVertices;s++)this.vertexTransformedX[s]=this.vertexTransformedX[s]*t>>8,this.vertexTransformedY[s]=this.vertexTransformedY[s]*e>>8,this.vertexTransformedZ[s]=this.vertexTransformedZ[s]*i>>8}computeBounds(){this.x1=this.y1=this.z1=999999,this.diameter=this.x2=this.y2=this.z2=-999999;for(let t=0;t<this.numFaces;t++){let e=this.faceVertices[t],i=e[0],s=this.faceNumVertices[t],r=0,n=r=this.vertexTransformedX[i],o=0,h=o=this.vertexTransformedY[i],a=0,l=a=this.vertexTransformedZ[i];for(let t=0;t<s;t++)i=e[t],this.vertexTransformedX[i]<r?r=this.vertexTransformedX[i]:this.vertexTransformedX[i]>n&&(n=this.vertexTransformedX[i]),this.vertexTransformedY[i]<o?o=this.vertexTransformedY[i]:this.vertexTransformedY[i]>h&&(h=this.vertexTransformedY[i]),this.vertexTransformedZ[i]<a?a=this.vertexTransformedZ[i]:this.vertexTransformedZ[i]>l&&(l=this.vertexTransformedZ[i]);this.isolated||(this.faceBoundLeft[t]=r,this.faceBoundRight[t]=n,this.faceBoundBottom[t]=o,this.faceBoundTop[t]=h,this.faceBoundNear[t]=a,this.faceBoundFar[t]=l),n-r>this.diameter&&(this.diameter=n-r),h-o>this.diameter&&(this.diameter=h-o),l-a>this.diameter&&(this.diameter=l-a),r<this.x1&&(this.x1=r),n>this.x2&&(this.x2=n),o<this.y1&&(this.y1=o),h>this.y2&&(this.y2=h),a<this.z1&&(this.z1=a),l>this.z2&&(this.z2=l)}}light(){if(this.unlit)return;let t=this.lightDiffuse*this.lightDirectionMagnitude>>8;for(let e=0;e<this.numFaces;e++)this.faceIntensity[e]!==this.magic&&(this.faceIntensity[e]=(this.faceNormalX[e]*this.lightDirectionX+this.faceNormalY[e]*this.lightDirectionY+this.faceNormalZ[e]*this.lightDirectionZ)/t|0);let e=new Int32Array(this.numVertices),i=new Int32Array(this.numVertices),s=new Int32Array(this.numVertices),r=new Int32Array(this.numVertices);for(let t=0;t<this.numVertices;t++)e[t]=0,i[t]=0,s[t]=0,r[t]=0;for(let t=0;t<this.numFaces;t++)if(this.faceIntensity[t]===this.magic)for(let n=0;n<this.faceNumVertices[t];n++){let o=this.faceVertices[t][n];e[o]+=this.faceNormalX[t],i[o]+=this.faceNormalY[t],s[o]+=this.faceNormalZ[t],r[o]++}for(let n=0;n<this.numVertices;n++)r[n]>0&&(this.vertexIntensity[n]=(e[n]*this.lightDirectionX+i[n]*this.lightDirectionY+s[n]*this.lightDirectionZ)/(t*r[n])|0)}relight(){if(!this.unlit||!this.isolated){for(let t=0;t<this.numFaces;t++){let e,i=this.faceVertices[t],s=this.vertexTransformedX[i[0]],r=this.vertexTransformedY[i[0]],n=this.vertexTransformedZ[i[0]],o=this.vertexTransformedX[i[1]]-s,h=this.vertexTransformedY[i[1]]-r,a=this.vertexTransformedZ[i[1]]-n,l=this.vertexTransformedX[i[2]]-s,c=this.vertexTransformedY[i[2]]-r,u=this.vertexTransformedZ[i[2]]-n,d=h*u-c*a,f=a*l-u*o;for(e=o*c-l*h;d>8192||f>8192||e>8192||d<-8192||f<-8192||e<-8192;e>>=1)d>>=1,f>>=1;let m=256*Math.sqrt(d*d+f*f+e*e)|0;m<=0&&(m=1),this.faceNormalX[t]=65536*d/m|0,this.faceNormalY[t]=65536*f/m|0,this.faceNormalZ[t]=65535*e/m|0,this.normalScale[t]=-1}this.light()}}apply(){if(2===this.transformState){this.transformState=0;for(let t=0;t<this.numVertices;t++)this.vertexTransformedX[t]=this.vertexX[t],this.vertexTransformedY[t]=this.vertexY[t],this.vertexTransformedZ[t]=this.vertexZ[t];return this.x1=this.y1=this.z1=-9999999,void(this.diameter=this.x2=this.y2=this.z2=9999999)}if(1===this.transformState){this.transformState=0;for(let t=0;t<this.numVertices;t++)this.vertexTransformedX[t]=this.vertexX[t],this.vertexTransformedY[t]=this.vertexY[t],this.vertexTransformedZ[t]=this.vertexZ[t];this.transformKind>=2&&this.applyRotation(this.orientationYaw,this.orientationPitch,this.orientationRoll),this.transformKind>=3&&this.applyScale(this.scaleFx,this.scaleFy,this.scaleFz),this.transformKind>=4&&this.applyShear(this.shearXy,this.shearXz,this.shearYx,this.shearYz,this.shearZx,this.shearZy),this.transformKind>=1&&this.applyTranslate(this.baseX,this.baseY,this.baseZ),this.computeBounds(),this.relight()}}project(t,e,i,s,n,h,a,l){if(this.apply(),this.z1>r.frustumNearZ||this.z2<r.frustumFarZ||this.x1>r.frustumMinX||this.x2<r.frustumMaxX||this.y1>r.frustumMinY||this.y2<r.frustumMaxY)return void(this.visible=!1);this.visible=!0;let c=0,u=0,d=0,f=0,m=0,p=0;0!==h&&(c=o.sine11[h],u=o.sine11[h+1024]),0!==n&&(m=o.sine11[n],p=o.sine11[n+1024]),0!==s&&(d=o.sine11[s],f=o.sine11[s+1024]);for(let r=0;r<this.numVertices;r++){let o=this.vertexTransformedX[r]-t,g=this.vertexTransformedY[r]-e,y=this.vertexTransformedZ[r]-i;if(0!==h){let t=g*c+o*u>>15;g=g*u-o*c>>15,o=t}if(0!==n){let t=y*m+o*p>>15;y=y*p-o*m>>15,o=t}if(0!==s){let t=g*f-y*d>>15;y=g*d+y*f>>15,g=t}this.vertexViewX[r]=y>=l?(o<<a)/y|0:o<<a,this.vertexViewY[r]=y>=l?(g<<a)/y|0:g<<a,this.projectVertexX[r]=o,this.projectVertexY[r]=g,this.projectVertexZ[r]=y}}commit(){this.apply();for(let t=0;t<this.numVertices;t++)this.vertexX[t]=this.vertexTransformedX[t],this.vertexY[t]=this.vertexTransformedY[t],this.vertexZ[t]=this.vertexTransformedZ[t];this.baseX=this.baseY=this.baseZ=0,this.orientationYaw=this.orientationPitch=this.orientationRoll=0,this.scaleFx=this.scaleFy=this.scaleFz=256,this.shearXy=this.shearXz=this.shearYx=this.shearYz=this.shearZx=this.shearZy=256,this.transformKind=0}copy(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(!e||!e.length){let t=o._from2A([this],1);return t.depth=this.depth,t.transparent=this.transparent,t}const[s,r,n,h]=e;let a=o._from6([this],1,s,r,n,h);return a.depth=this.depth,a}copyPosition(t){this.orientationYaw=t.orientationYaw,this.orientationPitch=t.orientationPitch,this.orientationRoll=t.orientationRoll,this.baseX=t.baseX,this.baseY=t.baseY,this.baseZ=t.baseZ,this.determineTransformKind(),this.transformState=1}readBase64(t){for(;10===t[this.dataPtr]||13===t[this.dataPtr];this.dataPtr++);let e=4096*o.base64Alphabet[255&t[this.dataPtr++]]+64*o.base64Alphabet[255&t[this.dataPtr++]]+o.base64Alphabet[255&t[this.dataPtr++]]-131072|0;return 123456===e&&(e=this.magic),e}}o.sine9=new Int32Array(512),o.sine11=new Int32Array(2048),o.base64Alphabet=new Int32Array(256);for(let t=0;t<256;t++)o.sine9[t]=32768*Math.sin(.02454369*t)|0,o.sine9[t+256]=32768*Math.cos(.02454369*t)|0;for(let t=0;t<1024;t++)o.sine11[t]=32768*Math.sin(.00613592315*t)|0,o.sine11[t+1024]=32768*Math.cos(.00613592315*t)|0;for(let t=0;t<10;t++)o.base64Alphabet[48+t]=t;for(let t=0;t<26;t++)o.base64Alphabet[65+t]=t+10;for(let t=0;t<26;t++)o.base64Alphabet[97+t]=t+36;o.base64Alphabet[163]=62,o.base64Alphabet[36]=63,t.exports=o},1531:(t,e,i)=>{const s=i(4202),r=i(3241),n=i(8107),o=i(8695),h=i(817),a=i(1371),l=i(9508),c=i(6848),u=i(7278),d=i(7808),f=i(5583),m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!\"\\243$%^&*()-_=+[{]};:'@#~,<.>/?\\| ",p=["h11p.jf","h12b.jf","h12p.jf","h13b.jf","h14b.jf","h16b.jf","h20b.jf","h24b.jf"],g={position:"absolute",display:"none",padding:0,border:0,outline:0,opacity:0,fontFamily:"sans"};function y(t,e){const i=t.getBoundingClientRect(),s=t.width/i.width,r=t.height/i.height;return{x:(e.clientX-i.left)*s|0,y:(e.clientY-i.top)*r|0}}t.exports=class{constructor(t){this._container=t,this._container.style.position="relative",this._canvas=document.createElement("canvas"),this._canvas.style.width="100%",this._canvas.style.height="100%",this._container.appendChild(this._canvas),this._graphics=new o(this._canvas),this.options={middleClickCamera:!1,mouseWheel:!1,resetCompass:!1,zoomCamera:!1,showRoofs:!0,remainingExperience:!1,totalExperience:!1,wordFilter:!0,accountManagement:!0,fpsCounter:!1,retryLoginOnDisconnect:!0,mobile:!1},this.middleButtonDown=!1,this.mouseScrollDelta=0,this.mouseActionTimeout=0,this.logoHeaderText=null,this.mouseX=0,this.mouseY=0,this.mouseButtonDown=0,this.lastMouseButtonDown=0,this.timings=[],this.resetTimings(),this.stopTimeout=0,this.interlaceTimer=0,this.loadingProgressPercent=0,this.imageLogo=null,this.graphics=null,this.appletWidth=1024,this.appletHeight=692,this.targetFPS=20,this.maxDrawTime=1e3,this.loadingStep=1,this.hasRefererLogoNotUsed=!1,this.loadingProgessText="Loading",this.fontTimesRoman15=new n("Times New Roman",0,15),this.fontHelvetica13b=new n("Helvetica",n.BOLD,13),this.fontHelvetica12=new n("Helvetica",0,12),this.keyLeft=!1,this.keyRight=!1,this.keyUp=!1,this.keyDown=!1,this.keySpace=!1,this.keyHome=!1,this.keyPgUp=!1,this.keyPgDown=!1,this.ctrl=!1,this.threadSleep=1,this.interlace=!1,this.inputTextCurrent="",this.inputTextFinal="",this.inputPMCurrent="",this.inputPMFinal=""}async startApplication(t,e,i){window.document.title=i,this._canvas.tabIndex=0,this._canvas.width=t,this._canvas.height=e,this._container.style.width=`${t}px`,this._container.style.height=`${e}px`,console.log("Started application"),this.appletWidth=t,this.appletHeight=e,this.options.mobile?(this._canvas.addEventListener("touchstart",(t=>{console.log("touchstart"),1===t.touches.length&&(clearTimeout(this.rightClickTimeout),this.rightClickTimeout=setTimeout((()=>{this.disableEndClick=!0,t={button:2,clientX:t.touches[0].clientX,clientY:t.touches[0].clientY},this.mousePressed(t),this.mouseReleased(t)}),500))})),this._canvas.addEventListener("touchmove",(t=>{console.log("touchmoving"),this.touchMoving?this.mouseMoved({clientX:t.touches[0].clientX,clientY:t.touches[0].clientY}):(clearTimeout(this.rightClickTimeout),this.mousePressed({button:1,clientX:t.touches[0].clientX,clientY:t.touches[0].clientY}),this.touchMoving=!0)})),this._canvas.addEventListener("touchend",(t=>{t.preventDefault(),console.log("touchend"),this.disableEndClick?this.disableEndClick=!1:(clearTimeout(this.rightClickTimeout),t={button:this.touchMoving?1:0,clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY},this.touchMoving?this.touchMoving=!1:this.mousePressed(t),this.mouseReleased(t))}))):(this._canvas.addEventListener("mousedown",this.mousePressed.bind(this)),window.addEventListener("mousemove",this.mouseMoved.bind(this)),window.addEventListener("mouseup",this.mouseReleased.bind(this))),this._canvas.addEventListener("wheel",this.mouseWheel.bind(this)),this._canvas.addEventListener("contextmenu",(t=>(t.preventDefault(),!1))),this._canvas.addEventListener("keydown",this.keyPressed.bind(this)),this._canvas.addEventListener("keyup",this.keyReleased.bind(this)),this.options.mobile&&(this.toggleKeyboard=!1,this.mobileInput=document.createElement("input"),Object.assign(this.mobileInput.style,g),this.mobilePassword=document.createElement("input"),this.mobilePassword.type="password",Object.assign(this.mobilePassword.style,g),this.mobileInput.addEventListener("keydown",this.mobileKeyDown.bind(this)),this.mobilePassword.addEventListener("keydown",this.mobileKeyDown.bind(this)),this.mobileInput.addEventListener("blur",this.closeKeyboard.bind(this)),this.mobilePassword.addEventListener("blur",this.closeKeyboard.bind(this)),this._container.appendChild(this.mobileInput),this._container.appendChild(this.mobilePassword)),this.loadingStep=1,await this.run()}closeKeyboard(){clearInterval(this.keyboardUpdateInterval),this.mobileInputEl.style.display="none",this._canvas.focus()}openKeyboard(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"text",e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;this.mobileInputCaret=-1,this.lastMobileInput=e,this.toggleKeyboard=!0,this.mobileInputEl="password"===t?this.mobilePassword:this.mobileInput,this.mobileInputEl.value=e,this.mobileInputEl.maxLength=i,this.mobileInputEl.style.display="block";for(const[t,e]of Object.entries(s))this.mobileInputEl.style[t]=e;this.keyboardUpdateInterval=setInterval((()=>{this.mobileKeyboardUpdate()}),125)}mobileKeyDown(t){t.keyCode===u.ENTER&&(this.closeKeyboard(),this.keyPressed(t))}mobileKeyboardUpdate(){this.mobileInputCaret=this.mobileInputEl.selectionStart;const t=this.mobileInputEl.value;if(t!==this.lastMobileInput){for(let t=0;t<this.lastMobileInput.length;t+=1)this.keyPressed({keyCode:u.BACKSPACE});for(let e=0;e<t.length;e+=1)this.keyPressed({key:t[e]});this.lastMobileInput=t}}keyPressed(t){const e=t.keyCode;let i=t.key&&1===t.key.length?t.key.charCodeAt(0):65535;t.preventDefault&&t.preventDefault(),[8,10,13,9].includes(e)&&(i=e),this.handleKeyPress(i),e===u.LEFT_ARROW?this.keyLeft=!0:e===u.RIGHT_ARROW?this.keyRight=!0:e===u.UP_ARROW?this.keyUp=!0:e===u.DOWN_ARROW?this.keyDown=!0:e===u.SPACE?this.keySpace=!0:e===u.F1?this.interlace=!this.interlace:e===u.HOME?this.keyHome=!0:e===u.PAGE_UP?this.keyPgUp=!0:e===u.PAGE_DOWN?this.keyPgDown=!0:e===u.CTRL&&(this.ctrl=!0);let s=!1;for(let t=0;t<98;t++)if(m.charCodeAt(t)===i){s=!0;break}s&&(this.inputTextCurrent.length<20&&(this.inputTextCurrent+=String.fromCharCode(i)),this.inputPMCurrent.length<80&&(this.inputPMCurrent+=String.fromCharCode(i))),e===u.ENTER?(this.inputTextFinal=this.inputTextCurrent,this.inputPMFinal=this.inputPMCurrent):e===u.BACKSPACE&&(this.inputTextCurrent.length>0&&(this.inputTextCurrent=this.inputTextCurrent.substring(0,this.inputTextCurrent.length-1)),this.inputPMCurrent.length>0&&(this.inputPMCurrent=this.inputPMCurrent.substring(0,this.inputPMCurrent.length-1))),this.options.mobile&&setTimeout((()=>{this.toggleKeyboard&&(this.toggleKeyboard=!1,this.mobileInputEl.focus())}),125)}keyReleased(t){t.preventDefault();const e=t.keyCode;e===u.LEFT_ARROW?this.keyLeft=!1:e===u.RIGHT_ARROW?this.keyRight=!1:e===u.UP_ARROW?this.keyUp=!1:e===u.DOWN_ARROW?this.keyDown=!1:e===u.SPACE?this.keySpace=!1:e===u.HOME?this.keyHome=!1:e===u.PAGE_UP?this.keyPgUp=!1:e===u.PAGE_DOWN?this.keyPgDown=!1:e===u.CTRL&&(this.ctrl=!1)}mouseMoved(t){const{x:e,y:i}=y(this._canvas,t);this.mouseX=e,this.mouseY=i,this.mouseActionTimeout=0}mouseReleased(t){const{x:e,y:i}=y(this._canvas,t);this.mouseX=e,this.mouseY=i,this.mouseButtonDown=0,1===t.button&&(this.middleButtonDown=!1)}mouseOut(t){const{x:e,y:i}=y(this._canvas,t);this.mouseX=e,this.mouseY=i,this.mouseButtonDown=0,this.middleButtonDown=!1}mousePressed(t){1===t.button&&t.preventDefault&&t.preventDefault(),this.options.mobile&&setTimeout((()=>{this.toggleKeyboard&&(this.toggleKeyboard=!1,this.mobileInputEl.focus())}),125);const{x:e,y:i}=y(this._canvas,t);if(this.mouseX=e,this.mouseY=i,this.options.middleClickCamera&&1===t.button)return this.middleButtonDown=!0,this.originRotation=this.cameraRotation,void(this.originMouseX=this.mouseX);t.metaKey||2===t.button?this.mouseButtonDown=2:this.mouseButtonDown=1,this.lastMouseButtonDown=this.mouseButtonDown,this.mouseActionTimeout=0,this.handleMouseDown(this.mouseButtonDown,e,i)}mouseWheel(t){if(this.options.mouseWheel&&document.activeElement===this._canvas)return t.preventDefault(),0===t.deltaMode?this.mouseScrollDelta=Math.floor(t.deltaY/14):1===t.deltaMode&&(this.mouseScrollDelta=Math.floor(t.deltaY)),!1}setTargetFps(t){this.targetFPS=1e3/t}resetTimings(){for(let t=0;t<10;t+=1)this.timings[t]=0}start(){this.stopTimeout>=0&&(this.stopTimeout=0)}stop(){this.stopTimeout>=0&&(this.stopTimeout=4e3/this.targetFPS)}async run(){1===this.loadingStep&&(this.loadingStep=2,this.graphics=this.getGraphics(),await this.loadJagex(),this.drawLoadingScreen(0,"Loading..."),await this.startGame(),this.loadingStep=0);let t=0,e=256,i=1,s=0;for(let t=0;t<10;t++)this.timings[t]=Date.now();for(;this.stopTimeout>=0;){if(this.stopTimeout>0&&(this.stopTimeout--,0===this.stopTimeout))return void this.onClosing();const r=e,n=i;e=300,i=1;const o=Date.now();if(0===this.timings[t]?(e=r,i=n):o>this.timings[t]&&(e=2560*this.targetFPS/(o-this.timings[t])|0),e<25&&(e=25),e>256&&(e=256,i=this.targetFPS-(o-this.timings[t])/10|0,i<this.threadSleep&&(i=this.threadSleep)),await f(i),this.timings[t]=o,t=(t+1)%10,i>1)for(let t=0;t<10;t++)0!==this.timings[t]&&(this.timings[t]+=i);let h=0;for(;s<256;)if(await this.handleInputs(),s+=e,++h>this.maxDrawTime){s=0,this.interlaceTimer+=6,this.interlaceTimer>25&&(this.interlaceTimer=0,this.interlace=!0);break}this.interlaceTimer--,s&=255,this.draw(),this.fps=1e3*e/(256*this.targetFPS),this.mouseScrollDelta=0}}async loadJagex(){this.graphics.setColor(r.black),this.graphics.fillRect(0,0,this.appletWidth,this.appletHeight);const t=await this.readDataFile("jagex.jag","Jagex library",0);if(t){const e=c.loadData("logo.tga",0,t);this.imageLogo=this.parseTGA(e)}const e=await this.readDataFile(`fonts${d.FONTS}.jag`,"Game fonts",5);if(t)for(let t=0;t<p.length;t+=1){const i=p[t];a.createFont(c.loadData(i,0,e),t)}}drawLoadingScreen(t,e){let i=(this.appletWidth-281)/2|0,s=(this.appletHeight-148)/2|0;this.graphics.setColor(r.black),this.graphics.fillRect(0,0,this.appletWidth,this.appletHeight),this.hasRefererLogoNotUsed||this.graphics.drawImage(this.imageLogo,i,s),i+=2,s+=90,this.loadingProgressPercent=t,this.loadingProgessText=e,this.graphics.setColor(new r(132,132,132)),this.hasRefererLogoNotUsed&&this.graphics.setColor(new r(220,0,0)),this.graphics.drawRect(i-2,s-2,280,23),this.graphics.fillRect(i,s,277*t/100|0,20),this.graphics.setColor(new r(198,198,198)),this.hasRefererLogoNotUsed&&this.graphics.setColor(new r(255,255,255)),this.drawString(this.graphics,e,this.fontTimesRoman15,i+138,s+10),this.hasRefererLogoNotUsed?(this.graphics.setColor(new r(132,132,152)),this.drawString(this.graphics,"©2001-2002 Andrew Gower and Jagex Ltd",this.fontHelvetica12,i+138,this.appletHeight-20)):(this.drawString(this.graphics,"Created by JAGeX - visit www.jagex.com",this.fontHelvetica13b,i+138,s+30),this.drawString(this.graphics,"©2001-2002 Andrew Gower and Jagex Ltd",this.fontHelvetica13b,i+138,s+44)),this.logoHeaderText&&(this.graphics.setColor(r.white),this.drawString(this.graphics,this.logoHeaderText,this.fontHelvetica13b,i+138,s-120))}showLoadingProgress(t,e){const i=2+((this.appletWidth-281)/2|0),s=90+((this.appletHeight-148)/2|0);this.loadingProgressPercent=t,this.loadingProgessText=e,this.graphics.setColor(new r(132,132,132)),this.hasRefererLogoNotUsed&&this.graphics.setColor(new r(220,0,0));const n=277*t/100|0;this.graphics.fillRect(i,s,n,20),this.graphics.setColor(r.black),this.graphics.fillRect(i+n,s,277-n,20),this.graphics.setColor(new r(198,198,198)),this.hasRefererLogoNotUsed&&this.graphics.setColor(new r(255,255,255)),this.drawString(this.graphics,e,this.fontTimesRoman15,i+138,s+10)}drawString(t,e,i,s,r){t.setFont(i);const{width:n,height:o}=t.ctx.measureText(e);t.drawString(e,s-(n/2|0),r+(o/4|0))}parseTGA(t){const e=new l;e.load(new Uint8Array(t.buffer));const i=e.getCanvas();return i.getContext("2d").getImageData(0,0,i.width,i.height)}async readDataFile(t,e,i){t=`./data204/${t}`,this.showLoadingProgress(i,`Loading ${e} - 0%`);const r=c.openFile(t),n=new Int8Array(6);await r.readFully(n,0,6);const o=((255&n[0])<<16)+((255&n[1])<<8)+(255&n[2]),h=((255&n[3])<<16)+((255&n[4])<<8)+(255&n[5]);this.showLoadingProgress(i,`Loading ${e} - 5%`);let a=0;const l=new Int8Array(h);for(;a<h;){let t=h-a;t>1e3&&(t=1e3),await r.readFully(l,a,t),a+=t,this.showLoadingProgress(i,`Loading ${e} - `+(5+95*a/h|0)+"%")}if(this.showLoadingProgress(i,`Unpacking ${e}`),h!==o){const t=new Int8Array(o);return s.decompress(t,o,l,h,0),t}return l}getGraphics(){return this._graphics}async createSocket(t,e){const i=new h(t,e);return await i.connect(),i}}},3241:t=>{class e{constructor(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255;this.r=t,this.g=e,this.b=i,this.a=s}toCanvasStyle(){return`rgba(${this.r},${this.g}, ${this.b}, ${this.a})`}}e.white=new e(255,255,255),e.WHITE=e.white,e.lightGray=new e(192,192,192),e.LIGHT_GRAY=e.lightGray,e.gray=new e(128,128,128),e.GRAY=e.gray,e.darkGray=new e(64,64,64),e.DARK_GRAY=e.darkGray,e.black=new e(0,0,0),e.BLACK=e.black,e.red=new e(255,0,0),e.RED=e.red,e.pink=new e(255,175,175),e.PINK=e.pink,e.orange=new e(255,200,0),e.ORANGE=e.orange,e.yellow=new e(255,255,0),e.YELLOW=e.yellow,e.green=new e(0,255,0),e.GREEN=e.green,e.magenta=new e(255,0,255),e.MAGENTA=e.magenta,e.cyan=new e(0,255,255),e.CYAN=e.cyan,e.blue=new e(0,0,255),e.BLUE=e.blue,t.exports=e},8107:t=>{class e{constructor(t,e,i){this.name=t,this.type=e,this.size=i}toCanvasFont(){return`${this.getType()} ${this.size}px ${this.name}`}getType(){return 1===this.type?"bold":2===this.type?"italic":"normal"}}e.BOLD=1,t.exports=e},8695:t=>{t.exports=class{constructor(t){this.canvas=t,this.ctx=t.getContext("2d",{alpha:!1})}setColor(t){this.ctx.fillStyle=t.toCanvasStyle(),this.ctx.strokeStyle=t.toCanvasStyle()}fillRect(t,e,i,s){this.ctx.fillRect(t,e,i,s)}drawRect(t,e,i,s){this.ctx.strokeRect(t,e,i,s)}setFont(t){this.ctx.font=t.toCanvasFont()}drawString(t,e,i){this.ctx.fillText(t,e,i)}measureTextWidth(t){return this.ctx.measureText(t).width}drawImage(t,e,i){this.ctx.putImageData(t,e,i)}getImage(t,e){return this.ctx.getImageData(0,0,t,e)}}},1970:t=>{t.exports=class{constructor(t){this.url=t,this.xhr=new XMLHttpRequest,this.xhr.responseType="arraybuffer",this.xhr.open("GET",t,!0),this.buffer=null,this.pos=0}_loadResBytes(){return new Promise(((t,e)=>{this.xhr.onerror=t=>e(t),this.xhr.onload=()=>{/^2/.test(this.xhr.status)?t(new Int8Array(this.xhr.response)):e(new Error(`unable to download ${this.url}.\n                        status code = ${this.xhr.status}`))},this.xhr.send()}))}async readFully(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;void 0===i&&(i=t.length),this.buffer||(this.buffer=await this._loadResBytes()),t.set(this.buffer.slice(this.pos,this.pos+i),e),this.pos+=i}}},817:(t,e,i)=>{i(4300);const s=i(254);t.exports=class{constructor(t,e){this.host=t,this.port=e,this.client=null,this.connected=!1,this.bytesAvailable=0,this.buffers=[],this.currentBuffer=null,this.offset=0,this.bytesLeft=0}connect(){return new Promise(((t,e)=>{if("string"==typeof this.host)this.client=new WebSocket(`ws://${this.host}:${this.port}`,"binary");else if("Worker"===this.host.constructor.name)this.client=new s(this.host);else if("Peer"===this.host.constructor.name){const t=this.host,e={onmessage(){},postMessage(e){"data"===e.type&&(e.data=Buffer.from(e.data).toString("base64")),t.send(JSON.stringify(e))}};this.client=new s(e),t.on("data",(t=>{"data"===(t=JSON.parse(t)).type&&(t.data=Buffer.from(t.data,"base64")),e.onmessage({data:t})})),t.on("close",(()=>{e.onmessage({data:{type:"disconnect"}})}))}const i=setTimeout((()=>{this.connected||(this.client.close(),e(new Error("websocket connect timeout")))}),5e3);this.client.binaryType="arraybuffer",this.client.addEventListener("error",(t=>{this.onError&&(this.onError(t),this.onError=void 0),e(t)})),this.client.addEventListener("close",(()=>{this.onClose&&(this.onClose(-1),this.onClose=void 0),this.connected=!1,this.clear()})),this.client.addEventListener("message",(t=>{this.buffers.push(new Int8Array(t.data)),this.bytesAvailable+=t.data.byteLength,this.refreshCurrentBuffer(),this.onNextMessage&&(this.onNextMessage(t.data.byteLength),this.onNextMessage=void 0)})),this.client.addEventListener("open",(()=>{this.connected=!0,clearTimeout(i),t()}))}))}write(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(!this.connected)throw new Error("attempting to write to closed socket");i=-1===i?t.length:i,this.client.send(t.slice(e,e+i))}refreshCurrentBuffer(){0===this.bytesLeft&&this.bytesAvailable>0&&(this.currentBuffer=this.buffers.shift(),this.offset=0,this.currentBuffer&&this.currentBuffer.length?this.bytesLeft=this.currentBuffer.length:this.bytesLeft=0)}async read(){return this.connected?this.bytesLeft>0?(this.bytesLeft--,this.bytesAvailable--,255&this.currentBuffer[this.offset++]):-1===await new Promise(((t,e)=>{this.onClose=t,this.onError=e,this.onNextMessage=t}))?-1:await this.read():-1}async readBytes(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(!this.connected)return-1;if(i=-1===i?t.length:i,!(this.bytesAvailable>=i))return-1===await new Promise(((t,e)=>{this.onClose=t,this.onError=e,this.onNextMessage=t}))?-1:await this.readBytes(t,e,i);for(;i>0;)t[e++]=255&this.currentBuffer[this.offset++],this.bytesLeft-=1,this.bytesAvailable-=1,i-=1,0===this.bytesLeft&&this.refreshCurrentBuffer()}close(){this.connected&&this.client.close()}available(){return this.bytesAvailable}clear(){this.connected&&this.client.close(),this.currentBuffer=null,this.buffers.length=0,this.bytesLeft=0}}},254:(t,e,i)=>{const{uid:s}=i(8396);t.exports=class{constructor(t){this.worker=t,this.id=s(64),this.worker.onmessage=t=>{t.data.id===this.id&&("data"===t.data.type?this.dispatchEvent("message",t.data):"disconnect"===t.data.type&&this.dispatchEvent("close"))},this.handlers={},setTimeout((()=>{this.worker.postMessage({id:this.id,type:"connect"}),this.dispatchEvent("open")}),1)}send(t){this.worker.postMessage({id:this.id,type:"data",data:t})}dispatchEvent(t,e){const i=this.handlers[t];i&&i(e)}addEventListener(t,e){this.handlers[t]=e}close(){postMessage({id:this.id,type:"disconnect"}),this.dispatchEvent("close")}}},9923:(t,e,i)=>{const s=i(3241),r=i(8107),n=i(7910),o=i(6451),h=i(5575),a=i(5178),l=i(5822),c=i(3720),u=i(2184),d=i(5965),f=i(5179),m=i(1371),p=i(6848),g=i(1474),y=i(7767),w=i(4368),b=i(9438),C=(i(7278),i(8576)),I=i(7808),S=1250,v=250,x=500,T=500,A=5e3,k=1500,B=["torcha2","torcha3","torcha4","skulltorcha2","skulltorcha3","skulltorcha4","firea2","firea3","fireplacea2","fireplacea3","firespell2","firespell3","lightning2","lightning3","clawspell2","clawspell3","clawspell4","clawspell5","spellcharge2","spellcharge3"];t.exports=class extends h{constructor(t){super(t),w(this),this.packetHandlers=b(this),this.localRegionX=0,this.localRegionY=0,this.messageTabSelected=0,this.mouseClickXX=0,this.mouseClickXY=0,this.privateMessageTarget=new c(0),this.controlListQuest=0,this.controlListMagic=0,this.packetErrorCount=0,this.mouseButtonDownTime=0,this.mouseButtonItemCountIncrement=0,this.animationIndex=0,this.cameraRotationX=0,this.tradeConfirmAccepted=!1,this.appearanceHeadType=0,this.appearanceSkinColour=0,this.anInt707=0,this.deathScreenTimeout=0,this.cameraRotationY=0,this.welcomeUnreadMessages=0,this.logoutTimeout=0,this.tradeRecipientConfirmHash=new c(0),this.loginTimer=0,this.npcCombatModelArray1=new Int32Array([0,1,2,1,0,0,0,0]),this.npcCombatModelArray2=new Int32Array([0,0,0,0,0,1,2,1]),this.systemUpdate=0,this.graphics=null,this.regionX=0,this.regionY=0,this.welcomScreenAlreadyShown=!1,this.mouseButtonClick=0,this.healthBarCount=0,this.spriteMedia=0,this.spriteUtil=0,this.spriteItem=0,this.spriteProjectile=0,this.spriteTexture=0,this.spriteTextureWorld=0,this.spriteLogo=0,this.teleportBubbleCount=0,this.mouseClickCount=0,this.shopSellPriceMod=0,this.shopBuyPriceMod=0,this.duelOptionRetreat=0,this.duelOptionMagic=0,this.duelOptionPrayer=0,this.duelOptionWeapons=0,this.groundItemCount=0,this.receivedMessagesCount=0,this.messageTabFlashAll=0,this.messageTabFlashHistory=0,this.messageTabFlashQuest=0,this.messageTabFlashPrivate=0,this.bankItemCount=0,this.objectAnimationNumberFireLightningSpell=0,this.objectAnimationNumberTorch=0,this.objectAnimationNumberClaw=0,this.loggedIn=0,this.npcCount=0,this.npcCacheCount=0,this.objectAnimationCount=0,this.tradeConfirmItemsCount=0,this.mouseClickXStep=0,this.newBankItemCount=0,this.npcAnimationArray=[new Int32Array([11,2,9,7,1,6,10,0,5,8,3,4]),new Int32Array([11,2,9,7,1,6,10,0,5,8,3,4]),new Int32Array([11,3,2,9,7,1,6,10,0,5,8,4]),new Int32Array([3,4,2,9,7,1,6,10,8,11,0,5]),new Int32Array([3,4,2,9,7,1,6,10,8,11,0,5]),new Int32Array([4,3,2,9,7,1,6,10,8,11,0,5]),new Int32Array([11,4,2,9,7,1,6,10,0,5,8,3]),new Int32Array([11,2,9,7,1,6,10,0,5,8,4,3])],this.npcWalkModel=new Int32Array([0,1,2,1]),this.referID=0,this.combatTimeout=0,this.optionMenuCount=0,this.errorLoadingCodebase=!1,this.cameraRotationTime=0,this.duelOpponentItemsCount=0,this.duelItemsCount=0,this.duelOfferOpponentItemCount=0,this.characterHairColours=new Int32Array([16760880,16752704,8409136,6307872,3158064,16736288,16728064,16777215,65280,65535]),this.characterTopBottomColours=new Int32Array([16711680,16744448,16769024,10543104,57344,32768,41088,45311,33023,12528,14680288,3158064,6307840,8409088,16777215]),this.characterSkinColours=new Int32Array([15523536,13415270,11766848,10056486,9461792]),this.itemsAboveHeadCount=0,this.statFatigue=0,this.fatigueSleeping=0,this.tradeRecipientConfirmItemsCount=0,this.tradeRecipientItemsCount=0,this.showDialogServerMessage=!1,this.menuX=0,this.menuY=0,this.menuWidth=0,this.menuHeight=0,this.menuItemsCount=0,this.showUITab=0,this.tradeItemsCount=0,this.planeWidth=0,this.planeHeight=0,this.planeMultiplier=0,this.playerQuestPoints=0,this.welcomeLastLoggedInDays=0,this.inventoryItemsCount=0,this.duelOpponentNameHash=new c(0),this.minimapRandom1=0,this.minimapRandom2=0,this.objectCount=0,this.duelOfferItemCount=0,this.cameraAutoRotatePlayerX=0,this.cameraAutoRotatePlayerY=0,this.playerCount=0,this.knownPlayerCount=0,this.spriteCount=0,this.wallObjectCount=0,this.welcomeRecoverySetDays=0,this.localLowerX=0,this.localLowerY=0,this.localUpperX=0,this.localUpperY=0,this.world=null,this.welcomeLastLoggedInIP=0,this.sleepWordDelayTimer=0,this.menuIndices=new Int32Array(v),this.cameraAutoAngleDebug=!1,this.wallObjectDirection=new Int32Array(T),this.wallObjectId=new Int32Array(T),this.cameraRotationXIncrement=2,this.inventoryMaxItemCount=30,this.bankItemsMax=48,this.optionMenuEntry=[],this.optionMenuEntry.length=5,this.optionMenuEntry.fill(null),this.newBankItems=new Int32Array(256),this.newBankItemsCount=new Int32Array(256),this.teleportBubbleTime=new Int32Array(50),this.receivedMessageX=new Int32Array(50),this.receivedMessageY=new Int32Array(50),this.receivedMessageMidPoint=new Int32Array(50),this.receivedMessageHeight=new Int32Array(50),this.localPlayer=new o,this.localPlayerServerIndex=-1,this.menuItemX=new Int32Array(v),this.menuItemY=new Int32Array(v),this.bankItems=new Int32Array(256),this.bankItemsCount=new Int32Array(256),this.appearanceBodyGender=1,this.appearance2Colour=2,this.appearanceHairColour=2,this.appearanceTopColour=8,this.appearanceBottomColour=14,this.appearanceHeadGender=1,this.loginUser="",this.loginPass="",this.cameraAngle=1,this.members=!1,this.optionSoundDisabled=!1,this.showRightClickMenu=!1,this.cameraRotationYIncrement=2,this.objectAlreadyInMenu=new Int8Array(k),this.menuItemText1=[],this.menuItemText1.length=v,this.menuItemText1.fill(null),this.duelOpponentName="",this.lastObjectAnimationNumberFireLightningSpell=-1,this.lastObjectAnimationNumberTorch=-1,this.lastObjectAnimationNumberClaw=-1,this.planeIndex=-1,this.cameraRotation=128,this.teleportBubbleX=new Int32Array(50),this.errorLoadingData=!1,this.playerExperience=new Int32Array(18),this.tradeRecipientAccepted=!1,this.tradeAccepted=!1,this.mouseClickXHistory=new Int32Array(8192),this.mouseClickYHistory=new Int32Array(8192),this.playerServerIndexes=new Int32Array(x),this.teleportBubbleY=new Int32Array(50),this.receivedMessages=[],this.receivedMessages.length=50,this.receivedMessages.fill(null),this.showDialogDuelConfirm=!1,this.duelAccepted=!1,this.players=[],this.players.length=x,this.players.fill(null),this.prayerOn=new Int8Array(50),this.menuIndex=new Int32Array(v),this.menuSourceIndex=new Int32Array(v),this.menuTargetIndex=new Int32Array(v),this.wallObjectAlreadyInMenu=new Int8Array(T),this.magicLoc=128,this.errorLoadingMemory=!1,this.fogOfWar=!1,this.gameWidth=1024,this.gameHeight=668,this.tradeConfirmItems=new Int32Array(14),this.tradeConfirmItemCount=new Int32Array(14),this.tradeRecipientName="",this.selectedSpell=-1,this.showOptionMenu=!1,this.playerStatCurrent=new Int32Array(18),this.teleportBubbleType=new Int32Array(50),this.showDialogShop=!1,this.shopItem=new Int32Array(256),this.shopItemCount=new Int32Array(256),this.shopItemPrice=new Int32Array(256),this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1,this.gameModels=[],this.gameModels.length=1e3,this.gameModels.fill(null),this.showDialogDuel=!1,this.serverMessage="",this.duelOpponentItems=new Int32Array(8),this.duelOpponentItemCount=new Int32Array(8),this.duelItems=new Int32Array(8),this.duelItemCount=new Int32Array(8),this.playerStatBase=new Int32Array(18),this.npcsCache=[],this.npcsCache.length=500,this.npcsCache.fill(null),this.groundItemX=new Int32Array(A),this.groundItemY=new Int32Array(A),this.groundItemID=new Int32Array(A),this.groundItemZ=new Int32Array(A),this.bankSelectedItemSlot=-1,this.bankSelectedItem=-2,this.duelOfferOpponentItemId=new Int32Array(8),this.duelOfferOpponentItemStack=new Int32Array(8),this.messageHistoryTimeout=new Int32Array(5),this.optionCameraModeAuto=!0,this.objectX=new Int32Array(k),this.objectY=new Int32Array(k),this.objectId=new Int32Array(k),this.objectDirection=new Int32Array(k),this.selectedItemInventoryIndex=-1,this.selectedItemName="",this.loadingArea=!1,this.tradeRecipientConfirmItems=new Int32Array(14),this.tradeRecipientConfirmItemCount=new Int32Array(14),this.tradeRecipientItems=new Int32Array(14),this.tradeRecipientItemCount=new Int32Array(14),this.showDialogServerMessage=!1,this.menuType=new Int32Array(v),this.questComplete=new Int8Array(50),this.wallObjectModel=[],this.wallObjectModel.length=T,this.wallObjectModel.fill(null),this.actionBubbleX=new Int32Array(50),this.actionBubbleY=new Int32Array(50),this.cameraZoom=550,this.tradeItems=new Int32Array(14),this.tradeItemCount=new Int32Array(14),this.lastHeightOffset=-1,this.duelSettingsRetreat=!1,this.duelSettingsMagic=!1,this.duelSettingsPrayer=!1,this.duelSettingsWeapons=!1,this.showDialogBank=!1,this.loginUserDesc="",this.loginUserDisp="",this.optionMouseButtonOne=!1,this.inventoryItemId=new Int32Array(35),this.inventoryItemStackCount=new Int32Array(35),this.inventoryEquipped=new Int32Array(35),this.knownPlayers=[],this.knownPlayers.length=x,this.knownPlayers.fill(null),this.messageHistory=[],this.messageHistory.length=5,this.messageHistory.fill(null),this.duelOfferItemId=new Int32Array(8),this.duelOfferItemStack=new Int32Array(8),this.actionBubbleScale=new Int32Array(50),this.actionBubbleItem=new Int32Array(50),this.sleepWordDelay=!0,this.showAppearanceChange=!1,this.shopSelectedItemIndex=-1,this.shopSelectedItemType=-2,this.projectileMaxRange=40,this.npcs=[],this.npcs.length=500,this.npcs.fill(null),this.experienceArray=new Int32Array(99),this.healthBarX=new Int32Array(50),this.healthBarY=new Int32Array(50),this.healthBarMissing=new Int32Array(50),this.playerServer=[],this.playerServer.length=4e3,this.playerServer.fill(null),this.walkPathX=new Int32Array(8e3),this.walkPathY=new Int32Array(8e3),this.wallObjectX=new Int32Array(T),this.wallObjectY=new Int32Array(T),this.menuItemText2=[],this.menuItemText2.length=v,this.menuItemText2.fill(null),this.npcsServer=[],this.npcsServer.length=5e3,this.npcsServer.fill(null),this.playerStatEquipment=new Int32Array(5),this.objectModel=[],this.objectModel.length=k,this.objectModel.fill(null),this.playerMsgHistory=[],this.playerMsgPtr=0,this.recoveryQuestions=["Where were you born?","What was your first teachers name?","What is your fathers middle name?","Who was your first best friend?","What is your favourite vacation spot?","What is your mothers middle name?","What was your first pets name?","What was the name of your first school?","What is your mothers maiden name?","Who was your first boyfriend/girlfriend?","What was the first computer game you purchased?","Who is your favourite actor/actress?","Who is your favourite author?","Who is your favourite musician?","Who is your favourite cartoon character?","What is your favourite book?","What is your favourite food?","What is your favourite movie?"],this.showRecoverChange=!1,this.recoverCustomQuestionIndex=-1,this.showChangePasswordStep=0,this.changePasswordOld="",this.changePasswordNew="",this.welcomeTipDay=0}playSoundFile(t){if(!this.audioPlayer||this.optionSoundDisabled)return;const e=`${t}.pcm`;this.audioPlayer.writeStream(this.soundData,p.getDataFileOffset(e,this.soundData),p.getDataFileLength(e,this.soundData))}_walkToActionSource_from8(t,e,i,s,r,n,o,h){let a=this.world.route(t,e,i,s,r,n,this.walkPathX,this.walkPathY,o);if(-1===a){if(!h)return!1;a=1,this.walkPathX[0]=i,this.walkPathY[0]=s}a--,t=this.walkPathX[a],e=this.walkPathY[a],a--,h?this.packetStream.newPacket(C.WALK_ACTION):this.packetStream.newPacket(C.WALK),this.packetStream.putShort(t+this.regionX),this.packetStream.putShort(e+this.regionY),h&&-1===a&&(t+this.regionX)%5==0&&(a=0);for(let i=a;i>=0&&i>a-25;i--)this.packetStream.putByte(this.walkPathX[i]-t),this.packetStream.putByte(this.walkPathY[i]-e);return this.packetStream.sendPacket(),this.mouseClickXStep=-24,this.mouseClickXX=this.mouseX,this.mouseClickXY=this.mouseY,!0}walkTo(t,e,i,s,r,n,o,h){let a=this.world.route(t,e,i,s,r,n,this.walkPathX,this.walkPathY,o);if(-1===a)return!1;a--,t=this.walkPathX[a],e=this.walkPathY[a],a--,h?this.packetStream.newPacket(C.WALK_ACTION):this.packetStream.newPacket(C.WALK),this.packetStream.putShort(t+this.regionX),this.packetStream.putShort(e+this.regionY),h&&-1===a&&(t+this.regionX)%5==0&&(a=0);for(let i=a;i>=0&&i>a-25;i--)this.packetStream.putByte(this.walkPathX[i]-t),this.packetStream.putByte(this.walkPathY[i]-e);return this.packetStream.sendPacket(),this.mouseClickXStep=-24,this.mouseClickXX=this.mouseX,this.mouseClickXY=this.mouseY,!0}updateBankItems(){this.bankItemCount=this.newBankItemCount;for(let t=0;t<this.newBankItemCount;t++)this.bankItems[t]=this.newBankItems[t],this.bankItemsCount[t]=this.newBankItemsCount[t];for(let t=0;t<this.inventoryItemsCount&&!(this.bankItemCount>=this.bankItemsMax);t++){const e=this.inventoryItemId[t];let i=!1;for(let t=0;t<this.bankItemCount;t++)if(this.bankItems[t]===e){i=!0;break}i||(this.bankItems[this.bankItemCount]=e,this.bankItemsCount[this.bankItemCount]=0,this.bankItemCount++)}}drawAboveHeadStuff(){for(let t=0;t<this.receivedMessagesCount;t++){const e=this.surface.textHeight(1),i=this.receivedMessageX[t];let s=this.receivedMessageY[t];const r=this.receivedMessageMidPoint[t],n=this.receivedMessageHeight[t];let o=!0;for(;o;){o=!1;for(let h=0;h<t;h++)s+n>this.receivedMessageY[h]-e&&s-e<this.receivedMessageY[h]+this.receivedMessageHeight[h]&&i-r<this.receivedMessageX[h]+this.receivedMessageMidPoint[h]&&i+r>this.receivedMessageX[h]-this.receivedMessageMidPoint[h]&&this.receivedMessageY[h]-e-n<s&&(s=this.receivedMessageY[h]-e-n,o=!0)}this.receivedMessageY[t]=s,this.surface.drawParagraph(this.receivedMessages[t],i,s,1,16776960,300)}for(let t=0;t<this.itemsAboveHeadCount;t++){const e=this.actionBubbleX[t],i=this.actionBubbleY[t],s=this.actionBubbleScale[t],r=this.actionBubbleItem[t],n=39*s/100|0,o=27*s/100|0;this.surface.drawActionBubble(e-(n/2|0),i-o,n,o,this.spriteMedia+9,85);const h=36*s/100|0,l=24*s/100|0;this.surface._spriteClipping_from9(e-(h/2|0),i-o+(o/2|0)-(l/2|0),h,l,a.itemPicture[r]+this.spriteItem,a.itemMask[r],0,0,!1)}for(let t=0;t<this.healthBarCount;t++){const e=this.healthBarX[t],i=this.healthBarY[t],s=this.healthBarMissing[t];this.surface.drawBoxAlpha(e-15,i-3,s,5,65280,192),this.surface.drawBoxAlpha(e-15+s,i-3,30-s,5,16711680,192)}}_walkToActionSource_from5(t,e,i,s,r){this._walkToActionSource_from8(t,e,i,s,i,s,!1,r)}disposeAndCollect(){this.surface&&(this.surface.clear(),this.surface.pixels=null,this.surface=null),this.scene&&(this.scene.dispose(),this.scene=null),this.gameModels=null,this.objectModel=null,this.wallObjectModel=null,this.playerServer=null,this.players=null,this.npcsServer=null,this.npcs=null,this.localPlayer=null,this.world&&(this.world.terrainModels=null,this.world.wallModels=null,this.world.roofModels=null,this.world.parentModel=null,this.world=null)}drawUI(){if(0!==this.logoutTimeout)this.drawDialogLogout();else if(this.showDialogWelcome)this.drawDialogWelcome();else if(this.showDialogServerMessage)this.drawDialogServerMessage();else if(1===this.showUiWildWarn)this.drawDialogWildWarn();else if(this.showDialogBank&&0===this.combatTimeout)this.drawDialogBank();else if(this.showDialogShop&&0===this.combatTimeout)this.drawDialogShop();else if(this.showDialogTradeConfirm)this.drawDialogTradeConfirm();else if(this.showDialogTrade)this.drawDialogTrade();else if(this.showDialogDuelConfirm)this.drawDialogDuelConfirm();else if(this.showDialogDuel)this.drawDialogDuel();else if(1===this.showDialogReportAbuseStep)this.drawDialogReportAbuse();else if(2===this.showDialogReportAbuseStep)this.drawDialogReportAbuseInput();else if(0!==this.showChangePasswordStep)this.drawDialogChangePassword();else if(0!==this.showDialogSocialInput)this.drawDialogSocialInput();else{this.showOptionMenu&&(this.drawOptionMenu(),this.options.mobile&&(this.showUITab=0)),8!==this.localPlayer.animationCurrent&&9!==this.localPlayer.animationCurrent||this.drawDialogCombatStyle(),this.options.mobile?this.showOptionMenu||this.setActiveMobileUITab():this.setActiveUITab();const t=!this.showOptionMenu&&!this.showRightClickMenu;if(t&&(this.menuItemsCount=0),0===this.showUITab&&t&&this.createRightClickMenu(),1===this.showUITab?this.drawUiTabInventory(t):2===this.showUITab?this.drawUiTabMinimap(t):3===this.showUITab?this.drawUiTabPlayerInfo(t):4===this.showUITab?this.drawUiTabMagic(t):5===this.showUITab?this.drawUiTabSocial(t):6===this.showUITab&&this.drawUiTabOptions(t),this.showOptionMenu||(this.showRightClickMenu?this.drawRightClickMenu():this.createTopMouseMenu()),this.menuActionTimeout){const t=this.menuX<=this.gameWidth/2?8:-this.menuTextWidth-8;this.surface.drawBoxAlpha(t+this.menuX-4,this.menuY-4,this.menuTextWidth+4,18,12500670,192),this.surface.drawString(this.menuText,t+this.menuX-2,this.menuY+10,1,16777215),this.menuActionTimeout-=1}}this.mouseButtonClick=0}resetGame(){this.systemUpdate=0,this.combatStyle=0,this.logoutTimeout=0,this.loginScreen=0,this.loggedIn=1,this.resetPMText(),this.surface.blackScreen(),this.surface.draw(this.graphics,0,0);for(let t=0;t<this.objectCount;t++)this.scene.removeModel(this.objectModel[t]),this.world.removeObject(this.objectX[t],this.objectY[t],this.objectId[t]);for(let t=0;t<this.wallObjectCount;t++)this.scene.removeModel(this.wallObjectModel[t]),this.world.removeWallObject(this.wallObjectX[t],this.wallObjectY[t],this.wallObjectDirection[t],this.wallObjectId[t]);this.objectCount=0,this.wallObjectCount=0,this.groundItemCount=0,this.playerCount=0;for(let t=0;t<4e3;t++)this.playerServer[t]=null;for(let t=0;t<x;t++)this.players[t]=null;this.npcCount=0;for(let t=0;t<5e3;t++)this.npcsServer[t]=null;for(let t=0;t<500;t++)this.npcs[t]=null;for(let t=0;t<this.prayerOn.length;t++)this.prayerOn[t]=!1;this.mouseButtonClick=0,this.lastMouseButtonDown=0,this.mouseButtonDown=0,this.showDialogShop=!1,this.showDialogBank=!1,this.isSleeping=!1,this.friendListCount=0}handleKeyPress(t){if(0===this.loggedIn&&(0===this.loginScreen&&this.panelLoginWelcome&&this.panelLoginWelcome.keyPress(t),1===this.loginScreen&&this.panelLoginNewUser&&this.panelLoginNewUser.keyPress(t),2===this.loginScreen&&this.panelLoginExistingUser&&this.panelLoginExistingUser.keyPress(t),3===this.loginScreen&&this.panelRecoverUser&&this.panelRecoverUser.keyPress(t)),1===this.loggedIn){if(this.showAppearanceChange&&this.panelAppearance)return void this.panelAppearance.keyPress(t);0===this.showChangePasswordStep&&0===this.showDialogSocialInput&&0===this.showDialogReportAbuseStep&&!this.isSleeping&&this.panelMessageTabs&&this.panelMessageTabs.keyPress(t),3!==this.showChangePasswordStep&&4!==this.showChangePasswordStep||(this.showChangePasswordStep=0)}}sendLogout(){if(0!==this.loggedIn){if(!(this.combatTimeout>450))return this.combatTimeout>0?void this.showMessage("@cya@You can't logout for 10 seconds after combat",3):(this.packetStream.newPacket(C.LOGOUT),this.packetStream.sendPacket(),void(this.logoutTimeout=1e3));this.showMessage("@cya@You can't logout during combat!",3)}}createPlayer(t,e,i,s){null===this.playerServer[t]&&(this.playerServer[t]=new o,this.playerServer[t].serverIndex=t,this.playerServer[t].serverId=0);const r=this.playerServer[t];let n=!1;for(let e=0;e<this.knownPlayerCount;e++)if(this.knownPlayers[e].serverIndex===t){n=!0;break}if(n){r.animationNext=s;let t=r.waypointCurrent;e===r.waypointsX[t]&&i===r.waypointsY[t]||(r.waypointCurrent=t=(t+1)%10,r.waypointsX[t]=e,r.waypointsY[t]=i)}else r.serverIndex=t,r.movingStep=0,r.waypointCurrent=0,r.waypointsX[0]=r.currentX=e,r.waypointsY[0]=r.currentY=i,r.animationNext=r.animationCurrent=s,r.stepCount=0;return this.players[this.playerCount++]=r,r}drawItem(t,e,i,s,r){const n=a.itemPicture[r]+this.spriteItem,o=a.itemMask[r];this.surface._spriteClipping_from9(t,e,i,s,n,o,0,0,!1)}async handleGameInput(){if(this.systemUpdate>1&&this.systemUpdate--,await this.checkConnection(),this.logoutTimeout>0&&this.logoutTimeout--,this.mouseActionTimeout>4500&&0===this.combatTimeout&&0===this.logoutTimeout)return this.mouseActionTimeout-=500,void this.sendLogout();if(8!==this.localPlayer.animationCurrent&&9!==this.localPlayer.animationCurrent||(this.combatTimeout=500),this.combatTimeout>0&&this.combatTimeout--,this.showAppearanceChange)this.handleAppearancePanelInput();else{for(let t=0;t<this.playerCount;t++){const e=this.players[t];if(!e)return void console.log("null character at ",t,this.playerCount);let i=(e.waypointCurrent+1)%10;if(e.movingStep!==i){let t,s=-1,r=e.movingStep;t=r<i?i-r:10+i-r;let n=4;t>2&&(n=4*(t-1)),e.waypointsX[r]-e.currentX>3*this.magicLoc||e.waypointsY[r]-e.currentY>3*this.magicLoc||e.waypointsX[r]-e.currentX<3*-this.magicLoc||e.waypointsY[r]-e.currentY<3*-this.magicLoc||t>8?(e.currentX=e.waypointsX[r],e.currentY=e.waypointsY[r]):(e.currentX<e.waypointsX[r]?(e.currentX+=n,e.stepCount++,s=2):e.currentX>e.waypointsX[r]&&(e.currentX-=n,e.stepCount++,s=6),e.currentX-e.waypointsX[r]<n&&e.currentX-e.waypointsX[r]>-n&&(e.currentX=e.waypointsX[r]),e.currentY<e.waypointsY[r]?(e.currentY+=n,e.stepCount++,s=-1===s?4:2===s?3:5):e.currentY>e.waypointsY[r]&&(e.currentY-=n,e.stepCount++,s=-1===s?0:2===s?1:7),e.currentY-e.waypointsY[r]<n&&e.currentY-e.waypointsY[r]>-n&&(e.currentY=e.waypointsY[r])),-1!==s&&(e.animationCurrent=s),e.currentX===e.waypointsX[r]&&e.currentY===e.waypointsY[r]&&(e.movingStep=(r+1)%10)}else e.animationCurrent=e.animationNext;e.messageTimeout>0&&e.messageTimeout--,e.bubbleTimeout>0&&e.bubbleTimeout--,e.combatTimer>0&&e.combatTimer--,this.deathScreenTimeout>0&&(this.deathScreenTimeout--,0===this.deathScreenTimeout&&(this.showMessage("You have been granted another life. Be more careful this time!",3),this.showMessage("You retain your skills. Your objects land where you died",3)))}for(let t=0;t<this.npcCount;t++){const e=this.npcs[t];let i=(e.waypointCurrent+1)%10;if(e.movingStep!==i){let t,s=-1,r=e.movingStep;t=r<i?i-r:10+i-r;let n=4;t>2&&(n=4*(t-1)),e.waypointsX[r]-e.currentX>3*this.magicLoc||e.waypointsY[r]-e.currentY>3*this.magicLoc||e.waypointsX[r]-e.currentX<3*-this.magicLoc||e.waypointsY[r]-e.currentY<3*-this.magicLoc||t>8?(e.currentX=e.waypointsX[r],e.currentY=e.waypointsY[r]):(e.currentX<e.waypointsX[r]?(e.currentX+=n,e.stepCount++,s=2):e.currentX>e.waypointsX[r]&&(e.currentX-=n,e.stepCount++,s=6),e.currentX-e.waypointsX[r]<n&&e.currentX-e.waypointsX[r]>-n&&(e.currentX=e.waypointsX[r]),e.currentY<e.waypointsY[r]?(e.currentY+=n,e.stepCount++,s=-1===s?4:2===s?3:5):e.currentY>e.waypointsY[r]&&(e.currentY-=n,e.stepCount++,s=-1===s?0:2===s?1:7),e.currentY-e.waypointsY[r]<n&&e.currentY-e.waypointsY[r]>-n&&(e.currentY=e.waypointsY[r])),-1!==s&&(e.animationCurrent=s),e.currentX===e.waypointsX[r]&&e.currentY===e.waypointsY[r]&&(e.movingStep=(r+1)%10)}else e.animationCurrent=e.animationNext,43===e.npcId&&e.stepCount++;e.messageTimeout>0&&e.messageTimeout--,e.bubbleTimeout>0&&e.bubbleTimeout--,e.combatTimer>0&&e.combatTimer--}2!==this.showUITab&&(m.anInt346>0&&this.sleepWordDelayTimer++,m.anInt347>0&&(this.sleepWordDelayTimer=0),m.anInt346=0,m.anInt347=0);for(let t=0;t<this.playerCount;t++){const e=this.players[t];e.projectileRange>0&&e.projectileRange--}if(this.cameraAutoAngleDebug)(this.cameraAutoRotatePlayerX-this.localPlayer.currentX<-500||this.cameraAutoRotatePlayerX-this.localPlayer.currentX>500||this.cameraAutoRotatePlayerY-this.localPlayer.currentY<-500||this.cameraAutoRotatePlayerY-this.localPlayer.currentY>500)&&(this.cameraAutoRotatePlayerX=this.localPlayer.currentX,this.cameraAutoRotatePlayerY=this.localPlayer.currentY);else if((this.cameraAutoRotatePlayerX-this.localPlayer.currentX<-500||this.cameraAutoRotatePlayerX-this.localPlayer.currentX>500||this.cameraAutoRotatePlayerY-this.localPlayer.currentY<-500||this.cameraAutoRotatePlayerY-this.localPlayer.currentY>500)&&(this.cameraAutoRotatePlayerX=this.localPlayer.currentX,this.cameraAutoRotatePlayerY=this.localPlayer.currentY),this.cameraAutoRotatePlayerX!==this.localPlayer.currentX&&(this.cameraAutoRotatePlayerX+=(this.localPlayer.currentX-this.cameraAutoRotatePlayerX)/(16+((this.cameraZoom-500)/15|0))|0),this.cameraAutoRotatePlayerY!==this.localPlayer.currentY&&(this.cameraAutoRotatePlayerY+=(this.localPlayer.currentY-this.cameraAutoRotatePlayerY)/(16+((this.cameraZoom-500)/15|0))|0),this.optionCameraModeAuto){let t=32*this.cameraAngle-this.cameraRotation,e=1;0!==t?(this.anInt707++,t>128?(e=-1,t=256-t):t>0?e=1:t<-128?(e=1,t=256+t):t<0&&(e=-1,t=-t),this.cameraRotation+=((this.anInt707*t+255)/256|0)*e,this.cameraRotation&=255):this.anInt707=0}if(this.sleepWordDelayTimer>20&&(this.sleepWordDelay=!1,this.sleepWordDelayTimer=0),this.isSleeping)this.handleSleepInput();else{if(await this.handleMesssageTabsInput(),0!==this.deathScreenTimeout&&(this.lastMouseButtonDown=0),this.showDialogTrade||this.showDialogDuel?(0!==this.mouseButtonDown?this.mouseButtonDownTime++:this.mouseButtonDownTime=0,this.mouseButtonDownTime>600?this.mouseButtonItemCountIncrement+=5e3:this.mouseButtonDownTime>450?this.mouseButtonItemCountIncrement+=500:this.mouseButtonDownTime>300?this.mouseButtonItemCountIncrement+=50:this.mouseButtonDownTime>150?this.mouseButtonItemCountIncrement+=5:(this.mouseButtonDownTime>50||this.mouseButtonDownTime>20&&0==(5&this.mouseButtonDownTime))&&this.mouseButtonItemCountIncrement++):(this.mouseButtonDownTime=0,this.mouseButtonItemCountIncrement=0),1===this.lastMouseButtonDown?this.mouseButtonClick=1:2===this.lastMouseButtonDown&&(this.mouseButtonClick=2),this.scene.setMouseLoc(this.mouseX,this.mouseY),this.lastMouseButtonDown=0,this.optionCameraModeAuto){if(0===this.anInt707||this.cameraAutoAngleDebug){if(this.keyLeft&&(this.cameraAngle=this.cameraAngle+1&7,this.keyLeft=!1,!this.fogOfWar)){0==(1&this.cameraAngle)&&(this.cameraAngle=this.cameraAngle+1&7);for(let t=0;t<8&&!this.isValidCameraAngle(this.cameraAngle);t++)this.cameraAngle=this.cameraAngle+1&7}if(this.keyRight&&(this.cameraAngle=this.cameraAngle+7&7,this.keyRight=!1,!this.fogOfWar)){0==(1&this.cameraAngle)&&(this.cameraAngle=this.cameraAngle+7&7);for(let t=0;t<8&&!this.isValidCameraAngle(this.cameraAngle);t++)this.cameraAngle=this.cameraAngle+7&7}}}else this.keyLeft?this.cameraRotation=this.cameraRotation+2&255:this.keyRight&&(this.cameraRotation=this.cameraRotation-2&255);!this.optionCameraModeAuto&&this.options.middleClickCamera&&this.middleButtonDown&&(this.cameraRotation=this.originRotation+(this.mouseX-this.originMouseX)/2&255),this.options.zoomCamera?this.handleCameraZoom():this.fogOfWar&&this.cameraZoom>550?this.cameraZoom-=4:!this.fogOfWar&&this.cameraZoom<750&&(this.cameraZoom+=4),this.mouseClickXStep>0?this.mouseClickXStep--:this.mouseClickXStep<0&&this.mouseClickXStep++,this.scene.doSOemthingWithTheFuckinFountainFuck(17),this.objectAnimationCount++,this.objectAnimationCount>5&&(this.objectAnimationCount=0,this.objectAnimationNumberFireLightningSpell=(this.objectAnimationNumberFireLightningSpell+1)%3,this.objectAnimationNumberTorch=(this.objectAnimationNumberTorch+1)%4,this.objectAnimationNumberClaw=(this.objectAnimationNumberClaw+1)%5);for(let t=0;t<this.objectCount;t++){const e=this.objectX[t],i=this.objectY[t];e>=0&&i>=0&&e<96&&i<96&&74===this.objectId[t]&&this.objectModel[t].rotate(1,0,0)}for(let t=0;t<this.teleportBubbleCount;t++)if(this.teleportBubbleTime[t]++,this.teleportBubbleTime[t]>50){this.teleportBubbleCount--;for(let e=t;e<this.teleportBubbleCount;e++)this.teleportBubbleX[e]=this.teleportBubbleX[e+1],this.teleportBubbleY[e]=this.teleportBubbleY[e+1],this.teleportBubbleTime[e]=this.teleportBubbleTime[e+1],this.teleportBubbleType[e]=this.teleportBubbleType[e+1]}}}}handleCameraZoom(){if(this.keyUp&&!this.ctrl?this.cameraZoom-=16:this.keyDown&&!this.ctrl?this.cameraZoom+=16:this.keyHome?this.cameraZoom=750:this.keyPgUp?this.cameraZoom=450:this.keyPgDown&&(this.cameraZoom=S),0!==this.mouseScrollDelta&&(2===this.showUITab||0===this.showUITab)){if(0!==this.messageTabSelected&&(this.options.mobile&&this.mouseY<70||!this.options.mobile&&this.mouseY>this.gameHeight-64))return;this.cameraZoom+=24*this.mouseScrollDelta}this.cameraZoom>=S?this.cameraZoom=S:this.cameraZoom<=450&&(this.cameraZoom=450)}autoRotateCamera(){if(1==(1&this.cameraAngle)&&this.isValidCameraAngle(this.cameraAngle))return;if(0==(1&this.cameraAngle)&&this.isValidCameraAngle(this.cameraAngle))return this.isValidCameraAngle(this.cameraAngle+1&7)?void(this.cameraAngle=this.cameraAngle+1&7):void(this.isValidCameraAngle(this.cameraAngle+7&7)&&(this.cameraAngle=this.cameraAngle+7&7));let t=new Int32Array([1,-1,2,-2,3,-3,4]);for(let e=0;e<7;e++)if(this.isValidCameraAngle(this.cameraAngle+t[e]+8&7)){this.cameraAngle=this.cameraAngle+t[e]+8&7;break}if(0==(1&this.cameraAngle)&&this.isValidCameraAngle(this.cameraAngle)){if(this.isValidCameraAngle(this.cameraAngle+1&7))return void(this.cameraAngle=this.cameraAngle+1&7);this.isValidCameraAngle(this.cameraAngle+7&7)&&(this.cameraAngle=this.cameraAngle+7&7)}}drawRightClickMenu(){if(0!==this.mouseButtonClick){for(let t=0;t<this.menuItemsCount;t++){const e=this.menuX+2,i=this.menuY+27+15*t;if(!(this.mouseX<=e-2||this.mouseY<=i-12||this.mouseY>=i+4||this.mouseX>=e-3+this.menuWidth)){this.menuItemClick(this.menuIndices[t]);break}}return this.mouseButtonClick=0,void(this.showRightClickMenu=!1)}const t=this.mouseX<this.menuX-30,e=this.mouseY<this.menuY-30,i=this.mouseX>this.menuX+this.menuWidth+30,s=this.mouseY>this.menuY+this.menuHeight+30;if(t||e||i||s)this.showRightClickMenu=!1;else{this.surface.drawBoxAlpha(this.menuX,this.menuY,this.menuWidth,this.menuHeight,13684944,160),this.surface.drawString("Choose option",this.menuX+2,this.menuY+12,1,65535);for(let t=0;t<this.menuItemsCount;t++){const e=this.menuX+2,i=this.menuY+27+15*t;let s=16777215;this.mouseX>e-2&&this.mouseY>i-12&&this.mouseY<i+4&&this.mouseX<e-3+this.menuWidth&&(s=16776960),this.surface.drawString(this.menuItemText1[this.menuIndices[t]]+" "+this.menuItemText2[this.menuIndices[t]],e,i,1,s)}}}drawNpc(t,e,i,s,r,n,o){const h=this.npcs[r];let l=h.animationCurrent+(this.cameraRotation+16)/32&7,c=!1,u=l;5===u?(u=3,c=!0):6===u?(u=2,c=!0):7===u&&(u=1,c=!0);let d=3*u+this.npcWalkModel[(h.stepCount/a.npcWalkModel[h.npcId]|0)%4];8===h.animationCurrent?(u=5,l=2,c=!1,t-=a.npcCombatAnimation[h.npcId]*o/100|0,d=3*u+this.npcCombatModelArray1[((this.loginTimer/a.npcCombatModel[h.npcId]|0)-1)%8]):9===h.animationCurrent&&(u=5,l=2,c=!0,t+=a.npcCombatAnimation[h.npcId]*o/100|0,d=3*u+this.npcCombatModelArray2[(this.loginTimer/a.npcCombatModel[h.npcId]|0)%8]);for(let r=0;r<12;r++){let o=this.npcAnimationArray[l][r],f=a.npcSprite.get(h.npcId,o);if(f>=0){let r=0,o=0,l=d;if(c&&u>=1&&u<=3&&1===a.animationHasF[f]&&(l+=15),5!==u||1===a.animationHasA[f]){let u=l+a.animationNumber[f];r=r*i/this.surface.spriteWidthFull[u]|0,o=o*s/this.surface.spriteHeightFull[u]|0;let d=i*this.surface.spriteWidthFull[u]/this.surface.spriteWidthFull[a.animationNumber[f]]|0;r-=(d-i)/2|0;let m=a.animationCharacterColour[f],p=0;1===m?(m=a.npcColourHair[h.npcId],p=a.npcColourSkin[h.npcId]):2===m?(m=a.npcColourTop[h.npcId],p=a.npcColourSkin[h.npcId]):3===m&&(m=a.npcColorBottom[h.npcId],p=a.npcColourSkin[h.npcId]),this.surface._spriteClipping_from9(t+r,e+o,d,s,u,m,p,n,c)}}}if(h.messageTimeout>0&&(this.receivedMessageMidPoint[this.receivedMessagesCount]=this.surface.textWidth(h.message,1)/2|0,this.receivedMessageMidPoint[this.receivedMessagesCount]>150&&(this.receivedMessageMidPoint[this.receivedMessagesCount]=150),this.receivedMessageHeight[this.receivedMessagesCount]=(this.surface.textWidth(h.message,1)/300|0)*this.surface.textHeight(1),this.receivedMessageX[this.receivedMessagesCount]=t+(i/2|0),this.receivedMessageY[this.receivedMessagesCount]=e,this.receivedMessages[this.receivedMessagesCount++]=h.message),8===h.animationCurrent||9===h.animationCurrent||0!==h.combatTimer){if(h.combatTimer>0){let s=t;8===h.animationCurrent?s-=20*o/100|0:9===h.animationCurrent&&(s+=20*o/100|0);let r=30*h.healthCurrent/h.healthMax|0;this.healthBarX[this.healthBarCount]=s+(i/2|0),this.healthBarY[this.healthBarCount]=e,this.healthBarMissing[this.healthBarCount++]=r}if(h.combatTimer>150){let r=t;8===h.animationCurrent?r-=10*o/100|0:9===h.animationCurrent&&(r+=10*o/100|0),this.surface._drawSprite_from3(r+(i/2|0)-12,e+(s/2|0)-12,this.spriteMedia+12),this.surface.drawStringCenter(h.damageTaken.toString(),r+(i/2|0)-1,e+(s/2|0)+5,3,16777215)}}}walkToWallObject(t,e,i){0===i?this._walkToActionSource_from8(this.localRegionX,this.localRegionY,t,e-1,t,e,!1,!0):1===i?this._walkToActionSource_from8(this.localRegionX,this.localRegionY,t-1,e,t,e,!1,!0):this._walkToActionSource_from8(this.localRegionX,this.localRegionY,t,e,t,e,!0,!0)}async loadGameConfig(){const t=await this.readDataFile(`config${I.CONFIG}.jag`,"Configuration",10);if(!t)return void(this.errorLoadingData=!0);a.loadData(t,this.members);const e=await this.readDataFile(`filter${I.FILTER}.jag`,"Chat system",15);if(!e)return void(this.errorLoadingData=!0);const i=new n(p.loadData("fragmentsenc.txt",0,e)),s=new n(p.loadData("badenc.txt",0,e)),r=new n(p.loadData("hostenc.txt",0,e)),o=new n(p.loadData("tldlist.txt",0,e));g.loadFilters(i,s,r,o)}addNpc(t,e,i,s,r){null===this.npcsServer[t]&&(this.npcsServer[t]=new o,this.npcsServer[t].serverIndex=t);const n=this.npcsServer[t];let h=!1;for(let e=0;e<this.npcCacheCount;e++)if(this.npcsCache[e].serverIndex===t){h=!0;break}if(h){n.npcId=r,n.animationNext=s;let t=n.waypointCurrent;e===n.waypointsX[t]&&i===n.waypointsY[t]||(n.waypointCurrent=t=(t+1)%10,n.waypointsX[t]=e,n.waypointsY[t]=i)}else n.serverIndex=t,n.movingStep=0,n.waypointCurrent=0,n.waypointsX[0]=n.currentX=e,n.waypointsY[0]=n.currentY=i,n.npcId=r,n.animationNext=n.animationCurrent=s,n.stepCount=0;return this.npcs[this.npcCount++]=n,n}resetLoginVars(){this.systemUpdate=0,this.loginScreen=0,this.loggedIn=0,this.logoutTimeout=0}drawDialogDuel(){if(0!==this.mouseButtonClick&&0===this.mouseButtonItemCountIncrement&&(this.mouseButtonItemCountIncrement=1),this.mouseButtonItemCountIncrement>0){let t=this.mouseX-22,e=this.mouseY-36;if(t>=0&&e>=0&&t<468&&e<262){if(t>216&&e>30&&t<462&&e<235){let i=((t-217|0)/49|0)+5*((e-31)/34|0);if(i>=0&&i<this.inventoryItemsCount){let t=!1,e=0,s=this.inventoryItemId[i];for(let r=0;r<this.duelOfferItemCount;r++)if(this.duelOfferItemId[r]===s)if(0===a.itemStackable[s])for(let e=0;e<this.mouseButtonItemCountIncrement;e++)this.duelOfferItemStack[r]<this.inventoryItemStackCount[i]&&this.duelOfferItemStack[r]++,t=!0;else e++;if(this.getInventoryCount(s)<=e&&(t=!0),1===a.itemSpecial[s]&&(this.showMessage("This object cannot be added to a duel offer",3),t=!0),!t&&this.duelOfferItemCount<8&&(this.duelOfferItemId[this.duelOfferItemCount]=s,this.duelOfferItemStack[this.duelOfferItemCount]=1,this.duelOfferItemCount++,t=!0),t){this.packetStream.newPacket(C.DUEL_ITEM_UPDATE),this.packetStream.putByte(this.duelOfferItemCount);for(let t=0;t<this.duelOfferItemCount;t++)this.packetStream.putShort(this.duelOfferItemId[t]),this.packetStream.putInt(this.duelOfferItemStack[t]);this.packetStream.sendPacket(),this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1}}}if(t>8&&e>30&&t<205&&e<129){let i=((t-9)/49|0)+4*((e-31)/34|0);if(i>=0&&i<this.duelOfferItemCount){let t=this.duelOfferItemId[i];for(let e=0;e<this.mouseButtonItemCountIncrement;e++){if(!(0===a.itemStackable[t]&&this.duelOfferItemStack[i]>1)){this.duelOfferItemCount--,this.mouseButtonDownTime=0;for(let t=i;t<this.duelOfferItemCount;t++)this.duelOfferItemId[t]=this.duelOfferItemId[t+1],this.duelOfferItemStack[t]=this.duelOfferItemStack[t+1];break}this.duelOfferItemStack[i]--}this.packetStream.newPacket(C.DUEL_ITEM_UPDATE),this.packetStream.putByte(this.duelOfferItemCount);for(let t=0;t<this.duelOfferItemCount;t++)this.packetStream.putShort(this.duelOfferItemId[t]),this.packetStream.putInt(this.duelOfferItemStack[t]);this.packetStream.sendPacket(),this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1}}let i=!1;t>=93&&e>=221&&t<=104&&e<=232&&(this.duelSettingsRetreat=!this.duelSettingsRetreat,i=!0),t>=93&&e>=240&&t<=104&&e<=251&&(this.duelSettingsMagic=!this.duelSettingsMagic,i=!0),t>=191&&e>=221&&t<=202&&e<=232&&(this.duelSettingsPrayer=!this.duelSettingsPrayer,i=!0),t>=191&&e>=240&&t<=202&&e<=251&&(this.duelSettingsWeapons=!this.duelSettingsWeapons,i=!0),i&&(this.packetStream.newPacket(C.DUEL_SETTINGS),this.packetStream.putByte(this.duelSettingsRetreat?1:0),this.packetStream.putByte(this.duelSettingsMagic?1:0),this.packetStream.putByte(this.duelSettingsPrayer?1:0),this.packetStream.putByte(this.duelSettingsWeapons?1:0),this.packetStream.sendPacket(),this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1),t>=217&&e>=238&&t<=286&&e<=259&&(this.duelOfferAccepted=!0,this.packetStream.newPacket(C.DUEL_ACCEPT),this.packetStream.sendPacket()),t>=394&&e>=238&&t<463&&e<259&&(this.showDialogDuel=!1,this.packetStream.newPacket(C.DUEL_DECLINE),this.packetStream.sendPacket())}else 0!==this.mouseButtonClick&&(this.showDialogDuel=!1,this.packetStream.newPacket(C.DUEL_DECLINE),this.packetStream.sendPacket());this.mouseButtonClick=0,this.mouseButtonItemCountIncrement=0}if(!this.showDialogDuel)return;this.surface.drawBox(22,36,468,12,13175581),this.surface.drawBoxAlpha(22,48,468,18,10000536,160),this.surface.drawBoxAlpha(22,66,8,248,10000536,160),this.surface.drawBoxAlpha(227,66,11,248,10000536,160),this.surface.drawBoxAlpha(484,66,6,248,10000536,160),this.surface.drawBoxAlpha(30,135,197,24,10000536,160),this.surface.drawBoxAlpha(30,228,197,23,10000536,160),this.surface.drawBoxAlpha(30,294,197,20,10000536,160),this.surface.drawBoxAlpha(238,271,246,43,10000536,160),this.surface.drawBoxAlpha(30,66,197,69,13684944,160),this.surface.drawBoxAlpha(30,159,197,69,13684944,160),this.surface.drawBoxAlpha(30,251,197,43,13684944,160),this.surface.drawBoxAlpha(238,66,246,205,13684944,160);for(let t=0;t<3;t++)this.surface.drawLineHoriz(30,66+34*t,197,0);for(let t=0;t<3;t++)this.surface.drawLineHoriz(30,159+34*t,197,0);for(let t=0;t<7;t++)this.surface.drawLineHoriz(238,66+34*t,246,0);for(let t=0;t<6;t++)t<5&&this.surface.drawLineVert(30+49*t,66,69,0),t<5&&this.surface.drawLineVert(30+49*t,159,69,0),this.surface.drawLineVert(238+49*t,66,205,0);this.surface.drawLineHoriz(30,251,197,0),this.surface.drawLineHoriz(30,293,197,0),this.surface.drawLineVert(30,251,43,0),this.surface.drawLineVert(226,251,43,0),this.surface.drawString("Preparing to duel with: "+this.duelOpponentName,23,46,1,16777215),this.surface.drawString("Your Stake",31,63,4,16777215),this.surface.drawString("Opponent's Stake",31,156,4,16777215),this.surface.drawString("Duel Options",31,248,4,16777215),this.surface.drawString("Your Inventory",238,63,4,16777215),this.surface.drawString("No retreating",31,267,3,16776960),this.surface.drawString("No magic",31,286,3,16776960),this.surface.drawString("No prayer",132,267,3,16776960),this.surface.drawString("No weapons",132,286,3,16776960),this.surface.drawBoxEdge(115,257,11,11,16776960),this.duelSettingsRetreat&&this.surface.drawBox(117,259,7,7,16776960),this.surface.drawBoxEdge(115,276,11,11,16776960),this.duelSettingsMagic&&this.surface.drawBox(117,278,7,7,16776960),this.surface.drawBoxEdge(213,257,11,11,16776960),this.duelSettingsPrayer&&this.surface.drawBox(215,259,7,7,16776960),this.surface.drawBoxEdge(213,276,11,11,16776960),this.duelSettingsWeapons&&this.surface.drawBox(215,278,7,7,16776960),this.duelOfferAccepted||this.surface._drawSprite_from3(239,274,this.spriteMedia+25),this.surface._drawSprite_from3(416,274,this.spriteMedia+26),this.duelOfferOpponentAccepted&&(this.surface.drawStringCenter("Other player",363,282,1,16777215),this.surface.drawStringCenter("has accepted",363,292,1,16777215)),this.duelOfferAccepted&&(this.surface.drawStringCenter("Waiting for",274,282,1,16777215),this.surface.drawStringCenter("other player",274,292,1,16777215));for(let t=0;t<this.inventoryItemsCount;t++){let e=239+t%5*49,i=67+34*(t/5|0);this.surface._spriteClipping_from9(e,i,48,32,this.spriteItem+a.itemPicture[this.inventoryItemId[t]],a.itemMask[this.inventoryItemId[t]],0,0,!1),0===a.itemStackable[this.inventoryItemId[t]]&&this.surface.drawString(this.inventoryItemStackCount[t].toString(),e+1,i+10,1,16776960)}for(let t=0;t<this.duelOfferItemCount;t++){let e=31+t%4*49,i=67+34*(t/4|0);this.surface._spriteClipping_from9(e,i,48,32,this.spriteItem+a.itemPicture[this.duelOfferItemId[t]],a.itemMask[this.duelOfferItemId[t]],0,0,!1),0===a.itemStackable[this.duelOfferItemId[t]]&&this.surface.drawString(this.duelOfferItemStack[t].toString(),e+1,i+10,1,16776960),this.mouseX>e&&this.mouseX<e+48&&this.mouseY>i&&this.mouseY<i+32&&this.surface.drawString(a.itemName[this.duelOfferItemId[t]]+": @whi@"+a.itemDescription[this.duelOfferItemId[t]],30,309,1,16776960)}for(let t=0;t<this.duelOfferOpponentItemCount;t++){let e=31+t%4*49,i=160+34*(t/4|0);this.surface._spriteClipping_from9(e,i,48,32,this.spriteItem+a.itemPicture[this.duelOfferOpponentItemId[t]],a.itemMask[this.duelOfferOpponentItemId[t]],0,0,!1),0===a.itemStackable[this.duelOfferOpponentItemId[t]]&&this.surface.drawString(this.duelOfferOpponentItemStack[t].toString(),e+1,i+10,1,16776960),this.mouseX>e&&this.mouseX<e+48&&this.mouseY>i&&this.mouseY<i+32&&this.surface.drawString(a.itemName[this.duelOfferOpponentItemId[t]]+": @whi@"+a.itemDescription[this.duelOfferOpponentItemId[t]],30,309,1,16776960)}}loadNextRegion(t,e){if(0!==this.deathScreenTimeout)return this.world.playerAlive=!1,!1;if(this.loadingArea=!1,t+=this.planeWidth,e+=this.planeHeight,this.lastHeightOffset===this.planeIndex&&t>this.localLowerX&&t<this.localUpperX&&e>this.localLowerY&&e<this.localUpperY)return this.world.playerAlive=!0,!1;this.surface.drawStringCenter("Loading... Please wait",256,192,1,16777215),this.drawChatMessageTabs(),this.surface.draw(this.graphics,0,0);let i=this.regionX,s=this.regionY,r=(t+24)/48|0,n=(e+24)/48|0;this.lastHeightOffset=this.planeIndex,this.regionX=48*r-48,this.regionY=48*n-48,this.localLowerX=48*r-32,this.localLowerY=48*n-32,this.localUpperX=48*r+32,this.localUpperY=48*n+32,this.world._loadSection_from3(t,e,this.lastHeightOffset),this.regionX-=this.planeWidth,this.regionY-=this.planeHeight;let o=this.regionX-i,h=this.regionY-s;for(let t=0;t<this.objectCount;t++){this.objectX[t]-=o,this.objectY[t]-=h;let e=this.objectX[t],i=this.objectY[t],s=this.objectId[t],r=this.objectModel[t];try{let n=this.objectDirection[t],o=0,h=0;0===n||4===n?(o=a.objectWidth[s],h=a.objectHeight[s]):(h=a.objectWidth[s],o=a.objectHeight[s]);let l=(e+e+o)*this.magicLoc/2|0,c=(i+i+h)*this.magicLoc/2|0;e>=0&&i>=0&&e<96&&i<96&&(this.scene.addModel(r),r.place(l,-this.world.getElevation(l,c),c),this.world.removeObject2(e,i,s),74===s&&r.translate(0,-480,0))}catch(t){console.log("Loc Error: "+t.message),console.error(t)}}for(let t=0;t<this.wallObjectCount;t++){this.wallObjectX[t]-=o,this.wallObjectY[t]-=h;let e=this.wallObjectX[t],i=this.wallObjectY[t],s=this.wallObjectId[t],r=this.wallObjectDirection[t];try{this.world._setObjectAdjacency_from4(e,i,r,s);let n=this.createModel(e,i,r,s,t);this.wallObjectModel[t]=n}catch(t){console.log("Bound Error: "+t.message),console.error(t)}}for(let t=0;t<this.groundItemCount;t++)this.groundItemX[t]-=o,this.groundItemY[t]-=h;for(let t=0;t<this.playerCount;t++){let e=this.players[t];e.currentX-=o*this.magicLoc,e.currentY-=h*this.magicLoc;for(let t=0;t<=e.waypointCurrent;t++)e.waypointsX[t]-=o*this.magicLoc,e.waypointsY[t]-=h*this.magicLoc}for(let t=0;t<this.npcCount;t++){let e=this.npcs[t];e.currentX-=o*this.magicLoc,e.currentY-=h*this.magicLoc;for(let t=0;t<=e.waypointCurrent;t++)e.waypointsX[t]-=o*this.magicLoc,e.waypointsY[t]-=h*this.magicLoc}return this.world.playerAlive=!0,!0}drawPlayer(t,e,i,s,r,n,o){const h=this.players[r];if(255===h.colourBottom)return;let l=h.animationCurrent+(this.cameraRotation+16)/32&7,c=!1,u=l;5===u?(u=3,c=!0):6===u?(u=2,c=!0):7===u&&(u=1,c=!0);let d=3*u+this.npcWalkModel[(h.stepCount/6|0)%4];8===h.animationCurrent?(u=5,l=2,c=!1,t-=5*o/100|0,d=3*u+this.npcCombatModelArray1[(this.loginTimer/5|0)%8]):9===h.animationCurrent&&(u=5,l=2,c=!0,t+=5*o/100|0,d=3*u+this.npcCombatModelArray2[(this.loginTimer/6|0)%8]);for(let r=0;r<12;r++){let o=this.npcAnimationArray[l][r],f=h.equippedItem[o]-1;if(f>=0){let r=0,l=0,m=d;if(c&&u>=1&&u<=3&&(1===a.animationHasF[f]?m+=15:4===o&&1===u?(r=-22,l=-3,m=3*u+this.npcWalkModel[(2+(h.stepCount/6|0))%4]):4===o&&2===u?(r=0,l=-8,m=3*u+this.npcWalkModel[(2+(h.stepCount/6|0))%4]):4===o&&3===u?(r=26,l=-5,m=3*u+this.npcWalkModel[(2+(h.stepCount/6|0))%4]):3===o&&1===u?(r=22,l=3,m=3*u+this.npcWalkModel[(2+(h.stepCount/6|0))%4]):3===o&&2===u?(r=0,l=8,m=3*u+this.npcWalkModel[(2+(h.stepCount/6|0))%4]):3===o&&3===u&&(r=-26,l=5,m=3*u+this.npcWalkModel[(2+(h.stepCount/6|0))%4])),5!==u||1===a.animationHasA[f]){let o=m+a.animationNumber[f];r=r*i/this.surface.spriteWidthFull[o]|0,l=l*s/this.surface.spriteHeightFull[o]|0;let u=i*this.surface.spriteWidthFull[o]/this.surface.spriteWidthFull[a.animationNumber[f]]|0;r-=(u-i)/2|0;let d=a.animationCharacterColour[f];const p=this.characterSkinColours[h.colourSkin];1===d?d=this.characterHairColours[h.colourHair]:2===d?d=this.characterTopBottomColours[h.colourTop]:3===d&&(d=this.characterTopBottomColours[h.colourBottom]),this.surface._spriteClipping_from9(t+r,e+l,u,s,o,d,p,n,c)}}}if(h.messageTimeout>0&&(this.receivedMessageMidPoint[this.receivedMessagesCount]=this.surface.textWidth(h.message,1)/2|0,this.receivedMessageMidPoint[this.receivedMessagesCount]>150&&(this.receivedMessageMidPoint[this.receivedMessagesCount]=150),this.receivedMessageHeight[this.receivedMessagesCount]=(this.surface.textWidth(h.message,1)/300|0)*this.surface.textHeight(1),this.receivedMessageX[this.receivedMessagesCount]=t+(i/2|0),this.receivedMessageY[this.receivedMessagesCount]=e,this.receivedMessages[this.receivedMessagesCount++]=h.message),h.bubbleTimeout>0&&(this.actionBubbleX[this.itemsAboveHeadCount]=t+(i/2|0),this.actionBubbleY[this.itemsAboveHeadCount]=e,this.actionBubbleScale[this.itemsAboveHeadCount]=o,this.actionBubbleItem[this.itemsAboveHeadCount++]=h.bubbleItem),8===h.animationCurrent||9===h.animationCurrent||0!==h.combatTimer){if(h.combatTimer>0){let s=t;8===h.animationCurrent?s-=20*o/100|0:9===h.animationCurrent&&(s+=20*o/100|0);let r=30*h.healthCurrent/h.healthMax|0;this.healthBarX[this.healthBarCount]=s+(i/2|0),this.healthBarY[this.healthBarCount]=e,this.healthBarMissing[this.healthBarCount++]=r}if(h.combatTimer>150){let r=t;8===h.animationCurrent?r-=10*o/100|0:9===h.animationCurrent&&(r+=10*o/100|0),this.surface._drawSprite_from3(r+(i/2|0)-12,e+(s/2|0)-12,this.spriteMedia+11),this.surface.drawStringCenter(h.damageTaken.toString(),r+(i/2|0)-1,e+(s/2|0)+5,3,16777215)}}if(1===h.skullVisible&&0===h.bubbleTimeout){let s=n+t+(i/2|0);8===h.animationCurrent?s-=20*o/100|0:9===h.animationCurrent&&(s+=20*o/100|0);let r=16*o/100|0,a=16*o/100|0;this.surface._spriteClipping_from5(s-(r/2|0),e-(a/2|0)-(10*o/100|0),r,a,this.spriteMedia+13)}}async loadMedia(){const t=await this.readDataFile(`media${I.MEDIA}.jag`,"2d graphics",20);if(null===t)return void(this.errorLoadingData=!0);const e=p.loadData("index.dat",0,t);this.surface.parseSprite(this.spriteMedia,p.loadData("inv1.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+1,p.loadData("inv2.dat",0,t),e,6),this.surface.parseSprite(this.spriteMedia+9,p.loadData("bubble.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+10,p.loadData("runescape.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+11,p.loadData("splat.dat",0,t),e,3),this.surface.parseSprite(this.spriteMedia+14,p.loadData("icon.dat",0,t),e,8),this.surface.parseSprite(this.spriteMedia+22,p.loadData("hbar.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+23,p.loadData("hbar2.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+24,p.loadData("compass.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+25,p.loadData("buttons.dat",0,t),e,2),this.surface.parseSprite(this.spriteUtil,p.loadData("scrollbar.dat",0,t),e,2),this.surface.parseSprite(this.spriteUtil+2,p.loadData("corners.dat",0,t),e,4),this.surface.parseSprite(this.spriteUtil+6,p.loadData("arrows.dat",0,t),e,2),this.surface.parseSprite(this.spriteProjectile,p.loadData("projectile.dat",0,t),e,a.projectileSprite);let i=a.itemSpriteCount;for(let s=1;i>0;s++){let r=i;i-=30,r>30&&(r=30),this.surface.parseSprite(this.spriteItem+30*(s-1),p.loadData(`objects${s}.dat`,0,t),e,r)}this.surface.loadSprite(this.spriteMedia),this.surface.loadSprite(this.spriteMedia+9);for(let t=11;t<=26;t++)this.surface.loadSprite(this.spriteMedia+t);for(let t=0;t<a.projectileSprite;t++)this.surface.loadSprite(this.spriteProjectile+t);for(let t=0;t<a.itemSpriteCount;t++)this.surface.loadSprite(this.spriteItem+t)}async startGame(){if(this.port=this.port||43595,this.maxReadTries=1e3,h.clientVersion=I.CLIENT,await this.loadGameConfig(),this.errorLoadingData)return;this.spriteMedia=2e3,this.spriteUtil=this.spriteMedia+100,this.spriteItem=this.spriteUtil+50,this.spriteLogo=this.spriteItem+1e3,this.spriteProjectile=this.spriteLogo+10,this.spriteTexture=this.spriteProjectile+50,this.spriteTextureWorld=this.spriteTexture+10,this.graphics=this.getGraphics(),this.setTargetFps(50),this.surface=new m(this.gameWidth,this.gameHeight+12,4e3,this),this.surface.mudclientref=this,this.surface.setBounds(0,0,this.gameWidth,this.gameHeight+12),u.drawBackgroundArrow=!1,u.baseSpriteStart=this.spriteUtil;let t=this.surface.width2-199,e=36;this.options.mobile&&(t-=32,e=this.gameHeight/2-137.5|0),this.panelQuestList=new u(this.surface,5),this.controlListQuest=this.panelQuestList.addTextListInteractive(t,e+24,196,251,1,500,!0),this.options.mobile&&(t=35,e=this.gameHeight/2-91|0),this.panelMagic=new u(this.surface,5),this.controlListMagic=this.panelMagic.addTextListInteractive(t,e+24,196,90,1,500,!0),this.panelSocialList=new u(this.surface,5),this.controlListSocialPlayers=this.panelSocialList.addTextListInteractive(t,e+40,196,126,1,500,!0),await this.loadMedia(),this.errorLoadingData||(await this.loadEntities(),this.errorLoadingData||(this.scene=new d(this.surface,15e3,15e3,1e3),this.scene.view=l._from2(1e6,1e3),this.scene.setBounds(this.gameWidth/2|0,this.gameHeight/2|0,this.gameWidth/2|0,this.gameHeight/2|0,this.gameWidth,9),this.scene.clipFar3d=2400,this.scene.clipFar2d=2400,this.scene.fogZFalloff=1,this.scene.fogZDistance=2300,this.scene._setLight_from3(-50,-10,-50),this.world=new y(this.scene,this.surface),this.world.baseMediaSprite=this.spriteMedia,await this.loadTextures(),this.errorLoadingData||(await this.loadModels(),this.errorLoadingData||(await this.loadMaps(),this.errorLoadingData||(this.members&&await this.loadSounds(),this.errorLoadingData||(this.showLoadingProgress(100,"Starting game..."),this.createMessageTabPanel(),this.createLoginPanels(),this.createAppearancePanel(),this.resetLoginScreenVariables(),this.renderLoginScreenViewports()))))))}hasInventoryItems(t,e){return!(31!==t||!(this.isItemEquipped(197)||this.isItemEquipped(615)||this.isItemEquipped(682)))||!(32!==t||!(this.isItemEquipped(102)||this.isItemEquipped(616)||this.isItemEquipped(683)))||!(33!==t||!(this.isItemEquipped(101)||this.isItemEquipped(617)||this.isItemEquipped(684)))||!(34!==t||!(this.isItemEquipped(103)||this.isItemEquipped(618)||this.isItemEquipped(685)))||this.getInventoryCount(t)>=e}getHostnameIP(t){return p.ipToString(t)}cantLogout(){this.logoutTimeout=0,this.showMessage("@cya@Sorry, you can't logout at the moment",3)}drawGame(){if(0!==this.deathScreenTimeout)return this.surface.fadeToBlack(),this.surface.drawStringCenter("Oh dear! You are dead...",this.gameWidth/2|0,this.gameHeight/2|0,7,16711680),this.drawChatMessageTabs(),void this.surface.draw(this.graphics,0,0);if(this.showAppearanceChange)this.drawAppearancePanelCharacterSprites();else if(this.isSleeping)this.drawSleep();else if(this.world.playerAlive){for(let t=0;t<64;t++)this.scene.removeModel(this.world.roofModels[this.lastHeightOffset][t]),0===this.lastHeightOffset&&(this.scene.removeModel(this.world.wallModels[1][t]),this.scene.removeModel(this.world.roofModels[1][t]),this.scene.removeModel(this.world.wallModels[2][t]),this.scene.removeModel(this.world.roofModels[2][t])),this.options.showRoofs&&(this.fogOfWar=!0,0===this.lastHeightOffset&&0==(128&this.world.objectAdjacency.get(this.localPlayer.currentX/128|0,this.localPlayer.currentY/128|0))&&(this.scene.addModel(this.world.roofModels[this.lastHeightOffset][t]),0===this.lastHeightOffset&&(this.scene.addModel(this.world.wallModels[1][t]),this.scene.addModel(this.world.roofModels[1][t]),this.scene.addModel(this.world.wallModels[2][t]),this.scene.addModel(this.world.roofModels[2][t])),this.fogOfWar=!1));if(this.objectAnimationNumberFireLightningSpell!==this.lastObjectAnimationNumberFireLightningSpell){this.lastObjectAnimationNumberFireLightningSpell=this.objectAnimationNumberFireLightningSpell;for(let t=0;t<this.objectCount;t++)97===this.objectId[t]&&this.updateObjectAnimation(t,"firea"+(this.objectAnimationNumberFireLightningSpell+1)),274===this.objectId[t]&&this.updateObjectAnimation(t,"fireplacea"+(this.objectAnimationNumberFireLightningSpell+1)),1031===this.objectId[t]&&this.updateObjectAnimation(t,"lightning"+(this.objectAnimationNumberFireLightningSpell+1)),1036===this.objectId[t]&&this.updateObjectAnimation(t,"firespell"+(this.objectAnimationNumberFireLightningSpell+1)),1147===this.objectId[t]&&this.updateObjectAnimation(t,"spellcharge"+(this.objectAnimationNumberFireLightningSpell+1))}if(this.objectAnimationNumberTorch!==this.lastObjectAnimationNumberTorch){this.lastObjectAnimationNumberTorch=this.objectAnimationNumberTorch;for(let t=0;t<this.objectCount;t++)51===this.objectId[t]&&this.updateObjectAnimation(t,"torcha"+(this.objectAnimationNumberTorch+1)),143===this.objectId[t]&&this.updateObjectAnimation(t,"skulltorcha"+(this.objectAnimationNumberTorch+1))}if(this.objectAnimationNumberClaw!==this.lastObjectAnimationNumberClaw){this.lastObjectAnimationNumberClaw=this.objectAnimationNumberClaw;for(let t=0;t<this.objectCount;t++)1142===this.objectId[t]&&this.updateObjectAnimation(t,"clawspell"+(this.objectAnimationNumberClaw+1))}this.scene.reduceSprites(this.spriteCount),this.spriteCount=0;for(let t=0;t<this.playerCount;t++){const e=this.players[t];if(255!==e.colourBottom){const i=e.currentX,s=e.currentY,r=-this.world.getElevation(i,s),n=this.scene.addSprite(5e3+t,i,r,s,145,220,t+1e4);this.spriteCount++,e===this.localPlayer&&this.scene.setLocalPlayer(n),8===e.animationCurrent&&this.scene.setSpriteTranslateX(n,-30),9===e.animationCurrent&&this.scene.setSpriteTranslateX(n,30)}}for(let t=0;t<this.playerCount;t++){const e=this.players[t];if(e.projectileRange>0){let t=null;if(-1!==e.attackingNpcServerIndex?t=this.npcsServer[e.attackingNpcServerIndex]:-1!==e.attackingPlayerServerIndex&&(t=this.playerServer[e.attackingPlayerServerIndex]),t){const i=e.currentX,s=e.currentY,r=-this.world.getElevation(i,s)-110,n=t.currentX,o=t.currentY,h=-(this.world.getElevation(n,o)-a.npcHeight[t.npcId]/2|0),l=(i*e.projectileRange+n*(this.projectileMaxRange-e.projectileRange))/this.projectileMaxRange|0,c=(r*e.projectileRange+h*(this.projectileMaxRange-e.projectileRange))/this.projectileMaxRange|0,u=(s*e.projectileRange+o*(this.projectileMaxRange-e.projectileRange))/this.projectileMaxRange|0;this.scene.addSprite(this.spriteProjectile+e.incomingProjectileSprite,l,c,u,32,32,0),this.spriteCount++}}}for(let t=0;t<this.npcCount;t++){const e=this.npcs[t],i=e.currentX,s=e.currentY,r=-this.world.getElevation(i,s),n=this.scene.addSprite(2e4+t,i,r,s,a.npcWidth[e.npcId],a.npcHeight[e.npcId],t+3e4);this.spriteCount++,8===e.animationCurrent&&this.scene.setSpriteTranslateX(n,-30),9===e.animationCurrent&&this.scene.setSpriteTranslateX(n,30)}for(let t=0;t<this.groundItemCount;t++){const e=this.groundItemX[t]*this.magicLoc+64,i=this.groundItemY[t]*this.magicLoc+64;this.scene.addSprite(4e4+this.groundItemID[t],e,-this.world.getElevation(e,i)-this.groundItemZ[t],i,96,64,t+2e4),this.spriteCount++}for(let t=0;t<this.teleportBubbleCount;t++){const e=this.teleportBubbleX[t]*this.magicLoc+64,i=this.teleportBubbleY[t]*this.magicLoc+64,s=this.teleportBubbleType[t];0===s&&(this.scene.addSprite(5e4+t,e,-this.world.getElevation(e,i),i,128,256,t+5e4),this.spriteCount++),1===s&&(this.scene.addSprite(5e4+t,e,-this.world.getElevation(e,i),i,128,64,t+5e4),this.spriteCount++)}if(this.surface.interlace=!1,this.surface.blackScreen(),this.surface.interlace=this.interlace,3===this.lastHeightOffset){const t=40+(3*Math.random()|0),e=40+(7*Math.random()|0);this.scene._setLight_from5(t,e,-50,-10,-50)}if(this.itemsAboveHeadCount=0,this.receivedMessagesCount=0,this.healthBarCount=0,this.cameraAutoAngleDebug){if(this.optionCameraModeAuto&&!this.fogOfWar){const t=this.cameraAngle;this.autoRotateCamera(),this.cameraAngle!==t&&(this.cameraAutoRotatePlayerX=this.localPlayer.currentX,this.cameraAutoRotatePlayerY=this.localPlayer.currentY)}this.scene.clipFar3d=3e3,this.scene.clipFar2d=3e3,this.scene.fogZFalloff=1,this.scene.fogZDistance=2800,this.cameraRotation=32*this.cameraAngle;const t=this.cameraAutoRotatePlayerX+this.cameraRotationX,e=this.cameraAutoRotatePlayerY+this.cameraRotationY;this.scene.setCamera(t,-this.world.getElevation(t,e),e,912,4*this.cameraRotation,0,2e3)}else{this.optionCameraModeAuto&&!this.fogOfWar&&this.autoRotateCamera(),this.interlace?(this.scene.clipFar3d=2200,this.scene.clipFar2d=2200,this.scene.fogZFalloff=1,this.scene.fogZDistance=2100):(this.scene.clipFar3d=2400,this.scene.clipFar2d=2400,this.scene.fogZFalloff=1,this.scene.fogZDistance=2300),this.cameraZoom>750&&(this.scene.clipFar3d+=1400,this.scene.clipFar2d+=1400,this.scene.fogZDistance+=1400);let t=this.cameraAutoRotatePlayerX+this.cameraRotationX,e=this.cameraAutoRotatePlayerY+this.cameraRotationY;this.scene.setCamera(t,-this.world.getElevation(t,e),e,912,4*this.cameraRotation,0,2*this.cameraZoom)}if(this.scene.render(),this.drawAboveHeadStuff(),this.mouseClickXStep>0&&this.surface._drawSprite_from3(this.mouseClickXX-8,this.mouseClickXY-8,this.spriteMedia+14+((24-this.mouseClickXStep)/6|0)),this.mouseClickXStep<0&&this.surface._drawSprite_from3(this.mouseClickXX-8,this.mouseClickXY-8,this.spriteMedia+18+((24+this.mouseClickXStep)/6|0)),this.options.fpsCounter){const t=this.isInWild?70:0;this.surface.drawString("Fps: "+(0|this.fps),this.gameWidth-62-t,this.gameHeight-10,1,16776960)}if(0!==this.systemUpdate){let t=this.systemUpdate/50|0;const e=t/60|0;t%=60,t<10?this.surface.drawStringCenter("System update in: "+e+":0"+t,256,this.gameHeight-7,1,16776960):this.surface.drawStringCenter("System update in: "+e+":"+t,256,this.gameHeight-7,1,16776960)}if(!this.loadingArea){let t=2203-(this.localRegionY+this.planeHeight+this.regionY);if(this.localRegionX+this.planeWidth+this.regionX>=2640&&(t=-50),this.isInWild=t>0,this.isInWild){this.surface._drawSprite_from3(this.gameWidth-59,this.gameHeight-56,this.spriteMedia+13),this.surface.drawStringCenter("Wilderness",this.gameWidth-47,this.gameHeight-20,1,16776960);const e=1+(t/6|0);this.surface.drawStringCenter("Level: "+e,this.gameWidth-47,this.gameHeight-7,1,16776960),0===this.showUiWildWarn&&(this.showUiWildWarn=2)}0===this.showUiWildWarn&&t>-10&&t<=0&&(this.showUiWildWarn=1)}this.drawChatMessageTabsPanel(),this.options.mobile||this.surface._drawSpriteAlpha_from4(this.surface.width2-3-197,3,this.spriteMedia,128),this.drawUI(),this.surface.loggedIn=!1,this.drawChatMessageTabs(),this.surface.draw(this.graphics,0,0),this.options.mobile&&this.drawMobileUI()}}async loadSounds(){try{this.soundData=await this.readDataFile(`sounds${I.SOUNDS}.mem`,"Sound effects",90),this.audioPlayer=new f}catch(t){console.error(t)}}isItemEquipped(t){for(let e=0;e<this.inventoryItemsCount;e++)if(this.inventoryItemId[e]===t&&1===this.inventoryEquipped[e])return!0;return!1}async loadEntities(){const t=await this.readDataFile(`entity${I.ENTITY}.jag`,"people and monsters",30);if(!t)return void(this.errorLoadingData=!0);const e=p.loadData("index.dat",0,t);let i=null,s=null;if(this.members){if(i=await this.readDataFile("entity"+I.ENTITY+".mem","member graphics",45),!i)return void(this.errorLoadingData=!0);s=p.loadData("index.dat",0,i)}let r=0;this.animationIndex=0;t:for(let n=0;n<a.animationCount;n++){let o=a.animationName[n];for(let t=0;t<n;t++)if(a.animationName[t].toLowerCase()===o.toLowerCase()){a.animationNumber[n]=a.animationNumber[t];continue t}let h=p.loadData(o+".dat",0,t),l=e;if(null===h&&this.members&&(h=p.loadData(o+".dat",0,i),l=s),h){if(this.surface.parseSprite(this.animationIndex,h,l,15),r+=15,1===a.animationHasA[n]){let n=p.loadData(o+"a.dat",0,t),h=e;null===n&&this.members&&(n=p.loadData(o+"a.dat",0,i),h=s),this.surface.parseSprite(this.animationIndex+15,n,h,3),r+=3}if(1===a.animationHasF[n]){let n=p.loadData(o+"f.dat",0,t),h=e;null===n&&this.members&&(n=p.loadData(o+"f.dat",0,i),h=s),this.surface.parseSprite(this.animationIndex+18,n,h,9),r+=9}if(0!==a.animationGender[n])for(let t=this.animationIndex;t<this.animationIndex+27;t++)this.surface.loadSprite(t)}a.animationNumber[n]=this.animationIndex,this.animationIndex+=27}console.log("Loaded: "+r+" frames of animation")}draw(){if(this.errorLoadingData){const t=this.getGraphics();t.setColor(s.black),t.fillRect(0,0,1024,356),t.setFont(new r("Helvetica",1,16)),t.setColor(s.yellow);let e=35;return t.drawString("Sorry, an error has occured whilst loading RuneScape",30,e),e+=50,t.setColor(s.white),t.drawString("To fix this try the following (in order):",30,e),e+=50,t.setColor(s.white),t.setFont(new r("Helvetica",1,12)),t.drawString("1: Try closing ALL open web-browser windows, and reloading",30,e),e+=30,t.drawString("2: Try clearing your web-browsers cache from tools->internet options",30,e),e+=30,t.drawString("3: Try using a different game-world",30,e),e+=30,t.drawString("4: Try rebooting your computer",30,e),e+=30,t.drawString("5: Try selecting a different version of Java from the play-game menu",30,e),void this.setTargetFps(1)}if(this.errorLoadingCodebase){const t=this.getGraphics();return t.setColor(s.black),t.fillRect(0,0,1024,356),t.setFont(new r("Helvetica",1,20)),t.setColor(s.white),t.drawString("Error - unable to load game!",50,50),t.drawString("To play RuneScape make sure you play from",50,100),t.drawString("http://www.runescape.com",50,150),void this.setTargetFps(1)}if(this.errorLoadingMemory){const t=this.getGraphics();return t.setColor(s.black),t.fillRect(0,0,1024,356),t.setFont(new r("Helvetica",1,20)),t.setColor(s.white),t.drawString("Error - out of memory!",50,50),t.drawString("Close ALL unnecessary programs",50,100),t.drawString("and windows before loading the game",50,150),t.drawString("RuneScape needs about 48meg of spare RAM",50,200),void this.setTargetFps(1)}try{0===this.loggedIn?(this.surface.loggedIn=!1,this.drawLoginScreens()):1===this.loggedIn&&(this.surface.loggedIn=!0,this.drawGame())}catch(t){console.error(t),this.disposeAndCollect(),this.errorLoadingMemory=!0}}onClosing(){this.closeConnection(),this.disposeAndCollect(),this.audioPlayer&&this.audioPlayer.stopPlayer()}drawDialogDuelConfirm(){this.surface.drawBox(22,36,468,16,192),this.surface.drawBoxAlpha(22,52,468,246,10000536,160),this.surface.drawStringCenter("Please confirm your duel with @yel@"+p.hashToUsername(this.duelOpponentNameHash),256,48,1,16777215),this.surface.drawStringCenter("Your stake:",139,66,1,16776960);for(let t=0;t<this.duelItemsCount;t++){let e=a.itemName[this.duelItems[t]];0===a.itemStackable[this.duelItems[t]]&&(e=e+" x "+p.formatConfirmAmount(this.duelItemCount[t])),this.surface.drawStringCenter(e,139,78+12*t,1,16777215)}0===this.duelItemsCount&&this.surface.drawStringCenter("Nothing!",139,78,1,16777215),this.surface.drawStringCenter("Your opponent's stake:",373,66,1,16776960);for(let t=0;t<this.duelOpponentItemsCount;t++){let e=a.itemName[this.duelOpponentItems[t]];0===a.itemStackable[this.duelOpponentItems[t]]&&(e=e+" x "+p.formatConfirmAmount(this.duelOpponentItemCount[t])),this.surface.drawStringCenter(e,373,78+12*t,1,16777215)}0===this.duelOpponentItemsCount&&this.surface.drawStringCenter("Nothing!",373,78,1,16777215),0===this.duelOptionRetreat?this.surface.drawStringCenter("You can retreat from this duel",256,216,1,65280):this.surface.drawStringCenter("No retreat is possible!",256,216,1,16711680),0===this.duelOptionMagic?this.surface.drawStringCenter("Magic may be used",256,228,1,65280):this.surface.drawStringCenter("Magic cannot be used",256,228,1,16711680),0===this.duelOptionPrayer?this.surface.drawStringCenter("Prayer may be used",256,240,1,65280):this.surface.drawStringCenter("Prayer cannot be used",256,240,1,16711680),0===this.duelOptionWeapons?this.surface.drawStringCenter("Weapons may be used",256,252,1,65280):this.surface.drawStringCenter("Weapons cannot be used",256,252,1,16711680),this.surface.drawStringCenter("If you are sure click 'Accept' to begin the duel",256,266,1,16777215),this.duelAccepted?this.surface.drawStringCenter("Waiting for other player...",256,286,1,16776960):(this.surface._drawSprite_from3(105,274,this.spriteMedia+25),this.surface._drawSprite_from3(339,274,this.spriteMedia+26)),1===this.mouseButtonClick&&((this.mouseX<22||this.mouseY<36||this.mouseX>490||this.mouseY>298)&&(this.showDialogDuelConfirm=!1,this.packetStream.newPacket(C.TRADE_DECLINE),this.packetStream.sendPacket()),this.mouseX>=105&&this.mouseX<=210&&this.mouseY>=274&&this.mouseY<=295&&(this.duelAccepted=!0,this.packetStream.newPacket(C.DUEL_CONFIRM_ACCEPT),this.packetStream.sendPacket()),this.mouseX>=339&&this.mouseX<=445&&this.mouseY>=274&&this.mouseY<=295&&(this.showDialogDuelConfirm=!1,this.packetStream.newPacket(C.DUEL_DECLINE),this.packetStream.sendPacket()),this.mouseButtonClick=0)}walkToGroundItem(t,e,i,s,r){return this.walkTo(t,e,i,s,i,s,!1,r)?void 0:void this._walkToActionSource_from8(t,e,i,s,i,s,!0,r)}async loadModels(){for(const t of B)a.getModelIndex(t);const t=await this.readDataFile(`models${I.MODELS}.jag`,"3d models",60);if(t)for(let e=0;e<a.modelCount;e++){const i=p.getDataFileOffset(`${a.modelName[e]}.ob3`,t);this.gameModels[e]=0!==i?l.fromBytes(t,i):l._from2(1,1),"giantcrystal"===a.modelName[e].toLowerCase()&&(this.gameModels[e].transparent=!0)}else this.errorLoadingData=!0}showMessage(t,e){if(2===e||4===e||6===e){for(;t.length>5&&"@"===t[0]&&"@"===t[4];t=t.substring(5));const e=t.indexOf(":");if(-1!==e){const i=t.substring(0,e),s=p.usernameToHash(i);for(let t=0;t<this.ignoreListCount;t++)if(this.ignoreList[t].equals(s))return}}2===e?t="@yel@"+t:3===e||4===e?t="@whi@"+t:6===e&&(t="@cya@"+t),0!==this.messageTabSelected&&(4!==e&&3!==e||(this.messageTabFlashAll=200),2===e&&1!==this.messageTabSelected&&(this.messageTabFlashHistory=200),5===e&&2!==this.messageTabSelected&&(this.messageTabFlashQuest=200),6===e&&3!==this.messageTabSelected&&(this.messageTabFlashPrivate=200),3===e&&0!==this.messageTabSelected&&(this.messageTabSelected=0),6===e&&3!==this.messageTabSelected&&0!==this.messageTabSelected&&(this.messageTabSelected=0));for(let t=4;t>0;t--)this.messageHistory[t]=this.messageHistory[t-1],this.messageHistoryTimeout[t]=this.messageHistoryTimeout[t-1];if(this.messageHistory[0]=t,this.messageHistoryTimeout[0]=300,2===e)this.panelMessageTabs.controlFlashText[this.controlTextListChat]===this.panelMessageTabs.controlListEntryCount[this.controlTextListChat]-4?this.panelMessageTabs.removeListEntry(this.controlTextListChat,t,!0):this.panelMessageTabs.removeListEntry(this.controlTextListChat,t,!1);else if(5===e)this.panelMessageTabs.controlFlashText[this.controlTextListQuest]===this.panelMessageTabs.controlListEntryCount[this.controlTextListQuest]-4?this.panelMessageTabs.removeListEntry(this.controlTextListQuest,t,!0):this.panelMessageTabs.removeListEntry(this.controlTextListQuest,t,!1);else if(6===e){if(this.panelMessageTabs.controlFlashText[this.controlTextListPrivate]===this.panelMessageTabs.controlListEntryCount[this.controlTextListPrivate]-4)return void this.panelMessageTabs.removeListEntry(this.controlTextListPrivate,t,!0);this.panelMessageTabs.removeListEntry(this.controlTextListPrivate,t,!1)}}walkToObject(t,e,i,s){let r=0,n=0;0===i||4===i?(r=a.objectWidth[s],n=a.objectHeight[s]):(n=a.objectWidth[s],r=a.objectHeight[s]),2===a.objectType[s]||3===a.objectType[s]?(0===i?(t--,r++):2===i?n++:4===i?r++:6===i&&(e--,n++),this._walkToActionSource_from8(this.localRegionX,this.localRegionY,t,e,t+r-1,e+n-1,!1,!0)):this._walkToActionSource_from8(this.localRegionX,this.localRegionY,t,e,t+r-1,e+n-1,!0,!0)}getInventoryCount(t){let e=0;for(let i=0;i<this.inventoryItemsCount;i++)this.inventoryItemId[i]===t&&(1===a.itemStackable[t]?e++:e+=this.inventoryItemStackCount[i]);return e}async loadTextures(){const t=await this.readDataFile(`textures${I.TEXTURES}.jag`,"Textures",50);if(!t)return void(this.errorLoadingData=!0);const e=p.loadData("index.dat",0,t);this.scene.allocateTextures(a.textureCount,7,11);for(let i=0;i<a.textureCount;i++){const s=a.textureName[i];let r=p.loadData(`${s}.dat`,0,t);this.surface.parseSprite(this.spriteTexture,r,e,1),this.surface.drawBox(0,0,128,128,16711935),this.surface._drawSprite_from3(0,0,this.spriteTexture);let n=this.surface.spriteWidthFull[this.spriteTexture],o=a.textureSubtypeName[i];if(o&&o.length>0){let i=p.loadData(`${o}.dat`,0,t);this.surface.parseSprite(this.spriteTexture,i,e,1),this.surface._drawSprite_from3(0,0,this.spriteTexture)}this.surface._drawSprite_from5(this.spriteTextureWorld+i,0,0,n,n);for(let t=0;t<n*n;t++)65280===this.surface.surfacePixels[this.spriteTextureWorld+i][t]&&(this.surface.surfacePixels[this.spriteTextureWorld+i][t]=16711935);this.surface.drawWorld(this.spriteTextureWorld+i),this.scene.defineTexture(i,this.surface.spriteColoursUsed[this.spriteTextureWorld+i],this.surface.spriteColourList[this.spriteTextureWorld+i],(n/64|0)-1)}}handleMouseDown(t,e,i){this.mouseClickXHistory[this.mouseClickCount]=e,this.mouseClickYHistory[this.mouseClickCount]=i,this.mouseClickCount=this.mouseClickCount+1&8191;for(let t=10;t<4e3;t++){let s=this.mouseClickCount-t&8191;if(this.mouseClickXHistory[s]===e&&this.mouseClickYHistory[s]===i){let r=!1;for(let n=1;n<t;n++){let o=this.mouseClickCount-n&8191,h=s-n&8191;if(this.mouseClickXHistory[h]===e&&this.mouseClickYHistory[h]===i||(r=!0),this.mouseClickXHistory[o]!==this.mouseClickXHistory[h]||this.mouseClickYHistory[o]!==this.mouseClickYHistory[h])break;if(n===t-1&&r&&0===this.combatTimeout&&0===this.logoutTimeout)return void this.sendLogout()}}}}drawTeleportBubble(t,e,i,s,r){const n=this.teleportBubbleType[r],o=this.teleportBubbleTime[r];if(0===n){const r=255+5*o*256;this.surface.drawCircle(t+(i/2|0),e+(s/2|0),20+2*o,r,255-5*o)}else if(1===n){const r=16711680+5*o*256;this.surface.drawCircle(t+(i/2|0),e+(s/2|0),10+o,r,255-5*o)}}showServerMessage(t){/^@bor@/.test(t)?this.showMessage(t,4):/^@que@/.test(t)?this.showMessage(`@whi@${t}`,5):/^@pri@/.test(t)?this.showMessage(t,6):this.showMessage(t,3)}updateObjectAnimation(t,e){const i=this.objectX[t],s=this.objectY[t],r=i-(this.localPlayer.currentX/128|0),n=s-(this.localPlayer.currentY/128|0);if(i>=0&&s>=0&&i<96&&s<96&&r>-7&&r<7&&n>-7&&n<7){this.scene.removeModel(this.objectModel[t]);const i=a.getModelIndex(e),s=this.gameModels[i].copy();this.scene.addModel(s),s._setLight_from6(!0,48,48,-50,-10,-50),s.copyPosition(this.objectModel[t]),s.key=t,this.objectModel[t]=s}}createTopMouseMenu(){(this.selectedSpell>=0||this.selectedItemInventoryIndex>=0)&&(this.menuItemText1[this.menuItemsCount]="Cancel",this.menuItemText2[this.menuItemsCount]="",this.menuType[this.menuItemsCount]=4e3,this.menuItemsCount++);for(let t=0;t<this.menuItemsCount;t++)this.menuIndices[t]=t;for(let t=!1;!t;){t=!0;for(let e=0;e<this.menuItemsCount-1;e++){let i=this.menuIndices[e],s=this.menuIndices[e+1];this.menuType[i]>this.menuType[s]&&(this.menuIndices[e]=s,this.menuIndices[e+1]=i,t=!1)}}if(this.menuItemsCount>20&&(this.menuItemsCount=20),this.menuItemsCount>0){let t=-1;for(let e=0;e<this.menuItemsCount;e++)if(!(null===this.menuItemText2[this.menuIndices[e]]||this.menuItemText2[this.menuIndices[e]].length<=0)){t=e;break}let e=null;if((this.selectedItemInventoryIndex>=0||this.selectedSpell>=0)&&1===this.menuItemsCount?e="Choose a target":(this.selectedItemInventoryIndex>=0||this.selectedSpell>=0)&&this.menuItemsCount>1?e="@whi@"+this.menuItemText1[this.menuIndices[0]]+" "+this.menuItemText2[this.menuIndices[0]]:-1!==t&&(e=this.menuItemText2[this.menuIndices[t]]+": @whi@"+this.menuItemText1[this.menuIndices[0]]),2===this.menuItemsCount&&e&&(e+="@whi@ / 1 more option"),this.menuItemsCount>2&&e&&(e=e+"@whi@ / "+(this.menuItemsCount-1)+" more options"),!this.options.mobile&&e&&this.surface.drawString(e,6,14,1,16776960),!this.optionMouseButtonOne&&1===this.mouseButtonClick||this.optionMouseButtonOne&&1===this.mouseButtonClick&&1===this.menuItemsCount)return this.menuItemClick(this.menuIndices[0]),void(this.mouseButtonClick=0);if(!this.optionMouseButtonOne&&2===this.mouseButtonClick||this.optionMouseButtonOne&&1===this.mouseButtonClick){this.menuHeight=15*(this.menuItemsCount+1),this.menuWidth=this.surface.textWidth("Choose option",1)+5;for(let t=0;t<this.menuItemsCount;t++){let e=this.surface.textWidth(this.menuItemText1[t]+" "+this.menuItemText2[t],1)+5;e>this.menuWidth&&(this.menuWidth=e)}this.menuX=this.mouseX-(this.menuWidth/2|0),this.menuY=this.mouseY-7,this.showRightClickMenu=!0,this.menuX<0&&(this.menuX=0),this.menuY<0&&(this.menuY=0),this.mouseButtonClick=0}}}menuItemClick(t){const e=this.menuItemX[t],i=this.menuItemY[t],s=this.menuIndex[t],r=this.menuSourceIndex[t],n=this.menuTargetIndex[t],o=this.menuType[t];switch(this.options.mobile&&this.menuItemText2[t]&&(this.menuText=`${this.menuItemText1[t]} ${this.menuItemText2[t]}`,this.menuTextWidth=this.surface.textWidth(this.menuText,1),this.menuX=this.mouseX,this.menuY=this.mouseY,this.menuActionTimeout=60),o){case 200:this.walkToGroundItem(this.localRegionX,this.localRegionY,e,i,!0),this.packetStream.newPacket(C.CAST_GROUNDITEM),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 210:this.walkToGroundItem(this.localRegionX,this.localRegionY,e,i,!0),this.packetStream.newPacket(C.USEWITH_GROUNDITEM),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break;case 220:this.walkToGroundItem(this.localRegionX,this.localRegionY,e,i,!0),this.packetStream.newPacket(C.GROUNDITEM_TAKE),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket();break;case 3200:case 3600:this.showMessage(a.itemDescription[s],3);break;case 300:this.walkToWallObject(e,i,s),this.packetStream.newPacket(C.CAST_WALLOBJECT),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putByte(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 310:this.walkToWallObject(e,i,s),this.packetStream.newPacket(C.USEWITH_WALLOBJECT),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putByte(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break;case 320:this.walkToWallObject(e,i,s),this.packetStream.newPacket(C.WALL_OBJECT_COMMAND1),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putByte(s),this.packetStream.sendPacket();break;case 2300:this.walkToWallObject(e,i,s),this.packetStream.newPacket(C.WALL_OBJECT_COMMAND2),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putByte(s),this.packetStream.sendPacket();break;case 3300:this.showMessage(a.wallObjectDescription[s],3);break;case 400:this.walkToObject(e,i,s,r),this.packetStream.newPacket(C.CAST_OBJECT),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(n),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 410:this.walkToObject(e,i,s,r),this.packetStream.newPacket(C.USEWITH_OBJECT),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(n),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break;case 420:this.walkToObject(e,i,s,r),this.packetStream.newPacket(C.OBJECT_CMD1),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.sendPacket();break;case 2400:this.walkToObject(e,i,s,r),this.packetStream.newPacket(C.OBJECT_CMD2),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.sendPacket();break;case 3400:this.showMessage(a.objectDescription[s],3);break;case 600:this.packetStream.newPacket(C.CAST_INVITEM),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 610:this.packetStream.newPacket(C.USEWITH_INVITEM),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break;case 620:this.packetStream.newPacket(C.INV_UNEQUIP),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 630:this.packetStream.newPacket(C.INV_WEAR),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 640:this.packetStream.newPacket(C.INV_CMD),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 650:this.selectedItemInventoryIndex=s,this.showUITab=0,this.selectedItemName=a.itemName[this.inventoryItemId[this.selectedItemInventoryIndex]];break;case 660:this.packetStream.newPacket(C.INV_DROP),this.packetStream.putShort(s),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1,this.showUITab=0,this.showMessage("Dropping "+a.itemName[this.inventoryItemId[s]],4);break;case 700:{const t=(e-64)/this.magicLoc|0,n=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,n,!0),this.packetStream.newPacket(C.CAST_NPC),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedSpell=-1;break}case 710:{const t=(e-64)/this.magicLoc|0,n=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,n,!0),this.packetStream.newPacket(C.USEWITH_NPC),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break}case 720:{const t=(e-64)/this.magicLoc|0,r=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,r,!0),this.packetStream.newPacket(C.NPC_TALK),this.packetStream.putShort(s),this.packetStream.sendPacket();break}case 725:{const t=(e-64)/this.magicLoc|0,r=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,r,!0),this.packetStream.newPacket(C.NPC_CMD),this.packetStream.putShort(s),this.packetStream.sendPacket();break}case 715:case 2715:{const t=(e-64)/this.magicLoc|0,r=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,r,!0),this.packetStream.newPacket(C.NPC_ATTACK),this.packetStream.putShort(s),this.packetStream.sendPacket();break}case 3700:this.showMessage(a.npcDescription[s],3);break;case 800:{const t=(e-64)/this.magicLoc|0,n=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,n,!0),this.packetStream.newPacket(C.CAST_PLAYER),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedSpell=-1;break}case 810:{const t=(e-64)/this.magicLoc|0,n=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,n,!0),this.packetStream.newPacket(C.USEWITH_PLAYER),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break}case 805:case 2805:{const t=(e-64)/this.magicLoc|0,r=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,r,!0),this.packetStream.newPacket(C.PLAYER_ATTACK),this.packetStream.putShort(s),this.packetStream.sendPacket();break}case 2806:this.packetStream.newPacket(C.PLAYER_DUEL),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 2810:this.packetStream.newPacket(C.PLAYER_TRADE),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 2820:this.packetStream.newPacket(C.PLAYER_FOLLOW),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 900:this._walkToActionSource_from5(this.localRegionX,this.localRegionY,e,i,!0),this.packetStream.newPacket(C.CAST_GROUND),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(s),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 920:this._walkToActionSource_from5(this.localRegionX,this.localRegionY,e,i,!1),-24===this.mouseClickXStep&&(this.mouseClickXStep=24);break;case 1e3:this.packetStream.newPacket(C.CAST_SELF),this.packetStream.putShort(s),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 4e3:this.selectedItemInventoryIndex=-1,this.selectedSpell=-1}}showLoginScreenStatus(t,e){1===this.loginScreen?this.panelLoginNewUser.updateText(this.controlRegisterStatus,t+" "+e):2===this.loginScreen&&this.panelLoginExistingUser.updateText(this.controlLoginStatus,t+" "+e),this.loginUserDisp=e,this.drawLoginScreens(),this.resetTimings()}async lostConnection(){this.systemUpdate=0,0!==this.logoutTimeout?this.resetLoginVars():await super.lostConnection()}isValidCameraAngle(t){const e=this.localPlayer.currentX/128|0,i=this.localPlayer.currentY/128|0;for(let s=2;s>=1;s--){if(1===t&&(128==(128&this.world.objectAdjacency.get(e,i-s))||128==(128&this.world.objectAdjacency.get(e-s,i))||128==(128&this.world.objectAdjacency.get(e-s,i-s))))return!1;if(3===t&&(128==(128&this.world.objectAdjacency.get(e,i+s))||128==(128&this.world.objectAdjacency.get(e-s,i))||128==(128&this.world.objectAdjacency.get(e-s,i+s))))return!1;if(5===t&&(128==(128&this.world.objectAdjacency.get(e,i+s))||128==(128&this.world.objectAdjacency.get(e+s,i))||128==(128&this.world.objectAdjacency.get(e+s,i+s))))return!1;if(7===t&&(128==(128&this.world.objectAdjacency.get(e,i-s))||128==(128&this.world.objectAdjacency.get(e+s,i))||128==(128&this.world.objectAdjacency.get(e+s,i-s))))return!1;if(0===t&&128==(128&this.world.objectAdjacency.get(e,i-s)))return!1;if(2===t&&128==(128&this.world.objectAdjacency.get(e-s,i)))return!1;if(4===t&&128==(128&this.world.objectAdjacency.get(e,i+s)))return!1;if(6===t&&128==(128&this.world.objectAdjacency.get(e+s,i)))return!1}return!0}resetLoginScreenVariables(){this.loggedIn=0,this.loginScreen=0,this.loginUser="",this.loginPass="",this.loginUserDesc="Please enter a username:",this.loginUserDisp=`*${this.loginUser}*`,this.playerCount=0,this.npcCount=0}handleIncomingPacket(t,e,i){try{const s=this.packetHandlers[t];if(!s)throw new Error(`unhandled packet opcode ${t}`);s(i,e)}catch(s){if(console.error(s),this.packetErrorCount<3){let r=s.stack,n=r.length;this.packetStream.newPacket(C.PACKET_EXCEPTION),this.packetStream.putShort(n),this.packetStream.putString(r),this.packetStream.putShort(n=(r="p-type: "+t+" p-size:"+e).length),this.packetStream.putString(r),this.packetStream.putShort(n=(r="rx:"+this.localRegionX+" ry:"+this.localRegionY+" num3l:"+this.objectCount).length),this.packetStream.putString(r),r="";for(let t=0;t<80&&t<e;t++)r=r+i[t]+" ";this.packetStream.putShort(r.length),this.packetStream.putString(r),this.packetStream.sendPacket(),this.packetErrorCount++}this.packetStream.closeStream(),this.resetLoginVars()}}createRightClickMenu(){let t=2203-(this.localRegionY+this.planeHeight+this.regionY);this.localRegionX+this.planeWidth+this.regionX>=2640&&(t=-50);let e=-1;for(let t=0;t<this.objectCount;t++)this.objectAlreadyInMenu[t]=!1;for(let t=0;t<this.wallObjectCount;t++)this.wallObjectAlreadyInMenu[t]=!1;let i=this.scene.getMousePickedCount(),s=this.scene.getMousePickedModels(),r=this.scene.getMousePickedFaces();for(let n=0;n<i&&!(this.menuItemsCount>200);n++){let i=r[n],o=s[n];if(o.faceTag[i]<=65535||o.faceTag[i]>=2e5&&o.faceTag[i]<=3e5)if(o===this.scene.view){let e=o.faceTag[i]%1e4;const s=o.faceTag[i]/1e4|0;if(1===s){let i="",s=0;this.localPlayer.level>0&&this.players[e].level>0&&(s=this.localPlayer.level-this.players[e].level),s<0&&(i="@or1@"),s<-3&&(i="@or2@"),s<-6&&(i="@or3@"),s<-9&&(i="@red@"),s>0&&(i="@gr1@"),s>3&&(i="@gr2@"),s>6&&(i="@gr3@"),s>9&&(i="@gre@"),i=" "+i+"(level-"+this.players[e].level+")",this.selectedSpell>=0?1!==a.spellType[this.selectedSpell]&&2!==a.spellType[this.selectedSpell]||(this.menuItemText1[this.menuItemsCount]="Cast "+a.spellName[this.selectedSpell]+" on",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuType[this.menuItemsCount]=800,this.menuItemX[this.menuItemsCount]=this.players[e].currentX,this.menuItemY[this.menuItemsCount]=this.players[e].currentY,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuSourceIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++):this.selectedItemInventoryIndex>=0?(this.menuItemText1[this.menuItemsCount]="Use "+this.selectedItemName+" with",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuType[this.menuItemsCount]=810,this.menuItemX[this.menuItemsCount]=this.players[e].currentX,this.menuItemY[this.menuItemsCount]=this.players[e].currentY,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuSourceIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,this.menuItemsCount++):(t>0&&((this.players[e].currentY-64)/this.magicLoc+this.planeHeight+this.regionY|0)<2203?(this.menuItemText1[this.menuItemsCount]="Attack",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuType[this.menuItemsCount]=s>=0&&s<5?805:2805,this.menuItemX[this.menuItemsCount]=this.players[e].currentX,this.menuItemY[this.menuItemsCount]=this.players[e].currentY,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuItemsCount++):this.members&&(this.menuItemText1[this.menuItemsCount]="Duel with",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuItemX[this.menuItemsCount]=this.players[e].currentX,this.menuItemY[this.menuItemsCount]=this.players[e].currentY,this.menuType[this.menuItemsCount]=2806,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Trade with",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuType[this.menuItemsCount]=2810,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuItemsCount++,this.menuItemText1[this.menuItemsCount]="Follow",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuType[this.menuItemsCount]=2820,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuItemsCount++)}else if(2===s)this.selectedSpell>=0?3===a.spellType[this.selectedSpell]&&(this.menuItemText1[this.menuItemsCount]="Cast "+a.spellName[this.selectedSpell]+" on",this.menuItemText2[this.menuItemsCount]="@lre@"+a.itemName[this.groundItemID[e]],this.menuType[this.menuItemsCount]=200,this.menuItemX[this.menuItemsCount]=this.groundItemX[e],this.menuItemY[this.menuItemsCount]=this.groundItemY[e],this.menuIndex[this.menuItemsCount]=this.groundItemID[e],this.menuSourceIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++):this.selectedItemInventoryIndex>=0?(this.menuItemText1[this.menuItemsCount]="Use "+this.selectedItemName+" with",this.menuItemText2[this.menuItemsCount]="@lre@"+a.itemName[this.groundItemID[e]],this.menuType[this.menuItemsCount]=210,this.menuItemX[this.menuItemsCount]=this.groundItemX[e],this.menuItemY[this.menuItemsCount]=this.groundItemY[e],this.menuIndex[this.menuItemsCount]=this.groundItemID[e],this.menuSourceIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,this.menuItemsCount++):(this.menuItemText1[this.menuItemsCount]="Take",this.menuItemText2[this.menuItemsCount]="@lre@"+a.itemName[this.groundItemID[e]],this.menuType[this.menuItemsCount]=220,this.menuItemX[this.menuItemsCount]=this.groundItemX[e],this.menuItemY[this.menuItemsCount]=this.groundItemY[e],this.menuIndex[this.menuItemsCount]=this.groundItemID[e],this.menuItemsCount++,this.menuItemText1[this.menuItemsCount]="Examine",this.menuItemText2[this.menuItemsCount]="@lre@"+a.itemName[this.groundItemID[e]],this.menuType[this.menuItemsCount]=3200,this.menuIndex[this.menuItemsCount]=this.groundItemID[e],this.menuItemsCount++);else if(3===s){let t="",i=-1;const s=this.npcs[e].npcId;if(a.npcAttackable[s]>0){const e=(a.npcAttack[s]+a.npcDefense[s]+a.npcStrength[s]+a.npcHits[s])/4|0;i=((this.playerStatBase[0]+this.playerStatBase[1]+this.playerStatBase[2]+this.playerStatBase[3]+27)/4|0)-e,t="@yel@",i<0&&(t="@or1@"),i<-3&&(t="@or2@"),i<-6&&(t="@or3@"),i<-9&&(t="@red@"),i>0&&(t="@gr1@"),i>3&&(t="@gr2@"),i>6&&(t="@gr3@"),i>9&&(t="@gre@"),t=" "+t+"(level-"+e+")"}this.selectedSpell>=0?2===a.spellType[this.selectedSpell]&&(this.menuItemText1[this.menuItemsCount]="Cast "+a.spellName[this.selectedSpell]+" on",this.menuItemText2[this.menuItemsCount]="@yel@"+a.npcName[this.npcs[e].npcId],this.menuType[this.menuItemsCount]=700,this.menuItemX[this.menuItemsCount]=this.npcs[e].currentX,this.menuItemY[this.menuItemsCount]=this.npcs[e].currentY,this.menuIndex[this.menuItemsCount]=this.npcs[e].serverIndex,this.menuSourceIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++):this.selectedItemInventoryIndex>=0?(this.menuItemText1[this.menuItemsCount]="Use "+this.selectedItemName+" with",this.menuItemText2[this.menuItemsCount]="@yel@"+a.npcName[this.npcs[e].npcId],this.menuType[this.menuItemsCount]=710,this.menuItemX[this.menuItemsCount]=this.npcs[e].currentX,this.menuItemY[this.menuItemsCount]=this.npcs[e].currentY,this.menuIndex[this.menuItemsCount]=this.npcs[e].serverIndex,this.menuSourceIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,this.menuItemsCount++):(a.npcAttackable[s]>0&&(this.menuItemText1[this.menuItemsCount]="Attack",this.menuItemText2[this.menuItemsCount]="@yel@"+a.npcName[this.npcs[e].npcId]+t,this.menuType[this.menuItemsCount]=i>=0?715:2715,this.menuItemX[this.menuItemsCount]=this.npcs[e].currentX,this.menuItemY[this.menuItemsCount]=this.npcs[e].currentY,this.menuIndex[this.menuItemsCount]=this.npcs[e].serverIndex,this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Talk-to",this.menuItemText2[this.menuItemsCount]="@yel@"+a.npcName[this.npcs[e].npcId],this.menuType[this.menuItemsCount]=720,this.menuItemX[this.menuItemsCount]=this.npcs[e].currentX,this.menuItemY[this.menuItemsCount]=this.npcs[e].currentY,this.menuIndex[this.menuItemsCount]=this.npcs[e].serverIndex,this.menuItemsCount++,""!==a.npcCommand[s]&&(this.menuItemText1[this.menuItemsCount]=a.npcCommand[s],this.menuItemText2[this.menuItemsCount]="@yel@"+a.npcName[this.npcs[e].npcId],this.menuType[this.menuItemsCount]=725,this.menuItemX[this.menuItemsCount]=this.npcs[e].currentX,this.menuItemY[this.menuItemsCount]=this.npcs[e].currentY,this.menuIndex[this.menuItemsCount]=this.npcs[e].serverIndex,this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Examine",this.menuItemText2[this.menuItemsCount]="@yel@"+a.npcName[this.npcs[e].npcId],this.menuType[this.menuItemsCount]=3700,this.menuIndex[this.menuItemsCount]=this.npcs[e].npcId,this.menuItemsCount++)}}else if(o&&o.key>=1e4){const t=o.key-1e4,e=this.wallObjectId[t];this.wallObjectAlreadyInMenu[t]||(this.selectedSpell>=0?4===a.spellType[this.selectedSpell]&&(this.menuItemText1[this.menuItemsCount]="Cast "+a.spellName[this.selectedSpell]+" on",this.menuItemText2[this.menuItemsCount]="@cya@"+a.wallObjectName[e],this.menuType[this.menuItemsCount]=300,this.menuItemX[this.menuItemsCount]=this.wallObjectX[t],this.menuItemY[this.menuItemsCount]=this.wallObjectY[t],this.menuIndex[this.menuItemsCount]=this.wallObjectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++):this.selectedItemInventoryIndex>=0?(this.menuItemText1[this.menuItemsCount]="Use "+this.selectedItemName+" with",this.menuItemText2[this.menuItemsCount]="@cya@"+a.wallObjectName[e],this.menuType[this.menuItemsCount]=310,this.menuItemX[this.menuItemsCount]=this.wallObjectX[t],this.menuItemY[this.menuItemsCount]=this.wallObjectY[t],this.menuIndex[this.menuItemsCount]=this.wallObjectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,this.menuItemsCount++):(/^WalkTo$/i.test(a.wallObjectCommand1[e])||(this.menuItemText1[this.menuItemsCount]=a.wallObjectCommand1[e],this.menuItemText2[this.menuItemsCount]="@cya@"+a.wallObjectName[e],this.menuType[this.menuItemsCount]=320,this.menuItemX[this.menuItemsCount]=this.wallObjectX[t],this.menuItemY[this.menuItemsCount]=this.wallObjectY[t],this.menuIndex[this.menuItemsCount]=this.wallObjectDirection[t],this.menuItemsCount++),/^Examine$/i.test(a.wallObjectCommand2[e])||(this.menuItemText1[this.menuItemsCount]=a.wallObjectCommand2[e],this.menuItemText2[this.menuItemsCount]="@cya@"+a.wallObjectName[e],this.menuType[this.menuItemsCount]=2300,this.menuItemX[this.menuItemsCount]=this.wallObjectX[t],this.menuItemY[this.menuItemsCount]=this.wallObjectY[t],this.menuIndex[this.menuItemsCount]=this.wallObjectDirection[t],this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Examine",this.menuItemText2[this.menuItemsCount]="@cya@"+a.wallObjectName[e],this.menuType[this.menuItemsCount]=3300,this.menuIndex[this.menuItemsCount]=e,this.menuItemsCount++),this.wallObjectAlreadyInMenu[t]=!0)}else if(o&&o.key>=0){const t=o.key,e=this.objectId[t];this.objectAlreadyInMenu[t]||(this.selectedSpell>=0?5===a.spellType[this.selectedSpell]&&(this.menuItemText1[this.menuItemsCount]="Cast "+a.spellName[this.selectedSpell]+" on",this.menuItemText2[this.menuItemsCount]="@cya@"+a.objectName[e],this.menuType[this.menuItemsCount]=400,this.menuItemX[this.menuItemsCount]=this.objectX[t],this.menuItemY[this.menuItemsCount]=this.objectY[t],this.menuIndex[this.menuItemsCount]=this.objectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.objectId[t],this.menuTargetIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++):this.selectedItemInventoryIndex>=0?(this.menuItemText1[this.menuItemsCount]="Use "+this.selectedItemName+" with",this.menuItemText2[this.menuItemsCount]="@cya@"+a.objectName[e],this.menuType[this.menuItemsCount]=410,this.menuItemX[this.menuItemsCount]=this.objectX[t],this.menuItemY[this.menuItemsCount]=this.objectY[t],this.menuIndex[this.menuItemsCount]=this.objectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.objectId[t],this.menuTargetIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,this.menuItemsCount++):(/^WalkTo$/i.test(a.objectCommand1[e])||(this.menuItemText1[this.menuItemsCount]=a.objectCommand1[e],this.menuItemText2[this.menuItemsCount]="@cya@"+a.objectName[e],this.menuType[this.menuItemsCount]=420,this.menuItemX[this.menuItemsCount]=this.objectX[t],this.menuItemY[this.menuItemsCount]=this.objectY[t],this.menuIndex[this.menuItemsCount]=this.objectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.objectId[t],this.menuItemsCount++),/^Examine$/i.test(a.objectCommand2[e])||(this.menuItemText1[this.menuItemsCount]=a.objectCommand2[e],this.menuItemText2[this.menuItemsCount]="@cya@"+a.objectName[e],this.menuType[this.menuItemsCount]=2400,this.menuItemX[this.menuItemsCount]=this.objectX[t],this.menuItemY[this.menuItemsCount]=this.objectY[t],this.menuIndex[this.menuItemsCount]=this.objectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.objectId[t],this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Examine",this.menuItemText2[this.menuItemsCount]="@cya@"+a.objectName[e],this.menuType[this.menuItemsCount]=3400,this.menuIndex[this.menuItemsCount]=e,this.menuItemsCount++),this.objectAlreadyInMenu[t]=!0)}else i>=0&&(i=o.faceTag[i]-2e5),i>=0&&(e=i)}if(this.selectedSpell>=0&&a.spellType[this.selectedSpell]<=1&&(this.menuItemText1[this.menuItemsCount]="Cast "+a.spellName[this.selectedSpell]+" on self",this.menuItemText2[this.menuItemsCount]="",this.menuType[this.menuItemsCount]=1e3,this.menuIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++),-1!==e)if(this.selectedSpell>=0){if(6===a.spellType[this.selectedSpell])return this.menuItemText1[this.menuItemsCount]="Cast "+a.spellName[this.selectedSpell]+" on ground",this.menuItemText2[this.menuItemsCount]="",this.menuType[this.menuItemsCount]=900,this.menuItemX[this.menuItemsCount]=this.world.localX[e],this.menuItemY[this.menuItemsCount]=this.world.localY[e],this.menuIndex[this.menuItemsCount]=this.selectedSpell,void this.menuItemsCount++}else this.selectedItemInventoryIndex<0&&(this.menuItemText1[this.menuItemsCount]="Walk here",this.menuItemText2[this.menuItemsCount]="",this.menuType[this.menuItemsCount]=920,this.menuItemX[this.menuItemsCount]=this.world.localX[e],this.menuItemY[this.menuItemsCount]=this.world.localY[e],this.menuItemsCount++)}async handleInputs(){if(!(this.errorLoadingCodebase||this.errorLoadingMemory||this.errorLoadingData))try{if(this.loginTimer++,0===this.loggedIn?(this.mouseActionTimeout=0,await this.handleLoginScreenInput()):1===this.loggedIn&&(this.mouseActionTimeout++,await this.handleGameInput()),this.lastMouseButtonDown=0,this.cameraRotationTime++,this.cameraRotationTime>500){this.cameraRotationTime=0;const t=4*Math.random()|0;1==(1&t)&&(this.cameraRotationX+=this.cameraRotationXIncrement),2==(2&t)&&(this.cameraRotationY+=this.cameraRotationYIncrement)}if(this.cameraRotationX<-50?this.cameraRotationXIncrement=2:this.cameraRotationX>50&&(this.cameraRotationXIncrement=-2),this.cameraRotationY<-50?this.cameraRotationYIncrement=2:this.cameraRotationY>50&&(this.cameraRotationYIncrement=-2),this.messageTabFlashAll>0&&this.messageTabFlashAll--,this.messageTabFlashHistory>0&&this.messageTabFlashHistory--,this.messageTabFlashQuest>0&&this.messageTabFlashQuest--,this.messageTabFlashPrivate>0)return void this.messageTabFlashPrivate--}catch(t){console.error(t),this.disposeAndCollect(),this.errorLoadingMemory=!0}}async loadMaps(){this.world.mapPack=await this.readDataFile(`maps${I.MAPS}.jag`,"map",70),this.members&&(this.world.memberMapPack=await this.readDataFile(`maps${I.MAPS}.mem`,"members map",75)),this.world.landscapePack=await this.readDataFile(`land${I.MAPS}.jag`,"landscape",80),this.members&&(this.world.memberLandscapePack=await this.readDataFile(`land${I.MAPS}.mem`,"members landscape",85))}createModel(t,e,i,s,r){let n=t,o=e,h=t,c=e;const u=a.wallObjectTextureFront[s],d=a.wallObjectTextureBack[s],f=a.wallObjectHeight[s],m=l._from2(4,1);0===i?h=t+1:1===i?c=e+1:2===i?(n=t+1,c=e+1):3===i&&(h=t+1,c=e+1),n*=this.magicLoc,o*=this.magicLoc,h*=this.magicLoc,c*=this.magicLoc;const p=new Int32Array([m.vertexAt(n,-this.world.getElevation(n,o),o),m.vertexAt(n,-this.world.getElevation(n,o)-f,o),m.vertexAt(h,-this.world.getElevation(h,c)-f,c),m.vertexAt(h,-this.world.getElevation(h,c),c)]);return m.createFace(4,p,u,d),m._setLight_from6(!1,60,24,-50,-10,-50),t>=0&&e>=0&&t<96&&e<96&&this.scene.addModel(m),m.key=r+1e4,m}}},9438:(t,e,i)=>{const s=i(4854);t.exports=function(t){const e=s(__dirname,["*.js"]),i={};for(const[s,r]of Object.entries(e))if(!/^_|index/.test(s))for(const[e,s]of Object.entries(r))i[e]=s.bind(t);return i}},9222:(t,e,i)=>{const s=i(3720);class r{constructor(t){this.socket=t,this.closed=!1,this.closing=!1,this.delay=0,this.isaacIncoming=null,this.isaacOutgoing=null,this.length=0,this.maxReadTries=0,this.packet8Check=8,this.packetData=null,this.packetEnd=3,this.packetMaxLength=5e3,this.packetStart=0,this.readTries=0,this.socketException=!1,this.socketExceptionMessage=""}async readBytes(t,e){await this.readStreamBytes(t,0,e)}async readPacket(t){try{if(this.readTries++,this.maxReadTries>0&&this.readTries>this.maxReadTries)return this.socketException=!0,this.socketExceptionMessage="time-out",this.maxReadTries+=this.maxReadTries,0;if(0===this.length&&this.availableStream()>=2&&(this.length=await this.readStream(),this.length>=160&&(this.length=256*(this.length-160)+await this.readStream())),this.length>0&&this.availableStream()>=this.length){this.length>=160?await this.readBytes(this.length,t):(t[this.length-1]=255&await this.readStream(),this.length>1&&await this.readBytes(this.length-1,t));let e=this.length;return this.length=0,this.readTries=0,e}}catch(t){this.socketException=!0,this.socketExceptionMessage=t.message}return 0}hasPacket(){return this.packetStart>0}writePacket(t){if(this.socketException)throw this.packetStart=0,this.packetEnd=3,this.socketException=!1,new Error(this.socketExceptionMessage);this.delay++,this.delay<t||(this.packetStart>0&&(this.delay=0,this.writeStreamBytes(this.packetData,0,this.packetStart)),this.packetStart=0,this.packetEnd=3)}sendPacket(){if(null!==this.isaacOutgoing){let t=255&this.packetData[this.packetStart+2];this.packetData[this.packetStart+2]=t+this.isaacOutgoing.getNextValue()&255}8!==this.packet8Check&&this.packetEnd++;const t=this.packetEnd-this.packetStart-2;if(t>=160?(this.packetData[this.packetStart]=160+(t/256|0)&255,this.packetData[this.packetStart+1]=255&t):(this.packetData[this.packetStart]=255&t,this.packetEnd--,this.packetData[this.packetStart+1]=this.packetData[this.packetEnd]),this.packetMaxLength<=1e4){let t=255&this.packetData[this.packetStart+2];r.anIntArray537[t]++,r.anIntArray541[t]+=this.packetEnd-this.packetStart}this.packetStart=this.packetEnd}putBytes(t,e,i){for(let s=0;s<i;s++)this.packetData[this.packetEnd++]=255&t[e+s]}putLong(t){this.putInt(t.shiftRight(32).toInt()),this.putInt(t.toInt())}newPacket(t){if(this.packetStart>(4*this.packetMaxLength/5|0))try{this.writePacket(0)}catch(t){this.socketException=!0,this.socketExceptionMessage=t.message}null===this.packetData&&(this.packetData=new Int8Array(this.packetMaxLength)),this.packetData[this.packetStart+2]=255&t,this.packetData[this.packetStart+3]=0,this.packetEnd=this.packetStart+3,this.packet8Check=8}async getLong(){let t=await this.getShort(),e=await this.getShort(),i=await this.getShort(),r=await this.getShort();return s.fromInt(t).shiftLeft(48).add(s.fromInt(e).shiftLeft(32)).add(i<<16).add(r)}putShort(t){this.packetData[this.packetEnd++]=t>>8&255,this.packetData[this.packetEnd++]=255&t}putInt(t){this.packetData[this.packetEnd++]=t>>24&255,this.packetData[this.packetEnd++]=t>>16&255,this.packetData[this.packetEnd++]=t>>8&255,this.packetData[this.packetEnd++]=255&t}async getShort(){return 256*await this.getByte()+await this.getByte()}putString(t){this.putBytes(function(t){const e=new Uint16Array(t.length);for(let i=0;i<t.length;i+=1)e[i]=t.charCodeAt(i);return e}(t),0,t.length)}putByte(t){this.packetData[this.packetEnd++]=255&t}isaacCommand(t){return t}async getByte(){return 255&await this.readStream()}flushPacket(){this.sendPacket(),this.writePacket(0)}closeStream(){this.closing=!0,this.socket.close(),this.closed=!0}async readStream(){return this.closing?0:await this.socket.read()}availableStream(){return this.closing?0:this.socket.available()}async readStreamBytes(t,e,i){this.closing||await this.socket.readBytes(i,e,t)}writeStreamBytes(t,e,i){this.closing||this.socket.write(t,e,i)}}r.anIntArray537=new Int32Array(256),r.anIntArray541=new Int32Array(256),t.exports=r},2184:(t,e,i)=>{const s=i(1371),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!\"£$%^&*()-_=+[{]};:'@#~,<.>/?\\| ";class n{constructor(t,e){this.controlCount=0,this.mouseX=0,this.mouseY=0,this.mouseLastButtonDown=0,this.mouseButtonDown=0,this.mouseMetaButtonHeld=0,this.mouseScrollDelta=0,this.focusControlIndex=-1,this.aBoolean219=!0,this.surface=t,this.maxControls=e,this.controlShown=new Int8Array(e),this.controlListScrollbarHandleDragged=new Int8Array(e),this.controlMaskText=new Int8Array(e),this.controlClicked=new Int8Array(e),this.controlUseAlternativeColour=new Int8Array(e),this.controlFlashText=new Int32Array(e),this.controlListEntryCount=new Int32Array(e),this.controlListEntryMouseButtonDown=new Int32Array(e),this.controlListEntryMouseOver=new Int32Array(e),this.controlX=new Int32Array(e),this.controlY=new Int32Array(e),this.controlType=new Int32Array(e),this.controlWidth=new Int32Array(e),this.controlHeight=new Int32Array(e),this.controlInputMaxLen=new Int32Array(e),this.controlTextSize=new Int32Array(e),this.controlText=[],this.controlText.length=e,this.controlListEntries=[];for(let t=0;t<e;t+=1)this.controlListEntries.push([]);this.colourScrollbarTop=this.rgbToIntMod(114,114,176),this.colourScrollbarBottom=this.rgbToIntMod(14,14,62),this.colourScrollbarHandleLeft=this.rgbToIntMod(200,208,232),this.colourScrollbarHandleMid=this.rgbToIntMod(96,129,184),this.colourScrollbarHandleRight=this.rgbToIntMod(53,95,115),this.colourRoundedBoxOut=this.rgbToIntMod(117,142,171),this.colourRoundedBoxMid=this.rgbToIntMod(98,122,158),this.colourRoundedBoxIn=this.rgbToIntMod(86,100,136),this.colourBoxTopNBottom=this.rgbToIntMod(135,146,179),this.colourBoxTopNBottom2=this.rgbToIntMod(97,112,151),this.colourBoxLeftNRight2=this.rgbToIntMod(88,102,136),this.colourBoxLeftNRight=this.rgbToIntMod(84,93,120)}rgbToIntMod(t,e,i){return s.rgbToInt(n.redMod*t/114|0,n.greenMod*e/114|0,n.blueMod*i/176|0)}handleMouse(t,e,i,s){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(this.mouseX=t,this.mouseY=e,this.mouseButtonDown=s,this.mouseScrollDelta=r,0!==i&&(this.mouseLastButtonDown=i),1===i)for(let t=0;t<this.controlCount;t++)this.controlShown[t]&&10===this.controlType[t]&&this.mouseX>=this.controlX[t]&&this.mouseY>=this.controlY[t]&&this.mouseX<=this.controlX[t]+this.controlWidth[t]&&this.mouseY<=this.controlY[t]+this.controlHeight[t]&&(this.controlClicked[t]=!0),this.controlShown[t]&&14===this.controlType[t]&&this.mouseX>=this.controlX[t]&&this.mouseY>=this.controlY[t]&&this.mouseX<=this.controlX[t]+this.controlWidth[t]&&this.mouseY<=this.controlY[t]+this.controlHeight[t]&&(this.controlListEntryMouseButtonDown[t]=1-this.controlListEntryMouseButtonDown[t]);1===s?this.mouseMetaButtonHeld++:this.mouseMetaButtonHeld=0}isClicked(t){return!(!this.controlShown[t]||!this.controlClicked[t]||(this.controlClicked[t]=!1,0))}keyPress(t){if(0!==t&&-1!==this.focusControlIndex&&null!==this.controlText[this.focusControlIndex]&&this.controlShown[this.focusControlIndex]){const e=this.controlText[this.focusControlIndex].length;if(8===t&&e>0&&(this.controlText[this.focusControlIndex]=this.controlText[this.focusControlIndex].slice(0,e-1)),(10===t||13===t)&&e>0&&(this.controlClicked[this.focusControlIndex]=!0),e<this.controlInputMaxLen[this.focusControlIndex])for(let e=0;e<95;e++)t===r.charCodeAt(e)&&(this.controlText[this.focusControlIndex]+=String.fromCharCode(t));if(9===t)do{this.focusControlIndex=(this.focusControlIndex+1)%this.controlCount}while(5!==this.controlType[this.focusControlIndex]&&6!==this.controlType[this.focusControlIndex])}}drawPanel(){for(let t=0;t<this.controlCount;t++)this.controlShown[t]&&(0===this.controlType[t]?this.drawText(t,this.controlX[t],this.controlY[t],this.controlText[t],this.controlTextSize[t]):1===this.controlType[t]?this.drawText(t,this.controlX[t]-(this.surface.textWidth(this.controlText[t],this.controlTextSize[t])/2|0),this.controlY[t],this.controlText[t],this.controlTextSize[t]):2===this.controlType[t]?this.drawBox(this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t]):3===this.controlType[t]?this.drawLineHoriz(this.controlX[t],this.controlY[t],this.controlWidth[t]):4===this.controlType[t]?this.drawTextList(t,this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t],this.controlTextSize[t],this.controlListEntries[t],this.controlListEntryCount[t],this.controlFlashText[t]):5===this.controlType[t]||6===this.controlType[t]?this.drawTextInput(t,this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t],this.controlText[t],this.controlTextSize[t]):7===this.controlType[t]?this.drawOptionListHoriz(t,this.controlX[t],this.controlY[t],this.controlTextSize[t],this.controlListEntries[t]):8===this.controlType[t]?this.drawOptionListVert(t,this.controlX[t],this.controlY[t],this.controlTextSize[t],this.controlListEntries[t]):9===this.controlType[t]?this.drawTextListInteractive(t,this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t],this.controlTextSize[t],this.controlListEntries[t],this.controlListEntryCount[t],this.controlFlashText[t]):11===this.controlType[t]?this.drawRoundedBox(this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t]):12===this.controlType[t]?this.drawPicture(this.controlX[t],this.controlY[t],this.controlTextSize[t]):14===this.controlType[t]&&this.drawCheckbox(t,this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t]));this.mouseLastButtonDown=0}drawCheckbox(t,e,i,s,r){if(this.surface.drawBox(e,i,s,r,16777215),this.surface.drawLineHoriz(e,i,s,this.colourBoxTopNBottom),this.surface.drawLineVert(e,i,r,this.colourBoxTopNBottom),this.surface.drawLineHoriz(e,i+r-1,s,this.colourBoxLeftNRight),this.surface.drawLineVert(e+s-1,i,r,this.colourBoxLeftNRight),1===this.controlListEntryMouseButtonDown[t])for(let t=0;t<r;t++)this.surface.drawLineHoriz(e+t,i+t,1,0),this.surface.drawLineHoriz(e+s-1-t,i+t,1,0)}drawText(t,e,i,s,r){const n=i+(this.surface.textHeight(r)/3|0);this.drawString(t,e,n,s,r)}drawString(t,e,i,s,r){let n;n=this.controlUseAlternativeColour[t]?16777215:0,this.surface.drawString(s,e,i,r,n)}drawTextInput(t,e,i,s,r,n,o){let h=n;if(this.controlMaskText[t]){const t=h.length;h="";for(let e=0;e<t;e++)h+="X"}if(5===this.controlType[t]?1===this.mouseLastButtonDown&&this.mouseX>=e&&this.mouseY>=i-(r/2|0)&&this.mouseX<=e+s&&this.mouseY<=i+(r/2|0)&&(this.focusControlIndex=t,this.setMobileFocus(t,n)):6===this.controlType[t]&&(1===this.mouseLastButtonDown&&this.mouseX>=e-(s/2|0)&&this.mouseY>=i-(r/2|0)&&this.mouseX<=e+s/2&&this.mouseY<=i+(r/2|0)&&(this.focusControlIndex=t,this.setMobileFocus(t,n)),e-=this.surface.textWidth(h,o)/2|0),this.focusControlIndex===t){const{mudclient:t}=this.surface,e=t.mobileInputCaret;t.options.mobile&&-1!==e?h=h.slice(0,e)+"*"+h.slice(e):h+="*"}const a=i+(this.surface.textHeight(o)/3|0);this.drawString(t,e,a,h,o)}drawBox(t,e,i,s){if(this.surface.setBounds(t,e,t+i,e+s),this.surface.drawGradient(t,e,i,s,this.colourBoxLeftNRight,this.colourBoxTopNBottom),n.drawBackgroundArrow)for(let r=t-(63&e);r<t+i;r+=128)for(let t=e-(31&e);t<e+s;t+=128)this.surface.drawSpriteAlpha(r,t,6+n.baseSpriteStart,128);this.surface.drawLineHoriz(t,e,i,this.colourBoxTopNBottom),this.surface.drawLineHoriz(t+1,e+1,i-2,this.colourBoxTopNBottom),this.surface.drawLineHoriz(t+2,e+2,i-4,this.colourBoxTopNBottom2),this.surface.drawLineVert(t,e,s,this.colourBoxTopNBottom),this.surface.drawLineVert(t+1,e+1,s-2,this.colourBoxTopNBottom),this.surface.drawLineVert(t+2,e+2,s-4,this.colourBoxTopNBottom2),this.surface.drawLineHoriz(t,e+s-1,i,this.colourBoxLeftNRight),this.surface.drawLineHoriz(t+1,e+s-2,i-2,this.colourBoxLeftNRight),this.surface.drawLineHoriz(t+2,e+s-3,i-4,this.colourBoxLeftNRight2),this.surface.drawLineVert(t+i-1,e,s,this.colourBoxLeftNRight),this.surface.drawLineVert(t+i-2,e+1,s-2,this.colourBoxLeftNRight),this.surface.drawLineVert(t+i-3,e+2,s-4,this.colourBoxLeftNRight2),this.surface.resetBounds()}drawRoundedBox(t,e,i,s){this.surface.drawBox(t,e,i,s,0),this.surface.drawBoxEdge(t,e,i,s,this.colourRoundedBoxOut),this.surface.drawBoxEdge(t+1,e+1,i-2,s-2,this.colourRoundedBoxMid),this.surface.drawBoxEdge(t+2,e+2,i-4,s-4,this.colourRoundedBoxIn),this.surface._drawSprite_from3(t,e,2+n.baseSpriteStart),this.surface._drawSprite_from3(t+i-7,e,3+n.baseSpriteStart),this.surface._drawSprite_from3(t,e+s-7,4+n.baseSpriteStart),this.surface._drawSprite_from3(t+i-7,e+s-7,5+n.baseSpriteStart)}drawPicture(t,e,i){this.surface._drawSprite_from3(t,e,i)}drawLineHoriz(t,e,i){this.surface.drawLineHoriz(t,e,i,16777215)}drawTextList(t,e,i,s,r,o,h,a,l){const c=r/this.surface.textHeight(o)|0,u=a-c;if(l>u&&(l=u),l<0&&(l=0),this.controlFlashText[t]=l,c<a){const n=e+s-12;let o=(r-27)*c/a|0;o<6&&(o=6);let h=(r-27-o)*l/u|0;0!==this.mouseScrollDelta&&this.mouseX>e&&this.mouseX<e+s&&this.mouseY>i&&this.mouseY<i+r&&((l+=this.mouseScrollDelta)<0?l=0:l>u&&(l=u),this.controlFlashText[t]=l),1===this.mouseButtonDown&&this.mouseX>=n&&this.mouseX<=n+12&&(this.mouseY>i&&this.mouseY<i+12&&l>0&&l--,this.mouseY>i+r-12&&this.mouseY<i+r&&l<a-c&&l++,this.controlFlashText[t]=l),1===this.mouseButtonDown&&(this.mouseX>=n&&this.mouseX<=n+12||this.mouseX>=n-12&&this.mouseX<=n+24&&this.controlListScrollbarHandleDragged[t])?this.mouseY>i+12&&this.mouseY<i+r-12&&(this.controlListScrollbarHandleDragged[t]=!0,(l=(this.mouseY-i-12-(o/2|0))*a/(r-24)|0)>u&&(l=u),l<0&&(l=0),this.controlFlashText[t]=l):this.controlListScrollbarHandleDragged[t]=!1,h=(r-27-o)*l/(a-c)|0,this.drawListContainer(e,i,s,r,h,o)}const d=r-c*this.surface.textHeight(o);let f=i+(5*this.surface.textHeight(o)/6+d/2)|0;for(let s=l;s<a;s++)if(this.drawString(t,e+2,f,h[s],o),f+=this.surface.textHeight(o)-n.textListEntryHeightMod,f>=i+r)return}drawListContainer(t,e,i,s,r,o){const h=t+i-12;this.surface.drawBoxEdge(h,e,12,s,0),this.surface._drawSprite_from3(h+1,e+1,n.baseSpriteStart),this.surface._drawSprite_from3(h+1,e+s-12,n.baseSpriteStart+1),this.surface.drawLineHoriz(h,e+13,12,0),this.surface.drawLineHoriz(h,e+s-13,12,0),this.surface.drawGradient(h+1,e+14,11,s-27,this.colourScrollbarTop,this.colourScrollbarBottom),this.surface.drawBox(h+3,r+e+14,7,o,this.colourScrollbarHandleMid),this.surface.drawLineVert(h+2,r+e+14,o,this.colourScrollbarHandleLeft),this.surface.drawLineVert(h+2+8,r+e+14,o,this.colourScrollbarHandleRight)}drawOptionListHoriz(t,e,i,s,r){let n=0;const o=r.length;for(let t=0;t<o;t++)n+=this.surface.textWidth(r[t],s),t<o-1&&(n+=this.surface.textWidth("  ",s));let h=e-(n/2|0);const a=i+(this.surface.textHeight(s)/3|0);for(let e=0;e<o;e++){let i;i=this.controlUseAlternativeColour[t]?16777215:0,this.mouseX>=h&&this.mouseX<=h+this.surface.textWidth(r[e],s)&&this.mouseY<=a&&this.mouseY>a-this.surface.textHeight(s)&&(i=this.controlUseAlternativeColour[t]?8421504:16777215,1===this.mouseLastButtonDown&&(this.controlListEntryMouseButtonDown[t]=e,this.controlClicked[t]=!0)),this.controlListEntryMouseButtonDown[t]===e&&(i=this.controlUseAlternativeColour[t]?16711680:12582912),this.surface.drawString(r[e],h,a,s,i),h+=this.surface.textWidth(r[e]+"  ",s)}}drawOptionListVert(t,e,i,s,r){const n=r.length;let o=i-(this.surface.textHeight(s)*(n-1)/2|0);for(let i=0;i<n;i++){let n;n=this.controlUseAlternativeColour[t]?16777215:0;const h=this.surface.textWidth(r[i],s);this.mouseX>=e-(h/2|0)&&this.mouseX<=e+(h/2|0)&&this.mouseY-2<=o&&this.mouseY-2>o-this.surface.textHeight(s)&&(n=this.controlUseAlternativeColour[t]?8421504:16777215,1===this.mouseLastButtonDown&&(this.controlListEntryMouseButtonDown[t]=i,this.controlClicked[t]=!0)),this.controlListEntryMouseButtonDown[t]===i&&(n=this.controlUseAlternativeColour[t]?16711680:12582912),this.surface.drawString(r[i],e-(h/2|0),o,s,n),o+=this.surface.textHeight(s)}}drawTextListInteractive(t,e,i,s,r,n,o,h,a){const l=r/this.surface.textHeight(n)|0,c=h-l;if(l<h){const n=e+s-12;let o=(r-27)*l/h|0;o<6&&(o=6);let u=(r-27-o)*a/c|0;0!==this.mouseScrollDelta&&this.mouseX>e&&this.mouseX<e+s&&this.mouseY>i&&this.mouseY<i+r&&((a+=this.mouseScrollDelta)<0?a=0:a>c&&(a=c),this.controlFlashText[t]=a),1===this.mouseButtonDown&&this.mouseX>=n&&this.mouseX<=n+12&&(this.mouseY>i&&this.mouseY<i+12&&a>0&&a--,this.mouseY>i+r-12&&this.mouseY<i+r&&a<c&&a++,this.controlFlashText[t]=a),1===this.mouseButtonDown&&(this.mouseX>=n&&this.mouseX<=n+12||this.mouseX>=n-12&&this.mouseX<=n+24&&this.controlListScrollbarHandleDragged[t])?this.mouseY>i+12&&this.mouseY<i+r-12&&(this.controlListScrollbarHandleDragged[t]=!0,(a=(this.mouseY-i-12-(o/2|0))*h/(r-24)|0)<0&&(a=0),a>c&&(a=c),this.controlFlashText[t]=a):this.controlListScrollbarHandleDragged[t]=!1,u=(r-27-o)*a/c|0,this.drawListContainer(e,i,s,r,u,o)}else a=0,this.controlFlashText[t]=0;this.controlListEntryMouseOver[t]=-1;const u=r-l*this.surface.textHeight(n);let d=i+((5*this.surface.textHeight(n)/6|0)+u/2|0);for(let l=a;l<h;l++){let h;if(h=this.controlUseAlternativeColour[t]?16777215:0,this.mouseX>=e+2&&this.mouseX<=e+s-12&&this.mouseY-2<=d&&this.mouseY-2>d-this.surface.textHeight(n)&&(h=this.controlUseAlternativeColour[t]?8421504:16777215,this.controlListEntryMouseOver[t]=l,1===this.mouseLastButtonDown&&(this.controlListEntryMouseButtonDown[t]=l,this.controlClicked[t]=!0)),this.controlListEntryMouseButtonDown[t]===l&&this.aBoolean219&&(h=16711680),this.surface.drawString(o[l],e+2,d,n,h),d+=this.surface.textHeight(n),d>=i+r)return}}addText(t,e,i,s,r){return this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlTextSize[this.controlCount]=s,this.controlUseAlternativeColour[this.controlCount]=r,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlText[this.controlCount]=i,this.controlCount++}addTextCentre(t,e,i,s,r){return this.controlType[this.controlCount]=1,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlTextSize[this.controlCount]=s,this.controlUseAlternativeColour[this.controlCount]=r,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlText[this.controlCount]=i,this.controlCount++}addButtonBackground(t,e,i,s){return this.controlType[this.controlCount]=2,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlX[this.controlCount]=t-(i/2|0),this.controlY[this.controlCount]=e-(s/2|0),this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlCount++}addBoxRounded(t,e,i,s){return this.controlType[this.controlCount]=11,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlX[this.controlCount]=t-(i/2|0),this.controlY[this.controlCount]=e-(s/2|0),this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlCount++}addSprite(t,e,i){const s=this.surface.spriteWidth[i],r=this.surface.spriteHeight[i];return this.controlType[this.controlCount]=12,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlX[this.controlCount]=t-(s/2|0),this.controlY[this.controlCount]=e-(r/2|0),this.controlWidth[this.controlCount]=s,this.controlHeight[this.controlCount]=r,this.controlTextSize[this.controlCount]=i,this.controlCount++}addTextList(t,e,i,s,r,n,o){return this.controlType[this.controlCount]=4,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlUseAlternativeColour[this.controlCount]=o,this.controlTextSize[this.controlCount]=r,this.controlInputMaxLen[this.controlCount]=n,this.controlListEntryCount[this.controlCount]=0,this.controlFlashText[this.controlCount]=0,this.controlListEntries[this.controlCount]=[],this.controlListEntries[this.controlCount].length=n,this.controlListEntries[this.controlCount].fill(null),this.controlCount++}addTextListInput(t,e,i,s,r,n,o,h){return this.controlType[this.controlCount]=5,this.controlShown[this.controlCount]=!0,this.controlMaskText[this.controlCount]=o,this.controlClicked[this.controlCount]=!1,this.controlTextSize[this.controlCount]=r,this.controlUseAlternativeColour[this.controlCount]=h,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlInputMaxLen[this.controlCount]=n,this.controlText[this.controlCount]="",this.controlCount++}addTextInput(t,e,i,s,r,n,o,h){return this.controlType[this.controlCount]=6,this.controlShown[this.controlCount]=!0,this.controlMaskText[this.controlCount]=o,this.controlClicked[this.controlCount]=!1,this.controlTextSize[this.controlCount]=r,this.controlUseAlternativeColour[this.controlCount]=h,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlInputMaxLen[this.controlCount]=n,this.controlText[this.controlCount]="",this.controlCount++}addTextListInteractive(t,e,i,s,r,n,o){return this.controlType[this.controlCount]=9,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlTextSize[this.controlCount]=r,this.controlUseAlternativeColour[this.controlCount]=o,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlInputMaxLen[this.controlCount]=n,this.controlListEntries[this.controlCount]=[],this.controlListEntries[this.controlCount].length=n,this.controlListEntries[this.controlCount].fill(null),this.controlListEntryCount[this.controlCount]=0,this.controlFlashText[this.controlCount]=0,this.controlListEntryMouseButtonDown[this.controlCount]=-1,this.controlListEntryMouseOver[this.controlCount]=-1,this.controlCount++}addButton(t,e,i,s){return this.controlType[this.controlCount]=10,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlX[this.controlCount]=t-(i/2|0),this.controlY[this.controlCount]=e-(s/2|0),this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlCount++}addLineHoriz(t,e,i){return this.controlType[this.controlCount]=3,this.controlShown[this.controlCount]=!0,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlCount++}addOptionListHoriz(t,e,i,s,r){return this.controlType[this.controlCount]=7,this.controlShown[this.controlCount]=!0,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlTextSize[this.controlCount]=i,this.controlListEntries[this.controlCount]=[],this.controlListEntries[this.controlCount].length=s,this.controlListEntries[this.controlCount].fill(null),this.controlListEntryCount[this.controlCount]=0,this.controlUseAlternativeColour[this.controlCount]=r,this.controlClicked[this.controlCount]=!1,this.controlCount++}addOptionListVert(t,e,i,s,r){return this.controlType[this.controlCount]=8,this.controlShown[this.controlCount]=!0,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlTextSize[this.controlCount]=i,this.controlListEntries[this.controlCount]=[],this.controlListEntries[this.controlCount].length=s,this.controlListEntries[this.controlCount].fill(null),this.controlListEntryCount[this.controlCount]=0,this.controlUseAlternativeColour[this.controlCount]=r,this.controlClicked[this.controlCount]=!1,this.controlCount++}addCheckbox(t,e,i,s){return this.controlType[this.controlCount]=14,this.controlShown[this.controlCount]=!0,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlListEntryMouseButtonDown[this.controlCount]=0,this.controlCount++}toggleCheckbox(t,e){this.controlListEntryMouseButtonDown[t]=+e}isActivated(t){return 0!==this.controlListEntryMouseButtonDown[t]}clearList(t){this.controlListEntryCount[t]=0}resetListProps(t){this.controlFlashText[t]=0,this.controlListEntryMouseOver[t]=-1}addListEntry(t,e,i){this.controlListEntries[t][e]=i,e+1>this.controlListEntryCount[t]&&(this.controlListEntryCount[t]=e+1)}removeListEntry(t,e,i){let s=this.controlListEntryCount[t]++;if(s>=this.controlInputMaxLen[t]){s--,this.controlListEntryCount[t]--;for(let e=0;e<s;e++)this.controlListEntries[t][e]=this.controlListEntries[t][e+1]}this.controlListEntries[t][s]=e,i&&(this.controlFlashText[t]=999999)}updateText(t,e){this.controlText[t]=e}getText(t){return null===this.controlText[t]?"null":this.controlText[t]}show(t){this.controlShown[t]=!0}hide(t){this.controlShown[t]=!1}setFocus(t){this.focusControlIndex=t,this.setMobileFocus(t,this.controlText[t])}getListEntryIndex(t){return this.controlListEntryMouseOver[t]}setMobileFocus(t,e){const{mudclient:i}=this.surface;if(!i.options.mobile)return;const s=this.controlMaskText[t],r=5===this.controlType[t],n=this.controlWidth[t],o=this.controlHeight[t],h=r?this.controlX[t]:this.controlX[t]-Math.floor(n/2);i.openKeyboard(s?"password":"text",e,this.controlInputMaxLen[t],{width:`${n}px`,height:`${o}px`,top:this.controlY[t]-Math.floor(o/2)+"px",left:`${h}px`,fontSize:r?"12px":"14px",textAlign:r?"left":"center"})}}n.baseSpriteStart=0,n.drawBackgroundArrow=!0,n.redMod=114,n.greenMod=114,n.blueMod=176,n.textListEntryHeightMod=0,t.exports=n},2401:t=>{t.exports=class{constructor(){this.minPlaneX=0,this.minPlaneY=0,this.maxPlaneX=0,this.maxPlaneY=0,this.minZ=0,this.maxZ=0,this.model=null,this.face=0,this.depth=0,this.normalX=0,this.normalY=0,this.normalZ=0,this.visibility=0,this.facefill=0,this.skipSomething=!1,this.index=0,this.index2=0}}},7218:t=>{t.exports=class{constructor(){this.startX=0,this.endX=0,this.startS=0,this.endS=0}}},5965:(t,e,i)=>{const s=i(3720),r=i(2401),n=i(7218),o=12345678;class h{constructor(t,e,i,s){this.lastVisiblePolygonsCount=0,this.anIntArray377=null,this.textureCount=0,this.textureColoursUsed=null,this.textureColourList=null,this.textureDimension=null,this.textureLoadedNumber=null,this.texturePixels=null,this.textureBackTransparent=null,this.textureColours64=null,this.textureColours128=null,this.scanlines=null,this.minY=0,this.maxY=0,this.interlace=!1,this.mouseX=0,this.mouseY=0,this.mousePickedCount=0,this.newStart=0,this.newEnd=0,this.cameraX=0,this.cameraY=0,this.cameraZ=0,this.cameraYaw=0,this.cameraPitch=0,this.cameraRoll=0,this.rampCount=50,this.gradientBase=new Int32Array(this.rampCount),this.gradientRamps=[];for(let t=0;t<this.rampCount;t+=1)this.gradientRamps.push(new Int32Array(256));this.clipNear=5,this.clipFar3d=1e3,this.clipFar2d=1e3,this.fogZFalloff=20,this.fogZDistance=10,this.wideBand=!1,this.mousePickingActive=!1,this.mousePickedMax=100,this.mousePickedModels=[],this.mousePickedModels.length=this.mousePickedMax,this.mousePickedModels.fill(null),this.mousePickedFaces=new Int32Array(this.mousePickedMax),this.width=1024,this.clipX=256,this.clipY=192,this.baseX=256,this.baseY=256,this.viewDistance=8,this.normalMagnitude=4,this.planeX=new Int32Array(40),this.planeY=new Int32Array(40),this.vertexShade=new Int32Array(40),this.vertexX=new Int32Array(40),this.vertexY=new Int32Array(40),this.vertexZ=new Int32Array(40),this.interlace=!1,this.surface=t,this.clipX=t.width2/2|0,this.clipY=t.height2/2|0,this.raster=t.pixels,this.modelCount=0,this.maxModelCount=e,this.models=[],this.models.length=this.maxModelCount,this.models.fill(null),this.visiblePolygonsCount=0,this.visiblePolygons=[];for(let t=0;t<i;t++)this.visiblePolygons.push(new r);this.spriteCount=0,this.spriteId=new Int32Array(s),this.spriteWidth=new Int32Array(s),this.spriteHeight=new Int32Array(s),this.spriteX=new Int32Array(s),this.spriteZ=new Int32Array(s),this.spriteY=new Int32Array(s),this.spriteTranslateX=new Int32Array(s),this.cameraX=0,this.cameraY=0,this.cameraZ=0,this.cameraYaw=0,this.cameraPitch=0,this.cameraRoll=0;for(let t=0;t<256;t++)h.sin512Cache[t]=32768*Math.sin(.02454369*t)|0,h.sin512Cache[t+256]=32768*Math.cos(.02454369*t)|0;for(let t=0;t<1024;t++)h.sinCosCache[t]=32768*Math.sin(.00613592315*t)|0,h.sinCosCache[t+1024]=32768*Math.cos(.00613592315*t)|0}static textureScanline(t,e,i,s,r,n,o,h,a,l,c,u,d,f){if(c<=0)return;let m=0,p=0,g=0;0!==o&&(i=r/o<<7,s=n/o<<7),i<0?i=0:i>16256&&(i=16256),r+=h,n+=a,0!==(o+=l)&&(m=r/o<<7,p=n/o<<7),m<0?m=0:m>16256&&(m=16256);let y=m-i>>4,w=p-s>>4;for(let b=c>>4;b>0;b--)i+=6291456&d,g=d>>23,d+=f,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,s+=w,i=(16383&(i+=y))+(6291456&d),g=d>>23,d+=f,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,s+=w,i=(16383&(i+=y))+(6291456&d),g=d>>23,d+=f,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,s+=w,i=(16383&(i+=y))+(6291456&d),g=d>>23,d+=f,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w,t[u++]=e[(16256&s)+(i>>7)]>>>g,i=m,s=p,r+=h,n+=a,0!==(o+=l)&&(m=r/o<<7,p=n/o<<7),m<0?m=0:m>16256&&(m=16256),y=m-i>>4,w=p-s>>4;for(let r=0;r<(15&c);r++)0==(3&r)&&(i=(16383&i)+(6291456&d),g=d>>23,d+=f),t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=y,s+=w}static textureTranslucentScanline(t,e,i,s,r,n,o,h,a,l,c,u,d,f){if(c<=0)return;let m=0,p=0,g=0;0!==o&&(i=r/o<<7,s=n/o<<7),i<0?i=0:i>16256&&(i=16256),r+=h,n+=a,0!==(o+=l)&&(m=r/o<<7,p=n/o<<7),m<0?m=0:m>16256&&(m=16256);let y=m-i>>4,w=p-s>>4;for(let b=c>>4;b>0;b--)i+=6291456&d,g=d>>23,d+=f,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),s+=w,i=(16383&(i+=y))+(6291456&d),g=d>>23,d+=f,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),s+=w,i=(16383&(i+=y))+(6291456&d),g=d>>23,d+=f,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),s+=w,i=(16383&(i+=y))+(6291456&d),g=d>>23,d+=f,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i=m,s=p,r+=h,n+=a,0!==(o+=l)&&(m=r/o<<7,p=n/o<<7),m<0?m=0:m>16256&&(m=16256),y=m-i>>4,w=p-s>>4;for(let r=0;r<(15&c);r++)0==(3&r)&&(i=(16383&i)+(6291456&d),g=d>>23,d+=f),t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=y,s+=w}static textureBackTranslucentScanline(t,e,i,s,r,n,o,h,a,l,c,u,d,f,m){if(u<=0)return;let p=0,g=0;m<<=2,0!==h&&(p=n/h<<7,g=o/h<<7),p<0?p=0:p>16256&&(p=16256);for(let y=u;y>0;y-=16){n+=a,o+=l,i=p,s=g,0!==(h+=c)&&(p=n/h<<7,g=o/h<<7),p<0?p=0:p>16256&&(p=16256);let u=p-i>>4,w=g-s>>4,b=f>>23;if(i+=6291456&f,f+=m,y<16)for(let n=0;n<y;n++)0!=(e=r[(16256&s)+(i>>7)]>>>b)&&(t[d]=e),d++,i+=u,s+=w,3==(3&n)&&(i=(16383&i)+(6291456&f),b=f>>23,f+=m);else 0!=(e=r[(16256&s)+(i>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,i=(16383&(i+=u))+(6291456&f),b=f>>23,f+=m,0!=(e=r[(16256&(s+=w))+(i>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,i=(16383&(i+=u))+(6291456&f),b=f>>23,f+=m,0!=(e=r[(16256&(s+=w))+(i>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,i=(16383&(i+=u))+(6291456&f),b=f>>23,f+=m,0!=(e=r[(16256&(s+=w))+(i>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=w))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++}}static textureScanline2(t,e,i,s,r,n,o,h,a,l,c,u,d,f){if(c<=0)return;let m=0,p=0;f<<=2,0!==o&&(m=r/o<<6,p=n/o<<6),m<0?m=0:m>4032&&(m=4032);for(let g=c;g>0;g-=16){r+=h,n+=a,i=m,s=p,0!==(o+=l)&&(m=r/o<<6,p=n/o<<6),m<0?m=0:m>4032&&(m=4032);let c=m-i>>4,y=p-s>>4,w=d>>20;if(i+=786432&d,d+=f,g<16)for(let r=0;r<g;r++)t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,3==(3&r)&&(i=(4095&i)+(786432&d),w=d>>20,d+=f);else t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,s+=y,i=(4095&(i+=c))+(786432&d),w=d>>20,d+=f,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,s+=y,i=(4095&(i+=c))+(786432&d),w=d>>20,d+=f,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,s+=y,i=(4095&(i+=c))+(786432&d),w=d>>20,d+=f,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w,i+=c,s+=y,t[u++]=e[(4032&s)+(i>>6)]>>>w}}static textureTranslucentScanline2(t,e,i,s,r,n,o,h,a,l,c,u,d,f){if(c<=0)return;let m=0,p=0;f<<=2,0!==o&&(m=r/o<<6,p=n/o<<6),m<0?m=0:m>4032&&(m=4032);for(let g=c;g>0;g-=16){r+=h,n+=a,i=m,s=p,0!==(o+=l)&&(m=r/o<<6,p=n/o<<6),m<0?m=0:m>4032&&(m=4032);let c=m-i>>4,y=p-s>>4,w=d>>20;if(i+=786432&d,d+=f,g<16)for(let r=0;r<g;r++)t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,3==(3&r)&&(i=(4095&i)+(786432&d),w=d>>20,d+=f);else t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),s+=y,i=(4095&(i+=c))+(786432&d),w=d>>20,d+=f,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),s+=y,i=(4095&(i+=c))+(786432&d),w=d>>20,d+=f,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),s+=y,i=(4095&(i+=c))+(786432&d),w=d>>20,d+=f,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711),i+=c,s+=y,t[u++]=(e[(4032&s)+(i>>6)]>>>w)+(t[u]>>1&8355711)}}static textureBackTranslucentScanline2(t,e,i,s,r,n,o,h,a,l,c,u,d,f,m){if(u<=0)return;let p=0,g=0;m<<=2,0!==h&&(p=n/h<<6,g=o/h<<6),p<0?p=0:p>4032&&(p=4032);for(let y=u;y>0;y-=16){n+=a,o+=l,i=p,s=g,0!==(h+=c)&&(p=n/h<<6,g=o/h<<6),p<0?p=0:p>4032&&(p=4032);let u=p-i>>4,w=g-s>>4,b=f>>20;if(i+=786432&f,f+=m,y<16)for(let n=0;n<y;n++)0!=(e=r[(4032&s)+(i>>6)]>>>b)&&(t[d]=e),d++,i+=u,s+=w,3==(3&n)&&(i=(4095&i)+(786432&f),b=f>>20,f+=m);else 0!=(e=r[(4032&s)+(i>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,i=(4095&(i+=u))+(786432&f),b=f>>20,f+=m,0!=(e=r[(4032&(s+=w))+(i>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,i=(4095&(i+=u))+(786432&f),b=f>>20,f+=m,0!=(e=r[(4032&(s+=w))+(i>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,i=(4095&(i+=u))+(786432&f),b=f>>20,f+=m,0!=(e=r[(4032&(s+=w))+(i>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=w))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++}}static gradientScanline(t,e,i,s,r,n,o){if(e>=0)return;o<<=1,s=r[n>>8&255],n+=o;let h=e/8|0;for(let e=h;e<0;e++)t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o;h=-e%8;for(let e=0;e<h;e++)t[i++]=s,1==(1&e)&&(s=r[n>>8&255],n+=o)}static textureGradientScanline(t,e,i,s,r,n,o){if(e>=0)return;o<<=2,s=r[n>>8&255],n+=o;let h=e/16|0;for(let e=h;e<0;e++)t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),s=r[n>>8&255],n+=o,t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),s=r[n>>8&255],n+=o,t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),s=r[n>>8&255],n+=o,t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),s=r[n>>8&255],n+=o;h=-e%16;for(let e=0;e<h;e++)t[i++]=s+(t[i]>>1&8355711),3==(3&e)&&(s=r[n>>8&255],n+=o,n+=o)}static gradientScanline2(t,e,i,s,r,n,o){if(e>=0)return;o<<=2,s=r[n>>8&255],n+=o;let h=e/16|0;for(let e=h;e<0;e++)t[i++]=s,t[i++]=s,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o;h=-e%16;for(let e=0;e<h;e++)t[i++]=s,3==(3&e)&&(s=r[n>>8&255],n+=o)}static rgb(t,e,i){return-1-1024*(t/8|0)-32*(e/8|0)-(i/8|0)}addModel(t){null===t&&console.log("Warning tried to add null object!"),this.modelCount<this.maxModelCount&&(this.models[this.modelCount++]=t)}removeModel(t){for(let e=0;e<this.modelCount;e++)if(this.models[e]===t){this.modelCount--;for(let t=e;t<this.modelCount;t++)this.models[t]=this.models[t+1]}}dispose(){this.clear();for(let t=0;t<this.modelCount;t++)this.models[t]=null;this.modelCount=0}clear(){this.spriteCount=0,this.view.clear()}reduceSprites(t){this.spriteCount-=t,this.view.reduce(t,2*t),this.spriteCount<0&&(this.spriteCount=0)}addSprite(t,e,i,s,r,n,o){this.spriteId[this.spriteCount]=t,this.spriteX[this.spriteCount]=e,this.spriteZ[this.spriteCount]=i,this.spriteY[this.spriteCount]=s,this.spriteWidth[this.spriteCount]=r,this.spriteHeight[this.spriteCount]=n,this.spriteTranslateX[this.spriteCount]=0;const h=this.view.createVertex(e,i,s),a=this.view.createVertex(e,i-n,s),l=new Int32Array([h,a]);return this.view.createFace(2,l,0,0),this.view.faceTag[this.spriteCount]=o,this.view.isLocalPlayer[this.spriteCount++]=0,this.spriteCount-1}setLocalPlayer(t){this.view.isLocalPlayer[t]=1}setSpriteTranslateX(t,e){this.spriteTranslateX[t]=e}setMouseLoc(t,e){this.mouseX=t-this.baseX,this.mouseY=e,this.mousePickedCount=0,this.mousePickingActive=!0}getMousePickedCount(){return this.mousePickedCount}getMousePickedFaces(){return this.mousePickedFaces}getMousePickedModels(){return this.mousePickedModels}setBounds(t,e,i,s,r,o){this.clipX=i,this.clipY=s,this.baseX=t,this.baseY=e,this.width=r,this.viewDistance=o,this.scanlines=[];for(let t=0;t<s+e;t++)this.scanlines.push(new n)}polygonsQSort(t,e,i){if(e<i){let s=e-1,r=i+1,n=(e+i)/2|0,o=t[n];t[n]=t[e],t[e]=o;let h=o.depth;for(;s<r;){do{r--}while(t[r].depth<h);do{s++}while(t[s].depth>h);if(s<r){let e=t[s];t[s]=t[r],t[r]=e}}this.polygonsQSort(t,e,r),this.polygonsQSort(t,r+1,i)}}polygonsIntersectSort(t,e,i){for(let t=0;t<=i;t++)e[t].skipSomething=!1,e[t].index=t,e[t].index2=-1;let s=0;for(;;){for(;e[s].skipSomething;)s++;if(s===i)return;let r=e[s];r.skipSomething=!0;let n=s,o=s+t;o>=i&&(o=i-1);for(let t=o;t>=n+1;t--){let i=e[t];r.minPlaneX<i.maxPlaneX&&i.minPlaneX<r.maxPlaneX&&r.minPlaneY<i.maxPlaneY&&i.minPlaneY<r.maxPlaneY&&r.index!==i.index2&&!this.separatePolygon(r,i)&&this.heuristicPolygon(i,r)&&(this.polygonsOrder(e,n,t),e[t]!==i&&t++,n=this.newStart,i.index2=r.index)}}}polygonsOrder(t,e,i){for(;;){let s=t[e];for(let r=e+1;r<=i;r++){let n=t[r];if(!this.separatePolygon(n,s))break;if(t[e]=n,t[r]=s,(e=r)===i)return this.newStart=e,this.newEnd=e-1,!0}let r=t[i];for(let s=i-1;s>=e;s--){let n=t[s];if(!this.separatePolygon(r,n))break;if(t[i]=n,t[s]=r,e===(i=s))return this.newStart=i+1,this.newEnd=i,!0}if(e+1>=i)return this.newStart=e,this.newEnd=i,!1;if(!this.polygonsOrder(t,e+1,i))return this.newStart=e,!1;i=this.newEnd}}setFrustum(t,e,i){let s=1024-this.cameraYaw&1023,r=1024-this.cameraPitch&1023,n=1024-this.cameraRoll&1023;if(0!==n){let i=h.sinCosCache[n],s=h.sinCosCache[n+1024],r=e*i+t*s>>15;e=e*s-t*i>>15,t=r}if(0!==s){let t=h.sinCosCache[s],r=h.sinCosCache[s+1024],n=e*r-i*t>>15;i=e*t+i*r>>15,e=n}if(0!==r){let e=h.sinCosCache[r],s=h.sinCosCache[r+1024],n=i*e+t*s>>15;i=i*s-t*e>>15,t=n}t<h.frustumMaxX&&(h.frustumMaxX=t),t>h.frustumMinX&&(h.frustumMinX=t),e<h.frustumMaxY&&(h.frustumMaxY=e),e>h.frustumMinY&&(h.frustumMinY=e),i<h.frustumFarZ&&(h.frustumFarZ=i),i>h.frustumNearZ&&(h.frustumNearZ=i)}render(){this.interlace=this.surface.interlace;let t=this.clipX*this.clipFar3d>>this.viewDistance,e=this.clipY*this.clipFar3d>>this.viewDistance;h.frustumMaxX=0,h.frustumMinX=0,h.frustumMaxY=0,h.frustumMinY=0,h.frustumFarZ=0,h.frustumNearZ=0,this.setFrustum(-t,-e,this.clipFar3d),this.setFrustum(-t,e,this.clipFar3d),this.setFrustum(t,-e,this.clipFar3d),this.setFrustum(t,e,this.clipFar3d),this.setFrustum(-this.clipX,-this.clipY,0),this.setFrustum(-this.clipX,this.clipY,0),this.setFrustum(this.clipX,-this.clipY,0),this.setFrustum(this.clipX,this.clipY,0),h.frustumMaxX+=this.cameraX,h.frustumMinX+=this.cameraX,h.frustumMaxY+=this.cameraY,h.frustumMinY+=this.cameraY,h.frustumFarZ+=this.cameraZ,h.frustumNearZ+=this.cameraZ,this.models[this.modelCount]=this.view,this.view.transformState=2;for(let t=0;t<this.modelCount;t++)this.models[t].project(this.cameraX,this.cameraY,this.cameraZ,this.cameraYaw,this.cameraPitch,this.cameraRoll,this.viewDistance,this.clipNear);this.models[this.modelCount].project(this.cameraX,this.cameraY,this.cameraZ,this.cameraYaw,this.cameraPitch,this.cameraRoll,this.viewDistance,this.clipNear),this.visiblePolygonsCount=0;for(let t=0;t<this.modelCount;t++){let e=this.models[t];if(e.visible)for(let t=0;t<e.numFaces;t++){let i=e.faceNumVertices[t],s=e.faceVertices[t],r=!1;for(let t=0;t<i;t++){let i=e.projectVertexZ[s[t]];if(!(i<=this.clipNear||i>=this.clipFar3d)){r=!0;break}}if(r){let r=0;for(let t=0;t<i;t++){let i=e.vertexViewX[s[t]];if(i>-this.clipX&&(r|=1),i<this.clipX&&(r|=2),3===r)break}if(3===r){let r=0;for(let t=0;t<i;t++){let i=e.vertexViewY[s[t]];if(i>-this.clipY&&(r|=1),i<this.clipY&&(r|=2),3===r)break}if(3===r){let r=this.visiblePolygons[this.visiblePolygonsCount];r.model=e,r.face=t,this.initialisePolygon3D(this.visiblePolygonsCount);let n=0;if(n=r.visibility<0?e.faceFillFront[t]:e.faceFillBack[t],n!==o){let t=0;for(let r=0;r<i;r++)t+=e.projectVertexZ[s[r]];r.depth=(t/i|0)+e.depth,r.facefill=n,this.visiblePolygonsCount++}}}}}}let i=this.view;if(i.visible)for(let t=0;t<i.numFaces;t++){let e=i.faceVertices[t],s=e[0],r=i.vertexViewX[s],n=i.vertexViewY[s],o=i.projectVertexZ[s];if(o>this.clipNear&&o<this.clipFar2d){let s=(this.spriteWidth[t]<<this.viewDistance)/o|0,h=(this.spriteHeight[t]<<this.viewDistance)/o|0;if(r-(s/2|0)<=this.clipX&&r+(s/2|0)>=-this.clipX&&n-h<=this.clipY&&n>=-this.clipY){let s=this.visiblePolygons[this.visiblePolygonsCount];s.model=i,s.face=t,this.initialisePolygon2D(this.visiblePolygonsCount),s.depth=(o+i.projectVertexZ[e[1]])/2|0,this.visiblePolygonsCount++}}}if(0!==this.visiblePolygonsCount){this.lastVisiblePolygonsCount=this.visiblePolygonsCount,this.polygonsQSort(this.visiblePolygons,0,this.visiblePolygonsCount-1),this.polygonsIntersectSort(100,this.visiblePolygons,this.visiblePolygonsCount);for(let t=0;t<this.visiblePolygonsCount;t++){let e=this.visiblePolygons[t],i=e.model,s=e.face;if(i===this.view){let t=i.faceVertices[s],e=t[0],r=i.vertexViewX[e],n=i.vertexViewY[e],o=i.projectVertexZ[e],h=(this.spriteWidth[s]<<this.viewDistance)/o|0,a=(this.spriteHeight[s]<<this.viewDistance)/o|0,l=i.vertexViewX[t[1]]-r,c=r-(h/2|0),u=this.baseY+n-a;this.surface._spriteClipping_from7(c+this.baseX,u,h,a,this.spriteId[s],l,(256<<this.viewDistance)/o|0),this.mousePickingActive&&this.mousePickedCount<this.mousePickedMax&&(c+=(this.spriteTranslateX[s]<<this.viewDistance)/o|0,this.mouseY>=u&&this.mouseY<=u+a&&this.mouseX>=c&&this.mouseX<=c+h&&!i.unpickable&&0===i.isLocalPlayer[s]&&(this.mousePickedModels[this.mousePickedCount]=i,this.mousePickedFaces[this.mousePickedCount]=s,this.mousePickedCount++))}else{let t=0,r=0,n=i.faceNumVertices[s],h=i.faceVertices[s];i.faceIntensity[s]!==o&&(r=e.visibility<0?i.lightAmbience-i.faceIntensity[s]:i.lightAmbience+i.faceIntensity[s]);for(let a=0;a<n;a++){let l=h[a];if(this.vertexX[a]=i.projectVertexX[l],this.vertexY[a]=i.projectVertexY[l],this.vertexZ[a]=i.projectVertexZ[l],i.faceIntensity[s]===o&&(r=e.visibility<0?i.lightAmbience-i.vertexIntensity[l]+i.vertexAmbience[l]:i.lightAmbience+i.vertexIntensity[l]+i.vertexAmbience[l]),i.projectVertexZ[l]>=this.clipNear)this.planeX[t]=i.vertexViewX[l],this.planeY[t]=i.vertexViewY[l],this.vertexShade[t]=r,i.projectVertexZ[l]>this.fogZDistance&&(this.vertexShade[t]+=(i.projectVertexZ[l]-this.fogZDistance)/this.fogZFalloff|0),t++;else{let e=0;if(e=0===a?h[n-1]:h[a-1],i.projectVertexZ[e]>=this.clipNear){let s=i.projectVertexZ[l]-i.projectVertexZ[e],n=i.projectVertexX[l]-((i.projectVertexX[l]-i.projectVertexX[e])*(i.projectVertexZ[l]-this.clipNear)/s|0),o=i.projectVertexY[l]-((i.projectVertexY[l]-i.projectVertexY[e])*(i.projectVertexZ[l]-this.clipNear)/s|0);this.planeX[t]=(n<<this.viewDistance)/this.clipNear|0,this.planeY[t]=(o<<this.viewDistance)/this.clipNear|0,this.vertexShade[t]=r,t++}if(e=a===n-1?h[0]:h[a+1],i.projectVertexZ[e]>=this.clipNear){let s=i.projectVertexZ[l]-i.projectVertexZ[e],n=i.projectVertexX[l]-((i.projectVertexX[l]-i.projectVertexX[e])*(i.projectVertexZ[l]-this.clipNear)/s|0),o=i.projectVertexY[l]-((i.projectVertexY[l]-i.projectVertexY[e])*(i.projectVertexZ[l]-this.clipNear)/s|0);this.planeX[t]=(n<<this.viewDistance)/this.clipNear|0,this.planeY[t]=(o<<this.viewDistance)/this.clipNear|0,this.vertexShade[t]=r,t++}}}for(let t=0;t<n;t++)this.vertexShade[t]<0?this.vertexShade[t]=0:this.vertexShade[t]>255&&(this.vertexShade[t]=255),e.facefill>=0&&(1===this.textureDimension[e.facefill]?this.vertexShade[t]<<=9:this.vertexShade[t]<<=6);this.generateScanlines(0,0,0,0,t,this.planeX,this.planeY,this.vertexShade,i,s),this.maxY>this.minY&&this.rasterize(0,0,n,this.vertexX,this.vertexY,this.vertexZ,e.facefill,i)}}this.mousePickingActive=!1}}generateScanlines(t,e,i,s,r,n,h,a,l,c){if(3===r){let r=h[0]+this.baseY,l=h[1]+this.baseY,c=h[2]+this.baseY,u=n[0],d=n[1],f=n[2],m=a[0],p=a[1],g=a[2],y=this.baseY+this.clipY-1,w=0,b=0,C=0,I=0,S=o,v=-12345678;c!==r&&(b=(f-u<<8)/(c-r)|0,I=(g-m<<8)/(c-r)|0,r<c?(w=u<<8,C=m<<8,S=r,v=c):(w=f<<8,C=g<<8,S=c,v=r),S<0&&(w-=b*S,C-=I*S,S=0),v>y&&(v=y));let x=0,T=0,A=0,k=0,B=o,L=-12345678;l!==r&&(T=(d-u<<8)/(l-r)|0,k=(p-m<<8)/(l-r)|0,r<l?(x=u<<8,A=m<<8,B=r,L=l):(x=d<<8,A=p<<8,B=l,L=r),B<0&&(x-=T*B|0,A-=k*B|0,B=0),L>y&&(L=y));let M=0,E=0,_=0,Y=0,P=o,j=-12345678;c!==l&&(E=(f-d<<8)/(c-l)|0,Y=(g-p<<8)/(c-l)|0,l<c?(M=d<<8,_=p<<8,P=l,j=c):(M=f<<8,_=g<<8,P=c,j=l),P<0&&(M-=E*P|0,_-=Y*P|0,P=0),j>y&&(j=y)),this.minY=S,B<this.minY&&(this.minY=B),P<this.minY&&(this.minY=P),this.maxY=v,L>this.maxY&&(this.maxY=L),j>this.maxY&&(this.maxY=j);let D=0;for(i=this.minY;i<this.maxY;i++){i>=S&&i<v?(t=e=w,s=D=C,w+=b,C+=I):(t=655360,e=-655360),i>=B&&i<L&&(x<t&&(t=x,s=A),x>e&&(e=x,D=A),x+=T,A+=k),i>=P&&i<j&&(M<t&&(t=M,s=_),M>e&&(e=M,D=_),M+=E,_+=Y);let r=this.scanlines[i];r.startX=t,r.endX=e,r.startS=s,r.endS=D}this.minY<this.baseY-this.clipY&&(this.minY=this.baseY-this.clipY)}else if(4===r){let r=h[0]+this.baseY,l=h[1]+this.baseY,c=h[2]+this.baseY,u=h[3]+this.baseY,d=n[0],f=n[1],m=n[2],p=n[3],g=a[0],y=a[1],w=a[2],b=a[3],C=this.baseY+this.clipY-1,I=0,S=0,v=0,x=0,T=o,A=-12345678;u!==r&&(S=(p-d<<8)/(u-r)|0,x=(b-g<<8)/(u-r)|0,r<u?(I=d<<8,v=g<<8,T=r,A=u):(I=p<<8,v=b<<8,T=u,A=r),T<0&&(I-=S*T,v-=x*T,T=0),A>C&&(A=C));let k=0,B=0,L=0,M=0,E=o,_=-12345678;l!==r&&(B=(f-d<<8)/(l-r)|0,M=(y-g<<8)/(l-r)|0,r<l?(k=d<<8,L=g<<8,E=r,_=l):(k=f<<8,L=y<<8,E=l,_=r),E<0&&(k-=B*E,L-=M*E,E=0),_>C&&(_=C));let Y=0,P=0,j=0,D=0,X=o,O=-12345678;c!==l&&(P=(m-f<<8)/(c-l)|0,D=(w-y<<8)/(c-l)|0,l<c?(Y=f<<8,j=y<<8,X=l,O=c):(Y=m<<8,j=w<<8,X=c,O=l),X<0&&(Y-=P*X,j-=D*X,X=0),O>C&&(O=C));let R=0,U=0,N=0,F=0,H=o,W=-12345678;u!==c&&(U=(p-m<<8)/(u-c)|0,F=(b-w<<8)/(u-c)|0,c<u?(R=m<<8,N=w<<8,H=c,W=u):(R=p<<8,N=b<<8,H=u,W=c),H<0&&(R-=U*H,N-=F*H,H=0),W>C&&(W=C)),this.minY=T,E<this.minY&&(this.minY=E),X<this.minY&&(this.minY=X),H<this.minY&&(this.minY=H),this.maxY=A,_>this.maxY&&(this.maxY=_),O>this.maxY&&(this.maxY=O),W>this.maxY&&(this.maxY=W);let V=0;for(i=this.minY;i<this.maxY;i++){i>=T&&i<A?(t=e=I,s=V=v,I+=S,v+=x):(t=655360,e=-655360),i>=E&&i<_&&(k<t&&(t=k,s=L),k>e&&(e=k,V=L),k+=B,L+=M),i>=X&&i<O&&(Y<t&&(t=Y,s=j),Y>e&&(e=Y,V=j),Y+=P,j+=D),i>=H&&i<W&&(R<t&&(t=R,s=N),R>e&&(e=R,V=N),R+=U,N+=F);let r=this.scanlines[i];r.startX=t,r.endX=e,r.startS=s,r.endS=V}this.minY<this.baseY-this.clipY&&(this.minY=this.baseY-this.clipY)}else{for(this.maxY=this.minY=h[0]+=this.baseY,i=1;i<r;i++){let t=0;(t=h[i]+=this.baseY)<this.minY?this.minY=t:t>this.maxY&&(this.maxY=t)}if(this.minY<this.baseY-this.clipY&&(this.minY=this.baseY-this.clipY),this.maxY>=this.baseY+this.clipY&&(this.maxY=this.baseY+this.clipY-1),this.minY>=this.maxY)return;for(i=this.minY;i<this.maxY;i++){let t=this.scanlines[i];t.startX=655360,t.endX=-655360}let t=r-1,e=h[0],s=h[t];if(e<s){let r=n[0]<<8,o=(n[t]-n[0]<<8)/(s-e)|0,h=a[0]<<8,l=(a[t]-a[0]<<8)/(s-e)|0;for(e<0&&(r-=o*e,h-=l*e,e=0),s>this.maxY&&(s=this.maxY),i=e;i<=s;i++){let t=this.scanlines[i];t.startX=t.endX=r,t.startS=t.endS=h,r+=o,h+=l}}else if(e>s){let r=n[t]<<8,o=(n[0]-n[t]<<8)/(e-s)|0,h=a[t]<<8,l=(a[0]-a[t]<<8)/(e-s)|0;for(s<0&&(r-=o*s,h-=l*s,s=0),e>this.maxY&&(e=this.maxY),i=s;i<=e;i++){let t=this.scanlines[i];t.startX=t.endX=r,t.startS=t.endS=h,r+=o,h+=l}}for(i=0;i<t;i++){let t=i+1,e=h[i],s=h[t];if(e<s){let r=n[i]<<8,o=(n[t]-n[i]<<8)/(s-e)|0,h=a[i]<<8,l=(a[t]-a[i]<<8)/(s-e)|0;e<0&&(r-=o*e,h-=l*e,e=0),s>this.maxY&&(s=this.maxY);for(let t=e;t<=s;t++){let e=this.scanlines[t];r<e.startX&&(e.startX=r,e.startS=h),r>e.endX&&(e.endX=r,e.endS=h),r+=o,h+=l}}else if(e>s){let r=n[t]<<8,o=(n[i]-n[t]<<8)/(e-s)|0,h=a[t]<<8,l=(a[i]-a[t]<<8)/(e-s)|0;s<0&&(r-=o*s,h-=l*s,s=0),e>this.maxY&&(e=this.maxY);for(let t=s;t<=e;t++){let e=this.scanlines[t];r<e.startX&&(e.startX=r,e.startS=h),r>e.endX&&(e.endX=r,e.endS=h),r+=o,h+=l}}}this.minY<this.baseY-this.clipY&&(this.minY=this.baseY-this.clipY)}if(this.mousePickingActive&&this.mousePickedCount<this.mousePickedMax&&this.mouseY>=this.minY&&this.mouseY<this.maxY){let t=this.scanlines[this.mouseY];this.mouseX>=t.startX>>8&&this.mouseX<=t.endX>>8&&t.startX<=t.endX&&!l.unpickable&&0===l.isLocalPlayer[c]&&(this.mousePickedModels[this.mousePickedCount]=l,this.mousePickedFaces[this.mousePickedCount]=c,this.mousePickedCount++)}}rasterize(t,e,i,s,r,n,o,a){if(-2===o)return;if(o>=0){o>=this.textureCount&&(o=0),this.prepareTexture(o);let l=s[0],c=r[0],u=n[0],d=l-s[1],f=c-r[1],m=u-n[1],p=s[--i]-l,g=r[i]-c,y=n[i]-u;if(1===this.textureDimension[o]){let i=p*c-g*l<<12,s=g*u-y*c<<5-this.viewDistance+7+4,r=y*l-p*u<<5-this.viewDistance+7,n=d*c-f*l<<12,w=f*u-m*c<<5-this.viewDistance+7+4,b=m*l-d*u<<5-this.viewDistance+7,C=f*p-d*g<<5,I=m*g-f*y<<5-this.viewDistance+4,S=d*y-m*p>>this.viewDistance-5,v=s>>4,x=w>>4,T=I>>4,A=this.minY-this.baseY,k=this.width,B=this.baseX+this.minY*k,L=1;if(i+=r*A,n+=b*A,C+=S*A,this.interlace&&(1==(1&this.minY)&&(this.minY++,i+=r,n+=b,C+=S,B+=k),r<<=1,b<<=1,S<<=1,k<<=1,L=2),a.textureTranslucent){for(t=this.minY;t<this.maxY;t+=L){let a=this.scanlines[t];e=a.startX>>8;let l=a.endX>>8,c=l-e;if(c<=0)i+=r,n+=b,C+=S,B+=k;else{let t=a.startS,u=(a.endS-t)/c|0;e<-this.clipX&&(t+=(-this.clipX-e)*u,c=l-(e=-this.clipX)),l>this.clipX&&(c=this.clipX-e),h.textureTranslucentScanline(this.raster,this.texturePixels[o],0,0,i+v*e,n+x*e,C+T*e,s,w,I,c,B+e,t,u<<2),i+=r,n+=b,C+=S,B+=k}}return}if(!this.textureBackTransparent[o]){for(t=this.minY;t<this.maxY;t+=L){let a=this.scanlines[t];e=a.startX>>8;let l=a.endX>>8,c=l-e;if(c<=0)i+=r,n+=b,C+=S,B+=k;else{let t=a.startS,u=(a.endS-t)/c|0;e<-this.clipX&&(t+=(-this.clipX-e)*u,c=l-(e=-this.clipX)),l>this.clipX&&(c=this.clipX-e),h.textureScanline(this.raster,this.texturePixels[o],0,0,i+v*e,n+x*e,C+T*e,s,w,I,c,B+e,t,u<<2),i+=r,n+=b,C+=S,B+=k}}return}for(t=this.minY;t<this.maxY;t+=L){let a=this.scanlines[t];e=a.startX>>8;let l=a.endX>>8,c=l-e;if(c<=0)i+=r,n+=b,C+=S,B+=k;else{let t=a.startS,u=(a.endS-t)/c|0;e<-this.clipX&&(t+=(-this.clipX-e)*u,c=l-(e=-this.clipX)),l>this.clipX&&(c=this.clipX-e),h.textureBackTranslucentScanline(this.raster,0,0,0,this.texturePixels[o],i+v*e,n+x*e,C+T*e,s,w,I,c,B+e,t,u),i+=r,n+=b,C+=S,B+=k}}return}let w=p*c-g*l<<11,b=g*u-y*c<<5-this.viewDistance+6+4,C=y*l-p*u<<5-this.viewDistance+6,I=d*c-f*l<<11,S=f*u-m*c<<5-this.viewDistance+6+4,v=m*l-d*u<<5-this.viewDistance+6,x=f*p-d*g<<5,T=m*g-f*y<<5-this.viewDistance+4,A=d*y-m*p>>this.viewDistance-5,k=b>>4,B=S>>4,L=T>>4,M=this.minY-this.baseY,E=this.width,_=this.baseX+this.minY*E,Y=1;if(w+=C*M,I+=v*M,x+=A*M,this.interlace&&(1==(1&this.minY)&&(this.minY++,w+=C,I+=v,x+=A,_+=E),C<<=1,v<<=1,A<<=1,E<<=1,Y=2),a.textureTranslucent){for(t=this.minY;t<this.maxY;t+=Y){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)w+=C,I+=v,x+=A,_+=E;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),h.textureTranslucentScanline2(this.raster,this.texturePixels[o],0,0,w+k*e,I+B*e,x+L*e,b,S,T,r,_+e,t,n),w+=C,I+=v,x+=A,_+=E}}return}if(!this.textureBackTransparent[o]){for(t=this.minY;t<this.maxY;t+=Y){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)w+=C,I+=v,x+=A,_+=E;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),h.textureScanline2(this.raster,this.texturePixels[o],0,0,w+k*e,I+B*e,x+L*e,b,S,T,r,_+e,t,n),w+=C,I+=v,x+=A,_+=E}}return}for(t=this.minY;t<this.maxY;t+=Y){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)w+=C,I+=v,x+=A,_+=E;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),h.textureBackTranslucentScanline2(this.raster,0,0,0,this.texturePixels[o],w+k*e,I+B*e,x+L*e,b,S,T,r,_+e,t,n),w+=C,I+=v,x+=A,_+=E}}return}for(let t=0;t<this.rampCount;t++){if(this.gradientBase[t]===o){this.anIntArray377=this.gradientRamps[t];break}if(t===this.rampCount-1){let t=Math.random()*this.rampCount|0;this.gradientBase[t]=o;let e=8*((o=-1-o)>>10&31),i=8*(o>>5&31),s=8*(31&o);for(let r=0;r<256;r++){let n=r*r,o=e*n/65536|0,h=i*n/65536|0,a=s*n/65536|0;this.gradientRamps[t][255-r]=(o<<16)+(h<<8)+a}this.anIntArray377=this.gradientRamps[t]}}let l=this.width,c=this.baseX+this.minY*l,u=1;if(this.interlace&&(1==(1&this.minY)&&(this.minY++,c+=l),l<<=1,u=2),a.transparent)for(t=this.minY;t<this.maxY;t+=u){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)c+=l;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),h.textureGradientScanline(this.raster,-r,c+e,0,this.anIntArray377,t,n),c+=l}}else if(this.wideBand)for(t=this.minY;t<this.maxY;t+=u){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)c+=l;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),h.gradientScanline(this.raster,-r,c+e,0,this.anIntArray377,t,n),c+=l}}else for(t=this.minY;t<this.maxY;t+=u){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)c+=l;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),h.gradientScanline2(this.raster,-r,c+e,0,this.anIntArray377,t,n),c+=l}}}setCamera(t,e,i,s,r,n,o){s&=1023,r&=1023,n&=1023,this.cameraYaw=1024-s&1023,this.cameraPitch=1024-r&1023,this.cameraRoll=1024-n&1023;let a=0,l=0,c=o;if(0!==s){let t=h.sinCosCache[s],e=h.sinCosCache[s+1024],i=l*e-c*t>>15;c=l*t+c*e>>15,l=i}if(0!==r){let t=h.sinCosCache[r],e=h.sinCosCache[r+1024],i=c*t+a*e>>15;c=c*e-a*t>>15,a=i}if(0!==n){let t=h.sinCosCache[n],e=h.sinCosCache[n+1024],i=l*t+a*e>>15;l=l*e-a*t>>15,a=i}this.cameraX=t-a,this.cameraY=e-l,this.cameraZ=i-c}initialisePolygon3D(t){let e=this.visiblePolygons[t],i=e.model,s=e.face,r=i.faceVertices[s],n=i.faceNumVertices[s],o=i.normalScale[s],h=i.projectVertexX[r[0]],a=i.projectVertexY[r[0]],l=i.projectVertexZ[r[0]],c=i.projectVertexX[r[1]]-h,u=i.projectVertexY[r[1]]-a,d=i.projectVertexZ[r[1]]-l,f=i.projectVertexX[r[2]]-h,m=i.projectVertexY[r[2]]-a,p=i.projectVertexZ[r[2]]-l,g=u*p-m*d,y=d*f-p*c,w=c*m-f*u;if(-1===o){for(o=0;g>25e3||y>25e3||w>25e3||g<-25e3||y<-25e3||w<-25e3;w>>=1)o++,g>>=1,y>>=1;i.normalScale[s]=o,i.normalMagnitude[s]=this.normalMagnitude*Math.sqrt(g*g+y*y+w*w)|0}else g>>=o,y>>=o,w>>=o;e.visibility=h*g+a*y+l*w,e.normalX=g,e.normalY=y,e.normalZ=w;let b=i.projectVertexZ[r[0]],C=b,I=i.vertexViewX[r[0]],S=I,v=i.vertexViewY[r[0]],x=v;for(let t=1;t<n;t++){let e=i.projectVertexZ[r[t]];e>C?C=e:e<b&&(b=e),e=i.vertexViewX[r[t]],e>S?S=e:e<I&&(I=e),e=i.vertexViewY[r[t]],e>x?x=e:e<v&&(v=e)}e.minZ=b,e.maxZ=C,e.minPlaneX=I,e.maxPlaneX=S,e.minPlaneY=v,e.maxPlaneY=x}initialisePolygon2D(t){let e=this.visiblePolygons[t],i=e.model,s=e.face,r=i.faceVertices[s],n=i.projectVertexX[r[0]],o=i.projectVertexY[r[0]],h=i.projectVertexZ[r[0]];i.normalMagnitude[s]=1,i.normalScale[s]=0,e.visibility=0*n+0*o+1*h,e.normalX=0,e.normalY=0,e.normalZ=1;let a=i.projectVertexZ[r[0]],l=a,c=i.vertexViewX[r[0]],u=c;i.vertexViewX[r[1]]<c?c=i.vertexViewX[r[1]]:u=i.vertexViewX[r[1]];let d=i.vertexViewY[r[1]],f=i.vertexViewY[r[0]],m=i.projectVertexZ[r[1]];m>l?l=m:m<a&&(a=m),m=i.vertexViewX[r[1]],m>u?u=m:m<c&&(c=m),m=i.vertexViewY[r[1]],m>f?f=m:m<d&&(d=m),e.minZ=a,e.maxZ=l,e.minPlaneX=c-20,e.maxPlaneX=u+20,e.minPlaneY=d,e.maxPlaneY=f}separatePolygon(t,e){if(t.minPlaneX>=e.maxPlaneX)return!0;if(e.minPlaneX>=t.maxPlaneX)return!0;if(t.minPlaneY>=e.maxPlaneY)return!0;if(e.minPlaneY>=t.maxPlaneY)return!0;if(t.minZ>=e.maxZ)return!0;if(e.minZ>t.maxZ)return!1;let i=t.model,s=e.model,r=t.face,n=e.face,o=i.faceVertices[r],h=s.faceVertices[n],a=i.faceNumVertices[r],l=s.faceNumVertices[n],c=s.projectVertexX[h[0]],u=s.projectVertexY[h[0]],d=s.projectVertexZ[h[0]],f=e.normalX,m=e.normalY,p=e.normalZ,g=s.normalMagnitude[n],y=e.visibility,w=!1;for(let t=0;t<a;t++){let e=o[t],s=(c-i.projectVertexX[e])*f+(u-i.projectVertexY[e])*m+(d-i.projectVertexZ[e])*p;if(!(s>=-g||y>=0)||!(s<=g||y<=0)){w=!0;break}}if(!w)return!0;c=i.projectVertexX[o[0]],u=i.projectVertexY[o[0]],d=i.projectVertexZ[o[0]],f=t.normalX,m=t.normalY,p=t.normalZ,g=i.normalMagnitude[r],y=t.visibility,w=!1;for(let t=0;t<l;t++){let e=h[t],i=(c-s.projectVertexX[e])*f+(u-s.projectVertexY[e])*m+(d-s.projectVertexZ[e])*p;if(!(i>=-g||y<=0)||!(i<=g||y>=0)){w=!0;break}}if(!w)return!0;let b=null,C=null;if(2===a){b=new Int32Array(4),C=new Int32Array(4);let t=o[0],e=o[1];b[0]=i.vertexViewX[t]-20,b[1]=i.vertexViewX[e]-20,b[2]=i.vertexViewX[e]+20,b[3]=i.vertexViewX[t]+20,C[0]=C[3]=i.vertexViewY[t],C[1]=C[2]=i.vertexViewY[e]}else{b=new Int32Array(a),C=new Int32Array(a);for(let t=0;t<a;t++){let e=o[t];b[t]=i.vertexViewX[e],C[t]=i.vertexViewY[e]}}let I=null,S=null;if(2===l){I=new Int32Array(4),S=new Int32Array(4);let t=h[0],e=h[1];I[0]=s.vertexViewX[t]-20,I[1]=s.vertexViewX[e]-20,I[2]=s.vertexViewX[e]+20,I[3]=s.vertexViewX[t]+20,S[0]=S[3]=s.vertexViewY[t],S[1]=S[2]=s.vertexViewY[e]}else{I=new Int32Array(l),S=new Int32Array(l);for(let t=0;t<l;t++){let e=h[t];I[t]=s.vertexViewX[e],S[t]=s.vertexViewY[e]}}return!this.intersect(b,C,I,S)}heuristicPolygon(t,e){let i=t.model,s=e.model,r=t.face,n=e.face,o=i.faceVertices[r],h=s.faceVertices[n],a=i.faceNumVertices[r],l=s.faceNumVertices[n],c=s.projectVertexX[h[0]],u=s.projectVertexY[h[0]],d=s.projectVertexZ[h[0]],f=e.normalX,m=e.normalY,p=e.normalZ,g=s.normalMagnitude[n],y=e.visibility,w=!1;for(let t=0;t<a;t++){let e=o[t],s=(c-i.projectVertexX[e])*f+(u-i.projectVertexY[e])*m+(d-i.projectVertexZ[e])*p;if(!(s>=-g||y>=0)||!(s<=g||y<=0)){w=!0;break}}if(!w)return!0;c=i.projectVertexX[o[0]],u=i.projectVertexY[o[0]],d=i.projectVertexZ[o[0]],f=t.normalX,m=t.normalY,p=t.normalZ,g=i.normalMagnitude[r],y=t.visibility,w=!1;for(let t=0;t<l;t++){let e=h[t],i=(c-s.projectVertexX[e])*f+(u-s.projectVertexY[e])*m+(d-s.projectVertexZ[e])*p;if(!(i>=-g||y<=0)||!(i<=g||y>=0)){w=!0;break}}return!w}allocateTextures(t,e,i){this.textureCount=t,this.textureColoursUsed=[],this.textureColoursUsed.length=t,this.textureColoursUsed.fill(null),this.textureColourList=[],this.textureColourList.length=t,this.textureColourList.fill(null),this.textureDimension=new Int32Array(t),this.textureLoadedNumber=[],this.textureLoadedNumber.length=t,this.textureLoadedNumber.fill(null),this.textureBackTransparent=new Int8Array(t),this.texturePixels=[],this.texturePixels.length=t,this.texturePixels.fill(null),h.textureCountLoaded=new s(0);for(let e=0;e<t;e+=1)this.textureLoadedNumber.push(new s(0));this.textureColours64=[],this.textureColours64.length=e,this.textureColours64.fill(null),this.textureColours128=[],this.textureColours128.length=i,this.textureColours128.fill(null)}defineTexture(t,e,i,r){this.textureColoursUsed[t]=e,this.textureColourList[t]=i,this.textureDimension[t]=r,this.textureLoadedNumber[t]=new s(0),this.textureBackTransparent[t]=!1,this.texturePixels[t]=null,this.prepareTexture(t)}prepareTexture(t){if(t<0)return;if(h.textureCountLoaded=h.textureCountLoaded.add(1),this.textureLoadedNumber[t]=new s(h.textureCountLoaded),null!==this.texturePixels[t])return;if(0===this.textureDimension[t]){for(let e=0;e<this.textureColours64.length;e++)if(null===this.textureColours64[e])return this.textureColours64[e]=new Int32Array(16384),this.texturePixels[t]=this.textureColours64[e],void this.setTexturePixels(t);let e=new s(1).shiftLeft(30),i=0;for(let s=0;s<this.textureCount;s++)s!==t&&0===this.textureDimension[s]&&null!==this.texturePixels[s]&&this.textureLoadedNumber[s].lessThan(e)&&(e=this.textureLoadedNumber[s],i=s);return this.texturePixels[t]=this.texturePixels[i],this.texturePixels[i]=null,void this.setTexturePixels(t)}for(let e=0;e<this.textureColours128.length;e++)if(null===this.textureColours128[e])return this.textureColours128[e]=new Int32Array(65536),this.texturePixels[t]=this.textureColours128[e],void this.setTexturePixels(t);let e=new s(1).shiftLeft(30),i=0;for(let s=0;s<this.textureCount;s++)s!==t&&1===this.textureDimension[s]&&null!==this.texturePixels[s]&&this.textureLoadedNumber[s].lessThan(e)&&(e=this.textureLoadedNumber[s],i=s);this.texturePixels[t]=this.texturePixels[i],this.texturePixels[i]=null,this.setTexturePixels(t)}setTexturePixels(t){let e=0;e=0===this.textureDimension[t]?64:128;let i=this.texturePixels[t],s=0;for(let r=0;r<e;r++)for(let n=0;n<e;n++){let o=this.textureColourList[t][255&this.textureColoursUsed[t][n+r*e]];o&=16316671,0===o?o=1:16253183===o&&(o=0,this.textureBackTransparent[t]=!0),i[s++]=o}for(let t=0;t<s;t++){let e=i[t];i[s+t]=e-(e>>>3)&16316671,i[2*s+t]=e-(e>>>2)&16316671,i[3*s+t]=e-(e>>>2)-(e>>>3)&16316671}}doSOemthingWithTheFuckinFountainFuck(t){if(null===this.texturePixels[t])return;let e=this.texturePixels[t];for(let i=0;i<64;i++){let s=i+4032,r=e[s];for(let t=0;t<63;t++)e[s]=e[s-64],s-=64;this.texturePixels[t][s]=r}let i=4096;for(let t=0;t<i;t++){let s=e[t];e[i+t]=s-(s>>>3)&16316671,e[2*i+t]=s-(s>>>2)&16316671,e[3*i+t]=s-(s>>>2)-(s>>>3)&16316671}}method302(t){return t===o?0:(this.prepareTexture(t),t>=0?this.texturePixels[t][0]:t<0?(((t=-(t+1))>>10&31)<<19)+((t>>5&31)<<11)+((31&t)<<3):0)}_setLight_from3(t,e,i){0===t&&0===e&&0===i&&(t=32);for(let s=0;s<this.modelCount;s++)this.models[s]._setLight_from3(t,e,i)}_setLight_from5(t,e,i,s,r){0===i&&0===s&&0===r&&(i=32);for(let n=0;n<this.modelCount;n++)this.models[n]._setLight_from5(t,e,i,s,r)}method306(t,e,i,s,r){return s===e?t:t+((i-t)*(r-e)/(s-e)|0)}method307(t,e,i,s,r){return r&&t<=i||t<i?t>s||e>i||e>s||!r:t<s||e<i||e<s||r}method308(t,e,i,s){return s&&t<=i||t<i?e>i||!s:e<i||s}intersect(t,e,i,s){let r,n,o=t.length,h=i.length,a=0,l=r=e[0],c=0,u=n=s[0],d=0;for(let t=1;t<o;t++)e[t]<r?(r=e[t],c=t):e[t]>l&&(l=e[t]);for(let t=1;t<h;t++)s[t]<n?(n=s[t],d=t):s[t]>u&&(u=s[t]);if(n>=l)return!1;if(r>=u)return!1;let f=0,m=0,p=!1;if(e[c]<s[d]){for(f=c;e[f]<s[d];f=(f+1)%o);for(;e[c]<s[d];c=(c-1+o)%o);let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[d]),l=i[d];if(p=r<l|n<l,this.method308(r,n,l,p))return!0;m=(d+1)%h,d=(d-1+h)%h,c===f&&(a=1)}else{for(m=d;s[m]<e[c];m=(m+1)%h);for(;s[d]<e[c];d=(d-1+h)%h);let r=t[c],n=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],e[c]),l=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],e[c]);if(p=r<n|r<l,this.method308(n,l,r,!p))return!0;f=(c+1)%o,c=(c-1+o)%o,d===m&&(a=2)}for(;0===a;)if(e[c]<e[f])if(e[c]<s[d])if(e[c]<s[m]){let r=t[c],n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],e[c]),l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],e[c]),u=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],e[c]);if(this.method307(r,n,l,u,p))return!0;c=(c-1+o)%o,c===f&&(a=1)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[m]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[m]),l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],s[m]),u=i[m];if(this.method307(r,n,l,u,p))return!0;m=(m+1)%h,d===m&&(a=2)}else if(s[d]<s[m]){let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[d]),l=i[d],u=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],s[d]);if(this.method307(r,n,l,u,p))return!0;d=(d-1+h)%h,d===m&&(a=2)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[m]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[m]),l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],s[m]),u=i[m];if(this.method307(r,n,l,u,p))return!0;m=(m+1)%h,d===m&&(a=2)}else if(e[f]<s[d])if(e[f]<s[m]){let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],e[f]),n=t[f],l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],e[f]),u=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],e[f]);if(this.method307(r,n,l,u,p))return!0;f=(f+1)%o,c===f&&(a=1)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[m]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[m]),l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],s[m]),u=i[m];if(this.method307(r,n,l,u,p))return!0;m=(m+1)%h,d===m&&(a=2)}else if(s[d]<s[m]){let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[d]),l=i[d],u=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],s[d]);if(this.method307(r,n,l,u,p))return!0;d=(d-1+h)%h,d===m&&(a=2)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[m]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[m]),l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],s[m]),u=i[m];if(this.method307(r,n,l,u,p))return!0;m=(m+1)%h,d===m&&(a=2)}for(;1===a;)if(e[c]<s[d]){if(e[c]<s[m]){let r=t[c],n=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],e[c]),o=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],e[c]);return this.method308(n,o,r,!p)}let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[m]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[m]),l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],s[m]),u=i[m];if(this.method307(r,n,l,u,p))return!0;m=(m+1)%h,d===m&&(a=0)}else if(s[d]<s[m]){let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[d]),l=i[d],u=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],s[d]);if(this.method307(r,n,l,u,p))return!0;d=(d-1+h)%h,d===m&&(a=0)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[m]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[m]),l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],s[m]),u=i[m];if(this.method307(r,n,l,u,p))return!0;m=(m+1)%h,d===m&&(a=0)}for(;2===a;)if(s[d]<e[c]){if(s[d]<e[f]){let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[d]),h=i[d];return this.method308(r,n,h,p)}let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],e[f]),n=t[f],l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],e[f]),u=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],e[f]);if(this.method307(r,n,l,u,p))return!0;f=(f+1)%o,c===f&&(a=0)}else if(e[c]<e[f]){let r=t[c],n=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],e[c]),l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],e[c]),u=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],e[c]);if(this.method307(r,n,l,u,p))return!0;c=(c-1+o)%o,c===f&&(a=0)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],e[f]),n=t[f],l=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],e[f]),u=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],e[f]);if(this.method307(r,n,l,u,p))return!0;f=(f+1)%o,c===f&&(a=0)}if(e[c]<s[d]){let r=t[c],n=this.method306(i[(d+1)%h],s[(d+1)%h],i[d],s[d],e[c]),o=this.method306(i[(m-1+h)%h],s[(m-1+h)%h],i[m],s[m],e[c]);return this.method308(n,o,r,!p)}let g=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),y=this.method306(t[(f-1+o)%o],e[(f-1+o)%o],t[f],e[f],s[d]),w=i[d];return this.method308(g,y,w,p)}}h.frustumFarZ=0,h.frustumMaxX=0,h.frustumMaxY=0,h.frustumMinX=0,h.frustumMinY=0,h.frustumNearZ=0,h.sin512Cache=new Int32Array(512),h.sinCosCache=new Int32Array(2048),h.textureCountLoaded=new s(0),t.exports=h},5179:(t,e,i)=>{const s=i(7175),{mulaw:r}=i(9875);t.exports=class{constructor(){this.player=new s({encoding:"16bitInt",channels:1,sampleRate:8e3})}stopPlayer(){this.player.destroy()}writeStream(t,e,i){const s=r.decode(new Uint8Array(t.slice(e,e+i)));this.player.feed(s)}}},1371:(t,e,i)=>{const s=i(6848),r="0".charCodeAt(0),n="9".charCodeAt(0);class o{constructor(t,e,i,s){this.mudclient=s,this.image=null,this.anIntArray340=null,this.anIntArray341=null,this.anIntArray342=null,this.anIntArray343=null,this.anIntArray344=null,this.anIntArray345=null,this.boundsTopY=0,this.boundsTopX=0,this.interlace=!1,this.loggedIn=!1,this.boundsBottomY=e,this.boundsBottomX=t,this.width1=this.width2=t,this.height1=this.height2=e,this.area=t*e,this.pixels=new Int32Array(t*e),this.surfacePixels=[],this.surfacePixels.length=i,this.surfacePixels.fill(null),this.spriteColoursUsed=[],this.spriteColoursUsed.length=i,this.spriteColoursUsed.fill(null),this.spriteColourList=[],this.spriteColourList.length=i,this.spriteColourList.fill(null),this.spriteTranslate=new Int8Array(i),this.spriteWidth=new Int32Array(i),this.spriteHeight=new Int32Array(i),this.spriteWidthFull=new Int32Array(i),this.spriteHeightFull=new Int32Array(i),this.spriteTranslateX=new Int32Array(i),this.spriteTranslateY=new Int32Array(i),this.rgbPixels=new Uint8Array(this.pixels.buffer,this.pixels.byteOffset),this.imageData=s._graphics.ctx.createImageData(t,e),this.setComplete()}static rgbToInt(t,e,i){return(t<<16)+(e<<8)+i}static createFont(t,e){o.gameFonts[e]=t}setComplete(){for(let t=0;t<4*this.area;t+=4){const e=this.rgbPixels[t];this.rgbPixels[t]=this.rgbPixels[t+2],this.rgbPixels[t+2]=e,this.rgbPixels[t+3]=255}this.imageData.data.set(this.rgbPixels)}setBounds(t,e,i,s){t<0&&(t=0),e<0&&(e=0),i>this.width2&&(i=this.width2),s>this.height2&&(s=this.height2),this.boundsTopX=t,this.boundsTopY=e,this.boundsBottomX=i,this.boundsBottomY=s}resetBounds(){this.boundsTopX=0,this.boundsTopY=0,this.boundsBottomX=this.width2,this.boundsBottomY=this.height2}draw(t,e,i){this.setComplete(),t.drawImage(this.imageData,e,i)}blackScreen(){const t=this.width2*this.height2;if(!this.interlace){for(let e=0;e<t;e++)this.pixels[e]=0;return}let e=0;for(let t=-this.height2;t<0;t+=2){for(let t=-this.width2;t<0;t++)this.pixels[e++]=0;e+=this.width2}}drawCircle(t,e,i,s,r){const n=256-r,o=(s>>16&255)*r,h=(s>>8&255)*r,a=(255&s)*r;let l=e-i;l<0&&(l=0);let c=e+i;c>=this.height2&&(c=this.height2-1);let u=1;this.interlace&&(u=2,0!=(1&l)&&l++);for(let s=l;s<=c;s+=u){const r=s-e,l=0|Math.sqrt(i*i-r*r);let c=t-l;c<0&&(c=0);let u=t+l;u>=this.width2&&(u=this.width2-1);let d=c+s*this.width2;for(let t=c;t<=u;t++){const t=(o+(this.pixels[d]>>16&255)*n>>8<<16)+(h+(this.pixels[d]>>8&255)*n>>8<<8)+(a+(255&this.pixels[d])*n>>8);this.pixels[d++]=t}}}drawBoxAlpha(t,e,i,s,r,n){t<this.boundsTopX&&(i-=this.boundsTopX-t,t=this.boundsTopX),e<this.boundsTopY&&(s-=this.boundsTopY-e,e=this.boundsTopY),t+i>this.boundsBottomX&&(i=this.boundsBottomX-t),e+s>this.boundsBottomY&&(s=this.boundsBottomY-e);const o=256-n,h=(r>>16&255)*n,a=(r>>8&255)*n,l=(255&r)*n;let c=this.width2-i,u=1;this.interlace&&(u=2,c+=this.width2,0!=(1&e)&&(e++,s--));let d=t+e*this.width2;for(let t=0;t<s;t+=u){for(let t=-i;t<0;t++){const t=(h+(this.pixels[d]>>16&255)*o>>8<<16)+(a+(this.pixels[d]>>8&255)*o>>8<<8)+(l+(255&this.pixels[d])*o>>8);this.pixels[d++]=t}d+=c}}drawGradient(t,e,i,s,r,n){t<this.boundsTopX&&(i-=this.boundsTopX-t,t=this.boundsTopX),t+i>this.boundsBottomX&&(i=this.boundsBottomX-t);const o=n>>16&255,h=n>>8&255,a=255&n,l=r>>16&255,c=r>>8&255,u=255&r;let d=this.width2-i,f=1;this.interlace&&(f=2,d+=this.width2,0!=(1&e)&&(e++,s--));let m=t+e*this.width2;for(let t=0;t<s;t+=f)if(t+e>=this.boundsTopY&&t+e<this.boundsBottomY){const e=((o*t+l*(s-t))/s<<16)+((h*t+c*(s-t))/s<<8)+((a*t+u*(s-t))/s|0);for(let t=-i;t<0;t++)this.pixels[m++]=e;m+=d}else m+=this.width2}drawBox(t,e,i,s,r){t<this.boundsTopX&&(i-=this.boundsTopX-t,t=this.boundsTopX),e<this.boundsTopY&&(s-=this.boundsTopY-e,e=this.boundsTopY),t+i>this.boundsBottomX&&(i=this.boundsBottomX-t),e+s>this.boundsBottomY&&(s=this.boundsBottomY-e);let n=this.width2-i,o=1;this.interlace&&(o=2,n+=this.width2,0!=(1&e)&&(e++,s--));let h=t+e*this.width2;for(let t=-s;t<0;t+=o){for(let t=-i;t<0;t++)this.pixels[h++]=r;h+=n}}drawBoxEdge(t,e,i,s,r){this.drawLineHoriz(t,e,i,r),this.drawLineHoriz(t,e+s-1,i,r),this.drawLineVert(t,e,s,r),this.drawLineVert(t+i-1,e,s,r)}drawLineHoriz(t,e,i,s){if(e<this.boundsTopY||e>=this.boundsBottomY)return;t<this.boundsTopX&&(i-=this.boundsTopX-t,t=this.boundsTopX),t+i>this.boundsBottomX&&(i=this.boundsBottomX-t);let r=t+e*this.width2;for(let t=0;t<i;t++)this.pixels[r+t]=s}drawLineVert(t,e,i,s){if(t<this.boundsTopX||t>=this.boundsBottomX)return;e<this.boundsTopY&&(i-=this.boundsTopY-e,e=this.boundsTopY),e+i>this.boundsBottomX&&(i=this.boundsBottomY-e);let r=t+e*this.width2;for(let t=0;t<i;t++)this.pixels[r+t*this.width2]=s}setPixel(t,e,i){t<this.boundsTopX||e<this.boundsTopY||t>=this.boundsBottomX||e>=this.boundsBottomY||(this.pixels[t+e*this.width2]=i)}fadeToBlack(){const t=this.width2*this.height2;for(let e=0;e<t;e++){let t=16777215&this.pixels[e];this.pixels[e]=(t>>>1&8355711)+(t>>>2&4144959)+(t>>>3&2039583)+(t>>>4&986895)}}drawLineAlpha(t,e,i,s,r,n){for(let o=i;o<i+r;o++)for(let i=s;i<s+n;i++){let s=0,r=0,n=0,h=0;for(let a=o-t;a<=o+t;a++)if(a>=0&&a<this.width2)for(let t=i-e;t<=i+e;t++)if(t>=0&&t<this.height2){let e=this.pixels[a+this.width2*t];s+=e>>16&255,r+=e>>8&255,n+=255&e,h++}this.pixels[o+this.width2*i]=(s/h<<16)+(r/h<<8)+(n/h|0)}}clear(){for(let t=0;t<this.surfacePixels.length;t++)this.surfacePixels[t]=null,this.spriteWidth[t]=0,this.spriteHeight[t]=0,this.spriteColoursUsed[t]=null,this.spriteColourList[t]=null}parseSprite(t,e,i,r){let n=s.getUnsignedShort(e,0);const o=s.getUnsignedShort(i,n);n+=2;const h=s.getUnsignedShort(i,n);n+=2;const a=255&i[n++],l=new Int32Array(a);l[0]=16711935;for(let t=0;t<a-1;t++)l[t+1]=((255&i[n])<<16)+((255&i[n+1])<<8)+(255&i[n+2]),n+=3;let c=2;for(let a=t;a<t+r;a++){this.spriteTranslateX[a]=255&i[n++],this.spriteTranslateY[a]=255&i[n++],this.spriteWidth[a]=s.getUnsignedShort(i,n),n+=2,this.spriteHeight[a]=s.getUnsignedShort(i,n),n+=2;const t=255&i[n++],r=this.spriteWidth[a]*this.spriteHeight[a];if(this.spriteColoursUsed[a]=new Int8Array(r),this.spriteColourList[a]=l,this.spriteWidthFull[a]=o,this.spriteHeightFull[a]=h,this.surfacePixels[a]=null,this.spriteTranslate[a]=!1,0===this.spriteTranslateX[a]&&0===this.spriteTranslateY[a]||(this.spriteTranslate[a]=!0),0===t)for(let t=0;t<r;t++)this.spriteColoursUsed[a][t]=e[c++],0===this.spriteColoursUsed[a][t]&&(this.spriteTranslate[a]=!0);else if(1===t)for(let t=0;t<this.spriteWidth[a];t++)for(let i=0;i<this.spriteHeight[a];i++)this.spriteColoursUsed[a][t+i*this.spriteWidth[a]]=e[c++],0===this.spriteColoursUsed[a][t+i*this.spriteWidth[a]]&&(this.spriteTranslate[a]=!0)}}readSleepWord(t,e){const i=this.surfacePixels[t]=new Int32Array(10200);this.spriteWidth[t]=255,this.spriteHeight[t]=40,this.spriteTranslateX[t]=0,this.spriteTranslateY[t]=0,this.spriteWidthFull[t]=255,this.spriteHeightFull[t]=40,this.spriteTranslate[t]=!1;let s=0,r=1,n=0;for(n=0;n<255;){const t=255&e[r++];for(let e=0;e<t;e++)i[n++]=s;s=16777215-s}for(let t=1;t<40;t++)for(let t=0;t<255;){const s=255&e[r++];for(let e=0;e<s;e++)i[n]=i[n-255],n++,t++;t<255&&(i[n]=16777215-i[n-255],n++,t++)}}drawWorld(t){let e=this.spriteWidth[t]*this.spriteHeight[t],i=this.surfacePixels[t],s=new Int32Array(32768);for(let t=0;t<e;t++){let e=i[t];s[((16252928&e)>>9)+((63488&e)>>6)+((248&e)>>3)]++}let r=new Int32Array(256);r[0]=16711935;let n=new Int32Array(256);for(let t=0;t<32768;t++){let e=s[t];if(e>n[255])for(let i=1;i<256;i++)if(!(e<=n[i])){for(let t=255;t>i;t--)r[t]=r[t-1],n[t]=n[t-1];r[i]=((31744&t)<<9)+((992&t)<<6)+((31&t)<<3)+263172,n[i]=e;break}s[t]=-1}let o=new Int8Array(e);for(let t=0;t<e;t++){let e=i[t],n=((16252928&e)>>9)+((63488&e)>>6)+((248&e)>>3),h=s[n];if(-1===h){let t=999999999,i=e>>16&255,o=e>>8&255,a=255&e;for(let e=0;e<256;e++){let s=r[e],n=s>>16&255,l=s>>8&255,c=255&s,u=(i-n)*(i-n)+(o-l)*(o-l)+(a-c)*(a-c);u<t&&(t=u,h=e)}s[n]=h}o[t]=255&h}this.spriteColoursUsed[t]=o,this.spriteColourList[t]=r,this.surfacePixels[t]=null}loadSprite(t){if(null===this.spriteColoursUsed[t])return;const e=this.spriteWidth[t]*this.spriteHeight[t],i=this.spriteColoursUsed[t],s=this.spriteColourList[t],r=new Int32Array(e);for(let t=0;t<e;t++){let e=s[255&i[t]];0===e?e=1:16711935===e&&(e=0),r[t]=e}this.surfacePixels[t]=r,this.spriteColoursUsed[t]=null,this.spriteColourList[t]=null}drawSpriteMinimap(t,e,i,s,r){this.spriteWidth[t]=s,this.spriteHeight[t]=r,this.spriteTranslate[t]=!1,this.spriteTranslateX[t]=0,this.spriteTranslateY[t]=0,this.spriteWidthFull[t]=s,this.spriteHeightFull[t]=r,this.surfacePixels[t]=new Int32Array(s*r);let n=0;for(let o=e;o<e+s;o++)for(let e=i;e<i+r;e++)this.surfacePixels[t][n++]=this.pixels[o+e*this.width2]}_drawSprite_from5(t,e,i,s,r){this.spriteWidth[t]=s,this.spriteHeight[t]=r,this.spriteTranslate[t]=!1,this.spriteTranslateX[t]=0,this.spriteTranslateY[t]=0,this.spriteWidthFull[t]=s,this.spriteHeightFull[t]=r,this.surfacePixels[t]=new Int32Array(s*r);let n=0;for(let o=i;o<i+r;o++)for(let i=e;i<e+s;i++)this.surfacePixels[t][n++]=this.pixels[i+o*this.width2]}_drawSprite_from3(t,e,i){this.spriteTranslate[i]&&(t+=this.spriteTranslateX[i],e+=this.spriteTranslateY[i]);let s=t+e*this.width2,r=0,n=this.spriteHeight[i],o=this.spriteWidth[i],h=this.width2-o,a=0;if(e<this.boundsTopY){let t=this.boundsTopY-e;n-=t,e=this.boundsTopY,r+=t*o,s+=t*this.width2}if(e+n>=this.boundsBottomY&&(n-=e+n-this.boundsBottomY+1),t<this.boundsTopX){let e=this.boundsTopX-t;o-=e,t=this.boundsTopX,r+=e,s+=e,a+=e,h+=e}if(t+o>=this.boundsBottomX){let e=t+o-this.boundsBottomX+1;o-=e,a+=e,h+=e}if(o<=0||n<=0)return;let l=1;this.interlace&&(l=2,h+=this.width2,a+=this.spriteWidth[i],0!=(1&e)&&(s+=this.width2,n--)),null===this.surfacePixels[i]?this._drawSprite_from10A(this.pixels,this.spriteColoursUsed[i],this.spriteColourList[i],r,s,o,n,h,a,l):this._drawSprite_from10(this.pixels,this.surfacePixels[i],0,r,s,o,n,h,a,l)}_spriteClipping_from5(t,e,i,s,r){try{const n=this.spriteWidth[r],o=this.spriteHeight[r];let h=0,a=0,l=(n<<16)/i|0,c=(o<<16)/s|0;if(this.spriteTranslate[r]){let n=this.spriteWidthFull[r],o=this.spriteHeightFull[r];l=(n<<16)/i|0,c=(o<<16)/s|0,t+=(this.spriteTranslateX[r]*i+n-1)/n|0,e+=(this.spriteTranslateY[r]*s+o-1)/o|0,this.spriteTranslateX[r]*i%n!=0&&(h=(n-this.spriteTranslateX[r]*i%n<<16)/i|0),this.spriteTranslateY[r]*s%o!=0&&(a=(o-this.spriteTranslateY[r]*s%o<<16)/s|0),i=i*(this.spriteWidth[r]-(h>>16))/n|0,s=s*(this.spriteHeight[r]-(a>>16))/o|0}let u=t+e*this.width2,d=this.width2-i;if(e<this.boundsTopY){let t=this.boundsTopY-e;s-=t,e=0,u+=t*this.width2,a+=c*t}if(e+s>=this.boundsBottomY&&(s-=e+s-this.boundsBottomY+1),t<this.boundsTopX){let e=this.boundsTopX-t;i-=e,t=0,u+=e,h+=l*e,d+=e}if(t+i>=this.boundsBottomX){let e=t+i-this.boundsBottomX+1;i-=e,d+=e}let f=1;this.interlace&&(f=2,d+=this.width2,c+=c,0!=(1&e)&&(u+=this.width2,s--)),this._plotScale_from13(this.pixels,this.surfacePixels[r],0,h,a,u,d,i,s,l,c,n,f)}catch(t){console.error(t)}}_spriteClipping_from7(t,e,i,s,r,n,o){r>=5e4?this.mudclientref.drawTeleportBubble(t,e,i,s,r-5e4,n,o):r>=4e4?this.mudclientref.drawItem(t,e,i,s,r-4e4,n,o):r>=2e4?this.mudclientref.drawNpc(t,e,i,s,r-2e4,n,o):r>=5e3?this.mudclientref.drawPlayer(t,e,i,s,r-5e3,n,o):this._spriteClipping_from5(t,e,i,s,r)}_drawSpriteAlpha_from4(t,e,i,s){this.spriteTranslate[i]&&(t+=this.spriteTranslateX[i],e+=this.spriteTranslateY[i]);let r=t+e*this.width2,n=0,o=this.spriteHeight[i],h=this.spriteWidth[i],a=this.width2-h,l=0;if(e<this.boundsTopY){let t=this.boundsTopY-e;o-=t,e=this.boundsTopY,n+=t*h,r+=t*this.width2}if(e+o>=this.boundsBottomY&&(o-=e+o-this.boundsBottomY+1),t<this.boundsTopX){let e=this.boundsTopX-t;h-=e,t=this.boundsTopX,n+=e,r+=e,l+=e,a+=e}if(t+h>=this.boundsBottomX){let e=t+h-this.boundsBottomX+1;h-=e,l+=e,a+=e}if(h<=0||o<=0)return;let c=1;this.interlace&&(c=2,a+=this.width2,l+=this.spriteWidth[i],0!=(1&e)&&(r+=this.width2,o--)),null===this.surfacePixels[i]?this._drawSpriteAlpha_from11A(this.pixels,this.spriteColoursUsed[i],this.spriteColourList[i],n,r,h,o,a,l,c,s):this._drawSpriteAlpha_from11(this.pixels,this.surfacePixels[i],0,n,r,h,o,a,l,c,s)}drawActionBubble(t,e,i,s,r,n){try{const o=this.spriteWidth[r],h=this.spriteHeight[r];let a=0,l=0,c=(o<<16)/i|0,u=(h<<16)/s|0;if(this.spriteTranslate[r]){const n=this.spriteWidthFull[r],o=this.spriteHeightFull[r];c=(n<<16)/i|0,u=(o<<16)/s|0,t+=(this.spriteTranslateX[r]*i+n-1)/n|0,e+=(this.spriteTranslateY[r]*s+o-1)/o|0,this.spriteTranslateX[r]*i%n!=0&&(a=(n-this.spriteTranslateX[r]*i%n<<16)/i|0),this.spriteTranslateY[r]*s%o!=0&&(l=(o-this.spriteTranslateY[r]*s%o<<16)/s|0),i=i*(this.spriteWidth[r]-(a>>16))/n|0,s=s*(this.spriteHeight[r]-(l>>16))/o|0}let d=t+e*this.width2,f=this.width2-i;if(e<this.boundsTopY){let t=this.boundsTopY-e;s-=t,e=0,d+=t*this.width2,l+=u*t}if(e+s>=this.boundsBottomY&&(s-=e+s-this.boundsBottomY+1),t<this.boundsTopX){let e=this.boundsTopX-t;i-=e,t=0,d+=e,a+=c*e,f+=e}if(t+i>=this.boundsBottomX){let e=t+i-this.boundsBottomX+1;i-=e,f+=e}let m=1;this.interlace&&(m=2,f+=this.width2,u+=u,0!=(1&e)&&(d+=this.width2,s--)),this.transparentScale(this.pixels,this.surfacePixels[r],0,a,l,d,f,i,s,c,u,o,m,n)}catch(t){console.error(t)}}_spriteClipping_from6(t,e,i,s,r,n){try{let o=this.spriteWidth[r],h=this.spriteHeight[r],a=0,l=0,c=(o<<16)/i|0,u=(h<<16)/s|0;if(this.spriteTranslate[r]){let n=this.spriteWidthFull[r],o=this.spriteHeightFull[r];c=(n<<16)/i|0,u=(o<<16)/s|0,t+=(this.spriteTranslateX[r]*i+n-1)/n|0,e+=(this.spriteTranslateY[r]*s+o-1)/o|0,this.spriteTranslateX[r]*i%n!=0&&(a=(n-this.spriteTranslateX[r]*i%n<<16)/i|0),this.spriteTranslateY[r]*s%o!=0&&(l=(o-this.spriteTranslateY[r]*s%o<<16)/s|0),i=i*(this.spriteWidth[r]-(a>>16))/n|0,s=s*(this.spriteHeight[r]-(l>>16))/o|0}let d=t+e*this.width2,f=this.width2-i;if(e<this.boundsTopY){let t=this.boundsTopY-e;s-=t,e=0,d+=t*this.width2,l+=u*t}if(e+s>=this.boundsBottomY&&(s-=e+s-this.boundsBottomY+1),t<this.boundsTopX){let e=this.boundsTopX-t;i-=e,t=0,d+=e,a+=c*e,f+=e}if(t+i>=this.boundsBottomX){let e=t+i-this.boundsBottomX+1;i-=e,f+=e}let m=1;this.interlace&&(m=2,f+=this.width2,u+=u,0!=(1&e)&&(d+=this.width2,s--)),this._plotScale_from14(this.pixels,this.surfacePixels[r],0,a,l,d,f,i,s,c,u,o,m,n)}catch(t){console.error(t)}}_drawSprite_from10(t,e,i,s,r,n,o,h,a,l){let c=-(n>>2);n=-(3&n);for(let u=-o;u<0;u+=l){for(let n=c;n<0;n++)0!==(i=e[s++])?t[r++]=i:r++,0!==(i=e[s++])?t[r++]=i:r++,0!==(i=e[s++])?t[r++]=i:r++,0!==(i=e[s++])?t[r++]=i:r++;for(let o=n;o<0;o++)0!==(i=e[s++])?t[r++]=i:r++;r+=h,s+=a}}_drawSprite_from10A(t,e,i,s,r,n,o,h,a,l){let c=-(n>>2);n=-(3&n);for(let u=-o;u<0;u+=l){for(let n=c;n<0;n++){let n=e[s++];0!==n?t[r++]=i[255&n]:r++,n=e[s++],0!==n?t[r++]=i[255&n]:r++,n=e[s++],0!==n?t[r++]=i[255&n]:r++,n=e[s++],0!==n?t[r++]=i[255&n]:r++}for(let o=n;o<0;o++){let n=e[s++];0!==n?t[r++]=i[255&n]:r++}r+=h,s+=a}}_plotScale_from13(t,e,i,s,r,n,o,h,a,l,c,u,d){try{let f=s;for(let m=-a;m<0;m+=d){let a=(r>>16)*u;for(let r=-h;r<0;r++)0!==(i=e[(s>>16)+a])?t[n++]=i:n++,s+=l;r+=c,s=f,n+=o}}catch(t){console.error(t)}}_drawSpriteAlpha_from11(t,e,i,s,r,n,o,h,a,l,c){let u=256-c;for(let d=-o;d<0;d+=l){for(let o=-n;o<0;o++)if(0!==(i=e[s++])){let e=t[r];t[r++]=((16711935&i)*c+(16711935&e)*u&-16711936)+((65280&i)*c+(65280&e)*u&16711680)>>8}else r++;r+=h,s+=a}}_drawSpriteAlpha_from11A(t,e,i,s,r,n,o,h,a,l,c){let u=256-c;for(let d=-o;d<0;d+=l){for(let o=-n;o<0;o++){let n=e[s++];if(0!==n){n=i[255&n];let e=t[r];t[r++]=((16711935&n)*c+(16711935&e)*u&-16711936)+((65280&n)*c+(65280&e)*u&16711680)>>8}else r++}r+=h,s+=a}}transparentScale(t,e,i,s,r,n,o,h,a,l,c,u,d,f){let m=256-f;try{let p=s;for(let g=-a;g<0;g+=d){let a=(r>>16)*u;for(let r=-h;r<0;r++){if(0!==(i=e[(s>>16)+a])){let e=t[n];t[n++]=((16711935&i)*f+(16711935&e)*m&-16711936)+((65280&i)*f+(65280&e)*m&16711680)>>8}else n++;s+=l}r+=c,s=p,n+=o}}catch(t){console.error(t)}}_plotScale_from14(t,e,i,s,r,n,o,h,a,l,c,u,d,f){let m=f>>16&255,p=f>>8&255,g=255&f;try{let f=s;for(let y=-a;y<0;y+=d){let a=(r>>16)*u;for(let r=-h;r<0;r++){if(0!==(i=e[(s>>16)+a])){let e=i>>16&255,s=i>>8&255,r=255&i;t[n++]=e===s&&s===r?(e*m>>8<<16)+(s*p>>8<<8)+(r*g>>8):i}else n++;s+=l}r+=c,s=f,n+=o}}catch(t){console.error(t)}}drawMinimapSprite(t,e,i,s,r){let n=this.width2,h=this.height2;if(!this.sinCosCache){this.sinCosCache=new Int32Array(512);for(let t=0;t<256;t++)this.sinCosCache[t]=32768*Math.sin(.02454369*t)|0,this.sinCosCache[t+256]=32768*Math.cos(.02454369*t)|0}let a=-(this.spriteWidthFull[i]/2|0),l=-(this.spriteHeightFull[i]/2|0);this.spriteTranslate[i]&&(a+=this.spriteTranslateX[i],l+=this.spriteTranslateY[i]);let c=a+this.spriteWidth[i],u=l+this.spriteHeight[i],d=c,f=l,m=a,p=u;s&=255;let g=this.sinCosCache[s]*r,y=this.sinCosCache[s+256]*r,w=t+(l*g+a*y>>22),b=e+(l*y-a*g>>22),C=t+(f*g+d*y>>22),I=e+(f*y-d*g>>22),S=t+(u*g+c*y>>22),v=e+(u*y-c*g>>22),x=t+(p*g+m*y>>22),T=e+(p*y-m*g>>22);192===r&&(63&s)==(63&o.anInt348)?o.anInt346++:128===r?o.anInt348=s:o.anInt347++;let A=b,k=b;I<A?A=I:I>k&&(k=I),v<A?A=v:v>k&&(k=v),T<A?A=T:T>k&&(k=T),A<this.boundsTopY&&(A=this.boundsTopY),k>this.boundsBottomY&&(k=this.boundsBottomY),null!==this.anIntArray340&&this.anIntArray340.length===h+1||(this.anIntArray340=new Int32Array(h+1),this.anIntArray341=new Int32Array(h+1),this.anIntArray342=new Int32Array(h+1),this.anIntArray343=new Int32Array(h+1),this.anIntArray344=new Int32Array(h+1),this.anIntArray345=new Int32Array(h+1));for(let t=A;t<=k;t++)this.anIntArray340[t]=99999999,this.anIntArray341[t]=-99999999;let B=0,L=0,M=0,E=this.spriteWidth[i],_=this.spriteHeight[i];a=0,l=0,d=E-1,f=0,c=E-1,u=_-1,m=0,p=_-1,T!==b&&(B=(x-w<<8)/(T-b)|0,M=(p-l<<8)/(T-b)|0);let Y=0,P=0,j=0,D=0;b>T?(j=x<<8,D=p<<8,Y=T,P=b):(j=w<<8,D=l<<8,Y=b,P=T),Y<0&&(j-=B*Y,D-=M*Y,Y=0),P>h-1&&(P=h-1);for(let t=Y;t<=P;t++)this.anIntArray340[t]=this.anIntArray341[t]=j,j+=B,this.anIntArray342[t]=this.anIntArray343[t]=0,this.anIntArray344[t]=this.anIntArray345[t]=D,D+=M;I!==b&&(B=(C-w<<8)/(I-b)|0,L=(d-a<<8)/(I-b)|0);let X=0;b>I?(j=C<<8,X=d<<8,Y=I,P=b):(j=w<<8,X=a<<8,Y=b,P=I),Y<0&&(j-=B*Y,X-=L*Y,Y=0),P>h-1&&(P=h-1);for(let t=Y;t<=P;t++)j<this.anIntArray340[t]&&(this.anIntArray340[t]=j,this.anIntArray342[t]=X,this.anIntArray344[t]=0),j>this.anIntArray341[t]&&(this.anIntArray341[t]=j,this.anIntArray343[t]=X,this.anIntArray345[t]=0),j+=B,X+=L;v!==I&&(B=(S-C<<8)/(v-I)|0,M=(u-f<<8)/(v-I)|0),I>v?(j=S<<8,X=c<<8,D=u<<8,Y=v,P=I):(j=C<<8,X=d<<8,D=f<<8,Y=I,P=v),Y<0&&(j-=B*Y,D-=M*Y,Y=0),P>h-1&&(P=h-1);for(let t=Y;t<=P;t++)j<this.anIntArray340[t]&&(this.anIntArray340[t]=j,this.anIntArray342[t]=X,this.anIntArray344[t]=D),j>this.anIntArray341[t]&&(this.anIntArray341[t]=j,this.anIntArray343[t]=X,this.anIntArray345[t]=D),j+=B,D+=M;T!==v&&(B=(x-S<<8)/(T-v)|0,L=(m-c<<8)/(T-v)|0),v>T?(j=x<<8,X=m<<8,D=p<<8,Y=T,P=v):(j=S<<8,X=c<<8,D=u<<8,Y=v,P=T),Y<0&&(j-=B*Y,X-=L*Y,Y=0),P>h-1&&(P=h-1);for(let t=Y;t<=P;t++)j<this.anIntArray340[t]&&(this.anIntArray340[t]=j,this.anIntArray342[t]=X,this.anIntArray344[t]=D),j>this.anIntArray341[t]&&(this.anIntArray341[t]=j,this.anIntArray343[t]=X,this.anIntArray345[t]=D),j+=B,X+=L;let O=A*n,R=this.surfacePixels[i];for(let t=A;t<k;t++){let e=this.anIntArray340[t]>>8,s=this.anIntArray341[t]>>8;if(s-e<=0)O+=n;else{let r=this.anIntArray342[t]<<9,o=((this.anIntArray343[t]<<9)-r)/(s-e)|0,h=this.anIntArray344[t]<<9,a=((this.anIntArray345[t]<<9)-h)/(s-e)|0;e<this.boundsTopX&&(r+=(this.boundsTopX-e)*o,h+=(this.boundsTopX-e)*a,e=this.boundsTopX),s>this.boundsBottomX&&(s=this.boundsBottomX),this.interlace&&0!=(1&t)||(this.spriteTranslate[i]?this.drawMinimapTranslate(this.pixels,R,0,O+e,r,h,o,a,e-s,E):this.drawMinimap(this.pixels,R,0,O+e,r,h,o,a,e-s,E)),O+=n}}}drawMinimap(t,e,i,s,r,n,o,h,a,l){for(i=a;i<0;i++)this.pixels[s++]=e[(r>>17)+(n>>17)*l],r+=o,n+=h}drawMinimapTranslate(t,e,i,s,r,n,o,h,a,l){for(let t=a;t<0;t++)0!==(i=e[(r>>17)+(n>>17)*l])?this.pixels[s++]=i:s++,r+=o,n+=h}_spriteClipping_from9(t,e,i,s,r,n,o,h,a){try{0===n&&(n=16777215),0===o&&(o=16777215);const l=this.spriteWidth[r],c=this.spriteHeight[r];let u=0,d=0,f=h<<16,m=(l<<16)/i|0,p=(c<<16)/s|0,g=-((h<<16)/s|0);if(this.spriteTranslate[r]){const n=this.spriteWidthFull[r],o=this.spriteHeightFull[r];m=(n<<16)/i|0,p=(o<<16)/s|0;let h=this.spriteTranslateX[r],l=this.spriteTranslateY[r];a&&(h=n-this.spriteWidth[r]-h),t+=(h*i+n-1)/n|0;let c=(l*s+o-1)/o|0;e+=c,f+=c*g,h*i%n!=0&&(u=(n-h*i%n<<16)/i|0),l*s%o!=0&&(d=(o-l*s%o<<16)/s|0),i=((this.spriteWidth[r]<<16)-u+m-1)/m|0,s=((this.spriteHeight[r]<<16)-d+p-1)/p|0}let y=e*this.width2;if(f+=t<<16,e<this.boundsTopY){let t=this.boundsTopY-e;s-=t,e=this.boundsTopY,y+=t*this.width2,d+=p*t,f+=g*t}e+s>=this.boundsBottomY&&(s-=e+s-this.boundsBottomY+1);let w=y/this.width2&1;if(this.interlace||(w=2),16777215===o)return null!==this.surfacePixels[r]?a?void this._transparentSpritePlot_from15(this.pixels,this.surfacePixels[r],0,(this.spriteWidth[r]<<16)-u-1,d,y,i,s,-m,p,l,n,f,g,w):void this._transparentSpritePlot_from15(this.pixels,this.surfacePixels[r],0,u,d,y,i,s,m,p,l,n,f,g,w):a?void this._transparentSpritePlot_from16A(this.pixels,this.spriteColoursUsed[r],this.spriteColourList[r],0,(this.spriteWidth[r]<<16)-u-1,d,y,i,s,-m,p,l,n,f,g,w):void this._transparentSpritePlot_from16A(this.pixels,this.spriteColoursUsed[r],this.spriteColourList[r],0,u,d,y,i,s,m,p,l,n,f,g,w);if(null!==this.surfacePixels[r])return a?void this._transparentSpritePlot_from16(this.pixels,this.surfacePixels[r],0,(this.spriteWidth[r]<<16)-u-1,d,y,i,s,-m,p,l,n,o,f,g,w):void this._transparentSpritePlot_from16(this.pixels,this.surfacePixels[r],0,u,d,y,i,s,m,p,l,n,o,f,g,w);a?this._transparentSpritePlot_from17(this.pixels,this.spriteColoursUsed[r],this.spriteColourList[r],0,(this.spriteWidth[r]<<16)-u-1,d,y,i,s,-m,p,l,n,o,f,g,w):this._transparentSpritePlot_from17(this.pixels,this.spriteColoursUsed[r],this.spriteColourList[r],0,u,d,y,i,s,m,p,l,n,o,f,g,w)}catch(t){console.error(t)}}_transparentSpritePlot_from15(t,e,i,s,r,n,o,h,a,l,c,u,d,f,m){let p=u>>16&255,g=u>>8&255,y=255&u;try{let u=s;for(let w=-h;w<0;w++){let h=(r>>16)*c,w=d>>16,b=o;if(w<this.boundsTopX){let t=this.boundsTopX-w;b-=t,w=this.boundsTopX,s+=a*t}if(w+b>=this.boundsBottomX&&(b-=w+b-this.boundsBottomX),0!=(m=1-m))for(let r=w;r<w+b;r++){if(0!==(i=e[(s>>16)+h])){let e=i>>16&255,s=i>>8&255,o=255&i;t[r+n]=e===s&&s===o?(e*p>>8<<16)+(s*g>>8<<8)+(o*y>>8):i}s+=a}r+=l,s=u,n+=this.width2,d+=f}}catch(t){console.error(t)}}_transparentSpritePlot_from16(t,e,i,s,r,n,o,h,a,l,c,u,d,f,m,p){let g=u>>16&255,y=u>>8&255,w=255&u,b=d>>16&255,C=d>>8&255,I=255&d;try{let u=s;for(let d=-h;d<0;d++){let h=(r>>16)*c,d=f>>16,S=o;if(d<this.boundsTopX){let t=this.boundsTopX-d;S-=t,d=this.boundsTopX,s+=a*t}if(d+S>=this.boundsBottomX&&(S-=d+S-this.boundsBottomX),0!=(p=1-p))for(let r=d;r<d+S;r++){if(0!==(i=e[(s>>16)+h])){let e=i>>16&255,s=i>>8&255,o=255&i;t[r+n]=e===s&&s===o?(e*g>>8<<16)+(s*y>>8<<8)+(o*w>>8):255===e&&s===o?(e*b>>8<<16)+(s*C>>8<<8)+(o*I>>8):i}s+=a}r+=l,s=u,n+=this.width2,f+=m}}catch(t){console.error(t)}}_transparentSpritePlot_from16A(t,e,i,s,r,n,o,h,a,l,c,u,d,f,m,p){let g=d>>16&255,y=d>>8&255,w=255&d;try{let d=r;for(let b=-a;b<0;b++){let a=(n>>16)*u,b=f>>16,C=h;if(b<this.boundsTopX){let t=this.boundsTopX-b;C-=t,b=this.boundsTopX,r+=l*t}if(b+C>=this.boundsBottomX&&(C-=b+C-this.boundsBottomX),0!=(p=1-p))for(let n=b;n<b+C;n++){if(0!=(s=255&e[(r>>16)+a])){let e=(s=i[s])>>16&255,r=s>>8&255,h=255&s;t[n+o]=e===r&&r===h?(e*g>>8<<16)+(r*y>>8<<8)+(h*w>>8):s}r+=l}n+=c,r=d,o+=this.width2,f+=m}}catch(t){console.error(t)}}_transparentSpritePlot_from17(t,e,i,s,r,n,o,h,a,l,c,u,d,f,m,p,g){let y=d>>16&255,w=d>>8&255,b=255&d,C=f>>16&255,I=f>>8&255,S=255&f;try{let d=r;for(let f=-a;f<0;f++){let a=(n>>16)*u,f=m>>16,v=h;if(f<this.boundsTopX){let t=this.boundsTopX-f;v-=t,f=this.boundsTopX,r+=l*t}if(f+v>=this.boundsBottomX&&(v-=f+v-this.boundsBottomX),0!=(g=1-g))for(let n=f;n<f+v;n++){if(0!=(s=255&e[(r>>16)+a])){let e=(s=i[s])>>16&255,r=s>>8&255,h=255&s;t[n+o]=e===r&&r===h?(e*y>>8<<16)+(r*w>>8<<8)+(h*b>>8):255===e&&r===h?(e*C>>8<<16)+(r*I>>8<<8)+(h*S>>8):s}r+=l}n+=c,r=d,o+=this.width2,m+=p}}catch(t){console.error(t)}}drawStringRight(t,e,i,s,r){this.drawString(t,e-this.textWidth(t,s),i,s,r)}drawStringCenter(t,e,i,s,r){this.drawString(t,e-(this.textWidth(t,s)/2|0),i,s,r)}drawParagraph(t,e,i,s,r,n){try{let h=0;const a=o.gameFonts[s];let l=0,c=0;for(let u=0;u<t.length;u++)"@"===t[u]&&u+4<t.length&&"@"===t[u+4]||"~"===t[u]&&u+4<t.length&&"~"===t[u+4]?u+=4:h+=a[o.characterWidth[t.charCodeAt(u)]+7]," "===t[u]&&(c=u),"%"===t[u]&&(c=u,h=1e3),h>n&&(c<=l&&(c=u),this.drawStringCenter(t.slice(l,c),e,i,s,r),h=0,l=u=c+1,i+=this.textHeight(s));h>0&&this.drawStringCenter(t.slice(l),e,i,s,r)}catch(t){console.error(t)}}drawString(t,e,i,s,h){try{const a=o.gameFonts[s];for(let s=0;s<t.length;s++)if("@"===t[s]&&s+4<t.length&&"@"===t[s+4])"red"===t.slice(s+1,s+4).toLowerCase()?h=16711680:"lre"===t.slice(s+1,s+4).toLowerCase()?h=16748608:"yel"===t.slice(s+1,s+4).toLowerCase()?h=16776960:"gre"===t.slice(s+1,s+4).toLowerCase()?h=65280:"blu"===t.slice(s+1,s+4).toLowerCase()?h=255:"cya"===t.slice(s+1,s+4).toLowerCase()?h=65535:"mag"===t.slice(s+1,s+4).toLowerCase()?h=16711935:"whi"===t.slice(s+1,s+4).toLowerCase()?h=16777215:"bla"===t.slice(s+1,s+4).toLowerCase()?h=0:"dre"===t.slice(s+1,s+4).toLowerCase()?h=12582912:"ora"===t.slice(s+1,s+4).toLowerCase()?h=16748608:"ran"===t.slice(s+1,s+4).toLowerCase()?h=16777215*Math.random()|0:"or1"===t.slice(s+1,s+4).toLowerCase()?h=16756736:"or2"===t.slice(s+1,s+4).toLowerCase()?h=16740352:"or3"===t.slice(s+1,s+4).toLowerCase()?h=16723968:"gr1"===t.slice(s+1,s+4).toLowerCase()?h=12648192:"gr2"===t.slice(s+1,s+4).toLowerCase()?h=8453888:"gr3"===t.slice(s+1,s+4).toLowerCase()&&(h=4259584),s+=4;else if("~"===t[s]&&s+4<t.length&&"~"===t[s+4]){let i=t.charCodeAt(s+1),o=t.charCodeAt(s+2),h=t.charCodeAt(s+3);i>=r&&i<=n&&o>=r&&o<=n&&h>=r&&h<=n&&(e=0|Number(t.substring(s+1,s+4))),s+=4}else{const r=o.characterWidth[t.charCodeAt(s)];this.loggedIn&&0!==h&&(this.drawCharacter(r,e+1,i,0,a),this.drawCharacter(r,e,i+1,0,a)),this.drawCharacter(r,e,i,h,a),e+=a[r+7]}}catch(t){console.error(t)}}drawCharacter(t,e,i,s,r){let n=e+r[t+5],o=i-r[t+6],h=r[t+3],a=r[t+4],l=16384*r[t]+128*r[t+1]+r[t+2],c=n+o*this.width2,u=this.width2-h,d=0;if(o<this.boundsTopY){let t=this.boundsTopY-o;a-=t,o=this.boundsTopY,l+=t*h,c+=t*this.width2}if(o+a>=this.boundsBottomY&&(a-=o+a-this.boundsBottomY+1),n<this.boundsTopX){let t=this.boundsTopX-n;h-=t,n=this.boundsTopX,l+=t,c+=t,d+=t,u+=t}if(n+h>=this.boundsBottomX){let t=n+h-this.boundsBottomX+1;h-=t,d+=t,u+=t}h>0&&a>0&&this.plotLetter(this.pixels,r,s,l,c,h,a,u,d)}plotLetter(t,e,i,s,r,n,o,h,a){try{let l=-(n>>2);n=-(3&n);for(let c=-o;c<0;c++){for(let n=l;n<0;n++)0!==e[s++]?t[r++]=i:r++,0!==e[s++]?t[r++]=i:r++,0!==e[s++]?t[r++]=i:r++,0!==e[s++]?t[r++]=i:r++;for(let o=n;o<0;o++)0!==e[s++]?t[r++]=i:r++;r+=h,s+=a}}catch(t){console.error(t)}}method259(t,e,i,s,r,n,o,h,a){for(let l=-o;l<0;l++){for(let o=-n;o<0;o++){let n=255&e[s++];if(n>30)if(n>=230)t[r++]=i;else{let e=t[r];t[r++]=((16711935&i)*n+(16711935&e)*(256-n)&4278255360)+((65280&i)*n+(65280&e)*(256-n)&16711680)>>8}else r++}r+=h,s+=a}}textHeight(t){return 0===t?12:1===t||2===t?14:3===t||4===t?15:5===t?19:6===t?24:7===t?29:this.textHeightFont(t)}textHeightFont(t){return 0===t?o.gameFonts[t][8]-2:o.gameFonts[t][8]-1}textWidth(t,e){let i=0;const s=o.gameFonts[e];for(let e=0;e<t.length;e++)"@"===t[e]&&e+4<t.length&&"@"===t[e+4]||"~"===t[e]&&e+4<t.length&&"~"===t[e+4]?e+=4:i+=s[o.characterWidth[t.charCodeAt(e)]+7];return i}drawTabs(t,e,i,s,r,n){const o=i/r.length|0;let h=0;for(let i=0;i<r.length;i+=1){const a=n===i?14474460:10526880;this.drawBoxAlpha(t+h,e,o,s,a,128),this.drawStringCenter(r[i],t+h+(o/2|0),e+16,4,0),i>0&&this.drawLineVert(t+h,e,s,0),h+=o}this.drawLineHoriz(t,e+s,i,0)}}o.anInt346=0,o.anInt347=0,o.anInt348=0,o.gameFonts=[],o.gameFonts.length=50,o.gameFonts.fill(null),o.characterWidth=new Int32Array(256);for(let t=0;t<256;t++){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!\"£$%^&*()-_=+[{]};:'@#~,<.>/?\\| ".indexOf(String.fromCharCode(t));-1===e&&(e=74),o.characterWidth[t]=9*e}t.exports=o},4368:(t,e,i)=>{const s=i(4854);t.exports=function(t){const e=s(__dirname,["*.js"]);for(const[i,s]of Object.entries(e))if(!/^_|index/.test(i))for(const[e,i]of Object.entries(s))t[e]="function"==typeof i?i.bind(t):i}},6848:(t,e,i)=>{const s=i(4202),r=i(1970),n=i(3720),o="0".charCodeAt(0),h="9".charCodeAt(0),a="a".charCodeAt(0),l="A".charCodeAt(0),c="Z".charCodeAt(0),u="z".charCodeAt(0);class d{static openFile(t){return new r(t)}static getUnsignedByte(t){return 255&t}static getUnsignedShort(t,e){return((255&t[e])<<8)+(255&t[e+1])}static getUnsignedInt(t,e){return((255&t[e])<<24)+((255&t[e+1])<<16)+((255&t[e+2])<<8)+(255&t[e+3])}static getUnsignedLong(t,e){return n.fromInt(4294967295&d.getUnsignedInt(t,e)).shiftLeft(32).add(new n(4294967295&d.getUnsignedInt(t,e+4)))}static getSignedShort(t,e){let i=256*d.getUnsignedByte(t[e])+d.getUnsignedByte(t[e+1])|0;return i>32767&&(i-=65536),i}static getStackInt(t,e){return(255&t[e])<128?t[e]:((255&t[e])-128<<24)+((255&t[e+1])<<16)+((255&t[e+2])<<8)+(255&t[e+3])}static getBitMask(t,e,i){let s=e>>3,r=8-(7&e),n=0;for(;i>r;r=8)n+=(t[s++]&d.bitmask[r])<<i-r,i-=r;return n+=i===r?t[s]&d.bitmask[r]:t[s]>>r-i&d.bitmask[i],n}static formatAuthString(t,e){let i="";for(let s=0;s<e;s++)if(s>=t.length)i+=" ";else{let e=t.charCodeAt(s);i+=e>=a&&e<=u||e>=l&&e<=c||e>=o&&e<=h?String.fromCharCode(e):"_"}return i}static ipToString(t){return(t>>24&255)+"."+(t>>16&255)+"."+(t>>8&255)+"."+(255&t)}static usernameToHash(t){let e="";for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);e+=s>=a&&s<=u?String.fromCharCode(s):s>=l&&s<=c?String.fromCharCode(s+97-65):s>=o&&s<=h?String.fromCharCode(s):" "}e=e.trim(),e.length>12&&(e=e.slice(0,12));let i=new n(0);for(let t=0;t<e.length;t++){let s=e.charCodeAt(t);i=i.multiply(37),s>=a&&s<=u?i=i.add(1+s-97):s>=o&&s<=h&&(i=i.add(27+s-48))}return i}static hashToUsername(t){if(t.lessThan(0))return"invalidName";let e="";for(;!t.equals(0);){let i=t.modulo(37).toInt();t=t.divide(37),e=0===i?" "+e:i<27?t.modulo(37).equals(0)?String.fromCharCode(i+65-1)+e:String.fromCharCode(i+97-1)+e:String.fromCharCode(i+48-27)+e}return e}static getDataFileOffset(t,e){let i=d.getUnsignedShort(e,0),s=0;t=t.toUpperCase();for(let e=0;e<t.length;e++)s=(61*s|0)+t.charCodeAt(e)-32;let r=2+10*i;for(let t=0;t<i;t++){let i=16777216*(255&e[10*t+2])+65536*(255&e[10*t+3])+256*(255&e[10*t+4])+(255&e[10*t+5])|0,n=65536*(255&e[10*t+9])+256*(255&e[10*t+10])+(255&e[10*t+11])|0;if(i===s)return r;r+=n}return 0}static getDataFileLength(t,e){const i=d.getUnsignedShort(e,0);let s=0;t=t.toUpperCase();for(let e=0;e<t.length;e++)s=(61*s|0)+t.charCodeAt(e)-32;for(let t=0;t<i;t++){let i=16777216*(255&e[10*t+2])+65536*(255&e[10*t+3])+256*(255&e[10*t+4])+(255&e[10*t+5])|0,r=65536*(255&e[10*t+6])+256*(255&e[10*t+7])+(255&e[10*t+8])|0;if(i===s)return r}return 0}static loadData(t,e,i){return d.unpackData(t,e,i,null)}static unpackData(t,e,i,r){const n=256*(255&i[0])+(255&i[1])|0;let o=0;t=t.toUpperCase();for(let e=0;e<t.length;e++)o=(61*o|0)+t.charCodeAt(e)-32;let h=2+10*n;for(let t=0;t<n;t++){const n=16777216*(255&i[10*t+2])+65536*(255&i[10*t+3])+256*(255&i[10*t+4])+(255&i[10*t+5])|0,a=65536*(255&i[10*t+6])+256*(255&i[10*t+7])+(255&i[10*t+8])|0,l=65536*(255&i[10*t+9])+256*(255&i[10*t+10])+(255&i[10*t+11])|0;if(n===o){if(null===r&&(r=new Int8Array(a+e)),a!==l)s.decompress(r,a,i,l,h);else for(let t=0;t<a;t++)r[t]=i[h+t];return r}h+=l}return null}static formatConfirmAmount(t){let e=t.toString();for(let t=e.length-3;t>0;t-=3)e=e.substring(0,t)+","+e.substring(t);return e.length>8?e=`@gre@${e.substring(0,e.length-8)} million @whi@(${e})`:e.length>4&&(e=`@cya@${e.substring(0,e.length-4)}K @whi@(${e})`),e}}d.bitmask=new Int32Array([0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647,-1]),t.exports=d},1474:t=>{const e="0".charCodeAt(0),i="9".charCodeAt(0),s="a".charCodeAt(0),r="*".charCodeAt(0),n="\\".charCodeAt(0),o="A".charCodeAt(0),h="Z".charCodeAt(0),a=",".charCodeAt(0),l=".".charCodeAt(0),c="j".charCodeAt(0),u="q".charCodeAt(0),d="'".charCodeAt(0),f="/".charCodeAt(0),m=" ".charCodeAt(0),p="v".charCodeAt(0),g="x".charCodeAt(0),y="z".charCodeAt(0);function w(t){const e=new Uint16Array(t.length);for(let i=0;i<t.length;i+=1)e[i]=t.charCodeAt(i);return e}function b(t){return Array.from(t).map((t=>String.fromCharCode(t))).join("")}class C{static loadFilters(t,e,i,s){C.loadBad(e),C.loadHost(i),C.loadFragments(t),C.loadTLD(s)}static loadTLD(t){const e=t.getUnsignedInt();C.tldList=[],C.tldType=new Int32Array(e);for(let i=0;i<e;i++){C.tldType[i]=t.getUnsignedByte();const e=new Uint16Array(t.getUnsignedByte());for(let i=0;i<e.length;i++)e[i]=t.getUnsignedByte();C.tldList.push(e)}}static loadBad(t){const e=t.getUnsignedInt();C.badList=[],C.badList.length=e,C.badList.fill(null),C.badCharIds=[],C.badCharIds.length=e,C.badCharIds.fill(null),C.readBuffer(t,C.badList,C.badCharIds)}static loadHost(t){const e=t.getUnsignedInt();C.hostList=[],C.hostList.length=e,C.hostList.fill(null),C.hostCharIds=[],C.hostCharIds.length=e,C.hostCharIds.fill(null),C.readBuffer(t,C.hostList,C.hostCharIds)}static loadFragments(t){C.hashFragments=new Int32Array(t.getUnsignedInt());for(let e=0;e<C.hashFragments.length;e++)C.hashFragments[e]=t.getUnsignedShort()}static readBuffer(t,e,i){for(let s=0;s<e.length;s++){const r=new Uint16Array(t.getUnsignedByte());for(let e=0;e<r.length;e++)r[e]=t.getUnsignedByte();e[s]=r;const n=[];n.length=t.getUnsignedInt();for(let e=0;e<n.length;e++)n[e]=[255&t.getUnsignedByte(),255&t.getUnsignedByte()];n.length>0&&(i[s]=n)}}static filter(t){const e=w(t.toLowerCase());C.applyDotSlashFilter(e),C.applyBadwordFilter(e),C.applyHostFilter(e),C.filterDigits(e);for(let i=0;i<C.ignoreList.length;i++)for(let s=-1;-1!==(s=t.indexOf(C.ignoreList[i],s+1));){const t=w(C.ignoreList[i]);for(let i=0;i<t.length;i++)e[i+s]=t[i]}return C.forceLowerCase&&(C.stripLowerCase(w(t),e),C.toLowerCase(e)),b(e)}static stripLowerCase(t,e){for(let i=0;i<t.length;i++)e[i]!==r&&C.isUpperCase(t[i])&&(e[i]=t[i])}static toLowerCase(t){let e=!0;for(let i=0;i<t.length;i++){const s=t[i];C.isLetter(s)?e?C.isLowerCase(s)&&(e=!1):C.isUpperCase(s)&&(t[i]=s+97-65):e=!0}}static applyBadwordFilter(t){for(let e=0;e<2;e++)for(let e=C.badList.length-1;e>=0;e--)C.applyWordFilter(t,C.badList[e],C.badCharIds[e])}static applyHostFilter(t){for(let e=C.hostList.length-1;e>=0;e--)C.applyWordFilter(t,C.hostList[e],C.hostCharIds[e])}static applyDotSlashFilter(t){const e=t.slice(),i=w("dot");C.applyWordFilter(e,i,null);const s=t.slice(),r=w("slash");C.applyWordFilter(s,r,null);for(let i=0;i<C.tldList.length;i++)C.applyTLDFilter(t,e,s,C.tldList[i],C.tldType[i])}static applyTLDFilter(t,e,i,s,n){if(!(s.length>t.length))for(let o=0;o<=t.length-s.length;o++){let h=o,a=0;for(;h<t.length;){let e=0;const i=t[h];let r=0;if(h+1<t.length&&(r=t[h+1]),a<s.length&&(e=C.compareLettersNumbers(s[a],i,r))>0)h+=e,a++;else{if(0===a)break;if((e=C.compareLettersNumbers(s[a-1],i,r))>0)h+=e;else{if(a>=s.length||!C.isSpecial(i))break;h++}}}if(a>=s.length){let a=!1;const l=C.getAsteriskCount(t,e,o),c=C.getAsteriskCount2(t,i,h-1);if(C.DEBUGTLD&&console.log(`Potential tld: ${s} at char ${o} (type="${n}, startmatch="${l}, endmatch=${c})`),1===n&&l>0&&c>0&&(a=!0),2===n&&(l>2&&c>0||l>0&&c>2)&&(a=!0),3===n&&l>0&&c>2&&(a=!0),a){C.DEBUGTLD&&console.log(`Filtered tld: ${s} at char ${o}`);let n=o,a=h-1;if(l>2){if(4===l){let t=!1;for(let i=n-1;i>=0;i--)if(t){if(e[i]!==r)break;n=i}else e[i]===r&&(n=i,t=!0)}let i=!1;for(let e=n-1;e>=0;e--)if(i){if(C.isSpecial(t[e]))break;n=e}else C.isSpecial(t[e])||(i=!0,n=e)}if(c>2){if(4===c){let e=!1;for(let s=a+1;s<t.length;s++)if(e){if(i[s]!==r)break;a=s}else i[s]===r&&(a=s,e=!0)}let e=!1;for(let i=a+1;i<t.length;i++)if(e){if(C.isSpecial(t[i]))break;a=i}else C.isSpecial(t[i])||(e=!0,a=i)}for(let e=n;e<=a;e++)t[e]=r}}}}static getAsteriskCount(t,e,i){if(0===i)return 2;for(let e=i-1;e>=0&&C.isSpecial(t[e]);e--)if(t[e]===a||t[e]===l)return 3;let s=0;for(let t=i-1;t>=0&&C.isSpecial(e[t]);t--)e[t]===r&&s++;return s>=3?4:C.isSpecial(t[i-1])?1:0}static getAsteriskCount2(t,e,i){if(i+1===t.length)return 2;for(let e=i+1;e<t.length&&C.isSpecial(t[e]);e++)if(t[e]===n||t[e]===f)return 3;let s=0;for(let n=i+1;n<t.length&&C.isSpecial(e[n]);n++)e[n]===r&&s++;return s>=5?4:C.isSpecial(t[i+1])?1:0}static applyWordFilter(t,e,i){if(!(e.length>t.length))for(let s=0;s<=t.length-e.length;s++){let n=s,o=0,h=!1;for(;n<t.length;){let i=0;const s=t[n];let r=0;if(n+1<t.length&&(r=t[n+1]),o<e.length&&(i=C.compareLettersSymbols(e[o],s,r))>0)n+=i,o++;else{if(0===o)break;if((i=C.compareLettersSymbols(e[o-1],s,r))>0)n+=i;else{if(o>=e.length||!C.isNotLowerCase(s))break;C.isSpecial(s)&&s!==d&&(h=!0),n++}}}if(o>=e.length){let o=!0;if(C.DEBUGTLD&&console.log(`Potential word: ${e} at char ${s}`),h){let e=!1,i=!1;if((s-1<0||C.isSpecial(t[s-1])&&t[s-1]!==d)&&(e=!0),(n>=t.length||C.isSpecial(t[n])&&t[n]!==d)&&(i=!0),!e||!i){let i=!1,r=s-2;for(e&&(r=s);!i&&r<n;r++)if(r>=0&&(!C.isSpecial(t[r])||t[r]===d)){const e=new Uint16Array(3);let s;for(s=0;s<3&&!(r+s>=t.length||C.isSpecial(t[r+s])&&t[r+s]!==d);s++)e[s]=t[r+s];let n=!0;0===s&&(n=!1),s<3&&r-1>=0&&(!C.isSpecial(t[r-1])||t[r-1]===d)&&(n=!1),n&&!C.containsFragmentHashes(e)&&(i=!0)}i||(o=!1)}}else{let e=m;s-1>=0&&(e=t[s-1]);let r=m;n<t.length&&(r=t[n]);const h=C.getCharId(e),a=C.getCharId(r);i&&C.compareCharIds(i,h,a)&&(o=!1)}if(o){C.DEBUGWORD&&console.log(`Filtered word: ${e} at char ${s}`);for(let e=s;e<n;e++)t[e]=r}}}}static compareCharIds(t,e,i){let s=0;if(t[s][0]===e&&t[s][1]===i)return!0;let r=t.length-1;if(t[r][0]===e&&t[r][1]===i)return!0;for(;s!==r&&s+1!==r;){const n=(s+r)/2|0;if(t[n][0]===e&&t[n][1]===i)return!0;e<t[n][0]||e===t[n][0]&&i<t[n][1]?r=n:s=n}return!1}static compareLettersNumbers(t,e,i){return t=String.fromCharCode(t),e=String.fromCharCode(e),i=String.fromCharCode(i),t===e||"e"===t&&"3"===e?1:("t"!==t||"7"!==e&&"+"!==e)&&("a"!==t||"4"!==e&&"@"!==e)?"o"===t&&"0"===e||"i"===t&&"1"===e||"s"===t&&"5"===e?1:"f"===t&&"p"===e&&"h"===i?2:"g"===t&&"9"===e?1:0:1}static compareLettersSymbols(t,e,i){if(t=String.fromCharCode(t),e=String.fromCharCode(e),i=String.fromCharCode(i),"*"===t)return 0;if(t===e)return 1;if(t>="a"&&t<="z"){if("e"===t)return"3"===e?1:0;if("t"===t)return"7"===e?1:0;if("a"===t)return"4"===e||"@"===e?1:0;if("o"===t)return"0"===e||"*"===e?1:"("===e&&")"===i?2:0;if("i"===t)return"y"===e||"l"===e||"j"===e||"l"===e||"!"===e||":"===e||";"===e?1:0;if("n"===t)return 0;if("s"===t)return"5"===e||"z"===e||"$"===e?1:0;if("r"===t)return 0;if("h"===t)return 0;if("l"===t)return"1"===e?1:0;if("d"===t)return 0;if("c"===t)return"("===e?1:0;if("u"===t)return"v"===e?1:0;if("m"===t)return 0;if("f"===t)return"p"===e&&"h"===i?2:0;if("p"===t)return 0;if("g"===t)return"9"===e||"6"===e?1:0;if("w"===t)return"v"===e&&"v"===i?2:0;if("y"===t)return 0;if("b"===t)return"1"===e&&"3"===i?2:0;if("v"===t)return 0;if("k"===t)return 0;if("x"===t)return")"===e&&"("===i?2:0;if("j"===t)return 0;if("q"===t)return 0;if("z"===t)return 0}if(t>="0"&&t<="9"){if("0"===t)return"o"===e||"O"===e?1:"("===e&&")"===i?2:0;if("1"===t)return"l"!==e?0:1;if("2"===t)return 0;if("3"===t)return 0;if("4"===t)return 0;if("5"===t)return 0;if("6"===t)return 0;if("7"===t)return 0;if("8"===t)return 0;if("9"===t)return 0}return"-"===t?0:","===t?"."===e?1:0:"."===t?","===e?1:0:"("===t||")"===t?0:"!"===t?"i"===e?1:0:("'"===t||C.DEBUGWORD&&console.log(`Letter=${t} not matched`),0)}static getCharId(t){return t>=s&&t<=y?t-97+1:t===d?28:t>=e&&t<=i?t-48+29:27}static filterDigits(t){let e=0,i=0,s=0,n=0;for(;-1!=(e=C.indexOfDigit(t,i));){let o=!1;for(let s=i;s>=0&&s<e&&!o;s++)C.isSpecial(t[s])||C.isNotLowerCase(t[s])||(o=!0);o&&(s=0),0===s&&(n=e),i=C.indexOfNonDigit(t,e);let h=0;for(let s=e;s<i;s++)h=10*h+t[s]-48;if(h>255||i-e>8?s=0:s++,4===s){for(let e=n;e<i;e++)t[e]=r;s=0}}}static indexOfDigit(t,s){for(let r=s;r<t.length&&r>=0;r++)if(t[r]>=e&&t[r]<=i)return r;return-1}static indexOfNonDigit(t,s){for(let r=s;r<t.length&&r>=0;r++)if(t[r]<e||t[r]>i)return r;return t.length}static isSpecial(t){return!C.isLetter(t)&&!C.isDigit(t)}static isNotLowerCase(t){return t<s||t>y||t===p||t===g||t===c||t===u||t===y}static isLetter(t){return t>=s&&t<=y||t>=o&&t<=h}static isDigit(t){return t>=e&&t<=i}static isLowerCase(t){return t>=s&&t<=y}static isUpperCase(t){return t>=o&&t<=h}static containsFragmentHashes(t){let e=!0;for(let i=0;i<t.length;i++)C.isDigit(t[i])||0===t[i]||(e=!1);if(e)return!0;const i=C.wordToHash(t);let s=0,r=C.hashFragments.length-1;if(i===C.hashFragments[s]||i===C.hashFragments[r])return!0;for(;s!=r&&s+1!=r;){const t=(s+r)/2|0;if(i===C.hashFragments[t])return!0;i<C.hashFragments[t]?r=t:s=t}return!1}static wordToHash(t){if(t.length>6)return 0;let r=0;for(let n=0;n<t.length;n++){const o=t[t.length-n-1];if(o>=s&&o<=y)r=38*r+o-97+1|0;else if(o===d)r=38*r+27|0;else if(o>=e&&o<=i)r=38*r+o-48+28|0;else if(0!==o)return C.DEBUGWORD&&console.log(`wordToHash failed on ${b(t)}`),0}return r}}C.DEBUGTLD=!1,C.DEBUGWORD=!1,C.forceLowerCase=!0,C.ignoreList=["cook","cook's","cooks","seeks","sheet"],t.exports=C},7767:(t,e,i)=>{const s=i(5178),r=i(5965),n=i(5822),o=i(6848),h=i(2861);class a{constructor(t,e){this.regionWidth=96,this.regionHeight=96,this.anInt585=128,this.parentModel=null,this.landscapePack=null,this.mapPack=null,this.memberLandscapePack=null,this.memberMapPack=null,this.worldInitialised=!0,this.objectAdjacency=h(new Int32Array(this.regionWidth*this.regionHeight),[this.regionWidth,this.regionHeight]),this.tileDirection=h(new Int8Array(9216),[4,2304]),this.wallModels=[],this.roofModels=[];for(let t=0;t<4;t+=1){this.wallModels.push([]),this.roofModels.push([]);for(let e=0;e<64;e+=1)this.wallModels[t].push(null),this.roofModels[t].push(null)}this.terrainColours=new Int32Array(256),this.wallsNorthSouth=h(new Int8Array(9216),[4,2304]),this.wallsRoof=h(new Int8Array(9216),[4,2304]),this.terrainHeight=h(new Int8Array(9216),[4,2304]),this.terrainColour=h(new Int8Array(9216),[4,2304]),this.localY=new Int32Array(18432),this.tileDecoration=h(new Int8Array(9216),[4,2304]),this.routeVia=h(new Int32Array(this.regionWidth*this.regionHeight),[this.regionWidth,this.regionHeight]),this.wallsDiagonal=h(new Int32Array(9216),[4,2304]),this.wallsEastWest=h(new Int8Array(9216),[4,2304]),this.aBoolean592=!1,this.playerAlive=!1,this.terrainHeightLocal=h(new Int32Array(this.regionWidth*this.regionHeight),[this.regionWidth,this.regionHeight]),this.terrainModels=[],this.terrainModels.length=64,this.terrainModels.fill(null),this.localX=new Int32Array(18432),this.baseMediaSprite=750,this.scene=t,this.surface=e;for(let t=0;t<64;t++)this.terrainColours[t]=r.rgb(255-4*t,255-(1.75*t|0),255-4*t);for(let t=0;t<64;t++)this.terrainColours[t+64]=r.rgb(3*t,144,0);for(let t=0;t<64;t++)this.terrainColours[t+128]=r.rgb(192-(1.5*t|0),144-(1.5*t|0),0);for(let t=0;t<64;t++)this.terrainColours[t+192]=r.rgb(96-(1.5*t|0),48+(1.5*t|0),0)}getWallEastWest(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),255&this.wallsEastWest.get(i,48*t+e)}setTerrainAmbience(t,e,i,s,r){let n=this.terrainModels[t+8*e];for(let t=0;t<n.numVertices;t++)if(n.vertexX[t]===i*this.anInt585&&n.vertexZ[t]===s*this.anInt585)return void n.setVertexAmbience(t,r)}getWallRoof(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),this.wallsRoof.get(i,48*t+e)}getElevation(t,e){let i=t>>7,s=e>>7,r=127&t,n=127&e;if(i<0||s<0||i>=95||s>=95)return 0;let o=0,h=0,a=0;return r<=this.anInt585-n?(o=this.getTerrainHeight(i,s),h=this.getTerrainHeight(i+1,s)-o,a=this.getTerrainHeight(i,s+1)-o):(o=this.getTerrainHeight(i+1,s+1),h=this.getTerrainHeight(i,s+1)-o,a=this.getTerrainHeight(i+1,s)-o,r=this.anInt585-r,n=this.anInt585-n),o+(h*r/this.anInt585|0)+(a*n/this.anInt585|0)}getWallDiagonal(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),this.wallsDiagonal.get(i,48*t+e)}removeObject2(t,e,i){if(!(t<0||e<0||t>=95||e>=95||1!==s.objectType[i]&&2!==s.objectType[i])){let r=this.getTileDirection(t,e),n=0,o=0;0===r||4===r?(n=s.objectWidth[i],o=s.objectHeight[i]):(o=s.objectWidth[i],n=s.objectHeight[i]);for(let h=t;h<t+n;h++)for(let t=e;t<e+o;t++){const e=this.objectAdjacency.get(h,t);1===s.objectType[i]?this.objectAdjacency.set(h,t,64|e):0===r?(this.objectAdjacency.set(h,t,2|e),h>0&&this._setObjectAdjacency_from3(h-1,t,8)):2===r?(this.objectAdjacency.set(h,t,4|e),t<95&&this._setObjectAdjacency_from3(h,t+1,1)):4===r?(this.objectAdjacency.set(h,t,8|e),h<95&&this._setObjectAdjacency_from3(h+1,t,2)):6===r&&(this.objectAdjacency.set(h,t,1|e),t>0&&this._setObjectAdjacency_from3(h,t-1,4))}this.method404(t,e,n,o)}}removeWallObject(t,e,i,r){if(!(t<0||e<0||t>=95||e>=95)&&1===s.wallObjectAdjacent[r]){const s=this.objectAdjacency.get(t,e);0===i?(this.objectAdjacency.set(t,e,65534&s),e>0&&this.method407(t,e-1,4)):1===i?(this.objectAdjacency.set(t,e,65533&s),t>0&&this.method407(t-1,e,8)):2===i?this.objectAdjacency.set(t,e,65519&s):3===i&&this.objectAdjacency.set(t,e,65503&s),this.method404(t,e,1,1)}}method402(t,e,i,s,r){let n=3*t,o=3*e,h=this.scene.method302(s),a=this.scene.method302(r);if(h=h>>1&8355711,a=a>>1&8355711,0===i)return this.surface.drawLineHoriz(n,o,3,h),this.surface.drawLineHoriz(n,o+1,2,h),this.surface.drawLineHoriz(n,o+2,1,h),this.surface.drawLineHoriz(n+2,o+1,1,a),void this.surface.drawLineHoriz(n+1,o+2,2,a);1===i&&(this.surface.drawLineHoriz(n,o,3,a),this.surface.drawLineHoriz(n+1,o+1,2,a),this.surface.drawLineHoriz(n+2,o+2,1,a),this.surface.drawLineHoriz(n,o+1,1,h),this.surface.drawLineHoriz(n,o+2,2,h))}_loadSection_from4I(t,e,i,s){const r="m"+i+(t/10|0)+t%10+(e/10|0)+e%10;if(!this.landscapePack)return;let n=o.loadData(r+".hei",0,this.landscapePack);if(!n&&this.memberLandscapePack&&(n=o.loadData(r+".hei",0,this.memberLandscapePack)),n&&n.length){let t=0,e=0;for(let i=0;i<2304;){let r=255&n[t++];if(r<128&&(this.terrainHeight.set(s,i++,255&r),e=r),r>=128)for(let t=0;t<r-128;t++)this.terrainHeight.set(s,i++,255&e)}e=64;for(let t=0;t<48;t++)for(let i=0;i<48;i++)e=this.terrainHeight.get(s,48*i+t)+e&127,this.terrainHeight.set(s,48*i+t,2*e&255);e=0;for(let i=0;i<2304;){let r=255&n[t++];if(r<128&&(this.terrainColour.set(s,i++,255&r),e=r),r>=128)for(let t=0;t<r-128;t++)this.terrainColour.set(s,i++,255&e)}e=35;for(let t=0;t<48;t++)for(let i=0;i<48;i++)e=this.terrainColour.get(s,48*i+t)+e&127,this.terrainColour.set(s,48*i+t,2*e&255)}else for(let t=0;t<2304;t++)this.terrainHeight.set(s,t,0),this.terrainColour.set(s,t,0);if(n=o.loadData(r+".dat",0,this.mapPack),!n&&this.memberMapPack&&(n=o.loadData(r+".dat",0,this.memberMapPack)),n&&n.length){let t=0;for(let e=0;e<2304;e++)this.wallsNorthSouth.set(s,e,n[t++]);for(let e=0;e<2304;e++)this.wallsEastWest.set(s,e,n[t++]);for(let e=0;e<2304;e++)this.wallsDiagonal.set(s,e,255&n[t++]);for(let e=0;e<2304;e++){let i=255&n[t++];i>0&&this.wallsDiagonal.set(s,e,i+12e3)}for(let e=0;e<2304;){let i=255&n[t++];if(i<128)this.wallsRoof.set(s,e++,255&i);else for(let t=0;t<i-128;t++)this.wallsRoof.set(s,e++,0)}let e=0;for(let i=0;i<2304;){let r=255&n[t++];if(r<128)this.tileDecoration.set(s,i++,255&r),e=r;else for(let t=0;t<r-128;t++)this.tileDecoration.set(s,i++,e)}for(let e=0;e<2304;){let i=255&n[t++];if(i<128)this.tileDirection.set(s,e++,255&i);else for(let t=0;t<i-128;t++)this.tileDirection.set(s,e++,0)}if(n=o.loadData(r+".loc",0,this.mapPack),n&&n.length){t=0;for(let e=0;e<2304;){let i=255&n[t++];i<128?this.wallsDiagonal.set(s,e++,i+48e3):e+=i-128}return}}else for(let t=0;t<2304;t++)this.terrainHeight.set(s,t,0),this.terrainColour.set(s,t,0),this.wallsNorthSouth.set(s,t,0),this.wallsEastWest.set(s,t,0),this.wallsDiagonal.set(s,t,0),this.wallsRoof.set(s,t,0),this.tileDecoration.set(s,t,0),0===i&&this.tileDecoration.set(s,t,-6),3===i&&this.tileDecoration.set(s,t,8),this.tileDirection.set(s,t,0)}loadSection(){switch(arguments.length){case 3:return this._loadSection_from3(...arguments);case 4:return"number"==typeof(arguments.length<=3?void 0:arguments[3])?this._loadSection_from4I(...arguments):this._loadSection_from4(...arguments)}}method404(t,e,i,s){if(!(t<1||e<1||t+i>=this.regionWidth||e+s>=this.regionHeight))for(let r=t;r<=t+i;r++)for(let t=e;t<=e+s;t++)0!=(99&this.getObjectAdjacency(r,t))||0!=(89&this.getObjectAdjacency(r-1,t))||0!=(86&this.getObjectAdjacency(r,t-1))||0!=(108&this.getObjectAdjacency(r-1,t-1))?this.method425(r,t,35):this.method425(r,t,0)}getObjectAdjacency(t,e){return t<0||e<0||t>=this.regionWidth||e>=this.regionHeight?0:this.objectAdjacency.get(t,e)}hasRoof(t,e){return this.getWallRoof(t,e)>0&&this.getWallRoof(t-1,e)>0&&this.getWallRoof(t-1,e-1)>0&&this.getWallRoof(t,e-1)>0}method407(t,e,i){const s=this.objectAdjacency.get(t,e);this.objectAdjacency.set(t,e,s&65535-i)}getTerrainColour(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),255&this.terrainColour.get(i,48*t+e)}reset(){this.worldInitialised&&this.scene.dispose();for(let t=0;t<64;t++){this.terrainModels[t]=null;for(let e=0;e<4;e++)this.wallModels[e][t]=null;for(let e=0;e<4;e++)this.roofModels[e][t]=null}}setTiles(){for(let t=0;t<this.regionWidth;t++)for(let e=0;e<this.regionHeight;e++)250===this.getTileDecoration(t,e,0)&&(47===t&&250!==this.getTileDecoration(t+1,e,0)&&2!==this.getTileDecoration(t+1,e,0)||47===e&&250!==this.getTileDecoration(t,e+1,0)&&2!==this.getTileDecoration(t,e+1,0)?this.setTileDecoration(t,e,9):this.setTileDecoration(t,e,2))}getWallNorthSouth(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),255&this.wallsNorthSouth.get(i,48*t+e)}getTileDirection(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),this.tileDirection.get(i,48*t+e)}_getTileDecoration_from4(t,e,i,r){const n=this._getTileDecoration_from3(t,e);return 0===n?r:s.tileDecoration[n-1]}_getTileDecoration_from3(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),255&this.tileDecoration.get(i,48*t+e)}getTileDecoration(){switch(arguments.length){case 3:return this._getTileDecoration_from3(...arguments);case 4:return this._getTileDecoration_from4(...arguments)}}setTileDecoration(t,e,i){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return;let s=0;t>=48&&e<48?(s=1,t-=48):t<48&&e>=48?(s=2,e-=48):t>=48&&e>=48&&(s=3,t-=48,e-=48),this.tileDecoration.set(s,48*t+e,255&i)}route(t,e,i,s,r,n,o,h,a){for(let t=0;t<this.regionWidth;t++)for(let e=0;e<this.regionHeight;e++)this.routeVia.set(t,e,0);let l=0,c=0,u=t,d=e;this.routeVia.set(t,e,99),o[l]=t,h[l++]=e;let f,m=o.length,p=!1;for(;c!==l;){if(u=o[c],d=h[c],c=(c+1)%m,u>=i&&u<=r&&d>=s&&d<=n){p=!0;break}if(a){if(u>0&&u-1>=i&&u-1<=r&&d>=s&&d<=n&&0==(8&this.objectAdjacency.get(u-1,d))){p=!0;break}if(u<95&&u+1>=i&&u+1<=r&&d>=s&&d<=n&&0==(2&this.objectAdjacency.get(u+1,d))){p=!0;break}if(d>0&&u>=i&&u<=r&&d-1>=s&&d-1<=n&&0==(4&this.objectAdjacency.get(u,d-1))){p=!0;break}if(d<95&&u>=i&&u<=r&&d+1>=s&&d+1<=n&&0==(1&this.objectAdjacency.get(u,d+1))){p=!0;break}}u>0&&0===this.routeVia.get(u-1,d)&&0==(120&this.objectAdjacency.get(u-1,d))&&(o[l]=u-1,h[l]=d,l=(l+1)%m,this.routeVia.set(u-1,d,2)),u<95&&0===this.routeVia.get(u+1,d)&&0==(114&this.objectAdjacency.get(u+1,d))&&(o[l]=u+1,h[l]=d,l=(l+1)%m,this.routeVia.set(u+1,d,8)),d>0&&0===this.routeVia.get(u,d-1)&&0==(116&this.objectAdjacency.get(u,d-1))&&(o[l]=u,h[l]=d-1,l=(l+1)%m,this.routeVia.set(u,d-1,1)),d<95&&0===this.routeVia.get(u,d+1)&&0==(113&this.objectAdjacency.get(u,d+1))&&(o[l]=u,h[l]=d+1,l=(l+1)%m,this.routeVia.set(u,d+1,4)),u>0&&d>0&&0==(116&this.objectAdjacency.get(u,d-1))&&0==(120&this.objectAdjacency.get(u-1,d))&&0==(124&this.objectAdjacency.get(u-1,d-1))&&0===this.routeVia.get(u-1,d-1)&&(o[l]=u-1,h[l]=d-1,l=(l+1)%m,this.routeVia.set(u-1,d-1,3)),u<95&&d>0&&0==(116&this.objectAdjacency.get(u,d-1))&&0==(114&this.objectAdjacency.get(u+1,d))&&0==(118&this.objectAdjacency.get(u+1,d-1))&&0===this.routeVia.get(u+1,d-1)&&(o[l]=u+1,h[l]=d-1,l=(l+1)%m,this.routeVia.set(u+1,d-1,9)),u>0&&d<95&&0==(113&this.objectAdjacency.get(u,d+1))&&0==(120&this.objectAdjacency.get(u-1,d))&&0==(121&this.objectAdjacency.get(u-1,d+1))&&0===this.routeVia.get(u-1,d+1)&&(o[l]=u-1,h[l]=d+1,l=(l+1)%m,this.routeVia.set(u-1,d+1,6)),u<95&&d<95&&0==(113&this.objectAdjacency.get(u,d+1))&&0==(114&this.objectAdjacency.get(u+1,d))&&0==(115&this.objectAdjacency.get(u+1,d+1))&&0===this.routeVia.get(u+1,d+1)&&(o[l]=u+1,h[l]=d+1,l=(l+1)%m,this.routeVia.set(u+1,d+1,12))}if(!p)return-1;c=0,o[c]=u,h[c++]=d;for(let i=f=this.routeVia.get(u,d);u!==t||d!==e;i=this.routeVia.get(u,d))i!==f&&(f=i,o[c]=u,h[c++]=d),0!=(2&i)?u++:0!=(8&i)&&u--,0!=(1&i)?d++:0!=(4&i)&&d--;return c}_setObjectAdjacency_from4(t,e,i,r){if(!(t<0||e<0||t>=95||e>=95)&&1===s.wallObjectAdjacent[r]){const s=this.objectAdjacency.get(t,e);0===i?(this.objectAdjacency.set(t,e,1|s),e>0&&this._setObjectAdjacency_from3(t,e-1,4)):1===i?(this.objectAdjacency.set(t,e,2|s),t>0&&this._setObjectAdjacency_from3(t-1,e,8)):2===i?this.objectAdjacency.set(t,e,16|s):3===i&&this.objectAdjacency.set(t,e,32|s),this.method404(t,e,1,1)}}setObjectAdjacency(){switch(arguments.length){case 4:return this._setObjectAdjacency_from4(...arguments);case 3:return this._setObjectAdjacency_from3(...arguments)}}_loadSection_from4(t,e,i,r){let o=(t+24)/48|0,h=(e+24)/48|0;if(this._loadSection_from4I(o-1,h-1,i,0),this._loadSection_from4I(o,h-1,i,1),this._loadSection_from4I(o-1,h,i,2),this._loadSection_from4I(o,h,i,3),this.setTiles(),null===this.parentModel&&(this.parentModel=n._from7(18688,18688,!0,!0,!1,!1,!0)),r){this.surface.blackScreen();for(let t=0;t<this.regionWidth;t++)for(let e=0;e<this.regionHeight;e++)this.objectAdjacency.set(t,e,0);let t=this.parentModel;t.clear();for(let e=0;e<this.regionWidth;e++)for(let r=0;r<this.regionHeight;r++){let n=-this.getTerrainHeight(e,r);this.getTileDecoration(e,r,i)>0&&4===s.tileType[this.getTileDecoration(e,r,i)-1]&&(n=0),this.getTileDecoration(e-1,r,i)>0&&4===s.tileType[this.getTileDecoration(e-1,r,i)-1]&&(n=0),this.getTileDecoration(e,r-1,i)>0&&4===s.tileType[this.getTileDecoration(e,r-1,i)-1]&&(n=0),this.getTileDecoration(e-1,r-1,i)>0&&4===s.tileType[this.getTileDecoration(e-1,r-1,i)-1]&&(n=0);let o=t.vertexAt(e*this.anInt585,n,r*this.anInt585),h=(10*Math.random()|0)-5;t.setVertexAmbience(o,h)}for(let e=0;e<95;e++)for(let r=0;r<95;r++){let n=this.getTerrainColour(e,r),o=this.terrainColours[n],h=o,l=o,c=0;if(1!==i&&2!==i||(o=a.colourTransparent,h=a.colourTransparent,l=a.colourTransparent),this.getTileDecoration(e,r,i)>0){let t=this.getTileDecoration(e,r,i),n=s.tileType[t-1],u=this.getTileType(e,r,i);if(o=h=s.tileDecoration[t-1],4===n&&(o=1,h=1,12===t&&(o=31,h=31)),5===n?this.getWallDiagonal(e,r)>0&&this.getWallDiagonal(e,r)<24e3&&(this.getTileDecoration(e-1,r,i,l)!==a.colourTransparent&&this.getTileDecoration(e,r-1,i,l)!==a.colourTransparent?(o=this.getTileDecoration(e-1,r,i,l),c=0):this.getTileDecoration(e+1,r,i,l)!==a.colourTransparent&&this.getTileDecoration(e,r+1,i,l)!==a.colourTransparent?(h=this.getTileDecoration(e+1,r,i,l),c=0):this.getTileDecoration(e+1,r,i,l)!==a.colourTransparent&&this.getTileDecoration(e,r-1,i,l)!==a.colourTransparent?(h=this.getTileDecoration(e+1,r,i,l),c=1):this.getTileDecoration(e-1,r,i,l)!==a.colourTransparent&&this.getTileDecoration(e,r+1,i,l)!==a.colourTransparent&&(o=this.getTileDecoration(e-1,r,i,l),c=1)):(2!==n||this.getWallDiagonal(e,r)>0&&this.getWallDiagonal(e,r)<24e3)&&(this.getTileType(e-1,r,i)!==u&&this.getTileType(e,r-1,i)!==u?(o=l,c=0):this.getTileType(e+1,r,i)!==u&&this.getTileType(e,r+1,i)!==u?(h=l,c=0):this.getTileType(e+1,r,i)!==u&&this.getTileType(e,r-1,i)!==u?(h=l,c=1):this.getTileType(e-1,r,i)!==u&&this.getTileType(e,r+1,i)!==u&&(o=l,c=1)),0!==s.tileAdjacent[t-1]){const t=this.objectAdjacency.get(e,r);this.objectAdjacency.set(e,r,64|t)}if(2===s.tileType[t-1]){const t=this.objectAdjacency.get(e,r);this.objectAdjacency.set(e,r,128|t)}}this.method402(e,r,c,o,h);let u=this.getTerrainHeight(e+1,r+1)-this.getTerrainHeight(e+1,r)+this.getTerrainHeight(e,r+1)-this.getTerrainHeight(e,r);if(o!==h||0!==u){let i=new Int32Array(3),s=new Int32Array(3);if(0===c){if(o!==a.colourTransparent){i[0]=r+96*e+96,i[1]=r+96*e,i[2]=r+96*e+1;let s=t.createFace(3,i,a.colourTransparent,o);this.localX[s]=e,this.localY[s]=r,t.faceTag[s]=2e5+s}if(h!==a.colourTransparent){s[0]=r+96*e+1,s[1]=r+96*e+96+1,s[2]=r+96*e+96;let i=t.createFace(3,s,a.colourTransparent,h);this.localX[i]=e,this.localY[i]=r,t.faceTag[i]=2e5+i}}else{if(o!==a.colourTransparent){i[0]=r+96*e+1,i[1]=r+96*e+96+1,i[2]=r+96*e;let s=t.createFace(3,i,a.colourTransparent,o);this.localX[s]=e,this.localY[s]=r,t.faceTag[s]=2e5+s}if(h!==a.colourTransparent){s[0]=r+96*e+96,s[1]=r+96*e,s[2]=r+96*e+96+1;let i=t.createFace(3,s,a.colourTransparent,h);this.localX[i]=e,this.localY[i]=r,t.faceTag[i]=2e5+i}}}else if(o!==a.colourTransparent){let i=new Int32Array(4);i[0]=r+96*e+96,i[1]=r+96*e,i[2]=r+96*e+1,i[3]=r+96*e+96+1;let s=t.createFace(4,i,a.colourTransparent,o);this.localX[s]=e,this.localY[s]=r,t.faceTag[s]=2e5+s}}for(let e=1;e<95;e++)for(let r=1;r<95;r++)if(this.getTileDecoration(e,r,i)>0&&4===s.tileType[this.getTileDecoration(e,r,i)-1]){let n=s.tileDecoration[this.getTileDecoration(e,r,i)-1],o=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,r),r*this.anInt585),h=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,r),r*this.anInt585),l=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,r+1),(r+1)*this.anInt585),c=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,r+1),(r+1)*this.anInt585),u=new Int32Array([o,h,l,c]),d=t.createFace(4,u,n,a.colourTransparent);this.localX[d]=e,this.localY[d]=r,t.faceTag[d]=2e5+d,this.method402(e,r,0,n,n)}else if(0===this.getTileDecoration(e,r,i)||3!==s.tileType[this.getTileDecoration(e,r,i)-1]){if(this.getTileDecoration(e,r+1,i)>0&&4===s.tileType[this.getTileDecoration(e,r+1,i)-1]){let n=s.tileDecoration[this.getTileDecoration(e,r+1,i)-1],o=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,r),r*this.anInt585),h=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,r),r*this.anInt585),l=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,r+1),(r+1)*this.anInt585),c=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,r+1),(r+1)*this.anInt585),u=new Int32Array([o,h,l,c]),d=t.createFace(4,u,n,a.colourTransparent);this.localX[d]=e,this.localY[d]=r,t.faceTag[d]=2e5+d,this.method402(e,r,0,n,n)}if(this.getTileDecoration(e,r-1,i)>0&&4===s.tileType[this.getTileDecoration(e,r-1,i)-1]){let n=s.tileDecoration[this.getTileDecoration(e,r-1,i)-1],o=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,r),r*this.anInt585),h=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,r),r*this.anInt585),l=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,r+1),(r+1)*this.anInt585),c=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,r+1),(r+1)*this.anInt585),u=new Int32Array([o,h,l,c]),d=t.createFace(4,u,n,a.colourTransparent);this.localX[d]=e,this.localY[d]=r,t.faceTag[d]=2e5+d,this.method402(e,r,0,n,n)}if(this.getTileDecoration(e+1,r,i)>0&&4===s.tileType[this.getTileDecoration(e+1,r,i)-1]){let n=s.tileDecoration[this.getTileDecoration(e+1,r,i)-1],o=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,r),r*this.anInt585),h=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,r),r*this.anInt585),l=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,r+1),(r+1)*this.anInt585),c=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,r+1),(r+1)*this.anInt585),u=new Int32Array([o,h,l,c]),d=t.createFace(4,u,n,a.colourTransparent);this.localX[d]=e,this.localY[d]=r,t.faceTag[d]=2e5+d,this.method402(e,r,0,n,n)}if(this.getTileDecoration(e-1,r,i)>0&&4===s.tileType[this.getTileDecoration(e-1,r,i)-1]){let n=s.tileDecoration[this.getTileDecoration(e-1,r,i)-1],o=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,r),r*this.anInt585),h=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,r),r*this.anInt585),l=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,r+1),(r+1)*this.anInt585),c=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,r+1),(r+1)*this.anInt585),u=new Int32Array([o,h,l,c]),d=t.createFace(4,u,n,a.colourTransparent);this.localX[d]=e,this.localY[d]=r,t.faceTag[d]=2e5+d,this.method402(e,r,0,n,n)}}t._setLight_from6(!0,40,48,-50,-10,-50),this.terrainModels=this.parentModel.split(0,0,1536,1536,8,64,233,!1);for(let t=0;t<64;t++)this.scene.addModel(this.terrainModels[t]);for(let t=0;t<this.regionWidth;t++)for(let e=0;e<this.regionHeight;e++)this.terrainHeightLocal.set(t,e,this.getTerrainHeight(t,e))}this.parentModel.clear();let l=6316128;for(let t=0;t<95;t++)for(let e=0;e<95;e++){let i=this.getWallEastWest(t,e);if(i>0&&(0===s.wallObjectInvisible[i-1]||this.aBoolean592)){if(this.method422(this.parentModel,i-1,t,e,t+1,e),r&&0!==s.wallObjectAdjacent[i-1]){const i=this.objectAdjacency.get(t,e);this.objectAdjacency.set(t,e,1|i),e>0&&this._setObjectAdjacency_from3(t,e-1,4)}r&&this.surface.drawLineHoriz(3*t,3*e,3,l)}if(i=this.getWallNorthSouth(t,e),i>0&&(0===s.wallObjectInvisible[i-1]||this.aBoolean592)){if(this.method422(this.parentModel,i-1,t,e,t,e+1),r&&0!==s.wallObjectAdjacent[i-1]){const i=this.objectAdjacency.get(t,e);this.objectAdjacency.set(t,e,2|i),t>0&&this._setObjectAdjacency_from3(t-1,e,8)}r&&this.surface.drawLineVert(3*t,3*e,3,l)}if(i=this.getWallDiagonal(t,e),i>0&&i<12e3&&(0===s.wallObjectInvisible[i-1]||this.aBoolean592)){if(this.method422(this.parentModel,i-1,t,e,t+1,e+1),r&&0!==s.wallObjectAdjacent[i-1]){const i=this.objectAdjacency.get(t,e);this.objectAdjacency.set(t,e,32|i)}r&&(this.surface.setPixel(3*t,3*e,l),this.surface.setPixel(3*t+1,3*e+1,l),this.surface.setPixel(3*t+2,3*e+2,l))}if(i>12e3&&i<24e3&&(0===s.wallObjectInvisible[i-12001]||this.aBoolean592)){if(this.method422(this.parentModel,i-12001,t+1,e,t,e+1),r&&0!==s.wallObjectAdjacent[i-12001]){const i=this.objectAdjacency.get(t,e);this.objectAdjacency.set(t,e,16|i)}r&&(this.surface.setPixel(3*t+2,3*e,l),this.surface.setPixel(3*t+1,3*e+1,l),this.surface.setPixel(3*t,3*e+2,l))}}r&&this.surface.drawSpriteMinimap(this.baseMediaSprite-1,0,0,285,285),this.parentModel._setLight_from6(!1,60,24,-50,-10,-50),this.wallModels[i]=this.parentModel.split(0,0,1536,1536,8,64,338,!0);for(let t=0;t<64;t++)this.scene.addModel(this.wallModels[i][t]);for(let t=0;t<95;t++)for(let e=0;e<95;e++){let i=this.getWallEastWest(t,e);i>0&&this.method428(i-1,t,e,t+1,e),i=this.getWallNorthSouth(t,e),i>0&&this.method428(i-1,t,e,t,e+1),i=this.getWallDiagonal(t,e),i>0&&i<12e3&&this.method428(i-1,t,e,t+1,e+1),i>12e3&&i<24e3&&this.method428(i-12001,t+1,e,t,e+1)}for(let t=1;t<95;t++)for(let e=1;e<95;e++)if(this.getWallRoof(t,e)>0){let i=t,s=e,r=t+1,n=e,o=t+1,h=e+1,a=t,l=e+1,c=0,u=this.terrainHeightLocal.get(i,s),d=this.terrainHeightLocal.get(r,n),f=this.terrainHeightLocal.get(o,h),m=this.terrainHeightLocal.get(a,l);if(u>8e4&&(u-=8e4),d>8e4&&(d-=8e4),f>8e4&&(f-=8e4),m>8e4&&(m-=8e4),u>c&&(c=u),d>c&&(c=d),f>c&&(c=f),m>c&&(c=m),c>=8e4&&(c-=8e4),u<8e4)this.terrainHeightLocal.set(i,s,c);else{const t=this.terrainHeightLocal.get(i,s);this.terrainHeightLocal.set(i,s,t-8e4)}if(d<8e4)this.terrainHeightLocal.set(r,n,c);else{const t=this.terrainHeightLocal.get(r,n);this.terrainHeightLocal.set(r,n,t-8e4)}if(f<8e4)this.terrainHeightLocal.set(o,h,c);else{const t=this.terrainHeightLocal.get(o,h);this.terrainHeightLocal.set(o,h,t-8e4)}if(m<8e4)this.terrainHeightLocal.set(a,l,c);else{const t=this.terrainHeightLocal.get(a,l);this.terrainHeightLocal.set(a,l,t-8e4)}}this.parentModel.clear();for(let t=1;t<95;t++)for(let e=1;e<95;e++){let i=this.getWallRoof(t,e);if(i>0){let r=t,n=e,o=t+1,h=e,l=t+1,c=e+1,u=t,d=e+1,f=t*this.anInt585,m=e*this.anInt585,p=f+this.anInt585,g=m+this.anInt585,y=f,w=m,b=p,C=g,I=this.terrainHeightLocal.get(r,n),S=this.terrainHeightLocal.get(o,h),v=this.terrainHeightLocal.get(l,c),x=this.terrainHeightLocal.get(u,d),T=s.roofHeight[i-1];this.hasRoof(r,n)&&I<8e4&&(I+=T+8e4,this.terrainHeightLocal.set(r,n,I)),this.hasRoof(o,h)&&S<8e4&&(S+=T+8e4,this.terrainHeightLocal.set(o,h,S)),this.hasRoof(l,c)&&v<8e4&&(v+=T+8e4,this.terrainHeightLocal.set(l,c,v)),this.hasRoof(u,d)&&x<8e4&&(x+=T+8e4,this.terrainHeightLocal.set(u,d,x)),I>=8e4&&(I-=8e4),S>=8e4&&(S-=8e4),v>=8e4&&(v-=8e4),x>=8e4&&(x-=8e4);let A=16;if(this.method427(r-1,n)||(f-=A),this.method427(r+1,n)||(f+=A),this.method427(r,n-1)||(m-=A),this.method427(r,n+1)||(m+=A),this.method427(o-1,h)||(p-=A),this.method427(o+1,h)||(p+=A),this.method427(o,h-1)||(w-=A),this.method427(o,h+1)||(w+=A),this.method427(l-1,c)||(b-=A),this.method427(l+1,c)||(b+=A),this.method427(l,c-1)||(g-=A),this.method427(l,c+1)||(g+=A),this.method427(u-1,d)||(y-=A),this.method427(u+1,d)||(y+=A),this.method427(u,d-1)||(C-=A),this.method427(u,d+1)||(C+=A),i=s.roofNumVertices[i-1],I=-I,S=-S,v=-v,x=-x,this.getWallDiagonal(t,e)>12e3&&this.getWallDiagonal(t,e)<24e3&&0===this.getWallRoof(t-1,e-1)){let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(b,v,g),t[1]=this.parentModel.vertexAt(y,x,C),t[2]=this.parentModel.vertexAt(p,S,w),this.parentModel.createFace(3,t,i,a.colourTransparent)}else if(this.getWallDiagonal(t,e)>12e3&&this.getWallDiagonal(t,e)<24e3&&0===this.getWallRoof(t+1,e+1)){let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(f,I,m),t[1]=this.parentModel.vertexAt(p,S,w),t[2]=this.parentModel.vertexAt(y,x,C),this.parentModel.createFace(3,t,i,a.colourTransparent)}else if(this.getWallDiagonal(t,e)>0&&this.getWallDiagonal(t,e)<12e3&&0===this.getWallRoof(t+1,e-1)){let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(y,x,C),t[1]=this.parentModel.vertexAt(f,I,m),t[2]=this.parentModel.vertexAt(b,v,g),this.parentModel.createFace(3,t,i,a.colourTransparent)}else if(this.getWallDiagonal(t,e)>0&&this.getWallDiagonal(t,e)<12e3&&0===this.getWallRoof(t-1,e+1)){let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(p,S,w),t[1]=this.parentModel.vertexAt(b,v,g),t[2]=this.parentModel.vertexAt(f,I,m),this.parentModel.createFace(3,t,i,a.colourTransparent)}else if(I===S&&v===x){let t=new Int32Array(4);t[0]=this.parentModel.vertexAt(f,I,m),t[1]=this.parentModel.vertexAt(p,S,w),t[2]=this.parentModel.vertexAt(b,v,g),t[3]=this.parentModel.vertexAt(y,x,C),this.parentModel.createFace(4,t,i,a.colourTransparent)}else if(I===x&&S===v){let t=new Int32Array(4);t[0]=this.parentModel.vertexAt(y,x,C),t[1]=this.parentModel.vertexAt(f,I,m),t[2]=this.parentModel.vertexAt(p,S,w),t[3]=this.parentModel.vertexAt(b,v,g),this.parentModel.createFace(4,t,i,a.colourTransparent)}else{let s=!0;if(this.getWallRoof(t-1,e-1)>0&&(s=!1),this.getWallRoof(t+1,e+1)>0&&(s=!1),s){let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(f,I,m),t[1]=this.parentModel.vertexAt(p,S,w),t[2]=this.parentModel.vertexAt(y,x,C),this.parentModel.createFace(3,t,i,a.colourTransparent);let e=new Int32Array(3);e[0]=this.parentModel.vertexAt(b,v,g),e[1]=this.parentModel.vertexAt(y,x,C),e[2]=this.parentModel.vertexAt(p,S,w),this.parentModel.createFace(3,e,i,a.colourTransparent)}else{let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(p,S,w),t[1]=this.parentModel.vertexAt(b,v,g),t[2]=this.parentModel.vertexAt(f,I,m),this.parentModel.createFace(3,t,i,a.colourTransparent);let e=new Int32Array(3);e[0]=this.parentModel.vertexAt(y,x,C),e[1]=this.parentModel.vertexAt(f,I,m),e[2]=this.parentModel.vertexAt(b,v,g),this.parentModel.createFace(3,e,i,a.colourTransparent)}}}}this.parentModel._setLight_from6(!0,50,50,-50,-10,-50),this.roofModels[i]=this.parentModel.split(0,0,1536,1536,8,64,169,!0);for(let t=0;t<64;t++)this.scene.addModel(this.roofModels[i][t]);if(null===this.roofModels[i][0])throw new EvalError("null roof!");for(let t=0;t<this.regionWidth;t++)for(let e=0;e<this.regionHeight;e++)if(this.terrainHeightLocal.get(t,e)>=8e4){const i=this.terrainHeightLocal.get(t,e);this.terrainHeightLocal.set(t,e,i-8e4)}}_setObjectAdjacency_from3(t,e,i){const s=this.objectAdjacency.get(t,e);this.objectAdjacency.set(t,e,s|i)}getTileType(t,e,i){let r=this.getTileDecoration(t,e,i);return 0===r?-1:2!==s.tileType[r-1]?0:1}addModels(t){for(let e=0;e<94;e++)for(let i=0;i<94;i++)if(this.getWallDiagonal(e,i)>48e3&&this.getWallDiagonal(e,i)<6e4){let r=this.getWallDiagonal(e,i)-48001,n=this.getTileDirection(e,i),o=0,h=0;0===n||4===n?(o=s.objectWidth[r],h=s.objectHeight[r]):(h=s.objectWidth[r],o=s.objectHeight[r]),this.removeObject2(e,i,r);let a=t[s.objectModelIndex[r]].copy(!1,!0,!1,!1),l=(e+e+o)*this.anInt585/2|0,c=(i+i+h)*this.anInt585/2|0;if(a.translate(l,-this.getElevation(l,c),c),a.orient(0,32*this.getTileDirection(e,i),0),this.scene.addModel(a),a._setLight_from5(48,48,-50,-10,-50),o>1||h>1)for(let t=e;t<e+o;t++)for(let s=i;s<i+h;s++)if((t>e||s>i)&&this.getWallDiagonal(t,s)-48001===r){let e=t,i=s,r=0;e>=48&&i<48?(r=1,e-=48):e<48&&i>=48?(r=2,i-=48):e>=48&&i>=48&&(r=3,e-=48,i-=48),this.wallsDiagonal.set(r,48*e+i,0)}}}method422(t,e,i,r,n,o){this.method425(i,r,40),this.method425(n,o,40);let h=s.wallObjectHeight[e],a=s.wallObjectTextureFront[e],l=s.wallObjectTextureBack[e],c=i*this.anInt585,u=r*this.anInt585,d=n*this.anInt585,f=o*this.anInt585,m=t.vertexAt(c,-this.terrainHeightLocal.get(i,r),u),p=t.vertexAt(c,-this.terrainHeightLocal.get(i,r)-h,u),g=t.vertexAt(d,-this.terrainHeightLocal.get(n,o)-h,f),y=t.vertexAt(d,-this.terrainHeightLocal.get(n,o),f),w=new Int32Array([m,p,g,y]),b=t.createFace(4,w,a,l);return 5===s.wallObjectInvisible[e]?void(t.faceTag[b]=3e4+e):void(t.faceTag[b]=0)}getTerrainHeight(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),3*(255&this.terrainHeight.get(i,48*t+e))}_loadSection_from3(t,e,i){this.reset();let s=(t+24)/48|0,r=(e+24)/48|0;this._loadSection_from4(t,e,i,!0),0===i&&(this._loadSection_from4(t,e,1,!1),this._loadSection_from4(t,e,2,!1),this._loadSection_from4I(s-1,r-1,i,0),this._loadSection_from4I(s,r-1,i,1),this._loadSection_from4I(s-1,r,i,2),this._loadSection_from4I(s,r,i,3),this.setTiles())}method425(t,e,i){let s=t/12|0,r=e/12|0,n=(t-1)/12|0,o=(e-1)/12|0;this.setTerrainAmbience(s,r,t,e,i),s!==n&&this.setTerrainAmbience(n,r,t,e,i),r!==o&&this.setTerrainAmbience(s,o,t,e,i),s!==n&&r!==o&&this.setTerrainAmbience(n,o,t,e,i)}removeObject(t,e,i){if(!(t<0||e<0||t>=95||e>=95||1!==s.objectType[i]&&2!==s.objectType[i])){let r=this.getTileDirection(t,e),n=0,o=0;0===r||4===r?(n=s.objectWidth[i],o=s.objectHeight[i]):(o=s.objectWidth[i],n=s.objectHeight[i]);for(let h=t;h<t+n;h++)for(let t=e;t<e+o;t++){const e=this.objectAdjacency.get(h,t);1===s.objectType[i]?this.objectAdjacency.set(h,t,65471&e):0===r?(this.objectAdjacency.set(h,t,65533&e),h>0&&this.method407(h-1,t,8)):2===r?(this.objectAdjacency.set(h,t,65531&e),t<95&&this.method407(h,t+1,1)):4===r?(this.objectAdjacency.set(h,t,65527&e),h<95&&this.method407(h+1,t,2)):6===r&&(this.objectAdjacency.set(h,t,65534&e),t>0&&this.method407(h,t-1,4))}this.method404(t,e,n,o)}}method427(t,e){return this.getWallRoof(t,e)>0||this.getWallRoof(t-1,e)>0||this.getWallRoof(t-1,e-1)>0||this.getWallRoof(t,e-1)>0}method428(t,e,i,r,n){let o=s.wallObjectHeight[t];const h=this.terrainHeightLocal.get(e,i);h<8e4&&this.terrainHeightLocal.set(e,i,h+8e4+o);const a=this.terrainHeightLocal.get(r,n);a<8e4&&this.terrainHeightLocal.set(r,n,a+8e4+o)}}a.colourTransparent=12345678,t.exports=a},5623:t=>{"use strict";function e(t,e,r){t instanceof RegExp&&(t=i(t,r)),e instanceof RegExp&&(e=i(e,r));var n=s(t,e,r);return n&&{start:n[0],end:n[1],pre:r.slice(0,n[0]),body:r.slice(n[0]+t.length,n[1]),post:r.slice(n[1]+e.length)}}function i(t,e){var i=e.match(t);return i?i[0]:null}function s(t,e,i){var s,r,n,o,h,a=i.indexOf(t),l=i.indexOf(e,a+1),c=a;if(a>=0&&l>0){if(t===e)return[a,l];for(s=[],n=i.length;c>=0&&!h;)c==a?(s.push(c),a=i.indexOf(t,c+1)):1==s.length?h=[s.pop(),l]:((r=s.pop())<n&&(n=r,o=l),l=i.indexOf(e,c+1)),c=a<l&&a>=0?a:l;s.length&&(h=[n,o])}return h}t.exports=e,e.range=s},9742:(t,e)=>{"use strict";e.byteLength=function(t){var e=h(t),i=e[0],s=e[1];return 3*(i+s)/4-s},e.toByteArray=function(t){var e,i,n=h(t),o=n[0],a=n[1],l=new r(function(t,e,i){return 3*(e+i)/4-i}(0,o,a)),c=0,u=a>0?o-4:o;for(i=0;i<u;i+=4)e=s[t.charCodeAt(i)]<<18|s[t.charCodeAt(i+1)]<<12|s[t.charCodeAt(i+2)]<<6|s[t.charCodeAt(i+3)],l[c++]=e>>16&255,l[c++]=e>>8&255,l[c++]=255&e;return 2===a&&(e=s[t.charCodeAt(i)]<<2|s[t.charCodeAt(i+1)]>>4,l[c++]=255&e),1===a&&(e=s[t.charCodeAt(i)]<<10|s[t.charCodeAt(i+1)]<<4|s[t.charCodeAt(i+2)]>>2,l[c++]=e>>8&255,l[c++]=255&e),l},e.fromByteArray=function(t){for(var e,s=t.length,r=s%3,n=[],o=16383,h=0,l=s-r;h<l;h+=o)n.push(a(t,h,h+o>l?l:h+o));return 1===r?(e=t[s-1],n.push(i[e>>2]+i[e<<4&63]+"==")):2===r&&(e=(t[s-2]<<8)+t[s-1],n.push(i[e>>10]+i[e>>4&63]+i[e<<2&63]+"=")),n.join("")};for(var i=[],s=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)i[o]=n[o],s[n.charCodeAt(o)]=o;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function a(t,e,s){for(var r,n,o=[],h=e;h<s;h+=3)r=(t[h]<<16&16711680)+(t[h+1]<<8&65280)+(255&t[h+2]),o.push(i[(n=r)>>18&63]+i[n>>12&63]+i[n>>6&63]+i[63&n]);return o.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},3644:(t,e,i)=>{var s=i(1048),r=i(5623);t.exports=function(t){return t?("{}"===t.substr(0,2)&&(t="\\{\\}"+t.substr(2)),y(function(t){return t.split("\\\\").join(n).split("\\{").join(o).split("\\}").join(h).split("\\,").join(a).split("\\.").join(l)}(t),!0).map(u)):[]};var n="\0SLASH"+Math.random()+"\0",o="\0OPEN"+Math.random()+"\0",h="\0CLOSE"+Math.random()+"\0",a="\0COMMA"+Math.random()+"\0",l="\0PERIOD"+Math.random()+"\0";function c(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function u(t){return t.split(n).join("\\").split(o).join("{").split(h).join("}").split(a).join(",").split(l).join(".")}function d(t){if(!t)return[""];var e=[],i=r("{","}",t);if(!i)return t.split(",");var s=i.pre,n=i.body,o=i.post,h=s.split(",");h[h.length-1]+="{"+n+"}";var a=d(o);return o.length&&(h[h.length-1]+=a.shift(),h.push.apply(h,a)),e.push.apply(e,h),e}function f(t){return"{"+t+"}"}function m(t){return/^-?0\d/.test(t)}function p(t,e){return t<=e}function g(t,e){return t>=e}function y(t,e){var i=[],n=r("{","}",t);if(!n||/\$$/.test(n.pre))return[t];var o,a=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),l=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),u=a||l,w=n.body.indexOf(",")>=0;if(!u&&!w)return n.post.match(/,.*\}/)?y(t=n.pre+"{"+n.body+h+n.post):[t];if(u)o=n.body.split(/\.\./);else if(1===(o=d(n.body)).length&&1===(o=y(o[0],!1).map(f)).length)return(I=n.post.length?y(n.post,!1):[""]).map((function(t){return n.pre+o[0]+t}));var b,C=n.pre,I=n.post.length?y(n.post,!1):[""];if(u){var S=c(o[0]),v=c(o[1]),x=Math.max(o[0].length,o[1].length),T=3==o.length?Math.abs(c(o[2])):1,A=p;v<S&&(T*=-1,A=g);var k=o.some(m);b=[];for(var B=S;A(B,v);B+=T){var L;if(l)"\\"===(L=String.fromCharCode(B))&&(L="");else if(L=String(B),k){var M=x-L.length;if(M>0){var E=new Array(M+1).join("0");L=B<0?"-"+E+L.slice(1):E+L}}b.push(L)}}else b=s(o,(function(t){return y(t,!1)}));for(var _=0;_<b.length;_++)for(var Y=0;Y<I.length;Y++){var P=C+b[_]+I[Y];(!e||u||P)&&i.push(P)}return i}},8764:(t,e,i)=>{"use strict";const s=i(9742),r=i(645),n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.lW=a,e.h2=50;const o=2147483647;function h(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,a.prototype),e}function a(t,e,i){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return u(t)}return l(t,e,i)}function l(t,e,i){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!a.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const i=0|p(t,e);let s=h(i);const r=s.write(t,e);return r!==i&&(s=s.slice(0,r)),s}(t,e);if(ArrayBuffer.isView(t))return function(t){if($(t,Uint8Array)){const e=new Uint8Array(t);return f(e.buffer,e.byteOffset,e.byteLength)}return d(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if($(t,ArrayBuffer)||t&&$(t.buffer,ArrayBuffer))return f(t,e,i);if("undefined"!=typeof SharedArrayBuffer&&($(t,SharedArrayBuffer)||t&&$(t.buffer,SharedArrayBuffer)))return f(t,e,i);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const s=t.valueOf&&t.valueOf();if(null!=s&&s!==t)return a.from(s,e,i);const r=function(t){if(a.isBuffer(t)){const e=0|m(t.length),i=h(e);return 0===i.length||t.copy(i,0,0,e),i}return void 0!==t.length?"number"!=typeof t.length||q(t.length)?h(0):d(t):"Buffer"===t.type&&Array.isArray(t.data)?d(t.data):void 0}(t);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return a.from(t[Symbol.toPrimitive]("string"),e,i);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function u(t){return c(t),h(t<0?0:0|m(t))}function d(t){const e=t.length<0?0:0|m(t.length),i=h(e);for(let s=0;s<e;s+=1)i[s]=255&t[s];return i}function f(t,e,i){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(i||0))throw new RangeError('"length" is outside of buffer bounds');let s;return s=void 0===e&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,e):new Uint8Array(t,e,i),Object.setPrototypeOf(s,a.prototype),s}function m(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function p(t,e){if(a.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||$(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const i=t.length,s=arguments.length>2&&!0===arguments[2];if(!s&&0===i)return 0;let r=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":return Z(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return G(t).length;default:if(r)return s?-1:Z(t).length;e=(""+e).toLowerCase(),r=!0}}function g(t,e,i){let s=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return M(this,e,i);case"utf8":case"utf-8":return A(this,e,i);case"ascii":return B(this,e,i);case"latin1":case"binary":return L(this,e,i);case"base64":return T(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,i);default:if(s)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),s=!0}}function y(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function w(t,e,i,s,r){if(0===t.length)return-1;if("string"==typeof i?(s=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),q(i=+i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof e&&(e=a.from(e,s)),a.isBuffer(e))return 0===e.length?-1:b(t,e,i,s,r);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):b(t,[e],i,s,r);throw new TypeError("val must be string, number or Buffer")}function b(t,e,i,s,r){let n,o=1,h=t.length,a=e.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(t.length<2||e.length<2)return-1;o=2,h/=2,a/=2,i/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(r){let s=-1;for(n=i;n<h;n++)if(l(t,n)===l(e,-1===s?0:n-s)){if(-1===s&&(s=n),n-s+1===a)return s*o}else-1!==s&&(n-=n-s),s=-1}else for(i+a>h&&(i=h-a),n=i;n>=0;n--){let i=!0;for(let s=0;s<a;s++)if(l(t,n+s)!==l(e,s)){i=!1;break}if(i)return n}return-1}function C(t,e,i,s){i=Number(i)||0;const r=t.length-i;s?(s=Number(s))>r&&(s=r):s=r;const n=e.length;let o;for(s>n/2&&(s=n/2),o=0;o<s;++o){const s=parseInt(e.substr(2*o,2),16);if(q(s))return o;t[i+o]=s}return o}function I(t,e,i,s){return z(Z(e,t.length-i),t,i,s)}function S(t,e,i,s){return z(function(t){const e=[];for(let i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,s)}function v(t,e,i,s){return z(G(e),t,i,s)}function x(t,e,i,s){return z(function(t,e){let i,s,r;const n=[];for(let o=0;o<t.length&&!((e-=2)<0);++o)i=t.charCodeAt(o),s=i>>8,r=i%256,n.push(r),n.push(s);return n}(e,t.length-i),t,i,s)}function T(t,e,i){return 0===e&&i===t.length?s.fromByteArray(t):s.fromByteArray(t.slice(e,i))}function A(t,e,i){i=Math.min(t.length,i);const s=[];let r=e;for(;r<i;){const e=t[r];let n=null,o=e>239?4:e>223?3:e>191?2:1;if(r+o<=i){let i,s,h,a;switch(o){case 1:e<128&&(n=e);break;case 2:i=t[r+1],128==(192&i)&&(a=(31&e)<<6|63&i,a>127&&(n=a));break;case 3:i=t[r+1],s=t[r+2],128==(192&i)&&128==(192&s)&&(a=(15&e)<<12|(63&i)<<6|63&s,a>2047&&(a<55296||a>57343)&&(n=a));break;case 4:i=t[r+1],s=t[r+2],h=t[r+3],128==(192&i)&&128==(192&s)&&128==(192&h)&&(a=(15&e)<<18|(63&i)<<12|(63&s)<<6|63&h,a>65535&&a<1114112&&(n=a))}}null===n?(n=65533,o=1):n>65535&&(n-=65536,s.push(n>>>10&1023|55296),n=56320|1023&n),s.push(n),r+=o}return function(t){const e=t.length;if(e<=k)return String.fromCharCode.apply(String,t);let i="",s=0;for(;s<e;)i+=String.fromCharCode.apply(String,t.slice(s,s+=k));return i}(s)}a.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(t,e,i){return l(t,e,i)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(t,e,i){return function(t,e,i){return c(t),t<=0?h(t):void 0!==e?"string"==typeof i?h(t).fill(e,i):h(t).fill(e):h(t)}(t,e,i)},a.allocUnsafe=function(t){return u(t)},a.allocUnsafeSlow=function(t){return u(t)},a.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==a.prototype},a.compare=function(t,e){if($(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),$(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let i=t.length,s=e.length;for(let r=0,n=Math.min(i,s);r<n;++r)if(t[r]!==e[r]){i=t[r],s=e[r];break}return i<s?-1:s<i?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);let i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;const s=a.allocUnsafe(e);let r=0;for(i=0;i<t.length;++i){let e=t[i];if($(e,Uint8Array))r+e.length>s.length?(a.isBuffer(e)||(e=a.from(e)),e.copy(s,r)):Uint8Array.prototype.set.call(s,e,r);else{if(!a.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(s,r)}r+=e.length}return s},a.byteLength=p,a.prototype._isBuffer=!0,a.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)y(this,e,e+1);return this},a.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},a.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},a.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?A(this,0,t):g.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){let t="";const i=e.h2;return t=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(t+=" ... "),"<Buffer "+t+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(t,e,i,s,r){if($(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===s&&(s=0),void 0===r&&(r=this.length),e<0||i>t.length||s<0||r>this.length)throw new RangeError("out of range index");if(s>=r&&e>=i)return 0;if(s>=r)return-1;if(e>=i)return 1;if(this===t)return 0;let n=(r>>>=0)-(s>>>=0),o=(i>>>=0)-(e>>>=0);const h=Math.min(n,o),l=this.slice(s,r),c=t.slice(e,i);for(let t=0;t<h;++t)if(l[t]!==c[t]){n=l[t],o=c[t];break}return n<o?-1:o<n?1:0},a.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},a.prototype.indexOf=function(t,e,i){return w(this,t,e,i,!0)},a.prototype.lastIndexOf=function(t,e,i){return w(this,t,e,i,!1)},a.prototype.write=function(t,e,i,s){if(void 0===e)s="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)s=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(i)?(i>>>=0,void 0===s&&(s="utf8")):(s=i,i=void 0)}const r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");let n=!1;for(;;)switch(s){case"hex":return C(this,t,e,i);case"utf8":case"utf-8":return I(this,t,e,i);case"ascii":case"latin1":case"binary":return S(this,t,e,i);case"base64":return v(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,t,e,i);default:if(n)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),n=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const k=4096;function B(t,e,i){let s="";i=Math.min(t.length,i);for(let r=e;r<i;++r)s+=String.fromCharCode(127&t[r]);return s}function L(t,e,i){let s="";i=Math.min(t.length,i);for(let r=e;r<i;++r)s+=String.fromCharCode(t[r]);return s}function M(t,e,i){const s=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>s)&&(i=s);let r="";for(let s=e;s<i;++s)r+=K[t[s]];return r}function E(t,e,i){const s=t.slice(e,i);let r="";for(let t=0;t<s.length-1;t+=2)r+=String.fromCharCode(s[t]+256*s[t+1]);return r}function _(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function Y(t,e,i,s,r,n){if(!a.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<n)throw new RangeError('"value" argument is out of bounds');if(i+s>t.length)throw new RangeError("Index out of range")}function P(t,e,i,s,r){F(e,s,r,t,i,7);let n=Number(e&BigInt(4294967295));t[i++]=n,n>>=8,t[i++]=n,n>>=8,t[i++]=n,n>>=8,t[i++]=n;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[i++]=o,o>>=8,t[i++]=o,o>>=8,t[i++]=o,o>>=8,t[i++]=o,i}function j(t,e,i,s,r){F(e,s,r,t,i,7);let n=Number(e&BigInt(4294967295));t[i+7]=n,n>>=8,t[i+6]=n,n>>=8,t[i+5]=n,n>>=8,t[i+4]=n;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[i+3]=o,o>>=8,t[i+2]=o,o>>=8,t[i+1]=o,o>>=8,t[i]=o,i+8}function D(t,e,i,s,r,n){if(i+s>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function X(t,e,i,s,n){return e=+e,i>>>=0,n||D(t,0,i,4),r.write(t,e,i,s,23,4),i+4}function O(t,e,i,s,n){return e=+e,i>>>=0,n||D(t,0,i,8),r.write(t,e,i,s,52,8),i+8}a.prototype.slice=function(t,e){const i=this.length;(t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t);const s=this.subarray(t,e);return Object.setPrototypeOf(s,a.prototype),s},a.prototype.readUintLE=a.prototype.readUIntLE=function(t,e,i){t>>>=0,e>>>=0,i||_(t,e,this.length);let s=this[t],r=1,n=0;for(;++n<e&&(r*=256);)s+=this[t+n]*r;return s},a.prototype.readUintBE=a.prototype.readUIntBE=function(t,e,i){t>>>=0,e>>>=0,i||_(t,e,this.length);let s=this[t+--e],r=1;for(;e>0&&(r*=256);)s+=this[t+--e]*r;return s},a.prototype.readUint8=a.prototype.readUInt8=function(t,e){return t>>>=0,e||_(t,1,this.length),this[t]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(t,e){return t>>>=0,e||_(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(t,e){return t>>>=0,e||_(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(t,e){return t>>>=0,e||_(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(t,e){return t>>>=0,e||_(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readBigUInt64LE=Q((function(t){H(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||W(t,this.length-8);const s=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,r=this[++t]+256*this[++t]+65536*this[++t]+i*2**24;return BigInt(s)+(BigInt(r)<<BigInt(32))})),a.prototype.readBigUInt64BE=Q((function(t){H(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||W(t,this.length-8);const s=e*2**24+65536*this[++t]+256*this[++t]+this[++t],r=this[++t]*2**24+65536*this[++t]+256*this[++t]+i;return(BigInt(s)<<BigInt(32))+BigInt(r)})),a.prototype.readIntLE=function(t,e,i){t>>>=0,e>>>=0,i||_(t,e,this.length);let s=this[t],r=1,n=0;for(;++n<e&&(r*=256);)s+=this[t+n]*r;return r*=128,s>=r&&(s-=Math.pow(2,8*e)),s},a.prototype.readIntBE=function(t,e,i){t>>>=0,e>>>=0,i||_(t,e,this.length);let s=e,r=1,n=this[t+--s];for(;s>0&&(r*=256);)n+=this[t+--s]*r;return r*=128,n>=r&&(n-=Math.pow(2,8*e)),n},a.prototype.readInt8=function(t,e){return t>>>=0,e||_(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},a.prototype.readInt16LE=function(t,e){t>>>=0,e||_(t,2,this.length);const i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},a.prototype.readInt16BE=function(t,e){t>>>=0,e||_(t,2,this.length);const i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},a.prototype.readInt32LE=function(t,e){return t>>>=0,e||_(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return t>>>=0,e||_(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readBigInt64LE=Q((function(t){H(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||W(t,this.length-8);const s=this[t+4]+256*this[t+5]+65536*this[t+6]+(i<<24);return(BigInt(s)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),a.prototype.readBigInt64BE=Q((function(t){H(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||W(t,this.length-8);const s=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(s)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+i)})),a.prototype.readFloatLE=function(t,e){return t>>>=0,e||_(t,4,this.length),r.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return t>>>=0,e||_(t,4,this.length),r.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return t>>>=0,e||_(t,8,this.length),r.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return t>>>=0,e||_(t,8,this.length),r.read(this,t,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(t,e,i,s){t=+t,e>>>=0,i>>>=0,s||Y(this,t,e,i,Math.pow(2,8*i)-1,0);let r=1,n=0;for(this[e]=255&t;++n<i&&(r*=256);)this[e+n]=t/r&255;return e+i},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(t,e,i,s){t=+t,e>>>=0,i>>>=0,s||Y(this,t,e,i,Math.pow(2,8*i)-1,0);let r=i-1,n=1;for(this[e+r]=255&t;--r>=0&&(n*=256);)this[e+r]=t/n&255;return e+i},a.prototype.writeUint8=a.prototype.writeUInt8=function(t,e,i){return t=+t,e>>>=0,i||Y(this,t,e,1,255,0),this[e]=255&t,e+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(t,e,i){return t=+t,e>>>=0,i||Y(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(t,e,i){return t=+t,e>>>=0,i||Y(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(t,e,i){return t=+t,e>>>=0,i||Y(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(t,e,i){return t=+t,e>>>=0,i||Y(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeBigUInt64LE=Q((function(t,e=0){return P(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),a.prototype.writeBigUInt64BE=Q((function(t,e=0){return j(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),a.prototype.writeIntLE=function(t,e,i,s){if(t=+t,e>>>=0,!s){const s=Math.pow(2,8*i-1);Y(this,t,e,i,s-1,-s)}let r=0,n=1,o=0;for(this[e]=255&t;++r<i&&(n*=256);)t<0&&0===o&&0!==this[e+r-1]&&(o=1),this[e+r]=(t/n>>0)-o&255;return e+i},a.prototype.writeIntBE=function(t,e,i,s){if(t=+t,e>>>=0,!s){const s=Math.pow(2,8*i-1);Y(this,t,e,i,s-1,-s)}let r=i-1,n=1,o=0;for(this[e+r]=255&t;--r>=0&&(n*=256);)t<0&&0===o&&0!==this[e+r+1]&&(o=1),this[e+r]=(t/n>>0)-o&255;return e+i},a.prototype.writeInt8=function(t,e,i){return t=+t,e>>>=0,i||Y(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,i){return t=+t,e>>>=0,i||Y(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeInt16BE=function(t,e,i){return t=+t,e>>>=0,i||Y(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeInt32LE=function(t,e,i){return t=+t,e>>>=0,i||Y(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},a.prototype.writeInt32BE=function(t,e,i){return t=+t,e>>>=0,i||Y(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeBigInt64LE=Q((function(t,e=0){return P(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),a.prototype.writeBigInt64BE=Q((function(t,e=0){return j(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),a.prototype.writeFloatLE=function(t,e,i){return X(this,t,e,!0,i)},a.prototype.writeFloatBE=function(t,e,i){return X(this,t,e,!1,i)},a.prototype.writeDoubleLE=function(t,e,i){return O(this,t,e,!0,i)},a.prototype.writeDoubleBE=function(t,e,i){return O(this,t,e,!1,i)},a.prototype.copy=function(t,e,i,s){if(!a.isBuffer(t))throw new TypeError("argument should be a Buffer");if(i||(i=0),s||0===s||(s=this.length),e>=t.length&&(e=t.length),e||(e=0),s>0&&s<i&&(s=i),s===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("Index out of range");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),t.length-e<s-i&&(s=t.length-e+i);const r=s-i;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,i,s):Uint8Array.prototype.set.call(t,this.subarray(i,s),e),r},a.prototype.fill=function(t,e,i,s){if("string"==typeof t){if("string"==typeof e?(s=e,e=0,i=this.length):"string"==typeof i&&(s=i,i=this.length),void 0!==s&&"string"!=typeof s)throw new TypeError("encoding must be a string");if("string"==typeof s&&!a.isEncoding(s))throw new TypeError("Unknown encoding: "+s);if(1===t.length){const e=t.charCodeAt(0);("utf8"===s&&e<128||"latin1"===s)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;let r;if(e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0),"number"==typeof t)for(r=e;r<i;++r)this[r]=t;else{const n=a.isBuffer(t)?t:a.from(t,s),o=n.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(r=0;r<i-e;++r)this[r+e]=n[r%o]}return this};const R={};function U(t,e,i){R[t]=class extends i{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function N(t){let e="",i=t.length;const s="-"===t[0]?1:0;for(;i>=s+4;i-=3)e=`_${t.slice(i-3,i)}${e}`;return`${t.slice(0,i)}${e}`}function F(t,e,i,s,r,n){if(t>i||t<e){const s="bigint"==typeof e?"n":"";let r;throw r=n>3?0===e||e===BigInt(0)?`>= 0${s} and < 2${s} ** ${8*(n+1)}${s}`:`>= -(2${s} ** ${8*(n+1)-1}${s}) and < 2 ** ${8*(n+1)-1}${s}`:`>= ${e}${s} and <= ${i}${s}`,new R.ERR_OUT_OF_RANGE("value",r,t)}!function(t,e,i){H(e,"offset"),void 0!==t[e]&&void 0!==t[e+i]||W(e,t.length-(i+1))}(s,r,n)}function H(t,e){if("number"!=typeof t)throw new R.ERR_INVALID_ARG_TYPE(e,"number",t)}function W(t,e,i){if(Math.floor(t)!==t)throw H(t,i),new R.ERR_OUT_OF_RANGE(i||"offset","an integer",t);if(e<0)throw new R.ERR_BUFFER_OUT_OF_BOUNDS;throw new R.ERR_OUT_OF_RANGE(i||"offset",`>= ${i?1:0} and <= ${e}`,t)}U("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),U("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),U("ERR_OUT_OF_RANGE",(function(t,e,i){let s=`The value of "${t}" is out of range.`,r=i;return Number.isInteger(i)&&Math.abs(i)>2**32?r=N(String(i)):"bigint"==typeof i&&(r=String(i),(i>BigInt(2)**BigInt(32)||i<-(BigInt(2)**BigInt(32)))&&(r=N(r)),r+="n"),s+=` It must be ${e}. Received ${r}`,s}),RangeError);const V=/[^+/0-9A-Za-z-_]/g;function Z(t,e){let i;e=e||1/0;const s=t.length;let r=null;const n=[];for(let o=0;o<s;++o){if(i=t.charCodeAt(o),i>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&n.push(239,191,189);continue}if(o+1===s){(e-=3)>-1&&n.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&n.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&n.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;n.push(i)}else if(i<2048){if((e-=2)<0)break;n.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;n.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;n.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return n}function G(t){return s.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(V,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function z(t,e,i,s){let r;for(r=0;r<s&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}function $(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function q(t){return t!=t}const K=function(){const t="0123456789abcdef",e=new Array(256);for(let i=0;i<16;++i){const s=16*i;for(let r=0;r<16;++r)e[s+r]=t[i]+t[r]}return e}();function Q(t){return"undefined"==typeof BigInt?J:t}function J(){throw new Error("BigInt not supported")}},4854:(t,e,i)=>{var s=i(2884),r=i(1017);t.exports=function(t,e,n){if("string"==typeof e&&(e=[e]),!Array.isArray(e))return{};n||(n={}),n.index=!1!==n.index;var o=n.require||i(6998);return function t(e){if(Array.isArray(e)){var i=o(e[0]),s=e.slice(1);if(0===s.length)return i;var r=function(t){return"function"!=typeof t?t:function(){var e=s.concat([].slice.call(arguments));return t.apply(this,e)}};return"function"==typeof i?r(i):Array.isArray(i)?i.map(r):i&&"object"==typeof i?Object.keys(i).reduce((function(t,e){return t[e]=r(i[e]),t}),{}):i}if("object"==typeof e){var h=n.index&&e.index&&"string"==typeof e.index[0]&&o(e.index[0]);return Object.keys(e).reduce((function(i,s){return i[s]=t(e[s]),i}),h&&"function"==typeof h?h:{})}}(e.map((function(e){return Array.isArray(e)?[r.resolve(t,e[0])].concat(e.slice(1)):r.resolve(t,e)})).reduce((function(e,i){var n=[];return Array.isArray(i)&&(n=i.slice(1),i=i[0]),s.sync(i).forEach((function(i){for(var s=function(e){var i=r.relative(t,e).split(/\/|\\/),s=i.length;return s&&(i[s-1]=i[s-1].replace(/\.[^.]*$/,"")),i}(i),o=e,h=0;h<s.length;h++){var a=s[h];h===s.length-1?(o[a]||(o[a]=[i]),o[a].push.apply(o[a],n)):(o[a]||(o[a]={}),o=o[a])}})),e}),{}))}},6998:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=6998,t.exports=e},1048:t=>{t.exports=function(t,i){for(var s=[],r=0;r<t.length;r++){var n=i(t[r],r);e(n)?s.push.apply(s,n):s.push(n)}return s};var e=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},7334:(t,e,i)=>{t.exports=c,c.realpath=c,c.sync=u,c.realpathSync=u,c.monkeypatch=function(){s.realpath=c,s.realpathSync=u},c.unmonkeypatch=function(){s.realpath=r,s.realpathSync=n};var s=i(7147),r=s.realpath,n=s.realpathSync,o=process.version,h=/^v[0-5]\./.test(o),a=i(7059);function l(t){return t&&"realpath"===t.syscall&&("ELOOP"===t.code||"ENOMEM"===t.code||"ENAMETOOLONG"===t.code)}function c(t,e,i){if(h)return r(t,e,i);"function"==typeof e&&(i=e,e=null),r(t,e,(function(s,r){l(s)?a.realpath(t,e,i):i(s,r)}))}function u(t,e){if(h)return n(t,e);try{return n(t,e)}catch(i){if(l(i))return a.realpathSync(t,e);throw i}}},7059:(t,e,i)=>{var s=i(1017),r="win32"===process.platform,n=i(7147),o=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);if(s.normalize,r)var h=/(.*?)(?:[\/\\]+|$)/g;else h=/(.*?)(?:[\/]+|$)/g;if(r)var a=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/;else a=/^[\/]*/;e.realpathSync=function(t,e){if(t=s.resolve(t),e&&Object.prototype.hasOwnProperty.call(e,t))return e[t];var i,o,l,c,u=t,d={},f={};function m(){var e=a.exec(t);i=e[0].length,o=e[0],l=e[0],c="",r&&!f[l]&&(n.lstatSync(l),f[l]=!0)}for(m();i<t.length;){h.lastIndex=i;var p=h.exec(t);if(c=o,o+=p[0],l=c+p[1],i=h.lastIndex,!(f[l]||e&&e[l]===l)){var g;if(e&&Object.prototype.hasOwnProperty.call(e,l))g=e[l];else{var y=n.lstatSync(l);if(!y.isSymbolicLink()){f[l]=!0,e&&(e[l]=l);continue}var w=null;if(!r){var b=y.dev.toString(32)+":"+y.ino.toString(32);d.hasOwnProperty(b)&&(w=d[b])}null===w&&(n.statSync(l),w=n.readlinkSync(l)),g=s.resolve(c,w),e&&(e[l]=g),r||(d[b]=w)}t=s.resolve(g,t.slice(i)),m()}}return e&&(e[u]=t),t},e.realpath=function(t,e,i){if("function"!=typeof i&&(i=function(t){return"function"==typeof t?t:function(){var t;if(o){var e=new Error;t=function(t){t&&(e.message=t.message,i(t=e))}}else t=i;return t;function i(t){if(t){if(process.throwDeprecation)throw t;if(!process.noDeprecation){var e="fs: missing callback "+(t.stack||t.message);process.traceDeprecation?console.trace(e):console.error(e)}}}}()}(e),e=null),t=s.resolve(t),e&&Object.prototype.hasOwnProperty.call(e,t))return process.nextTick(i.bind(null,null,e[t]));var l,c,u,d,f=t,m={},p={};function g(){var e=a.exec(t);l=e[0].length,c=e[0],u=e[0],d="",r&&!p[u]?n.lstat(u,(function(t){if(t)return i(t);p[u]=!0,y()})):process.nextTick(y)}function y(){if(l>=t.length)return e&&(e[f]=t),i(null,t);h.lastIndex=l;var s=h.exec(t);return d=c,c+=s[0],u=d+s[1],l=h.lastIndex,p[u]||e&&e[u]===u?process.nextTick(y):e&&Object.prototype.hasOwnProperty.call(e,u)?C(e[u]):n.lstat(u,w)}function w(t,s){if(t)return i(t);if(!s.isSymbolicLink())return p[u]=!0,e&&(e[u]=u),process.nextTick(y);if(!r){var o=s.dev.toString(32)+":"+s.ino.toString(32);if(m.hasOwnProperty(o))return b(null,m[o],u)}n.stat(u,(function(t){if(t)return i(t);n.readlink(u,(function(t,e){r||(m[o]=e),b(t,e)}))}))}function b(t,r,n){if(t)return i(t);var o=s.resolve(d,r);e&&(e[n]=o),C(o)}function C(e){t=s.resolve(e,t.slice(l)),g()}g()}},6772:(t,e,i)=>{function s(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.setopts=function(t,e,i){if(i||(i={}),i.matchBase&&-1===e.indexOf("/")){if(i.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}t.silent=!!i.silent,t.pattern=e,t.strict=!1!==i.strict,t.realpath=!!i.realpath,t.realpathCache=i.realpathCache||Object.create(null),t.follow=!!i.follow,t.dot=!!i.dot,t.mark=!!i.mark,t.nodir=!!i.nodir,t.nodir&&(t.mark=!0),t.sync=!!i.sync,t.nounique=!!i.nounique,t.nonull=!!i.nonull,t.nosort=!!i.nosort,t.nocase=!!i.nocase,t.stat=!!i.stat,t.noprocess=!!i.noprocess,t.absolute=!!i.absolute,t.fs=i.fs||r,t.maxLength=i.maxLength||1/0,t.cache=i.cache||Object.create(null),t.statCache=i.statCache||Object.create(null),t.symlinks=i.symlinks||Object.create(null),function(t,e){t.ignore=e.ignore||[],Array.isArray(t.ignore)||(t.ignore=[t.ignore]),t.ignore.length&&(t.ignore=t.ignore.map(c))}(t,i),t.changedCwd=!1;var o=process.cwd();s(i,"cwd")?(t.cwd=n.resolve(i.cwd),t.changedCwd=t.cwd!==o):t.cwd=o,t.root=i.root||n.resolve(t.cwd,"/"),t.root=n.resolve(t.root),"win32"===process.platform&&(t.root=t.root.replace(/\\/g,"/")),t.cwdAbs=h(t.cwd)?t.cwd:u(t,t.cwd),"win32"===process.platform&&(t.cwdAbs=t.cwdAbs.replace(/\\/g,"/")),t.nomount=!!i.nomount,i.nonegate=!0,i.nocomment=!0,i.allowWindowsEscape=!1,t.minimatch=new a(e,i),t.options=t.minimatch.options},e.ownProp=s,e.makeAbs=u,e.finish=function(t){for(var e=t.nounique,i=e?[]:Object.create(null),s=0,r=t.matches.length;s<r;s++){var n=t.matches[s];if(n&&0!==Object.keys(n).length){var o=Object.keys(n);e?i.push.apply(i,o):o.forEach((function(t){i[t]=!0}))}else if(t.nonull){var h=t.minimatch.globSet[s];e?i.push(h):i[h]=!0}}if(e||(i=Object.keys(i)),t.nosort||(i=i.sort(l)),t.mark){for(s=0;s<i.length;s++)i[s]=t._mark(i[s]);t.nodir&&(i=i.filter((function(e){var i=!/\/$/.test(e),s=t.cache[e]||t.cache[u(t,e)];return i&&s&&(i="DIR"!==s&&!Array.isArray(s)),i})))}t.ignore.length&&(i=i.filter((function(e){return!d(t,e)}))),t.found=i},e.mark=function(t,e){var i=u(t,e),s=t.cache[i],r=e;if(s){var n="DIR"===s||Array.isArray(s),o="/"===e.slice(-1);if(n&&!o?r+="/":!n&&o&&(r=r.slice(0,-1)),r!==e){var h=u(t,r);t.statCache[h]=t.statCache[i],t.cache[h]=t.cache[i]}}return r},e.isIgnored=d,e.childrenIgnored=function(t,e){return!!t.ignore.length&&t.ignore.some((function(t){return!(!t.gmatcher||!t.gmatcher.match(e))}))};var r=i(7147),n=i(1017),o=i(1171),h=i(4095),a=o.Minimatch;function l(t,e){return t.localeCompare(e,"en")}function c(t){var e=null;if("/**"===t.slice(-3)){var i=t.replace(/(\/\*\*)+$/,"");e=new a(i,{dot:!0})}return{matcher:new a(t,{dot:!0}),gmatcher:e}}function u(t,e){var i=e;return i="/"===e.charAt(0)?n.join(t.root,e):h(e)||""===e?e:t.changedCwd?n.resolve(t.cwd,e):n.resolve(e),"win32"===process.platform&&(i=i.replace(/\\/g,"/")),i}function d(t,e){return!!t.ignore.length&&t.ignore.some((function(t){return t.matcher.match(e)||!(!t.gmatcher||!t.gmatcher.match(e))}))}},2884:(t,e,i)=>{t.exports=w;var s=i(7334),r=i(1171),n=(r.Minimatch,i(4378)),o=i(2361).EventEmitter,h=i(1017),a=i(9491),l=i(4095),c=i(4751),u=i(6772),d=u.setopts,f=u.ownProp,m=i(7844),p=(i(3837),u.childrenIgnored),g=u.isIgnored,y=i(778);function w(t,e,i){if("function"==typeof e&&(i=e,e={}),e||(e={}),e.sync){if(i)throw new TypeError("callback provided to sync glob");return c(t,e)}return new C(t,e,i)}w.sync=c;var b=w.GlobSync=c.GlobSync;function C(t,e,i){if("function"==typeof e&&(i=e,e=null),e&&e.sync){if(i)throw new TypeError("callback provided to sync glob");return new b(t,e)}if(!(this instanceof C))return new C(t,e,i);d(this,t,e),this._didRealPath=!1;var s=this.minimatch.set.length;this.matches=new Array(s),"function"==typeof i&&(i=y(i),this.on("error",i),this.on("end",(function(t){i(null,t)})));var r=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(0===s)return h();for(var n=!0,o=0;o<s;o++)this._process(this.minimatch.set[o],o,!1,h);function h(){--r._processing,r._processing<=0&&(n?process.nextTick((function(){r._finish()})):r._finish())}n=!1}w.glob=w,w.hasMagic=function(t,e){var i=function(t,e){if(null===e||"object"!=typeof e)return t;for(var i=Object.keys(e),s=i.length;s--;)t[i[s]]=e[i[s]];return t}({},e);i.noprocess=!0;var s=new C(t,i).minimatch.set;if(!t)return!1;if(s.length>1)return!0;for(var r=0;r<s[0].length;r++)if("string"!=typeof s[0][r])return!0;return!1},w.Glob=C,n(C,o),C.prototype._finish=function(){if(a(this instanceof C),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();u.finish(this),this.emit("end",this.found)}},C.prototype._realpath=function(){if(!this._didRealpath){this._didRealpath=!0;var t=this.matches.length;if(0===t)return this._finish();for(var e=this,i=0;i<this.matches.length;i++)this._realpathSet(i,s)}function s(){0==--t&&e._finish()}},C.prototype._realpathSet=function(t,e){var i=this.matches[t];if(!i)return e();var r=Object.keys(i),n=this,o=r.length;if(0===o)return e();var h=this.matches[t]=Object.create(null);r.forEach((function(i,r){i=n._makeAbs(i),s.realpath(i,n.realpathCache,(function(s,r){s?"stat"===s.syscall?h[i]=!0:n.emit("error",s):h[r]=!0,0==--o&&(n.matches[t]=h,e())}))}))},C.prototype._mark=function(t){return u.mark(this,t)},C.prototype._makeAbs=function(t){return u.makeAbs(this,t)},C.prototype.abort=function(){this.aborted=!0,this.emit("abort")},C.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))},C.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var t=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<t.length;e++){var i=t[e];this._emitMatch(i[0],i[1])}}if(this._processQueue.length){var s=this._processQueue.slice(0);for(this._processQueue.length=0,e=0;e<s.length;e++){var r=s[e];this._processing--,this._process(r[0],r[1],r[2],r[3])}}}},C.prototype._process=function(t,e,i,s){if(a(this instanceof C),a("function"==typeof s),!this.aborted)if(this._processing++,this.paused)this._processQueue.push([t,e,i,s]);else{for(var n,o=0;"string"==typeof t[o];)o++;switch(o){case t.length:return void this._processSimple(t.join("/"),e,s);case 0:n=null;break;default:n=t.slice(0,o).join("/")}var h,c=t.slice(o);null===n?h=".":l(n)||l(t.map((function(t){return"string"==typeof t?t:"[*]"})).join("/"))?(n&&l(n)||(n="/"+n),h=n):h=n;var u=this._makeAbs(h);if(p(this,h))return s();c[0]===r.GLOBSTAR?this._processGlobStar(n,h,u,c,e,i,s):this._processReaddir(n,h,u,c,e,i,s)}},C.prototype._processReaddir=function(t,e,i,s,r,n,o){var h=this;this._readdir(i,n,(function(a,l){return h._processReaddir2(t,e,i,s,r,n,l,o)}))},C.prototype._processReaddir2=function(t,e,i,s,r,n,o,a){if(!o)return a();for(var l=s[0],c=!!this.minimatch.negate,u=l._glob,d=this.dot||"."===u.charAt(0),f=[],m=0;m<o.length;m++)("."!==(g=o[m]).charAt(0)||d)&&(c&&!t?!g.match(l):g.match(l))&&f.push(g);var p=f.length;if(0===p)return a();if(1===s.length&&!this.mark&&!this.stat){for(this.matches[r]||(this.matches[r]=Object.create(null)),m=0;m<p;m++){var g=f[m];t&&(g="/"!==t?t+"/"+g:t+g),"/"!==g.charAt(0)||this.nomount||(g=h.join(this.root,g)),this._emitMatch(r,g)}return a()}for(s.shift(),m=0;m<p;m++)g=f[m],t&&(g="/"!==t?t+"/"+g:t+g),this._process([g].concat(s),r,n,a);a()},C.prototype._emitMatch=function(t,e){if(!this.aborted&&!g(this,e))if(this.paused)this._emitQueue.push([t,e]);else{var i=l(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=i),!this.matches[t][e]){if(this.nodir){var s=this.cache[i];if("DIR"===s||Array.isArray(s))return}this.matches[t][e]=!0;var r=this.statCache[i];r&&this.emit("stat",e,r),this.emit("match",e)}}},C.prototype._readdirInGlobStar=function(t,e){if(!this.aborted){if(this.follow)return this._readdir(t,!1,e);var i=this,s=m("lstat\0"+t,(function(s,r){if(s&&"ENOENT"===s.code)return e();var n=r&&r.isSymbolicLink();i.symlinks[t]=n,n||!r||r.isDirectory()?i._readdir(t,!1,e):(i.cache[t]="FILE",e())}));s&&i.fs.lstat(t,s)}},C.prototype._readdir=function(t,e,i){if(!this.aborted&&(i=m("readdir\0"+t+"\0"+e,i))){if(e&&!f(this.symlinks,t))return this._readdirInGlobStar(t,i);if(f(this.cache,t)){var s=this.cache[t];if(!s||"FILE"===s)return i();if(Array.isArray(s))return i(null,s)}this.fs.readdir(t,function(t,e,i){return function(s,r){s?t._readdirError(e,s,i):t._readdirEntries(e,r,i)}}(this,t,i))}},C.prototype._readdirEntries=function(t,e,i){if(!this.aborted){if(!this.mark&&!this.stat)for(var s=0;s<e.length;s++){var r=e[s];r="/"===t?t+r:t+"/"+r,this.cache[r]=!0}return this.cache[t]=e,i(null,e)}},C.prototype._readdirError=function(t,e,i){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var s=this._makeAbs(t);if(this.cache[s]="FILE",s===this.cwdAbs){var r=new Error(e.code+" invalid cwd "+this.cwd);r.path=this.cwd,r.code=e.code,this.emit("error",r),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:this.cache[this._makeAbs(t)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e)}return i()}},C.prototype._processGlobStar=function(t,e,i,s,r,n,o){var h=this;this._readdir(i,n,(function(a,l){h._processGlobStar2(t,e,i,s,r,n,l,o)}))},C.prototype._processGlobStar2=function(t,e,i,s,r,n,o,h){if(!o)return h();var a=s.slice(1),l=t?[t]:[],c=l.concat(a);this._process(c,r,!1,h);var u=this.symlinks[i],d=o.length;if(u&&n)return h();for(var f=0;f<d;f++)if("."!==o[f].charAt(0)||this.dot){var m=l.concat(o[f],a);this._process(m,r,!0,h);var p=l.concat(o[f],s);this._process(p,r,!0,h)}h()},C.prototype._processSimple=function(t,e,i){var s=this;this._stat(t,(function(r,n){s._processSimple2(t,e,r,n,i)}))},C.prototype._processSimple2=function(t,e,i,s,r){if(this.matches[e]||(this.matches[e]=Object.create(null)),!s)return r();if(t&&l(t)&&!this.nomount){var n=/[\/\\]$/.test(t);"/"===t.charAt(0)?t=h.join(this.root,t):(t=h.resolve(this.root,t),n&&(t+="/"))}"win32"===process.platform&&(t=t.replace(/\\/g,"/")),this._emitMatch(e,t),r()},C.prototype._stat=function(t,e){var i=this._makeAbs(t),s="/"===t.slice(-1);if(t.length>this.maxLength)return e();if(!this.stat&&f(this.cache,i)){var r=this.cache[i];if(Array.isArray(r)&&(r="DIR"),!s||"DIR"===r)return e(null,r);if(s&&"FILE"===r)return e()}var n=this.statCache[i];if(void 0!==n){if(!1===n)return e(null,n);var o=n.isDirectory()?"DIR":"FILE";return s&&"FILE"===o?e():e(null,o,n)}var h=this,a=m("stat\0"+i,(function(s,r){if(r&&r.isSymbolicLink())return h.fs.stat(i,(function(s,n){s?h._stat2(t,i,null,r,e):h._stat2(t,i,s,n,e)}));h._stat2(t,i,s,r,e)}));a&&h.fs.lstat(i,a)},C.prototype._stat2=function(t,e,i,s,r){if(i&&("ENOENT"===i.code||"ENOTDIR"===i.code))return this.statCache[e]=!1,r();var n="/"===t.slice(-1);if(this.statCache[e]=s,"/"===e.slice(-1)&&s&&!s.isDirectory())return r(null,!1,s);var o=!0;return s&&(o=s.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||o,n&&"FILE"===o?r():r(null,o,s)}},4751:(t,e,i)=>{t.exports=f,f.GlobSync=m;var s=i(7334),r=i(1171),n=(r.Minimatch,i(2884).Glob,i(3837),i(1017)),o=i(9491),h=i(4095),a=i(6772),l=a.setopts,c=a.ownProp,u=a.childrenIgnored,d=a.isIgnored;function f(t,e){if("function"==typeof e||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");return new m(t,e).found}function m(t,e){if(!t)throw new Error("must provide pattern");if("function"==typeof e||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof m))return new m(t,e);if(l(this,t,e),this.noprocess)return this;var i=this.minimatch.set.length;this.matches=new Array(i);for(var s=0;s<i;s++)this._process(this.minimatch.set[s],s,!1);this._finish()}m.prototype._finish=function(){if(o.ok(this instanceof m),this.realpath){var t=this;this.matches.forEach((function(e,i){var r=t.matches[i]=Object.create(null);for(var n in e)try{n=t._makeAbs(n),r[s.realpathSync(n,t.realpathCache)]=!0}catch(e){if("stat"!==e.syscall)throw e;r[t._makeAbs(n)]=!0}}))}a.finish(this)},m.prototype._process=function(t,e,i){o.ok(this instanceof m);for(var s,n=0;"string"==typeof t[n];)n++;switch(n){case t.length:return void this._processSimple(t.join("/"),e);case 0:s=null;break;default:s=t.slice(0,n).join("/")}var a,l=t.slice(n);null===s?a=".":h(s)||h(t.map((function(t){return"string"==typeof t?t:"[*]"})).join("/"))?(s&&h(s)||(s="/"+s),a=s):a=s;var c=this._makeAbs(a);u(this,a)||(l[0]===r.GLOBSTAR?this._processGlobStar(s,a,c,l,e,i):this._processReaddir(s,a,c,l,e,i))},m.prototype._processReaddir=function(t,e,i,s,r,o){var h=this._readdir(i,o);if(h){for(var a=s[0],l=!!this.minimatch.negate,c=a._glob,u=this.dot||"."===c.charAt(0),d=[],f=0;f<h.length;f++)("."!==(g=h[f]).charAt(0)||u)&&(l&&!t?!g.match(a):g.match(a))&&d.push(g);var m=d.length;if(0!==m)if(1!==s.length||this.mark||this.stat)for(s.shift(),f=0;f<m;f++){var p;g=d[f],p=t?[t,g]:[g],this._process(p.concat(s),r,o)}else{this.matches[r]||(this.matches[r]=Object.create(null));for(f=0;f<m;f++){var g=d[f];t&&(g="/"!==t.slice(-1)?t+"/"+g:t+g),"/"!==g.charAt(0)||this.nomount||(g=n.join(this.root,g)),this._emitMatch(r,g)}}}},m.prototype._emitMatch=function(t,e){if(!d(this,e)){var i=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=i),!this.matches[t][e]){if(this.nodir){var s=this.cache[i];if("DIR"===s||Array.isArray(s))return}this.matches[t][e]=!0,this.stat&&this._stat(e)}}},m.prototype._readdirInGlobStar=function(t){if(this.follow)return this._readdir(t,!1);var e,i;try{i=this.fs.lstatSync(t)}catch(t){if("ENOENT"===t.code)return null}var s=i&&i.isSymbolicLink();return this.symlinks[t]=s,s||!i||i.isDirectory()?e=this._readdir(t,!1):this.cache[t]="FILE",e},m.prototype._readdir=function(t,e){if(e&&!c(this.symlinks,t))return this._readdirInGlobStar(t);if(c(this.cache,t)){var i=this.cache[t];if(!i||"FILE"===i)return null;if(Array.isArray(i))return i}try{return this._readdirEntries(t,this.fs.readdirSync(t))}catch(e){return this._readdirError(t,e),null}},m.prototype._readdirEntries=function(t,e){if(!this.mark&&!this.stat)for(var i=0;i<e.length;i++){var s=e[i];s="/"===t?t+s:t+"/"+s,this.cache[s]=!0}return this.cache[t]=e,e},m.prototype._readdirError=function(t,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var i=this._makeAbs(t);if(this.cache[i]="FILE",i===this.cwdAbs){var s=new Error(e.code+" invalid cwd "+this.cwd);throw s.path=this.cwd,s.code=e.code,s}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:if(this.cache[this._makeAbs(t)]=!1,this.strict)throw e;this.silent||console.error("glob error",e)}},m.prototype._processGlobStar=function(t,e,i,s,r,n){var o=this._readdir(i,n);if(o){var h=s.slice(1),a=t?[t]:[],l=a.concat(h);this._process(l,r,!1);var c=o.length;if(!this.symlinks[i]||!n)for(var u=0;u<c;u++)if("."!==o[u].charAt(0)||this.dot){var d=a.concat(o[u],h);this._process(d,r,!0);var f=a.concat(o[u],s);this._process(f,r,!0)}}},m.prototype._processSimple=function(t,e){var i=this._stat(t);if(this.matches[e]||(this.matches[e]=Object.create(null)),i){if(t&&h(t)&&!this.nomount){var s=/[\/\\]$/.test(t);"/"===t.charAt(0)?t=n.join(this.root,t):(t=n.resolve(this.root,t),s&&(t+="/"))}"win32"===process.platform&&(t=t.replace(/\\/g,"/")),this._emitMatch(e,t)}},m.prototype._stat=function(t){var e=this._makeAbs(t),i="/"===t.slice(-1);if(t.length>this.maxLength)return!1;if(!this.stat&&c(this.cache,e)){var s=this.cache[e];if(Array.isArray(s)&&(s="DIR"),!i||"DIR"===s)return s;if(i&&"FILE"===s)return!1}var r=this.statCache[e];if(!r){var n;try{n=this.fs.lstatSync(e)}catch(t){if(t&&("ENOENT"===t.code||"ENOTDIR"===t.code))return this.statCache[e]=!1,!1}if(n&&n.isSymbolicLink())try{r=this.fs.statSync(e)}catch(t){r=n}else r=n}return this.statCache[e]=r,s=!0,r&&(s=r.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,(!i||"FILE"!==s)&&s},m.prototype._mark=function(t){return a.mark(this,t)},m.prototype._makeAbs=function(t){return a.makeAbs(this,t)}},645:(t,e)=>{e.read=function(t,e,i,s,r){var n,o,h=8*r-s-1,a=(1<<h)-1,l=a>>1,c=-7,u=i?r-1:0,d=i?-1:1,f=t[e+u];for(u+=d,n=f&(1<<-c)-1,f>>=-c,c+=h;c>0;n=256*n+t[e+u],u+=d,c-=8);for(o=n&(1<<-c)-1,n>>=-c,c+=s;c>0;o=256*o+t[e+u],u+=d,c-=8);if(0===n)n=1-l;else{if(n===a)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,s),n-=l}return(f?-1:1)*o*Math.pow(2,n-s)},e.write=function(t,e,i,s,r,n){var o,h,a,l=8*n-r-1,c=(1<<l)-1,u=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=s?0:n-1,m=s?1:-1,p=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(h=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-o))<1&&(o--,a*=2),(e+=o+u>=1?d/a:d*Math.pow(2,1-u))*a>=2&&(o++,a/=2),o+u>=c?(h=0,o=c):o+u>=1?(h=(e*a-1)*Math.pow(2,r),o+=u):(h=e*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;t[i+f]=255&h,f+=m,h/=256,r-=8);for(o=o<<r|h,l+=r;l>0;t[i+f]=255&o,f+=m,o/=256,l-=8);t[i+f-m]|=128*p}},7844:(t,e,i)=>{var s=i(2479),r=Object.create(null),n=i(778);t.exports=s((function(t,e){return r[t]?(r[t].push(e),null):(r[t]=[e],function(t){return n((function e(){var i=r[t],s=i.length,n=function(t){for(var e=t.length,i=[],s=0;s<e;s++)i[s]=t[s];return i}(arguments);try{for(var o=0;o<s;o++)i[o].apply(null,n)}finally{i.length>s?(i.splice(0,s),process.nextTick((function(){e.apply(null,n)}))):delete r[t]}}))}(t))}))},4378:(t,e,i)=>{try{var s=i(3837);if("function"!=typeof s.inherits)throw"";t.exports=s.inherits}catch(e){t.exports=i(5717)}},5717:t=>{"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}}},6907:t=>{"use strict";t.exports=function(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=i;return e}},8738:t=>{function e(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(e(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&e(t.slice(0,0))}(t)||!!t._isBuffer)}},3720:t=>{t.exports=i;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function i(t,e,i){this.low=0|t,this.high=0|e,this.unsigned=!!i}function s(t){return!0===(t&&t.__isLong__)}i.prototype.__isLong__,Object.defineProperty(i.prototype,"__isLong__",{value:!0}),i.isLong=s;var r={},n={};function o(t,e){var i,s,o;return e?(o=0<=(t>>>=0)&&t<256)&&(s=n[t])?s:(i=a(t,(0|t)<0?-1:0,!0),o&&(n[t]=i),i):(o=-128<=(t|=0)&&t<128)&&(s=r[t])?s:(i=a(t,t<0?-1:0,!1),o&&(r[t]=i),i)}function h(t,e){if(isNaN(t))return e?y:g;if(e){if(t<0)return y;if(t>=f)return S}else{if(t<=-m)return v;if(t+1>=m)return I}return t<0?h(-t,e).neg():a(t%d|0,t/d|0,e)}function a(t,e,s){return new i(t,e,s)}i.fromInt=o,i.fromNumber=h,i.fromBits=a;var l=Math.pow;function c(t,e,i){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return g;if("number"==typeof e?(i=e,e=!1):e=!!e,(i=i||10)<2||36<i)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===s)return c(t.substring(1),e,i).neg();for(var r=h(l(i,8)),n=g,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),u=parseInt(t.substring(o,o+a),i);if(a<8){var d=h(l(i,a));n=n.mul(d).add(h(u))}else n=(n=n.mul(r)).add(h(u))}return n.unsigned=e,n}function u(t,e){return"number"==typeof t?h(t,e):"string"==typeof t?c(t,e):a(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}i.fromString=c,i.fromValue=u;var d=4294967296,f=d*d,m=f/2,p=o(1<<24),g=o(0);i.ZERO=g;var y=o(0,!0);i.UZERO=y;var w=o(1);i.ONE=w;var b=o(1,!0);i.UONE=b;var C=o(-1);i.NEG_ONE=C;var I=a(-1,2147483647,!1);i.MAX_VALUE=I;var S=a(-1,-1,!0);i.MAX_UNSIGNED_VALUE=S;var v=a(0,-2147483648,!1);i.MIN_VALUE=v;var x=i.prototype;x.toInt=function(){return this.unsigned?this.low>>>0:this.low},x.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},x.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(v)){var e=h(t),i=this.div(e),s=i.mul(e).sub(this);return i.toString(t)+s.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var r=h(l(t,6),this.unsigned),n=this,o="";;){var a=n.div(r),c=(n.sub(a.mul(r)).toInt()>>>0).toString(t);if((n=a).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},x.getHighBits=function(){return this.high},x.getHighBitsUnsigned=function(){return this.high>>>0},x.getLowBits=function(){return this.low},x.getLowBitsUnsigned=function(){return this.low>>>0},x.getNumBitsAbs=function(){if(this.isNegative())return this.eq(v)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},x.isZero=function(){return 0===this.high&&0===this.low},x.eqz=x.isZero,x.isNegative=function(){return!this.unsigned&&this.high<0},x.isPositive=function(){return this.unsigned||this.high>=0},x.isOdd=function(){return 1==(1&this.low)},x.isEven=function(){return 0==(1&this.low)},x.equals=function(t){return s(t)||(t=u(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},x.eq=x.equals,x.notEquals=function(t){return!this.eq(t)},x.neq=x.notEquals,x.ne=x.notEquals,x.lessThan=function(t){return this.comp(t)<0},x.lt=x.lessThan,x.lessThanOrEqual=function(t){return this.comp(t)<=0},x.lte=x.lessThanOrEqual,x.le=x.lessThanOrEqual,x.greaterThan=function(t){return this.comp(t)>0},x.gt=x.greaterThan,x.greaterThanOrEqual=function(t){return this.comp(t)>=0},x.gte=x.greaterThanOrEqual,x.ge=x.greaterThanOrEqual,x.compare=function(t){if(s(t)||(t=u(t)),this.eq(t))return 0;var e=this.isNegative(),i=t.isNegative();return e&&!i?-1:!e&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},x.comp=x.compare,x.negate=function(){return!this.unsigned&&this.eq(v)?v:this.not().add(w)},x.neg=x.negate,x.add=function(t){s(t)||(t=u(t));var e=this.high>>>16,i=65535&this.high,r=this.low>>>16,n=65535&this.low,o=t.high>>>16,h=65535&t.high,l=t.low>>>16,c=0,d=0,f=0,m=0;return f+=(m+=n+(65535&t.low))>>>16,d+=(f+=r+l)>>>16,c+=(d+=i+h)>>>16,c+=e+o,a((f&=65535)<<16|(m&=65535),(c&=65535)<<16|(d&=65535),this.unsigned)},x.subtract=function(t){return s(t)||(t=u(t)),this.add(t.neg())},x.sub=x.subtract,x.multiply=function(t){if(this.isZero())return g;if(s(t)||(t=u(t)),e)return a(e.mul(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned);if(t.isZero())return g;if(this.eq(v))return t.isOdd()?v:g;if(t.eq(v))return this.isOdd()?v:g;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(p)&&t.lt(p))return h(this.toNumber()*t.toNumber(),this.unsigned);var i=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,l=t.high>>>16,c=65535&t.high,d=t.low>>>16,f=65535&t.low,m=0,y=0,w=0,b=0;return w+=(b+=o*f)>>>16,y+=(w+=n*f)>>>16,w&=65535,y+=(w+=o*d)>>>16,m+=(y+=r*f)>>>16,y&=65535,m+=(y+=n*d)>>>16,y&=65535,m+=(y+=o*c)>>>16,m+=i*f+r*d+n*c+o*l,a((w&=65535)<<16|(b&=65535),(m&=65535)<<16|(y&=65535),this.unsigned)},x.mul=x.multiply,x.divide=function(t){if(s(t)||(t=u(t)),t.isZero())throw Error("division by zero");var i,r,n;if(e)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?a((this.unsigned?e.div_u:e.div_s)(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:g;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return y;if(t.gt(this.shru(1)))return b;n=y}else{if(this.eq(v))return t.eq(w)||t.eq(C)?v:t.eq(v)?w:(i=this.shr(1).div(t).shl(1)).eq(g)?t.isNegative()?w:C:(r=this.sub(t.mul(i)),n=i.add(r.div(t)));if(t.eq(v))return this.unsigned?y:g;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=g}for(r=this;r.gte(t);){i=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(i)/Math.LN2),c=o<=48?1:l(2,o-48),d=h(i),f=d.mul(t);f.isNegative()||f.gt(r);)f=(d=h(i-=c,this.unsigned)).mul(t);d.isZero()&&(d=w),n=n.add(d),r=r.sub(f)}return n},x.div=x.divide,x.modulo=function(t){return s(t)||(t=u(t)),e?a((this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,t.low,t.high),e.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},x.mod=x.modulo,x.rem=x.modulo,x.not=function(){return a(~this.low,~this.high,this.unsigned)},x.and=function(t){return s(t)||(t=u(t)),a(this.low&t.low,this.high&t.high,this.unsigned)},x.or=function(t){return s(t)||(t=u(t)),a(this.low|t.low,this.high|t.high,this.unsigned)},x.xor=function(t){return s(t)||(t=u(t)),a(this.low^t.low,this.high^t.high,this.unsigned)},x.shiftLeft=function(t){return s(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):a(0,this.low<<t-32,this.unsigned)},x.shl=x.shiftLeft,x.shiftRight=function(t){return s(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):a(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},x.shr=x.shiftRight,x.shiftRightUnsigned=function(t){if(s(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?a(this.low>>>t|e<<32-t,e>>>t,this.unsigned):a(32===t?e:e>>>t-32,0,this.unsigned)},x.shru=x.shiftRightUnsigned,x.shr_u=x.shiftRightUnsigned,x.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},x.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},x.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},x.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},x.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},i.fromBytes=function(t,e,s){return s?i.fromBytesLE(t,e):i.fromBytesBE(t,e)},i.fromBytesLE=function(t,e){return new i(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},i.fromBytesBE=function(t,e){return new i(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)}},1171:(t,e,i)=>{t.exports=d,d.Minimatch=f;var s=function(){try{return i(1017)}catch(t){}}()||{sep:"/"};d.sep=s.sep;var r=d.GLOBSTAR=f.GLOBSTAR={},n=i(3644),o={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},h="[^/]",a=h+"*?",l="().*{}+?[]^$\\!".split("").reduce((function(t,e){return t[e]=!0,t}),{}),c=/\/+/;function u(t,e){e=e||{};var i={};return Object.keys(t).forEach((function(e){i[e]=t[e]})),Object.keys(e).forEach((function(t){i[t]=e[t]})),i}function d(t,e,i){return p(e),i||(i={}),!(!i.nocomment&&"#"===e.charAt(0))&&new f(e,i).match(t)}function f(t,e){if(!(this instanceof f))return new f(t,e);p(t),e||(e={}),t=t.trim(),e.allowWindowsEscape||"/"===s.sep||(t=t.split(s.sep).join("/")),this.options=e,this.set=[],this.pattern=t,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.make()}function m(t,e){return e||(e=this instanceof f?this.options:{}),t=void 0===t?this.pattern:t,p(t),e.nobrace||!/\{(?:(?!\{).)*\}/.test(t)?[t]:n(t)}d.filter=function(t,e){return e=e||{},function(i,s,r){return d(i,t,e)}},d.defaults=function(t){if(!t||"object"!=typeof t||!Object.keys(t).length)return d;var e=d,i=function(i,s,r){return e(i,s,u(t,r))};return(i.Minimatch=function(i,s){return new e.Minimatch(i,u(t,s))}).defaults=function(i){return e.defaults(u(t,i)).Minimatch},i.filter=function(i,s){return e.filter(i,u(t,s))},i.defaults=function(i){return e.defaults(u(t,i))},i.makeRe=function(i,s){return e.makeRe(i,u(t,s))},i.braceExpand=function(i,s){return e.braceExpand(i,u(t,s))},i.match=function(i,s,r){return e.match(i,s,u(t,r))},i},f.defaults=function(t){return d.defaults(t).Minimatch},f.prototype.debug=function(){},f.prototype.make=function(){var t=this.pattern,e=this.options;if(e.nocomment||"#"!==t.charAt(0))if(t){this.parseNegate();var i=this.globSet=this.braceExpand();e.debug&&(this.debug=function(){console.error.apply(console,arguments)}),this.debug(this.pattern,i),i=this.globParts=i.map((function(t){return t.split(c)})),this.debug(this.pattern,i),i=i.map((function(t,e,i){return t.map(this.parse,this)}),this),this.debug(this.pattern,i),i=i.filter((function(t){return-1===t.indexOf(!1)})),this.debug(this.pattern,i),this.set=i}else this.empty=!0;else this.comment=!0},f.prototype.parseNegate=function(){var t=this.pattern,e=!1,i=0;if(!this.options.nonegate){for(var s=0,r=t.length;s<r&&"!"===t.charAt(s);s++)e=!e,i++;i&&(this.pattern=t.substr(i)),this.negate=e}},d.braceExpand=function(t,e){return m(t,e)},f.prototype.braceExpand=m;var p=function(t){if("string"!=typeof t)throw new TypeError("invalid pattern");if(t.length>65536)throw new TypeError("pattern is too long")};f.prototype.parse=function(t,e){p(t);var i=this.options;if("**"===t){if(!i.noglobstar)return r;t="*"}if(""===t)return"";var s,n="",c=!!i.nocase,u=!1,d=[],f=[],m=!1,y=-1,w=-1,b="."===t.charAt(0)?"":i.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",C=this;function I(){if(s){switch(s){case"*":n+=a,c=!0;break;case"?":n+=h,c=!0;break;default:n+="\\"+s}C.debug("clearStateChar %j %j",s,n),s=!1}}for(var S,v=0,x=t.length;v<x&&(S=t.charAt(v));v++)if(this.debug("%s\t%s %s %j",t,v,n,S),u&&l[S])n+="\\"+S,u=!1;else switch(S){case"/":return!1;case"\\":I(),u=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",t,v,n,S),m){this.debug("  in class"),"!"===S&&v===w+1&&(S="^"),n+=S;continue}C.debug("call clearStateChar %j",s),I(),s=S,i.noext&&I();continue;case"(":if(m){n+="(";continue}if(!s){n+="\\(";continue}d.push({type:s,start:v-1,reStart:n.length,open:o[s].open,close:o[s].close}),n+="!"===s?"(?:(?!(?:":"(?:",this.debug("plType %j %j",s,n),s=!1;continue;case")":if(m||!d.length){n+="\\)";continue}I(),c=!0;var T=d.pop();n+=T.close,"!"===T.type&&f.push(T),T.reEnd=n.length;continue;case"|":if(m||!d.length||u){n+="\\|",u=!1;continue}I(),n+="|";continue;case"[":if(I(),m){n+="\\"+S;continue}m=!0,w=v,y=n.length,n+=S;continue;case"]":if(v===w+1||!m){n+="\\"+S,u=!1;continue}var A=t.substring(w+1,v);try{RegExp("["+A+"]")}catch(t){var k=this.parse(A,g);n=n.substr(0,y)+"\\["+k[0]+"\\]",c=c||k[1],m=!1;continue}c=!0,m=!1,n+=S;continue;default:I(),u?u=!1:!l[S]||"^"===S&&m||(n+="\\"),n+=S}for(m&&(A=t.substr(w+1),k=this.parse(A,g),n=n.substr(0,y)+"\\["+k[0],c=c||k[1]),T=d.pop();T;T=d.pop()){var B=n.slice(T.reStart+T.open.length);this.debug("setting tail",n,T),B=B.replace(/((?:\\{2}){0,64})(\\?)\|/g,(function(t,e,i){return i||(i="\\"),e+e+i+"|"})),this.debug("tail=%j\n   %s",B,B,T,n);var L="*"===T.type?a:"?"===T.type?h:"\\"+T.type;c=!0,n=n.slice(0,T.reStart)+L+"\\("+B}I(),u&&(n+="\\\\");var M=!1;switch(n.charAt(0)){case"[":case".":case"(":M=!0}for(var E=f.length-1;E>-1;E--){var _=f[E],Y=n.slice(0,_.reStart),P=n.slice(_.reStart,_.reEnd-8),j=n.slice(_.reEnd-8,_.reEnd),D=n.slice(_.reEnd);j+=D;var X=Y.split("(").length-1,O=D;for(v=0;v<X;v++)O=O.replace(/\)[+*?]?/,"");var R="";""===(D=O)&&e!==g&&(R="$"),n=Y+P+D+R+j}if(""!==n&&c&&(n="(?=.)"+n),M&&(n=b+n),e===g)return[n,c];if(!c)return t.replace(/\\(.)/g,"$1");var U=i.nocase?"i":"";try{var N=new RegExp("^"+n+"$",U)}catch(t){return new RegExp("$.")}return N._glob=t,N._src=n,N};var g={};d.makeRe=function(t,e){return new f(t,e||{}).makeRe()},f.prototype.makeRe=function(){if(this.regexp||!1===this.regexp)return this.regexp;var t=this.set;if(!t.length)return this.regexp=!1,this.regexp;var e=this.options,i=e.noglobstar?a:e.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",s=e.nocase?"i":"",n=t.map((function(t){return t.map((function(t){return t===r?i:"string"==typeof t?t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):t._src})).join("\\/")})).join("|");n="^(?:"+n+")$",this.negate&&(n="^(?!"+n+").*$");try{this.regexp=new RegExp(n,s)}catch(t){this.regexp=!1}return this.regexp},d.match=function(t,e,i){var s=new f(e,i=i||{});return t=t.filter((function(t){return s.match(t)})),s.options.nonull&&!t.length&&t.push(e),t},f.prototype.match=function(t,e){if(void 0===e&&(e=this.partial),this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return""===t;if("/"===t&&e)return!0;var i=this.options;"/"!==s.sep&&(t=t.split(s.sep).join("/")),t=t.split(c),this.debug(this.pattern,"split",t);var r,n,o=this.set;for(this.debug(this.pattern,"set",o),n=t.length-1;n>=0&&!(r=t[n]);n--);for(n=0;n<o.length;n++){var h=o[n],a=t;if(i.matchBase&&1===h.length&&(a=[r]),this.matchOne(a,h,e))return!!i.flipNegate||!this.negate}return!i.flipNegate&&this.negate},f.prototype.matchOne=function(t,e,i){var s=this.options;this.debug("matchOne",{this:this,file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var n=0,o=0,h=t.length,a=e.length;n<h&&o<a;n++,o++){this.debug("matchOne loop");var l,c=e[o],u=t[n];if(this.debug(e,c,u),!1===c)return!1;if(c===r){this.debug("GLOBSTAR",[e,c,u]);var d=n,f=o+1;if(f===a){for(this.debug("** at the end");n<h;n++)if("."===t[n]||".."===t[n]||!s.dot&&"."===t[n].charAt(0))return!1;return!0}for(;d<h;){var m=t[d];if(this.debug("\nglobstar while",t,d,e,f,m),this.matchOne(t.slice(d),e.slice(f),i))return this.debug("globstar found match!",d,h,m),!0;if("."===m||".."===m||!s.dot&&"."===m.charAt(0)){this.debug("dot detected!",t,d,e,f);break}this.debug("globstar swallow a segment, and continue"),d++}return!(!i||(this.debug("\n>>> no match, partial?",t,d,e,f),d!==h))}if("string"==typeof c?(l=u===c,this.debug("string match",c,u,l)):(l=u.match(c),this.debug("pattern match",c,u,l)),!l)return!1}if(n===h&&o===a)return!0;if(n===h)return i;if(o===a)return n===h-1&&""===t[n];throw new Error("wtf?")}},2861:(t,e,i)=>{var s=i(6907),r=i(8738),n="undefined"!=typeof Float64Array;function o(t,e){return t[0]-e[0]}function h(){var t,e=this.stride,i=new Array(e.length);for(t=0;t<i.length;++t)i[t]=[Math.abs(e[t]),t];i.sort(o);var s=new Array(i.length);for(t=0;t<s.length;++t)s[t]=i[t][1];return s}function a(t,e){var i=["View",e,"d",t].join("");e<0&&(i="View_Nil"+t);var r="generic"===t;if(-1===e){var n="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(n)()}if(0===e)return n="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}",new Function("TrivialArray",n)(l[t][0]);n=["'use strict'"];var o=s(e),a=o.map((function(t){return"i"+t})),c="this.offset+"+o.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),u=o.map((function(t){return"b"+t})).join(","),d=o.map((function(t){return"c"+t})).join(",");n.push("function "+i+"(a,"+u+","+d+",d){this.data=a","this.shape=["+u+"]","this.stride=["+d+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),n.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+o.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===e?n.push("proto.order=[0]"):(n.push("Object.defineProperty(proto,'order',{get:"),e<4?(n.push("function "+i+"_order(){"),2===e?n.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&n.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):n.push("ORDER})")),n.push("proto.set=function "+i+"_set("+a.join(",")+",v){"),r?n.push("return this.data.set("+c+",v)}"):n.push("return this.data["+c+"]=v}"),n.push("proto.get=function "+i+"_get("+a.join(",")+"){"),r?n.push("return this.data.get("+c+")}"):n.push("return this.data["+c+"]}"),n.push("proto.index=function "+i+"_index(",a.join(),"){return "+c+"}"),n.push("proto.hi=function "+i+"_hi("+a.join(",")+"){return new "+i+"(this.data,"+o.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+o.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var f=o.map((function(t){return"a"+t+"=this.shape["+t+"]"})),m=o.map((function(t){return"c"+t+"=this.stride["+t+"]"}));n.push("proto.lo=function "+i+"_lo("+a.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+m.join(","));for(var p=0;p<e;++p)n.push("if(typeof i"+p+"==='number'&&i"+p+">=0){d=i"+p+"|0;b+=c"+p+"*d;a"+p+"-=d}");for(n.push("return new "+i+"(this.data,"+o.map((function(t){return"a"+t})).join(",")+","+o.map((function(t){return"c"+t})).join(",")+",b)}"),n.push("proto.step=function "+i+"_step("+a.join(",")+"){var "+o.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+o.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),p=0;p<e;++p)n.push("if(typeof i"+p+"==='number'){d=i"+p+"|0;if(d<0){c+=b"+p+"*(a"+p+"-1);a"+p+"=ceil(-a"+p+"/d)}else{a"+p+"=ceil(a"+p+"/d)}b"+p+"*=d}");n.push("return new "+i+"(this.data,"+o.map((function(t){return"a"+t})).join(",")+","+o.map((function(t){return"b"+t})).join(",")+",c)}");var g=new Array(e),y=new Array(e);for(p=0;p<e;++p)g[p]="a[i"+p+"]",y[p]="b[i"+p+"]";for(n.push("proto.transpose=function "+i+"_transpose("+a+"){"+a.map((function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+g.join(",")+","+y.join(",")+",this.offset)}"),n.push("proto.pick=function "+i+"_pick("+a+"){var a=[],b=[],c=this.offset"),p=0;p<e;++p)n.push("if(typeof i"+p+"==='number'&&i"+p+">=0){c=(c+this.stride["+p+"]*i"+p+")|0}else{a.push(this.shape["+p+"]);b.push(this.stride["+p+"])}");return n.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),n.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+o.map((function(t){return"shape["+t+"]"})).join(",")+","+o.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",n.join("\n"))(l[t],h)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,e,i,s){if(void 0===t)return(0,l.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var o=e.length;if(void 0===i){i=new Array(o);for(var h=o-1,c=1;h>=0;--h)i[h]=c,c*=e[h]}if(void 0===s)for(s=0,h=0;h<o;++h)i[h]<0&&(s-=(e[h]-1)*i[h]);for(var u=function(t){if(r(t))return"buffer";if(n)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),d=l[u];d.length<=o+1;)d.push(a(u,d.length-1));return(0,d[o+1])(t,e,i,s)}},778:(t,e,i)=>{var s=i(2479);function r(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function n(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},i=t.name||"Function wrapped with `once`";return e.onceError=i+" shouldn't be called more than once",e.called=!1,e}t.exports=s(r),t.exports.strict=s(n),r.proto=r((function(){Object.defineProperty(Function.prototype,"once",{value:function(){return r(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return n(this)},configurable:!0})}))},4095:t=>{"use strict";function e(t){return"/"===t.charAt(0)}function i(t){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/.exec(t),i=e[1]||"",s=Boolean(i&&":"!==i.charAt(1));return Boolean(e[2]||s)}t.exports="win32"===process.platform?i:e,t.exports.posix=e,t.exports.win32=i},7175:function(t){t.exports=function(){"use strict";class t{constructor(t){this.init(t)}init(t){this.option=Object.assign({},{inputCodec:"Int16",channels:1,sampleRate:8e3,flushTime:1e3},t),this.samples=new Float32Array,this.interval=setInterval(this.flush.bind(this),this.option.flushTime),this.convertValue=this.getConvertValue(),this.typedArray=this.getTypedArray(),this.initAudioContext()}getConvertValue(){const t={Int8:128,Int16:32768,Int32:2147483648,Float32:1};if(!t[this.option.inputCodec])throw new Error("wrong codec.please input one of these codecs:Int8,Int16,Int32,Float32");return t[this.option.inputCodec]}getTypedArray(){const t={Int8:Int8Array,Int16:Int16Array,Int32:Int32Array,Float32:Float32Array};if(!t[this.option.inputCodec])throw new Error("wrong codec.please input one of these codecs:Int8,Int16,Int32,Float32");return t[this.option.inputCodec]}initAudioContext(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=10,this.gainNode.connect(this.audioCtx.destination),this.startTime=this.audioCtx.currentTime}static isTypedArray(t){return t.byteLength&&t.buffer&&t.buffer.constructor==ArrayBuffer||t.constructor==ArrayBuffer}isSupported(e){if(!t.isTypedArray(e))throw new Error("请传入ArrayBuffer或者任意TypedArray");return!0}feed(t){this.isSupported(t),t=this.getFormatedValue(t);const e=new Float32Array(this.samples.length+t.length);e.set(this.samples,0),e.set(t,this.samples.length),this.samples=e}getFormatedValue(t){t=t.constructor==ArrayBuffer?new this.typedArray(t):new this.typedArray(t.buffer);let e=new Float32Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i]/this.convertValue;return e}volume(t){this.gainNode.gain.value=t}destroy(){this.interval&&clearInterval(this.interval),this.samples=null,this.audioCtx.close(),this.audioCtx=null}flush(){if(!this.samples.length)return;var t=this.audioCtx.createBufferSource();const e=this.samples.length/this.option.channels,i=this.audioCtx.createBuffer(this.option.channels,e,this.option.sampleRate);for(let t=0;t<this.option.channels;t++){const s=i.getChannelData(t);let r=t,n=50;for(let t=0;t<e;t++)s[t]=this.samples[r],t<50&&(s[t]=s[t]*t/50),t>=e-51&&(s[t]=s[t]*n--/50),r+=this.option.channels}this.startTime<this.audioCtx.currentTime&&(this.startTime=this.audioCtx.currentTime),console.log("start vs current "+this.startTime+" vs "+this.audioCtx.currentTime+" duration: "+i.duration),t.buffer=i,t.connect(this.gainNode),t.start(this.startTime),this.startTime+=i.duration,this.samples=new Float32Array}async pause(){await this.audioCtx.suspend()}async continue(){await this.audioCtx.resume()}}return t}()},8396:(t,e,i)=>{!function(){"use strict";var e=i(6113),s=i(9491),r=e.pseudoRandomBytes||e.randomBytes,n="0123456789",o="abcdefghijklmnopqrstuvwxyz",h=o.toUpperCase(),a=n+h+o;function l(t){s(t),s("string"==typeof t),s(t.length>0),s(t.length<256)}function c(t){switch(s(!t||"object"==typeof t),(t=t||{}).chars=t.chars||"default",t.source=t.source||"default",t.chars){case"default":t.chars=a;break;case"a-z":case"alpha":t.chars=o;break;case"A-Z":case"ALPHA":t.chars=h;break;case"0-9":case"numeric":t.chars=n;break;case"base32":t.chars=h+"234567"}switch(l(t.chars),t.source){case"default":t.source=r;break;case"crypto":t.source=e.randomBytes;break;case"math":t.source=function(t){for(var e=function(t){return Buffer.alloc?Buffer.alloc(t):new Buffer(t)}(t),i=0;i<t;i++)e.writeUInt8(Math.floor(256*Math.random()),i);return e};break;default:s("function"==typeof t.source)}return{generate:function(e,i){i?l(i):i=t.chars;for(var s=Math.floor(256/i.length)*i.length,r="";r.length<e;)for(var n=t.source(e-r.length),o=0;o<n.length;o++){var h=n.readUInt8(o);h<s&&(r+=i[h%i.length])}return r}}}var u=c();t.exports={generator:c,generate:u.generate,uid:u.generate,suid:function(t,e,i){return function(t,e){for(var i=function(t){s(t>=0),t=Math.floor(t);var e=[];do{var i=t%62;e.push(a[i]),t=Math.floor(t/62)}while(t>0);return e.reverse().join("")}(Date.now()-t);i.length<e;)i="0"+i;return i}(e=e||9466848e5,i=i||8)+u.generate(t)}}}()},9508:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>s});const s=class{_checkHeader(){const t=this.header;if(0===t.imageType)throw Error("No data");if(t.hasColorMap){if(t.colorMapLength>256||24!==t.colorMapDepth||1!==t.colorMapType)throw Error("Invalid colormap for indexed type")}else if(t.colorMapType)throw Error("Why does the image contain a palette ?");if(!t.width||!t.height)throw Error("Invalid image size");if(8!==t.pixelDepth&&16!==t.pixelDepth&&24!==t.pixelDepth&&32!==t.pixelDepth)throw Error('Invalid pixel size "'+t.pixelDepth+'"')}_decodeRLE(t,e,i,s){const r=new Uint8Array(s),n=new Uint8Array(i);let o=0;for(;o<s;){const s=t[e++];let h=1+(127&s);if(128&s){for(let s=0;s<i;++s)n[s]=t[e+s];e+=i;for(let t=0;t<h;++t)r.set(n,o),o+=i}else{h*=i;for(let i=0;i<h;++i)r[o+i]=t[e+i];o+=h,e+=h}}return r}_getImageData8bits(t,e,i,s,r,n,o,h,a,l){for(let c=0,u=r;u!==o;u+=n)for(let r=h;r!==l;r+=a,c++){const n=e[c];t[4*(r+s*u)+3]=255,t[4*(r+s*u)+2]=i[3*n+0],t[4*(r+s*u)+1]=i[3*n+1],t[4*(r+s*u)+0]=i[3*n+2]}return t}_getImageData16bits(t,e,i,s,r,n,o,h,a,l){for(let i=0,c=r;c!==o;c+=n)for(let r=h;r!==l;r+=a,i+=2){const n=e[i+0]|e[i+1]<<8;t[4*(r+s*c)+0]=(31744&n)>>7,t[4*(r+s*c)+1]=(992&n)>>2,t[4*(r+s*c)+2]=(31&n)>>3,t[4*(r+s*c)+3]=32768&n?0:255}return t}_getImageData24bits(t,e,i,s,r,n,o,h,a,l){for(let i=0,c=r;c!==o;c+=n)for(let r=h;r!==l;r+=a,i+=3)t[4*(r+s*c)+3]=255,t[4*(r+s*c)+2]=e[i+0],t[4*(r+s*c)+1]=e[i+1],t[4*(r+s*c)+0]=e[i+2];return t}_getImageData32bits(t,e,i,s,r,n,o,h,a,l){for(let i=0,c=r;c!==o;c+=n)for(let r=h;r!==l;r+=a,i+=4)t[4*(r+s*c)+2]=e[i+0],t[4*(r+s*c)+1]=e[i+1],t[4*(r+s*c)+0]=e[i+2],t[4*(r+s*c)+3]=e[i+3];return t}_getImageDataGrey8bits(t,e,i,s,r,n,o,h,a,l){for(let i=0,c=r;c!==o;c+=n)for(let r=h;r!==l;r+=a,i++){const n=e[i];t[4*(r+s*c)+0]=n,t[4*(r+s*c)+1]=n,t[4*(r+s*c)+2]=n,t[4*(r+s*c)+3]=255}return t}_getImageDataGrey16bits(t,e,i,s,r,n,o,h,a,l){for(let i=0,c=r;c!==o;c+=n)for(let r=h;r!==l;r+=a,i+=2)t[4*(r+s*c)+0]=e[i+0],t[4*(r+s*c)+1]=e[i+0],t[4*(r+s*c)+2]=e[i+0],t[4*(r+s*c)+3]=e[i+1];return t}open(t,e){const i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",t,!0),i.onload=()=>{200===i.status&&(this.load(new Uint8Array(i.response)),e&&e())},i.send(null)}load(t){let e=0;if(t.length<18)throw Error("Not enough data to contain header");const i={idLength:t[e++],colorMapType:t[e++],imageType:t[e++],colorMapIndex:t[e++]|t[e++]<<8,colorMapLength:t[e++]|t[e++]<<8,colorMapDepth:t[e++],offsetX:t[e++]|t[e++]<<8,offsetY:t[e++]|t[e++]<<8,width:t[e++]|t[e++]<<8,height:t[e++]|t[e++]<<8,pixelDepth:t[e++],flags:t[e++]};if(i.hasEncoding=9===i.imageType||10===i.imageType||11===i.imageType,i.hasColorMap=9===i.imageType||1===i.imageType,i.isGreyColor=11===i.imageType||3===i.imageType,this.header=i,this._checkHeader(),(e+=i.idLength)>=t.length)throw Error("No data");if(i.hasColorMap){const s=i.colorMapLength*(i.colorMapDepth>>3);this.palette=t.subarray(e,e+s),e+=s}const s=i.pixelDepth>>3,r=i.width*i.height,n=r*s;i.hasEncoding?this.imageData=this._decodeRLE(t,e,s,n):this.imageData=t.subarray(e,e+(i.hasColorMap?r:n))}getImageData(t){const{width:e,height:i,flags:s,pixelDepth:r,isGreyColor:n}=this.header,o=(48&s)>>4;let h,a,l,c,u,d,f;switch(t||(t=document?document.createElement("canvas").getContext("2d").createImageData(e,i):{width:e,height:i,data:new Uint8ClampedArray(e*i*4)}),2===o||3===o?(c=0,u=1,d=i):(c=i-1,u=-1,d=-1),2===o||0===o?(h=0,a=1,l=e):(h=e-1,a=-1,l=-1),r){case 8:f=n?this._getImageDataGrey8bits:this._getImageData8bits;break;case 16:f=n?this._getImageDataGrey16bits:this._getImageData16bits;break;case 24:f=this._getImageData24bits;break;case 32:f=this._getImageData32bits}return f.call(this,t.data,this.imageData,this.palette,e,c,u,d,h,a,l),t}getCanvas(){const{width:t,height:e}=this.header,i=document.createElement("canvas"),s=i.getContext("2d"),r=s.createImageData(t,e);return i.width=t,i.height=e,s.putImageData(this.getImageData(r),0,0),i}getDataURL(t){return this.getCanvas().toDataURL(t||"image/png")}}},2479:t=>{t.exports=function t(e,i){if(e&&i)return t(e)(i);if("function"!=typeof e)throw new TypeError("need wrapper function");return Object.keys(e).forEach((function(t){s[t]=e[t]})),s;function s(){for(var t=new Array(arguments.length),i=0;i<t.length;i++)t[i]=arguments[i];var s=e.apply(this,t),r=t[t.length-1];return"function"==typeof s&&s!==r&&Object.keys(r).forEach((function(t){s[t]=r[t]})),s}}},9491:t=>{"use strict";t.exports=require("assert")},4300:t=>{"use strict";t.exports=require("buffer")},6113:t=>{"use strict";t.exports=require("crypto")},2361:t=>{"use strict";t.exports=require("events")},7147:t=>{"use strict";t.exports=require("fs")},1017:t=>{"use strict";t.exports=require("path")},3837:t=>{"use strict";t.exports=require("util")},5583:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>n});var s=setTimeout;function r(t,e){var i=e.useCachedSetTimeout?s:setTimeout;return new Promise((function(e){i(e,t)}))}const n=function(t){var e=r(t,{useCachedSetTimeout:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).useCachedSetTimeout});function i(t){return e.then((function(){return t}))}return i.then=function(){return e.then.apply(e,arguments)},i.catch=Promise.resolve().catch,i}},7278:t=>{"use strict";t.exports=JSON.parse('{"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,"BACKSPACE":8,"TAB":9,"ENTER":13,"SPACE":32,"SHIFT":16,"CTRL":17,"ALT":18,"PAUSE_BREAK":19,"CAPS_LOCK":20,"ESCAPE":27,"PAGE_UP":33,"PAGE_DOWN":34,"END":35,"HOME":36,"LEFT_ARROW":37,"UP_ARROW":38,"RIGHT_ARROW":39,"DOWN_ARROW":40,"INSERT":45,"DELETE":46,"A":65,"B":66,"C":67,"D":68,"E":69,"F":70,"G":71,"H":72,"I":73,"J":74,"K":75,"L":76,"M":77,"N":78,"O":79,"P":80,"Q":81,"R":82,"S":83,"T":84,"U":85,"V":86,"W":87,"X":88,"Y":89,"Z":90,"LEFT_WINDOW_KEY":91,"RIGHT_WINDOW_KEY":92,"SELECT_KEY":93,"NUMPAD_0":96,"NUMPAD_1":97,"NUMPAD_2":98,"NUMPAD_3":99,"NUMPAD_4":100,"NUMPAD_5":101,"NUMPAD_6":102,"NUMPAD_7":103,"NUMPAD_8":104,"NUMPAD_9":105,"MULTIPLY":106,"ADD":107,"SUBTRACT":109,"DECIMAL_POINT":110,"DIVIDE":111,"F1":112,"F2":113,"F3":114,"F4":115,"F5":116,"F6":117,"F7":118,"F8":119,"F9":120,"F10":121,"F11":122,"F12":123,"NUM_LOCK":144,"SCROLL_LOCK":145,"SEMI_COLON":186,"EQUAL_SIGN":187,"COMMA":188,"DASH":189,"PERIOD":190,"FORWARD_SLASH":191,"GRAVE_ACCENT":192,"OPEN_BRACKET":219,"BACK_SLASH":220,"CLOSE_BRAKET":221,"SINGLE_QUOTE":222}')},8576:t=>{"use strict";t.exports=JSON.parse('{"APPEARANCE":235,"BANK_CLOSE":212,"BANK_DEPOSIT":23,"BANK_WITHDRAW":22,"CAST_GROUND":158,"CAST_GROUNDITEM":249,"CAST_INVITEM":4,"CAST_NPC":50,"CAST_OBJECT":99,"CAST_PLAYER":229,"CAST_SELF":137,"CAST_WALLOBJECT":180,"CHANGE_PASSWORD":25,"CHAT":216,"CHOOSE_OPTION":116,"CLOSE_CONNECTION":31,"COMBAT_STYLE":29,"COMMAND":38,"DUEL_ACCEPT":176,"DUEL_CONFIRM_ACCEPT":77,"DUEL_DECLINE":197,"DUEL_ITEM_UPDATE":33,"DUEL_SETTINGS":8,"FRIEND_ADD":195,"FRIEND_REMOVE":167,"GROUNDITEM_TAKE":247,"IGNORE_ADD":132,"IGNORE_REMOVE":241,"INV_CMD":90,"INV_DROP":246,"INV_UNEQUIP":170,"INV_WEAR":169,"KNOWN_PLAYERS":163,"LOGIN":0,"LOGOUT":102,"NPC_ATTACK":190,"NPC_CMD":202,"NPC_TALK":153,"OBJECT_CMD1":136,"OBJECT_CMD2":79,"PACKET_EXCEPTION":3,"PING":67,"PLAYER_ATTACK":171,"PLAYER_DUEL":103,"PLAYER_FOLLOW":165,"PLAYER_TRADE":142,"PM":218,"PRAYER_OFF":254,"PRAYER_ON":60,"RECOVER_CANCEL":196,"RECOVER_GET_QUESTIONS":233,"RECOVER_REQUEST":220,"RECOVER_SET":208,"RECOVER_SET_REQUEST":203,"REGISTER":2,"REPORT_ABUSE":206,"SESSION":32,"SETTINGS_GAME":111,"SETTINGS_PRIVACY":64,"SHOP_BUY":236,"SHOP_CLOSE":166,"SHOP_SELL":221,"SLEEP_WORD":45,"TRADE_ACCEPT":55,"TRADE_CONFIRM_ACCEPT":104,"TRADE_DECLINE":230,"TRADE_ITEM_UPDATE":46,"USEWITH_GROUNDITEM":53,"USEWITH_INVITEM":91,"USEWITH_NPC":135,"USEWITH_OBJECT":115,"USEWITH_PLAYER":113,"USEWITH_WALLOBJECT":161,"WALK":187,"WALK_ACTION":16,"WALL_OBJECT_COMMAND1":14,"WALL_OBJECT_COMMAND2":127}')},7808:t=>{"use strict";t.exports=JSON.parse('{"CLIENT":204,"CONFIG":85,"ENTITY":24,"FILTER":2,"FONTS":1,"MAPS":63,"MEDIA":58,"MODELS":36,"SOUNDS":1,"TEXTURES":17}')}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,i),n.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=i(9923);if("undefined"==typeof window)throw new Error("rsc-client needs to run in a browser");(async()=>{const e=document.createElement("div"),i=window.location.hash.slice(1).split(","),s=new t(e);window.mcOptions=s.options,Object.assign(s.options,{middleClickCamera:!0,mouseWheel:!0,resetCompass:!0,zoomCamera:!0,accountManagement:!0,mobile:!1}),s.members="members"===i[0],s.server=i[1]?i[1]:"127.0.0.1",s.port=i[2]&&!isNaN(+i[2])?+i[2]:43595,s.threadSleep=10,document.body.appendChild(e);const r=document.createElement("button");r.innerText="Fullscreen",r.onclick=()=>{e.requestFullscreen()},document.body.appendChild(r),await s.startApplication(1024,692,"Runescape by Andrew Gower")})()})()})();